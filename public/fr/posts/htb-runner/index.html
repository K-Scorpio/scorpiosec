<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Runner</title>
<meta name=description content="Platforme: Hack The Box Lien: Runner Niveau: Moyen OS: Linux Runner débute avec un site web présentant des solutions CI/CD. Grâce à l&amp;rsquo;énumération des …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/fr/posts/htb-runner/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Runner"><meta property="og:description" content="Platforme: Hack The Box Lien: Runner Niveau: Moyen OS: Linux Runner débute avec un site web présentant des solutions CI/CD. Grâce à l&amp;rsquo;énumération des …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Runner/Runner.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Runner/Runner.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Runner"><meta name=twitter:description content="Platforme: Hack The Box Lien: Runner Niveau: Moyen OS: Linux Runner débute avec un site web présentant des solutions CI/CD. Grâce à l&amp;rsquo;énumération des …"><meta property="twitter:domain" content="https://scorpiosec.com/fr/posts/htb-runner/"><meta property="twitter:url" content="https://scorpiosec.com/fr/posts/htb-runner/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Runner/Runner.png"><link rel=canonical href=https://scorpiosec.com/fr/posts/htb-runner/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/fr/posts/ aria-label=posts><span data-feather=book></span> Postes</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/projects/ aria-label=projects><span data-feather=code></span> Projets</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/categories/ aria-label=categories><span data-feather=folder></span> Catégories</a></div><div class=nav-link><a href=https://scorpiosec.com/ aria-label></a></div><div class="nav-link language-switcher"><a href=/posts/htb-runner/>English</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/fr/posts/><span data-feather=book></span> Postes</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/projects/><span data-feather=code></span> Projets</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/categories/><span data-feather=folder></span> Catégories</a></li><li class=nav-item><a href=https://scorpiosec.com/></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Runner</h1><small role=doc-subtitle></small><p class=post-date>6 min read |
<span class=post-date>22 Août 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/fr/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platforme: Hack The Box</li><li>Lien: <a href=https://app.hackthebox.com/machines/Runner>Runner</a></li><li>Niveau: Moyen</li><li>OS: Linux</li></ul><hr><p>Runner débute avec un site web présentant des solutions CI/CD. Grâce à l&rsquo;énumération des sous-domaines, nous découvrons une instance TeamCity vulnérable (CVE-2023-42793), ce qui nous permet d&rsquo;y accéder. Une archive de sauvegarde téléchargée depuis cette instance révèle une clé SSH privée et des hachages de mots de passe. En utilisant la clé SSH, nous obtenons un accès initial et récupérons le fichier <code>user.txt</code>. Après l&rsquo;énumération du system cible nous trouvons un autre sous-domaine hébergeant une instance de Portainer.io, à laquelle nous accédons en utilisant les informations d&rsquo;identification récupérées précédemment. L&rsquo;escalade des privilèges est réalisée en exploitant un montage bind, permettant l&rsquo;accès au répertoire racine de la machine cible via le conteneur.</p><p>Addresse IP cible - <code>10.10.11.13</code></p><h2 id=balayage>Balayage</h2><blockquote><p>J&rsquo;utilise un script pour la phase de balayage, vous pouvez le trouver <a href=https://github.com/K-Scorpio/scripts-collection/blob/main/nmap_scan.sh>ici</a> . Les commandes que j&rsquo;utilise sont souvent les mêmes, ce qui me facilite la tâche.</p></blockquote><pre tabindex=0><code>./nmap_scan.sh 10.10.11.13 Runner
</code></pre><p><strong>Résultats</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Running detailed scan on open ports: 22,80,8000
</span></span><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-08-22 19:23 CDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.13
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.054s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE     VERSION
</span></span><span style=display:flex><span>22/tcp   open  ssh         OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 <span style=color:#56b6c2>(</span>Ubuntu Linux; protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>80/tcp   open  http        nginx 1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://runner.htb/
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>8000/tcp open  nagios-nsca Nagios NSCA
</span></span><span style=display:flex><span>|_http-title: Site doesn&#39;t have a title <span style=color:#56b6c2>(</span>text/plain; <span style=color:#e06c75>charset</span><span style=color:#56b6c2>=</span>utf-8<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 9.64 seconds
</span></span></code></pre></div><p>Le scan détecte trois ports ouverts : 22 (SSH), 80 (HTTP avec Nginx), et 8000 (nagios-nsca).
Il y a aussi une redirection vers <code>runner.htb</code>.</p><p>Mettons à jour notre fichier hosts.</p><pre tabindex=0><code>sudo echo &#34;10.10.11.13 runner.htb&#34; | sudo tee -a /etc/hosts
</code></pre><h2 id=enumération>Enumération</h2><p>Nous découvrons le site web d&rsquo;une entreprise proposant des solutions CI/CD à l&rsquo;adresse <code>http://runner.htb</code>. Ce site ne présente aucune fonctionnalité que nous pourrions exploiter et l&rsquo;énumération des répertoires ne produit rien d&rsquo;utile pour <code>http://runner.htb</code>.</p><p><img src=/images/HTB-Runner/runner-website.png alt="Runner website"></p><p>Avec l&rsquo;énumération des sous-domaines, nous trouvons <code>teamcity</code> que nous ajoutons à notre fichier <code>/etc/hosts</code>.</p><pre tabindex=0><code>ffuf -c -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -t 100 -u http://runner.htb -H &#34;Host: FUZZ.runner.htb&#34; -ic -fs 154
</code></pre><p><img src=/images/HTB-Runner/ffuf-subdomain.png alt="subdomain enumeration"></p><h2 id=accès-initial>Accès Initial</h2><p><code>http://teamcity.runner.htb</code> mène à un formulaire de connexion pour TeamCity avec la version <code>2023.05.3</code>. En recherchant les vulnérabilités, nous découvrons le <a href=https://www.exploit-db.com/exploits/51884>CVE-2023-42793</a> , qui nous permet de créer un nouvel utilisateur avec des privilèges administratifs.</p><p><img src=/images/HTB-Runner/teamcity-runner.png alt="teamcity subdomain"></p><p>En utilisant ce <a href=https://github.com/H454NSec/CVE-2023-42793>PoC</a>, nous exploitons la vulnérabilité et créons un nouvel utilisateur admin avec les identifiants <code>H454NSec5438:@H454NSec</code>.</p><pre tabindex=0><code>python3 CVE-2023-42793.py -u http://teamcity.runner.htb
</code></pre><p><img src=/images/HTB-Runner/Poc_use.png alt="Poc in use"></p><p>Nous nous connectons à l&rsquo;instance TeamCity.</p><p><img src=/images/HTB-Runner/teamcity-admin-login.png alt="teamcity subdomain login"></p><p>Dans la section <code>Administration</code>, sous <code>Server Administration</code> nous trouvons une option <code>Backup</code> et nous utilisons le bouton <code>Start Backup</code> pour démarrer le processus.</p><p><img src=/images/HTB-Runner/backup.png alt="teamcity backup"></p><p><img src=/images/HTB-Runner/backup-start.png alt="teamcity backup start"></p><p>Une fois l&rsquo;opération terminée, nous pouvons télécharger l&rsquo;archive en cliquant sur le lien.</p><p><img src=/images/HTB-Runner/backup-file.png alt="teamcity backup archive"></p><blockquote><p>Après l&rsquo;extraction de l&rsquo;archive, nous modifions les permissions sur tous les fichiers afin d&rsquo;y accéder.</p></blockquote><pre tabindex=0><code>unzip TeamCity_Backup_20240421_214500.zip &amp;&amp; chmod -R 744 *
</code></pre><p><img src=/images/HTB-Runner/backup-files.png alt="teamcity backup files"></p><p>Nous trouvons une clé SSH dans <code>config/projects/AllProjects/pluginData/ssh_keys/id_rsa</code> mais pour l&rsquo;instant nous ne savons pas à quel utilisateur elle appartient.</p><p>Nous obtenons aussi une liste d&rsquo;utilisateurs et leurs hachage de mot de passe dans <code>database_dump/users</code>.</p><blockquote><p><code>admin</code> et <code>matthew</code> sont les utilisateurs intéressants ici, les autres ont été créés par le PoC.</p></blockquote><p><img src=/images/HTB-Runner/db-users-hashes.png alt="user hashes"></p><p>Le hash de <code>admin</code> (john) ne peut pas être craqué mais nous récupérons avec succès le mot de passe de <code>matthew</code> qui est <code>piper123</code>.</p><pre tabindex=0><code>hashcat -a 0 -m 3200 matthew-hash.txt /usr/share/wordlists/rockyou.txt
</code></pre><p><img src=/images/HTB-Runner/matthew-pwd.png alt="user matthew hash cracked"></p><p>En utilisant la clé SSH trouvée précédemment, nous nous connectons en tant que <code>john</code> via SSH.</p><p><img src=/images/HTB-Runner/ssh-login-admin.png alt="SSH admin login"></p><pre tabindex=0><code>ssh -i id_rsa john@runner.htb
</code></pre><p><img src=/images/HTB-Runner/john-user.png alt="john user"></p><p>Le fichier <code>user.txt</code> se trouve dans <code>/home/john/user.txt</code>.</p><h2 id=elévation-de-privilèges>Elévation de Privilèges</h2><p>En utilisant <code>linpeas</code> pour l&rsquo;énumération du système, nous identifions un autre sous-domaine que nous n&rsquo;avions pas pu découvrir auparavant, <code>portainer-administration.runner.htb</code>.</p><p><img src=/images/HTB-Runner/subdomain-intern.png alt="subdomain internal"></p><p>À l&rsquo;adresse <code>http://portainer-administration.runner.htb/</code> nous sommes face à une autre page de connexion pour <code>portainer.io</code>. Les identifiants <code>matthew:piper123</code> sont valides ici!</p><p><img src=/images/HTB-Runner/portainer-login.png alt="portainer login"></p><p>Nous ne sommes pas en mesure de modifier le conteneur actuel, mais nous pouvons créer de nouveaux volumes.</p><ol><li>Sélectionnez le conteneur <code>primary</code> et vous obtiendrez un menu déroulant dans le panneau de gauche.</li></ol><p><img src=/images/HTB-Runner/container-primary.png alt="container primary"></p><ol start=2><li>Cliquez sur <code>Volumes</code> puis sur <code>Add volume</code> dans le coin droit.</li></ol><p><img src=/images/HTB-Runner/add-volume.png alt="add volume for conmtainer"></p><ol start=3><li>Lors de la création du volume, utilisez l&rsquo;option <code>+ add driver option</code> et ajoutez les trois options ci-dessous afin de créer un volume racine.</li></ol><p><img src=/images/HTB-Runner/volume-options.png alt="volume options"></p><ul><li>L&rsquo;option <strong>device</strong> spécifie le chemin source sur le système hôte qui sera monté dans le conteneur. Dans ce cas, il est défini sur <code>/</code>, qui est le répertoire racine de la machine hôte.</li><li>L&rsquo;option <strong>o</strong> signifie «options» et, dans ce contexte, <code>bind</code> fait référence à un «montage bind».</li><li>L&rsquo;option <strong>type</strong> définit le type de montage utilisé. Lorsqu&rsquo;elle est définie par <code>none</code>, elle indique qu&rsquo;aucun type de système de fichiers spécifique n&rsquo;est utilisé pour ce montage.</li></ul><ol start=4><li>Dans <code>Containers</code> créez un nouveau container avec <code>ubuntu</code> comme nom d&rsquo;image, assurez-vous de cocher <code>Interactive & TTY (-i -t)</code> pour <code>Console</code> dans <code>Advanced container settings</code>.</li></ol><p><img src=/images/HTB-Runner/console-interactive.png alt="portainer console"></p><p>Sous <code>Volumes</code> cliquez sur <code>+map additional volume</code>, pour <code>container</code> entrez <code>/mnt/root</code> et sélectionnez le volume que vous venez de créer, enfin déployez le conteneur.</p><p><img src=/images/HTB-Runner/advanced_container_settings_volume.png alt="Advanced container settings, volume section"></p><ol start=5><li>Vous devriez maintenant avoir un nouveau conteneur en cours d&rsquo;exécution.</li></ol><p><img src=/images/HTB-Runner/myContainer.png alt="created container"></p><p>Sélectionnez-le et cliquez sur <code>Console</code> puis sur <code>Connect</code>.</p><p><img src=/images/HTB-Runner/console-container.png alt="container status"></p><ol start=6><li>Vous vous connecterez en tant que root et trouverez <code>root.txt</code> dans <code>/mnt/root/root/</code>.</li></ol><p><img src=/images/HTB-Runner/root-flag.png alt="Root flag"></p><h3 id=explication-du-processus-dexploitation>Explication du processus d&rsquo;exploitation</h3><p>Cette technique d&rsquo;escalade de privilèges exploite la fonctionnalité de liaison de volume de Docker, en particulier en utilisant Portainer.io comme outil de gestion.</p><p>Le volume en question est monté sur le conteneur avec le système de fichiers racine (<code>/</code>) comme périphérique et <code>bind</code> comme type. Ceci signifie que le système de fichiers racine de l&rsquo;hôte est monté sur le conteneur.</p><p>Lorsque nous créons un nouveau conteneur et que nous montons ce volume sur <code>/mnt/root</code>, cela donne essentiellement au conteneur l&rsquo;accès au répertoire racine de la machine hôte.</p><p>Puisque le volume est lié au répertoire racine de l&rsquo;hôte, et que nous nous sommes connectés au conteneur avec une console interactive, nous avons un accès direct au système de fichiers de l&rsquo;hôte depuis le conteneur.</p><p>Par défaut, les conteneurs s&rsquo;exécutent généralement en tant que root dans leur propre environnement, et grâce au montage avec <code>bind</code>, cet utilisateur root à l&rsquo;intérieur du conteneur a accès au répertoire racine de l&rsquo;hôte. Ainsi, nous pouvons manipuler ou exécuter des fichiers sur le système hôte comme si nous étions l&rsquo;utilisateur racine de l&rsquo;hôte, ce qui nous permet de contrôler totalement la machine hôte.</p><h2 id=mots-de-fin>Mots de Fin</h2><p>Je ne suis pas très compétent en matière d&rsquo;exploitation de conteneurs, mais cette box m&rsquo;a incité à en apprendre davantage sur le sujet. Vous trouverez ci-dessous une liste non exhaustive des ressources que j&rsquo;ai utilisées.</p><p>Tout d&rsquo;abord, il faut savoir ce qu&rsquo;est Docker et à quoi il sert - <a href="https://www.youtube.com/watch?v=pg19Z8LL06w&amp;ab_channel=TechWorldwithNana">Docker Crash Course</a></p><p>Ensuite, nous pourrons nous familiariser avec les méthodes d&rsquo;exploitation de Docker:</p><ul><li><a href=https://www.practical-devsecops.com/lesson-4-hacking-containers-like-a-boss/>Lesson 4: Hacking Containers Like A Boss</a></li><li><a href="https://www.youtube.com/watch?v=IuiJdQsty5k&amp;ab_channel=Docker">Hacking into your containers, and how to stop it!</a></li><li><a href=https://book.hacktricks.xyz/network-services-pentesting/2375-pentesting-docker#privilege-escalation>Pentesting Docker on HackTricks</a></li></ul><p>Merci d&rsquo;avoir pris le temps de lire mon article, j&rsquo;espère qu&rsquo;il vous a été utile !</p></div><div class=prev-next><div class=prev-post><p><a href=/fr/posts/htb-iclean/>&#8592;
Précédent:
HTB: IClean</a></p><p class=prev-post-date>août 1, 2024</p></div><div class=next-post><p><a href=/fr/posts/htb-mailing/>Suivant:
HTB: Mailing
&#8594;</a></p><p class=next-post-date>septembre 6, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#balayage>Balayage</a></li><li><a href=#enumération>Enumération</a></li><li><a href=#accès-initial>Accès Initial</a></li><li><a href=#elévation-de-privilèges>Elévation de Privilèges</a><ul><li><a href=#explication-du-processus-dexploitation>Explication du processus d&rsquo;exploitation</a></li></ul></li><li><a href=#mots-de-fin>Mots de Fin</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>