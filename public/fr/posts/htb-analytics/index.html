<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Analytics</title>
<meta name=description content="Platforme: Hack The Box Lien: Analytics Niveau: Facile OS: Linux Analytics comporte une instance Metabase, qui est un logiciel open-source de &amp;ldquo;business …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/fr/posts/htb-analytics/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Analytics"><meta property="og:description" content="Platforme: Hack The Box Lien: Analytics Niveau: Facile OS: Linux Analytics comporte une instance Metabase, qui est un logiciel open-source de &amp;ldquo;business …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Analytics/Analytics.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Analytics/Analytics.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Analytics"><meta name=twitter:description content="Platforme: Hack The Box Lien: Analytics Niveau: Facile OS: Linux Analytics comporte une instance Metabase, qui est un logiciel open-source de &amp;ldquo;business …"><meta property="twitter:domain" content="https://scorpiosec.com/fr/posts/htb-analytics/"><meta property="twitter:url" content="https://scorpiosec.com/fr/posts/htb-analytics/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Analytics/Analytics.png"><link rel=canonical href=https://scorpiosec.com/fr/posts/htb-analytics/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/fr/posts/ aria-label=posts><span data-feather=book></span> Postes</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/projects/ aria-label=projects><span data-feather=code></span> Projets</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/categories/ aria-label=categories><span data-feather=folder></span> Catégories</a></div><div class=nav-link><a href=https://scorpiosec.com/ aria-label></a></div><div class="nav-link language-switcher"><a href=/posts/htb-analytics/>English</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/fr/posts/><span data-feather=book></span> Postes</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/projects/><span data-feather=code></span> Projets</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/categories/><span data-feather=folder></span> Catégories</a></li><li class=nav-item><a href=https://scorpiosec.com/></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Analytics</h1><small role=doc-subtitle></small><p class=post-date>3 min read |
<span class=post-date>23 Mars 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/fr/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platforme: Hack The Box</li><li>Lien: <a href=https://app.hackthebox.com/machines/Analytics>Analytics</a></li><li>Niveau: Facile</li><li>OS: Linux</li></ul><hr><p>Analytics comporte une instance Metabase, qui est un logiciel open-source de &ldquo;business intelligence&rdquo;. La cible est vulnérable au CVE-2023-38646 qui permet l&rsquo;exécution de commandes en l&rsquo;absence d&rsquo;authentification. Après avoir énuméré les variables de l&rsquo;environnement, des identifiants SSH sont découverts et le shell root est obtenu via un &ldquo;kernel exploit&rdquo;.</p><p>L&rsquo;adresse IP cible - <code>10.10.11.233</code></p><h2 id=scanning>Scanning</h2><pre tabindex=0><code>nmap -sC -sV -oA nmap/Analytics 10.10.11.233
</code></pre><p><strong>Results</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-03-15 13:11 CDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.233
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.047s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>998</span> closed tcp ports <span style=color:#56b6c2>(</span>conn-refused<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.4 <span style=color:#56b6c2>(</span>Ubuntu Linux; protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    nginx 1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://analytical.htb/
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 9.31 seconds
</span></span></code></pre></div><p>Nous sommes redirigés vers <code>analytical.htb</code> qui est ajouté au fichier <code>/etc/hosts</code>.</p><pre tabindex=0><code>sudo echo &#34;10.10.11.233 analytical.htb&#34; | sudo tee -a /etc/hosts
</code></pre><h2 id=enumération>Enumération</h2><p>Le site ne présente rien d&rsquo;intéressant à part une page de login qui me redirige vers <code>http://data.analytical.htb/</code>, j&rsquo;ajoute le sous-domaine à mon fichier <code>/etc/hosts</code>.</p><pre tabindex=0><code>sudo echo &#34;10.10.11.233 data.analytical.htb&#34; | sudo tee -a /etc/hosts
</code></pre><p>La visite du sous-domaine récemment identifié conduit à une page de connexion pour <a href=https://www.metabase.com/>Metabase</a>.</p><p><img src=/images/HTB-Analytics/signin-Metabase.png alt="Metabase login page"></p><p>Aucune des informations d&rsquo;identification par défaut ne fonctionne.</p><p><img src=/images/HTB-Analytics/Metabase-default-users.png alt="Metabase default credentials"></p><p>En recherchant les vulnérabilités de Metabase, nous trouvons <a href=https://www.cvedetails.com/vulnerability-list/vendor_id-19475/product_id-51231/Metabase-Metabase.html>CVE-2023-38646</a> permettant aux attaquants d&rsquo;exécuter des commandes même lorsqu&rsquo;ils ne sont pas authentifiés.</p><p><img src=/images/HTB-Analytics/cve-2023-38646.png alt=CVE-2023-38646></p><p>Un PoC pour l&rsquo;exploit se trouve <a href=https://github.com/m3m0o/metabase-pre-auth-rce-poc/tree/main>ici</a>.</p><h2 id=accès-initial>Accès initial</h2><p>Le <code>setup-token</code> est récupéré en allant sur <code>http://data.analytical.htb/api/session/properties</code>.</p><p><img src=/images/HTB-Analytics/Metabase-setup-token.png alt=setup-token></p><p>Un shell inversé est créé à l&rsquo;aide de <a href=https://www.revshells.com/>Reverse shell generator</a>.</p><p>Pour exécuter l&rsquo;exploit, utilisez</p><pre tabindex=0><code>python3 main.py -u http://[targeturl] -t [setup-token] -c &#34;[command]&#34;
</code></pre><p>Configurez votre listener et exécutez la commande.</p><p><img src=/images/HTB-Analytics/Metabase-xploit.png alt="Metabase exploit running"></p><p>Nous accédons au système par l&rsquo;intermédiaire de l&rsquo;utilisateur <code>Metabase</code>.</p><p><img src=/images/HTB-Analytics/foothold.png alt="Initial foothold"></p><p>Le fichier <code>user.txt</code> ne se trouve pas dans le répertoire personnel de cet utilisateur et la tentative de &ldquo;upgrade&rdquo; l&rsquo;interpréteur de commandes échoue. Nous semblons être dans un environnement contraint avec un nombre limité de services, probablement un conteneur. <code>0::/</code> est découvert à la fois dans <code>/proc/1/cgroup</code> et <code>/proc/self/cgroup</code> ce qui est une forte indication que nous opérons dans un conteneur. Cela signifie typiquement que le processus avec le <code>PID 1</code> (habituellement le processus init) s&rsquo;exécute dans un <code>cgroup</code>, ce qui est une caractéristique commune des environnements conteneurisés.</p><p>Après avoir trouvé et examiné le contenu du script <code>/app/run_metabase.sh</code>, il est évident que les variables d&rsquo;environnement sont manipulées via les fonctions <code>file_env</code> et <code>docker_setup_env</code>.</p><p>L&rsquo;exécution de <code>env</code> dévoile quelques informations d&rsquo;identification.</p><blockquote><p>La commande <code>env</code> affiche les variables d&rsquo;environnement actuelles définies dans l&rsquo;interpréteur de commandes. Les variables d&rsquo;environnement sont des paires clé-valeur qui contiennent des informations sur l&rsquo;environnement dans lequel un processus s&rsquo;exécute.</p></blockquote><p><img src=/images/HTB-Analytics/user-credentials.png alt="Leaked user credentials"></p><pre tabindex=0><code>META_USER=metalytics
META_PASS=An4lytics_ds20223#
</code></pre><p>Nous utilisons ces identifiants pour nous connecter avec SSH.</p><pre tabindex=0><code>ssh metalytics@analytical.htb
</code></pre><p>Et le fichier <code>user.txt</code> se trouve dans <code>/home/metalytics/user.txt</code>.</p><p><img src=/images/HTB-Analytics/user-flag.png alt="User flag"></p><h2 id=escalade-des-privilèges>Escalade des privilèges</h2><p>La recherche de pistes d&rsquo;escalade de privilèges avec <code>sudo -l</code> et l&rsquo;énumération manuelle du système ne mènent à rien pour l&rsquo;instant. Portant mon attention sur le noyau du système, je vérifie ses caractéristiques avec <code>uname -a && cat /proc/version</code>.</p><p><img src=/images/HTB-Analytics/system-features.png alt="System kernel version"></p><p>Le système fonctionne sous Ubuntu 22.04 et la version du noyau 6.2.0-25-generic. Après avoir cherché des attaques, je découvre <a href=https://www.crowdstrike.com/blog/crowdstrike-discovers-new-container-exploit/>GameOver(lay)</a> avec les <code>CVE-2023-2640</code> et <code>CVE-2023-32629</code>. Un PoC est disponible sur ce <a href=https://github.com/g1vi/CVE-2023-2640-CVE-2023-32629/blob/main/exploit.sh>compte Github</a>.</p><p>Après l&rsquo;exécution de l&rsquo;exploit, un shell root est obtenu et le fichier <code>root.txt</code> est accessible dans <code>/root/root.txt</code>.</p><p><img src=/images/HTB-Analytics/root-flag.png alt="Root flag"></p><p>Merci d&rsquo;avoir visité mon blog!</p></div><div class=prev-next><div class=prev-post><p><a href=/fr/posts/thm-hacksmartersecurity/>&#8592;
Précédent:
THM: Hack Smarter Security</a></p><p class=prev-post-date>mars 22, 2024</p></div><div class=next-post><p><a href=/fr/posts/htb-codify/>Suivant:
HTB: Codify
&#8594;</a></p><p class=next-post-date>avril 5, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumération>Enumération</a></li><li><a href=#accès-initial>Accès initial</a></li><li><a href=#escalade-des-privilèges>Escalade des privilèges</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>