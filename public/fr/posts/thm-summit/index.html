<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>THM: Summit</title>
<meta name=description content="Ce challenge nécessite de créer des contre-mesures défensives pour différents échantillons de malware. Nous utiliserons des hachages de fichiers, des adresses …"><meta name=keywords content="TryHackMe"><meta property="og:url" content="https://scorpiosec.com/fr/posts/thm-summit/"><meta property="og:type" content="website"><meta property="og:title" content="THM: Summit"><meta property="og:description" content="Ce challenge nécessite de créer des contre-mesures défensives pour différents échantillons de malware. Nous utiliserons des hachages de fichiers, des adresses …"><meta property="og:image" content="https://scorpiosec.com/images/THM-Summit/Summit.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/THM-Summit/Summit.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="THM: Summit"><meta name=twitter:description content="Ce challenge nécessite de créer des contre-mesures défensives pour différents échantillons de malware. Nous utiliserons des hachages de fichiers, des adresses …"><meta property="twitter:domain" content="https://scorpiosec.com/fr/posts/thm-summit/"><meta property="twitter:url" content="https://scorpiosec.com/fr/posts/thm-summit/"><meta name=twitter:image content="https://scorpiosec.com/images/THM-Summit/Summit.png"><link rel=canonical href=https://scorpiosec.com/fr/posts/thm-summit/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/fr/posts/ aria-label=posts><span data-feather=book></span> Postes</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/projects/ aria-label=projects><span data-feather=code></span> Projets</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/categories/ aria-label=categories><span data-feather=folder></span> Catégories</a></div><div class=nav-link><a href=https://scorpiosec.com/ aria-label></a></div><div class="nav-link language-switcher"><a href=/posts/thm-summit/>English</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/fr/posts/><span data-feather=book></span> Postes</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/projects/><span data-feather=code></span> Projets</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/categories/><span data-feather=folder></span> Catégories</a></li><li class=nav-item><a href=https://scorpiosec.com/></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>THM: Summit</h1><small role=doc-subtitle></small><p class=post-date>3 min read |
<span class=post-date>29 Août 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/fr/tags/tryhackme>TryHackMe</a></li></ul></div><div class=post-content><p>Ce challenge nécessite de créer des contre-mesures défensives pour différents échantillons de malware. Nous utiliserons des hachages de fichiers, des adresses IP, des règles de pare-feu, des règles DNS et des règles sigma.</p><ul><li>Platforme: TryHackMe</li><li>Lien: <a href=https://tryhackme.com/r/room/summit>Summit</a></li><li>Niveau: Facile</li></ul><h2 id=what-is-the-first-flag-you-receive-after-successfully-detecting-sample1exe>What is the first flag you receive after successfully detecting sample1.exe?</h2><p>Après avoir cliqué sur le lien fourni, sélectionnez <code>Malware Snadbox</code>, le fichier <code>sample1.exe</code> est déjà présent et cliquez sur <code>Submit for Analysis</code>.</p><p><img src=/images/THM-Summit/malware_sandbox.png alt="Malware Sandbox"></p><p><img src=/images/THM-Summit/submit_for_analysis.png alt="Submit for analysis button"></p><p>Une fois l&rsquo;analyse terminée, nous obtenons trois valeurs de hachage.</p><p><img src=/images/THM-Summit/general_info.png alt="Sample1 analysis results"></p><p>Dans le menu déroulant, il y a une section <code>Manage Hashes</code>, copiez l&rsquo;un des hashs, cochez la case correcte pour <code>Hash Algorithm</code> et soumettez-le.</p><p><img src=/images/THM-Summit/detect_hashes.png alt="Detect Hashes"></p><p>Nous obtenons quelques résultats et un e-mail (la section <code>Mail</code> dans le menu déroulant) avec le premier drapeau.</p><p><img src=/images/THM-Summit/hash_blocklist.png alt="Hash Blocklist"></p><p><img src=/images/THM-Summit/first_flag.png alt="First flag"></p><h2 id=what-is-the-second-flag-you-receive-after-successfully-detecting-sample2exe>What is the second flag you receive after successfully detecting sample2.exe?</h2><p>En utilisant le même processus, nous analysons <code>sample2.exe</code>. Le rapport indique que ce fichier tente d&rsquo;envoyer une requête HTTP à l&rsquo;adresse IP <code>154.35.10.113:4444</code>.</p><p><img src=/images/THM-Summit/sample2_network_activity.png alt="Sample2 analysis results"></p><p>Créons une règle dans la section <code>Firewall Rule Manager</code>.</p><p><img src=/images/THM-Summit/firewall_rule_manager.png alt="Firewall rule manager"></p><p>Après la sauvegarde de cette règle, nous recevons le deuxième drapeau.</p><p><img src=/images/THM-Summit/flag_2.png alt="Second flag"></p><h2 id=what-is-the-third-flag-you-receive-after-successfully-detecting-sample3exe>What is the third flag you receive after successfully detecting sample3.exe?</h2><p>Après l&rsquo;analyse de <code>sample3.exe</code>, nous remarquons des requêtes HTTP vers l&rsquo;IP <code>62.123.140.9</code> et des requêtes DNS vers <code>emudyn.bresonicz.info</code> avec la même adresse IP.</p><p><img src=/images/THM-Summit/sample3_network_activity.png alt="Sample3 analysis results"></p><p>Nous nous dirigeons vers la section <code>DNS Filter</code> et créons une règle DNS pour ce domaine, ce qui nous permet d&rsquo;obtenir le troisième drapeau.</p><p><img src=/images/THM-Summit/DNS_malicious_domain.png alt="DNS Rule Manager"></p><p><img src=/images/THM-Summit/flag_3.png alt="Third flag"></p><h2 id=what-is-the-fourth-flag-you-receive-after-successfully-detecting-sample4exe>What is the fourth flag you receive after successfully detecting sample4.exe?</h2><p>Grâce à l&rsquo;e-mail précédent, nous savons que le blocage des hashs, des IP ou des domaines ne résoudra pas ce problème. Nous devons aller plus loin.</p><p>Le rapport d&rsquo;analyse de <code>sample4.exe</code> montre quelques modifications du registre.</p><p><img src=/images/THM-Summit/sample4_registry_activity.png alt="sample4 analysis results"></p><p>Nous utilisons le <code>Sigma Rule Builder</code> pour ce cas. Pour l&rsquo;étape 1, nous choisissons <code>Sysmon Event Logs</code> et pour l&rsquo;étape 2 <code>Registry Modifications</code>. A l&rsquo;étape 3, nous entrons les valeurs observées dans le rapport.</p><blockquote><p>Si vous cherchez sur Google <code>att&amp;ck DisableRealtimeMonitoring ID</code> vous verrez que son ID est <code>T1562.002</code> qui appartient à <a href=https://attack.mitre.org/tactics/TA0005/>Defense Evasion</a> avec l&rsquo;ID <code>TA0005</code>.</p></blockquote><table><thead><tr><th>Registry Key</th><th>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Defender\Real-Time Protection</th></tr></thead><tbody><tr><td>Registry Name</td><td>DisableRealtimeMonitoring</td></tr><tr><td>Value</td><td>1</td></tr><tr><td>ATT&amp;CK ID</td><td>Defense Evasion (TA0005)</td></tr></tbody></table><p><img src=/images/THM-Summit/Sigma_rule.png alt="Sigma rule for sample4"></p><p>Après avoir validé la règle, nous recevons le drapeau 4.</p><p><img src=/images/THM-Summit/flag_4.png alt="Fourth flag"></p><h2 id=what-is-the-fifth-flag-you-receive-after-successfully-detecting-sample5exe>What is the fifth flag you receive after successfully detecting sample5.exe?</h2><p>Cette fois-ci, nous devons utiliser les logs pour déterminer notre solution.</p><p><img src=/images/THM-Summit/log_file.png alt="Log file for sample5"></p><p>Nous remarquons une tendance dans les logs. Toutes les 30 minutes, il y a un trafic sortant de 97 octets vers l&rsquo;IP <code>51.102.10.19</code>. Dans le <code>Sigma Rule Builder</code>, allez dans <code>Sysmon Event Logs</code> -> <code>Network connections</code>.</p><p>Puisque l&rsquo;attaquant peut maintenant modifier les artefacts, nous ne pouvons pas nous fier aux adresses IP, aux protocoles ou aux numéros de port. De plus, étant donné que le trafic se produit toutes les 30 minutes, nous pouvons supposer qu&rsquo;il utilise un processus automatisé, probablement via un framework C2.</p><p>En utilisant les valeurs de l&rsquo;image ci-dessous, nous obtenons le cinquième drapeau.</p><p><img src=/images/THM-Summit/Sigma_rule_C2.png alt="Sigma rule C2 server"></p><p><img src=/images/THM-Summit/flag_5.png alt="Fifth flag"></p><h2 id=what-is-the-final-flag-you-receive-from-sphinx>What is the final flag you receive from Sphinx?</h2><p>Nous devons maintenant utiliser un journaul de commandes.</p><p><img src=/images/THM-Summit/commands_log.png alt="commands log file"></p><p>Tout d&rsquo;abord, nous devons comprendre ce que font ces commandes. Elles suggèrent que le logiciel malveillant effectue une reconnaissance et collecte des informations sur le système, le réseau et les comptes d&rsquo;utilisateurs. Les résultats sont stockés dans un fichier journal (<code>exfiltr8.log</code>) dans le répertoire temporaire (<code>%temp%</code>), probablement dans le but d&rsquo;exfiltrer ces données.</p><p>Le fichier journal nous montre que le répertoire temporaire <code>%temp%</code> est toujours utilisé en combinaison avec un fichier nommé <code>exfiltr8.log</code>. Nous nous concentrerons donc sur ces éléments pour créer notre contre-mesure.</p><p>Allez dans <code>Sigma Rule Builder</code> -> <code>Sysmon Event Logs</code> -> <code>FIle Creation and Modification</code> et utilisez les options ci-dessous.</p><p><img src=/images/THM-Summit/sigma_rule_exfiltration.png alt="Sigma rule data exfiltration malware"></p><p>Nous obtenons le drapeau final.</p><p><img src=/images/THM-Summit/final_flag.png alt="Final flag"></p></div><div class=prev-next><div class=prev-post><p><a href=/fr/posts/htb-runner/>&#8592;
Précédent:
HTB: Runner</a></p><p class=prev-post-date>août 22, 2024</p></div><div class=next-post><p><a href=/fr/posts/htb-mailing/>Suivant:
HTB: Mailing
&#8594;</a></p><p class=next-post-date>septembre 6, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#what-is-the-first-flag-you-receive-after-successfully-detecting-sample1exe>What is the first flag you receive after successfully detecting sample1.exe?</a></li><li><a href=#what-is-the-second-flag-you-receive-after-successfully-detecting-sample2exe>What is the second flag you receive after successfully detecting sample2.exe?</a></li><li><a href=#what-is-the-third-flag-you-receive-after-successfully-detecting-sample3exe>What is the third flag you receive after successfully detecting sample3.exe?</a></li><li><a href=#what-is-the-fourth-flag-you-receive-after-successfully-detecting-sample4exe>What is the fourth flag you receive after successfully detecting sample4.exe?</a></li><li><a href=#what-is-the-fifth-flag-you-receive-after-successfully-detecting-sample5exe>What is the fifth flag you receive after successfully detecting sample5.exe?</a></li><li><a href=#what-is-the-final-flag-you-receive-from-sphinx>What is the final flag you receive from Sphinx?</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>