<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>THM: Summit</title>
<meta name=description content="This is a blue team challenge where we need to create defensive countermeasures for various malware samples. This will be achieved by using file hashes, IP …"><meta name=keywords content="TryHackMe"><meta property="og:url" content="https://scorpiosec.com/posts/thm-summit/"><meta property="og:type" content="website"><meta property="og:title" content="THM: Summit"><meta property="og:description" content="This is a blue team challenge where we need to create defensive countermeasures for various malware samples. This will be achieved by using file hashes, IP …"><meta property="og:image" content="https://scorpiosec.com/images/THM-Summit/Summit.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/THM-Summit/Summit.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="THM: Summit"><meta name=twitter:description content="This is a blue team challenge where we need to create defensive countermeasures for various malware samples. This will be achieved by using file hashes, IP …"><meta property="twitter:domain" content="https://scorpiosec.com/posts/thm-summit/"><meta property="twitter:url" content="https://scorpiosec.com/posts/thm-summit/"><meta name=twitter:image content="https://scorpiosec.com/images/THM-Summit/Summit.png"><link rel=canonical href=https://scorpiosec.com/posts/thm-summit/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://scorpiosec.com/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://scorpiosec.com/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/categories/ aria-label><span data-feather=folder></span> Categories</a></div><div class="nav-link language-switcher"><a href=/fr/posts/thm-summit/>Français</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://scorpiosec.com/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://scorpiosec.com/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/categories/><span data-feather=folder></span> Categories</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>THM: Summit</h1><small role=doc-subtitle></small><p class=post-date>3 min read |
<span class=post-date>August 29, 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/tags/tryhackme>TryHackMe</a></li></ul></div><div class=post-content><p>This is a blue team challenge where we need to create defensive countermeasures for various malware samples. This will be achieved by using file hashes, IP addresses, firewall rules, DNS and sigma rules.</p><ul><li>Platform: TryHackMe</li><li>Link: <a href=https://tryhackme.com/r/room/summit>Summit</a></li><li>Level: Easy</li></ul><h2 id=what-is-the-first-flag-you-receive-after-successfully-detecting-sample1exe>What is the first flag you receive after successfully detecting sample1.exe?</h2><p>After navigating to the link provided, go to <code>Malware Snadbox</code>, the file <code>sample1.exe</code> is already loaded and click on <code>Submit for Analysis</code>.</p><p><img src=/images/THM-Summit/malware_sandbox.png alt="Malware Sandbox"></p><p><img src=/images/THM-Summit/submit_for_analysis.png alt="Submit for analysis button"></p><p>After the analysis is completed, we get three hash values.</p><p><img src=/images/THM-Summit/general_info.png alt="Sample1 analysis results"></p><p>Back to the drop down menu, there is a <code>Manage Hashes</code> section, copy one of the hashes, check the correct <code>Hash Algorithm</code> box and submit it.</p><p><img src=/images/THM-Summit/detect_hashes.png alt="Detect Hashes"></p><p>You will get some results and an email (check the <code>Mail</code> section in the drop down menu) with the first flag.</p><p><img src=/images/THM-Summit/hash_blocklist.png alt="Hash Blocklist"></p><p><img src=/images/THM-Summit/first_flag.png alt="First flag"></p><h2 id=what-is-the-second-flag-you-receive-after-successfully-detecting-sample2exe>What is the second flag you receive after successfully detecting sample2.exe?</h2><p>Using the same process we analyze <code>sample2.exe</code>. The report tells us that this file tries to send an HTTP request to IP address <code>154.35.10.113:4444</code>.</p><blockquote><p>If we try to get the flag via hash submission we are told that it requires another method.</p></blockquote><p><img src=/images/THM-Summit/sample2_network_activity.png alt="Sample2 analysis results"></p><p>Let&rsquo;s create a rule in the <code>Firewall Rule Manager</code> section.</p><p><img src=/images/THM-Summit/firewall_rule_manager.png alt="Firewall rule manager"></p><p>After saving that rule we get flag 2 in our mail.</p><p><img src=/images/THM-Summit/flag_2.png alt="Second flag"></p><h2 id=what-is-the-third-flag-you-receive-after-successfully-detecting-sample3exe>What is the third flag you receive after successfully detecting sample3.exe?</h2><p>After analyzing <code>sample3.exe</code>, we notice some HTTP requests to IP <code>62.123.140.9</code> and DNS requests to <code>emudyn.bresonicz.info</code> with the same IP address.</p><p><img src=/images/THM-Summit/sample3_network_activity.png alt="Sample3 analysis results"></p><p>We head to the <code>DNS Filter</code> section and create a DNS rule for that domain which gets us the third flag.</p><p><img src=/images/THM-Summit/DNS_malicious_domain.png alt="DNS Rule Manager"></p><p><img src=/images/THM-Summit/flag_3.png alt="Third flag"></p><h2 id=what-is-the-fourth-flag-you-receive-after-successfully-detecting-sample4exe>What is the fourth flag you receive after successfully detecting sample4.exe?</h2><p>From the previous email, we know that blocking hashes, IPs, or domain will not solve our problem. We need to look deeper.</p><p>The analysis report of <code>sample4.exe</code> shows some registry activity.</p><p><img src=/images/THM-Summit/sample4_registry_activity.png alt="sample4 analysis results"></p><p>We will use the <code>Sigma Rule Builder</code> for this case. For Step 1 we choose <code>Sysmon Event Logs</code> and for Step 2 we pick <code>Registry Modifications</code>. In Step 3 we enter the values from the report.</p><blockquote><p>If you google <code>att&amp;ck DisableRealtimeMonitoring ID</code> you will see that its ID is <code>T1562.002</code> which falls under <a href=https://attack.mitre.org/tactics/TA0005/>Defense Evasion</a> with ID <code>TA0005</code>.</p></blockquote><table><thead><tr><th>Registry Key</th><th>HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows Defender\Real-Time Protection</th></tr></thead><tbody><tr><td>Registry Name</td><td>DisableRealtimeMonitoring</td></tr><tr><td>Value</td><td>1</td></tr><tr><td>ATT&amp;CK ID</td><td>Defense Evasion (TA0005)</td></tr></tbody></table><p><img src=/images/THM-Summit/Sigma_rule.png alt="Sigma rule for sample4"></p><p>After validating the rule we get flag 4 in our inbox.</p><p><img src=/images/THM-Summit/flag_4.png alt="Fourth flag"></p><h2 id=what-is-the-fifth-flag-you-receive-after-successfully-detecting-sample5exe>What is the fifth flag you receive after successfully detecting sample5.exe?</h2><p>This time we have to focus on the logs to determine our countermeasure.</p><p><img src=/images/THM-Summit/log_file.png alt="Log file for sample5"></p><p>After paying close attention we notice some recurring traffic on the same port at regular intervals. Every 30 minutes there is some outgoing traffic of 97 bytes to IP <code>51.102.10.19</code>. In the <code>Sigma Rule Builder</code> go to <code>Sysmon Event Logs</code> -> <code>Network connections</code>.</p><p>Because the threat actor can now change the artifacts we cannot rely of IP addresses, protocols, or port numbers. Also given the fact that the traffic occurs every 30 minutes we can assume that it uses an automated process probably via a C2 framework.</p><p>Using the values in the picture below we get the fifth flag.</p><p><img src=/images/THM-Summit/Sigma_rule_C2.png alt="Sigma rule C2 server"></p><p><img src=/images/THM-Summit/flag_5.png alt="Fifth flag"></p><h2 id=what-is-the-final-flag-you-receive-from-sphinx>What is the final flag you receive from Sphinx?</h2><p>We now need to make use of a commands log file.</p><p><img src=/images/THM-Summit/commands_log.png alt="commands log file"></p><p>First we need to understand what those commands are doing. The commands suggest that the malware is performing reconnaissance and collecting information about the system, network, and user accounts. The output is stored in a log file (<code>exfiltr8.log</code>) in the temporary directory (<code>%temp%</code>), likely with the intention of exfiltrating this data to an external attacker.</p><p>The log file shows us that the temporary directory <code>%temp%</code> is always used in conjunction with a file named <code>exfiltr8.log</code>. So we should focus on that with our countermeasure.</p><p>Go to <code>Sigma Rule Builder</code> -> <code>Sysmon Event Logs</code> -> <code>FIle Creation and Modification</code> and use the options depicted below.</p><p><img src=/images/THM-Summit/sigma_rule_exfiltration.png alt="Sigma rule data exfiltration malware"></p><p>We then get the final flag.</p><p><img src=/images/THM-Summit/final_flag.png alt="Final flag"></p></div><div class=prev-next><div class=prev-post><p><a href=/posts/htb-runner/>&#8592;
Previous:
HTB: Runner</a></p><p class=prev-post-date>August 22, 2024</p></div><div class=next-post><p><a href=/posts/htb-mailing/>Next:
HTB: Mailing
&#8594;</a></p><p class=next-post-date>September 6, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#what-is-the-first-flag-you-receive-after-successfully-detecting-sample1exe>What is the first flag you receive after successfully detecting sample1.exe?</a></li><li><a href=#what-is-the-second-flag-you-receive-after-successfully-detecting-sample2exe>What is the second flag you receive after successfully detecting sample2.exe?</a></li><li><a href=#what-is-the-third-flag-you-receive-after-successfully-detecting-sample3exe>What is the third flag you receive after successfully detecting sample3.exe?</a></li><li><a href=#what-is-the-fourth-flag-you-receive-after-successfully-detecting-sample4exe>What is the fourth flag you receive after successfully detecting sample4.exe?</a></li><li><a href=#what-is-the-fifth-flag-you-receive-after-successfully-detecting-sample5exe>What is the fifth flag you receive after successfully detecting sample5.exe?</a></li><li><a href=#what-is-the-final-flag-you-receive-from-sphinx>What is the final flag you receive from Sphinx?</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>