<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Analytics</title>
<meta name=description content="Platform: Hack The Box Link: Analytics Level: Easy OS: Linux Analytics features a Metabase instance, which is an open-source business intelligence software. The …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/posts/htb-analytics/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Analytics"><meta property="og:description" content="Platform: Hack The Box Link: Analytics Level: Easy OS: Linux Analytics features a Metabase instance, which is an open-source business intelligence software. The …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Analytics/Analytics.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Analytics/Analytics.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Analytics"><meta name=twitter:description content="Platform: Hack The Box Link: Analytics Level: Easy OS: Linux Analytics features a Metabase instance, which is an open-source business intelligence software. The …"><meta property="twitter:domain" content="https://scorpiosec.com/posts/htb-analytics/"><meta property="twitter:url" content="https://scorpiosec.com/posts/htb-analytics/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Analytics/Analytics.png"><link rel=canonical href=https://scorpiosec.com/posts/htb-analytics/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://scorpiosec.com/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://scorpiosec.com/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/categories/ aria-label><span data-feather=folder></span> Categories</a></div><div class="nav-link language-switcher"><a href=/fr/posts/htb-analytics/>Français</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://scorpiosec.com/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://scorpiosec.com/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/categories/><span data-feather=folder></span> Categories</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Analytics</h1><small role=doc-subtitle></small><p class=post-date>3 min read |
<span class=post-date>March 23, 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platform: Hack The Box</li><li>Link: <a href=https://app.hackthebox.com/machines/Analytics>Analytics</a></li><li>Level: Easy</li><li>OS: Linux</li></ul><hr><p>Analytics features a Metabase instance, which is an open-source business intelligence software. The target is vulnerable to <code>CVE-2023-38646</code> allowing command execution while unauthenticated. After enumerating the environment varialbles, SSH credentials are discovered and the root shell is gained via a kernel exploit.</p><p>Target IP Address - <code>10.10.11.233</code></p><h2 id=scanning>Scanning</h2><pre tabindex=0><code>nmap -sC -sV -oA nmap/Analytics 10.10.11.233
</code></pre><p><strong>Results</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-03-15 13:11 CDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.233
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.047s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>998</span> closed tcp ports <span style=color:#56b6c2>(</span>conn-refused<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.4 <span style=color:#56b6c2>(</span>Ubuntu Linux; protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    nginx 1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://analytical.htb/
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 9.31 seconds
</span></span></code></pre></div><p>We are being redirected to <code>analytical.htb</code> which is added to the <code>/etc/hosts</code> file.</p><pre tabindex=0><code>sudo echo &#34;10.10.11.233 analytical.htb&#34; | sudo tee -a /etc/hosts
</code></pre><h2 id=enumeration>Enumeration</h2><p>The website does not have anything interesting besides a login page that redirects me to <code>http://data.analytical.htb/</code>, I add the subdomain to my <code>/etc/hosts</code> file.</p><pre tabindex=0><code>sudo echo &#34;10.10.11.233 data.analytical.htb&#34; | sudo tee -a /etc/hosts
</code></pre><p>Visiting the newly found subdomain leads to a login page for <a href=https://www.metabase.com/>Metabase</a> which is an open-source business intelligence software.</p><p><img src=/images/HTB-Analytics/signin-Metabase.png alt="Metabase login page"></p><p>None of the default credentials worked.</p><p><img src=/images/HTB-Analytics/Metabase-default-users.png alt="Metabase default credentials"></p><p>Looking for Metabase vulnerabilities we find <a href=https://www.cvedetails.com/vulnerability-list/vendor_id-19475/product_id-51231/Metabase-Metabase.html>CVE-2023-38646</a> allowing attackers to execute commands even while unauthenticated.</p><p><img src=/images/HTB-Analytics/cve-2023-38646.png alt=CVE-2023-38646></p><p>A PoC for the exploit is found <a href=https://github.com/m3m0o/metabase-pre-auth-rce-poc/tree/main>here</a>.</p><h2 id=initial-foothold>Initial Foothold</h2><p>The <code>setup-token</code> is retrieved by going to <code>http://data.analytical.htb/api/session/properties</code>.</p><p><img src=/images/HTB-Analytics/Metabase-setup-token.png alt=setup-token></p><p>Craft a reverse shell with <a href=https://www.revshells.com/>Reverse Shell Generator</a>.</p><p>To run the exploit use</p><pre tabindex=0><code>python3 main.py -u http://[targeturl] -t [setup-token] -c &#34;[command]&#34;
</code></pre><p>Setup your listener, run the command</p><p><img src=/images/HTB-Analytics/Metabase-xploit.png alt="Metabase exploit running"></p><p>And catch a shell!</p><p><img src=/images/HTB-Analytics/foothold.png alt="Initial foothold"></p><p>After accessing the system no flag is found in this user home directory and trying to upgrade the shell fails. We seem to be in a constrained environment with a limited amount of services/utilities, probably a container. <code>0::/</code> is discovered in both <code>/proc/1/cgroup</code> and <code>/proc/self/cgroup</code> which is a strong indication that we are operating within a container. This typically signifies that the process with <code>PID 1</code> (usually the init process) is running within a <code>cgroup</code>, which is a common characteristic of containerized environments.</p><p>After finding and examining the content of the script <code>/app/run_metabase.sh</code>, it appears that the environment variables are manipulated via the functions <code>file_env</code> and <code>docker_setup_env</code>.</p><p>Running <code>env</code> leaks some credentials.</p><blockquote><p>The <code>env</code> command prints out the current environment variables set in the shell. Environment variables are key-value pairs that hold information about the environment in which a process is running.</p></blockquote><p><img src=/images/HTB-Analytics/user-credentials.png alt="Leaked user credentials"></p><pre tabindex=0><code>META_USER=metalytics
META_PASS=An4lytics_ds20223#
</code></pre><p>We log in SSH with them.</p><pre tabindex=0><code>ssh metalytics@analytical.htb
</code></pre><p>And the user flag is found at <code>/home/metalytics/user.txt</code>.</p><p><img src=/images/HTB-Analytics/user-flag.png alt="User flag"></p><h2 id=privilege-escalation>Privilege Escalation</h2><p>Searching for privilege escalation paths with <code>sudo -l</code> and enumerating the system manually give no leads at this point. Turning my attention to system kernel, I check its features with <code>uname -a && cat /proc/version</code>.</p><p><img src=/images/HTB-Analytics/system-features.png alt="System kernel version"></p><p>The system is running Ubuntu 22.04 and kernel version 6.2.0-25-generic. After searching for exploits I find <a href=https://www.crowdstrike.com/blog/crowdstrike-discovers-new-container-exploit/>GameOver(lay)</a> featuring <code>CVE-2023-2640</code> and <code>CVE-2023-32629</code>. A PoC is available at this <a href=https://github.com/g1vi/CVE-2023-2640-CVE-2023-32629/blob/main/exploit.sh>Github account</a>.</p><p>After running the exploit, a root shell is obtained and the root flag is accessible at <code>/root/root.txt</code>.</p><p><img src=/images/HTB-Analytics/root-flag.png alt="Root flag"></p><p>Thanks for taking the time to check out my blog, this machine was fairly straightforward. Keep learning and practicing!</p></div><div class=prev-next><div class=prev-post><p><a href=/posts/thm-hacksmartersecurity/>&#8592;
Previous:
THM: Hack Smarter Security</a></p><p class=prev-post-date>March 22, 2024</p></div><div class=next-post><p><a href=/posts/htb-codify/>Next:
HTB: Codify
&#8594;</a></p><p class=next-post-date>April 5, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#initial-foothold>Initial Foothold</a></li><li><a href=#privilege-escalation>Privilege Escalation</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>