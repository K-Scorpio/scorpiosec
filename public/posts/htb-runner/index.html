<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Runner</title>
<meta name=description content="Platform: Hack The Box Link: Runner Level: Medium OS: Linux Runner starts with a basic website offering CI/CD solutions. Through subdomain enumeration, we …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/posts/htb-runner/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Runner"><meta property="og:description" content="Platform: Hack The Box Link: Runner Level: Medium OS: Linux Runner starts with a basic website offering CI/CD solutions. Through subdomain enumeration, we …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Runner/Runner.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Runner/Runner.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Runner"><meta name=twitter:description content="Platform: Hack The Box Link: Runner Level: Medium OS: Linux Runner starts with a basic website offering CI/CD solutions. Through subdomain enumeration, we …"><meta property="twitter:domain" content="https://scorpiosec.com/posts/htb-runner/"><meta property="twitter:url" content="https://scorpiosec.com/posts/htb-runner/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Runner/Runner.png"><link rel=canonical href=https://scorpiosec.com/posts/htb-runner/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://scorpiosec.com/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://scorpiosec.com/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/categories/ aria-label><span data-feather=folder></span> Categories</a></div><div class="nav-link language-switcher"><a href=/fr/posts/htb-runner/>Français</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://scorpiosec.com/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://scorpiosec.com/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/categories/><span data-feather=folder></span> Categories</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Runner</h1><small role=doc-subtitle></small><p class=post-date>6 min read |
<span class=post-date>August 22, 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platform: Hack The Box</li><li>Link: <a href=https://app.hackthebox.com/machines/Runner>Runner</a></li><li>Level: Medium</li><li>OS: Linux</li></ul><hr><p>Runner starts with a basic website offering CI/CD solutions. Through subdomain enumeration, we uncover a vulnerable TeamCity instance (CVE-2023-42793), granting us access. A backup archive downloaded from this instance reveals a private SSH key and password hashes. Using the SSH key, we gain an initial foothold and retrieve the user flag. Further exploration uncovers another subdomain hosting a Portainer.io instance, which we access using the previously recovered credentials. Privilege escalation is achieved by exploiting a bind mount, allowing access to the root directory of the target machine via the container.</p><p>Target IP address - <code>10.10.11.13</code></p><h2 id=scanning>Scanning</h2><blockquote><p>I am using a script for the scanning phase, you can find it <a href=https://github.com/K-Scorpio/scripts-collection/blob/main/nmap_scan.sh>here</a>. I found myself always running the same commands, so it makes things easier for me.</p></blockquote><pre tabindex=0><code>./nmap_scan.sh 10.10.11.13 Runner
</code></pre><p><strong>Results</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Running detailed scan on open ports: 22,80,8000
</span></span><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-08-22 19:23 CDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.13
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.054s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE     VERSION
</span></span><span style=display:flex><span>22/tcp   open  ssh         OpenSSH 8.9p1 Ubuntu 3ubuntu0.6 <span style=color:#56b6c2>(</span>Ubuntu Linux; protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 3e:ea:45:4b:c5:d1:6d:6f:e2:d4:d1:3b:0a:3d:a9:4f <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> 64:cc:75:de:4a:e6:a5:b4:73:eb:3f:1b:cf:b4:e3:94 <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>80/tcp   open  http        nginx 1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://runner.htb/
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>8000/tcp open  nagios-nsca Nagios NSCA
</span></span><span style=display:flex><span>|_http-title: Site doesn&#39;t have a title <span style=color:#56b6c2>(</span>text/plain; <span style=color:#e06c75>charset</span><span style=color:#56b6c2>=</span>utf-8<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 9.64 seconds
</span></span></code></pre></div><p>The scan discovers three open ports 22 (SSH), 80 (HTTP with Nginx), and 8000 (nagios-nsca).
There is also a redirection to <code>runner.htb</code>.</p><p>Let&rsquo;s update our hosts file.</p><pre tabindex=0><code>sudo echo &#34;10.10.11.13 runner.htb&#34; | sudo tee -a /etc/hosts
</code></pre><h2 id=enumeration>Enumeration</h2><p>We find a company website offering CI/CD solutions at <code>http://runner.htb</code>. This website does not present any features that we can exploit and directory enumeration does not return anything useful for <code>http://runner.htb</code>.</p><p><img src=/images/HTB-Runner/runner-website.png alt="Runner website"></p><p>Moving on to subdomain enumeration, we find <code>teamcity</code> which we add to our <code>/etc/hosts</code> file.</p><pre tabindex=0><code>ffuf -c -w /usr/share/seclists/Discovery/DNS/bitquark-subdomains-top100000.txt -t 100 -u http://runner.htb -H &#34;Host: FUZZ.runner.htb&#34; -ic -fs 154
</code></pre><p><img src=/images/HTB-Runner/ffuf-subdomain.png alt="subdomain enumeration"></p><h2 id=initial-foothold>Initial Foothold</h2><p><code>http://teamcity.runner.htb</code> leads to a login form for TeamCity with version <code>2023.05.3</code>. Researching for specific vulnerabilities we discover <a href=https://www.exploit-db.com/exploits/51884>CVE-2023-42793</a>, allowing us to create a new user with administrative privileges.</p><p><img src=/images/HTB-Runner/teamcity-runner.png alt="teamcity subdomain"></p><p>Using this <a href=https://github.com/H454NSec/CVE-2023-42793>PoC</a> we exploit the vulnerability and create a new admin user with the credentials <code>H454NSec5438:@H454NSec</code>.</p><pre tabindex=0><code>python3 CVE-2023-42793.py -u http://teamcity.runner.htb
</code></pre><p><img src=/images/HTB-Runner/Poc_use.png alt="Poc in use"></p><p>We now login into the TeamCity instance.</p><p><img src=/images/HTB-Runner/teamcity-admin-login.png alt="teamcity subdomain login"></p><p>In the <code>Administration</code> section, under <code>Server Administration</code> we find a <code>Backup</code> option and we use the <code>Start Backup</code> button to begin the process.</p><p><img src=/images/HTB-Runner/backup.png alt="teamcity backup"></p><p><img src=/images/HTB-Runner/backup-start.png alt="teamcity backup start"></p><p>After it&rsquo;s done we can download the archive by clicking on the link.</p><p><img src=/images/HTB-Runner/backup-file.png alt="teamcity backup archive"></p><blockquote><p>After unzipping the archive I couldn&rsquo;t access the files because they didn&rsquo;t have any permissions set, so I changed them recursively on all files.</p></blockquote><pre tabindex=0><code>unzip TeamCity_Backup_20240421_214500.zip &amp;&amp; chmod -R 744 *
</code></pre><p>We end up with several files and folders.</p><p><img src=/images/HTB-Runner/backup-files.png alt="teamcity backup files"></p><p>We find a private SSH key at <code>config/projects/AllProjects/pluginData/ssh_keys/id_rsa</code> but as of now we don&rsquo;t know which user it belongs to.</p><p>We also find a list of users and their password hashes at <code>database_dump/users</code>.</p><blockquote><p><code>admin</code> and <code>matthew</code> are the interesting users here, the other users were created by our exploit.</p></blockquote><p><img src=/images/HTB-Runner/db-users-hashes.png alt="user hashes"></p><p>The hash for <code>admin</code> (john) couldn&rsquo;t be cracked but we successfully recovered the password for <code>matthew</code> which is <code>piper123</code>.</p><pre tabindex=0><code>hashcat -a 0 -m 3200 matthew-hash.txt /usr/share/wordlists/rockyou.txt
</code></pre><p><img src=/images/HTB-Runner/matthew-pwd.png alt="user matthew hash cracked"></p><p>Using the previously found SSH key, we are able to login as <code>john</code> via SSH.</p><p><img src=/images/HTB-Runner/ssh-login-admin.png alt="SSH admin login"></p><pre tabindex=0><code>ssh -i id_rsa john@runner.htb
</code></pre><p><img src=/images/HTB-Runner/john-user.png alt="john user"></p><p>The user flag is at <code>/home/john/user.txt</code>.</p><h2 id=privilege-escaltion>Privilege Escaltion</h2><p>Using <code>linpeas</code> for the system enumeration we find another subdomain that we were unable to discover previously, <code>portainer-administration.runner.htb</code>.</p><p><img src=/images/HTB-Runner/subdomain-intern.png alt="subdomain internal"></p><p>At <code>http://portainer-administration.runner.htb/</code> we are presented with another login form for <code>portainer.io</code>. The credentials <code>matthew:piper123</code> work here!</p><p><img src=/images/HTB-Runner/portainer-login.png alt="portainer login"></p><p>We are unable to modify the current container but we can create new volumes.</p><ol><li>Select the container <code>primary</code> and you will get a drop down menu in the left pane</li></ol><p><img src=/images/HTB-Runner/container-primary.png alt="container primary"></p><ol start=2><li>Click on <code>Volumes</code> then <code>Add volume</code> in the right corner</li></ol><p><img src=/images/HTB-Runner/add-volume.png alt="add volume for conmtainer"></p><ol start=3><li>When creating the volume use the <code>+ add driver option</code> and add the three options below in order to create a root volume.</li></ol><p><img src=/images/HTB-Runner/add_driver_options.png alt="add driver option button"></p><p><img src=/images/HTB-Runner/volume-options.png alt="volume options"></p><ul><li>The <strong>device</strong> option specifies the source path on the host system that will be mounted into the container. In this case, it&rsquo;s set to <code>/</code>, which is the root directory of the host machine.</li><li>The <strong>o</strong> option stands for &ldquo;options,&rdquo; and in this context, <code>bind</code> refers to a &ldquo;bind mount.&rdquo;</li><li>The <strong>type</strong> option defines the type of mount being used. When set to <code>none</code>, it indicates that no specific file system type is being used for this mount.</li></ul><ol start=4><li>In <code>Containers</code> we create a new container with <code>ubuntu</code> as the image name, make sure to check <code>Interactive & TTY (-i -t)</code> for <code>Console</code> under <code>Advanced container settings</code>.</li></ol><p><img src=/images/HTB-Runner/console-interactive.png alt="portainer console"></p><p>Under <code>Volumes</code> click on <code>+map additional volume</code>, for <code>container</code> enter <code>/mnt/root</code> and select the volume you just created, finally deploy the container.</p><p><img src=/images/HTB-Runner/advanced_container_settings_volume.png alt="Advanced container settings, volume section"></p><ol start=5><li>You should now have a new running container</li></ol><p><img src=/images/HTB-Runner/myContainer.png alt="created container"></p><p>Select it and click on <code>Console</code> and then <code>Connect</code>.</p><p><img src=/images/HTB-Runner/console-container.png alt="container status"></p><ol start=6><li>You will login as root and the root flag is at <code>/mnt/root/root/root.txt</code>.</li></ol><p><img src=/images/HTB-Runner/root-flag.png alt="Root flag"></p><h3 id=why-does-this-work>Why does this work?</h3><p>This privilege escalation technique takes advantage of the volume binding feature in Docker, specifically using Portainer.io as a management tool.</p><p>The volume in question is mounted to the container with the root file system (<code>/</code>) as its device and <code>bind</code> as the type. This means that the root file system of the host is being mounted to the container.</p><p>When we create a new container and mount this volume at <code>/mnt/root</code>, it essentially gives the container access to the root directory of the host machine.</p><p>Since the volume is bound to the host&rsquo;s root directory, and we&rsquo;ve logged into the container with an interactive console, we have direct access to the host’s file system from within the container.</p><p>By default, containers typically run as root inside their own environment, and because of the bind mount, this root user inside the container effectively has access to the root directory of the host. This allows us to manipulate or execute files on the host system as if we were the root user of the host, leading to full control over the host machine.</p><h2 id=closing-words>Closing Words</h2><p>I am not proficient with container hacking but this box prompted me to learn more about it. Below you will find a non-exhaustive list of the resources I used.</p><p>First we need to know what is Docker and what it is used for - <a href="https://www.youtube.com/watch?v=pg19Z8LL06w&amp;ab_channel=TechWorldwithNana">Docker Crash Course</a>.</p><p>Then we can learn about Docker exploitation:</p><ul><li><a href=https://www.practical-devsecops.com/lesson-4-hacking-containers-like-a-boss/>Lesson 4: Hacking Containers Like A Boss</a></li><li><a href="https://www.youtube.com/watch?v=IuiJdQsty5k&amp;ab_channel=Docker">Hacking into your containers, and how to stop it!</a></li><li><a href=https://book.hacktricks.xyz/network-services-pentesting/2375-pentesting-docker#privilege-escalation>Pentesting Docker on HackTricks</a></li></ul><p>I hope you enjoyed this write up, thanks for taking the time to read it!</p></div><div class=prev-next><div class=prev-post><p><a href=/posts/htb-iclean/>&#8592;
Previous:
HTB: IClean</a></p><p class=prev-post-date>August 1, 2024</p></div><div class=next-post><p><a href=/posts/thm-summit/>Next:
THM: Summit
&#8594;</a></p><p class=next-post-date>August 29, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#initial-foothold>Initial Foothold</a></li><li><a href=#privilege-escaltion>Privilege Escaltion</a><ul><li><a href=#why-does-this-work>Why does this work?</a></li></ul></li><li><a href=#closing-words>Closing Words</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>