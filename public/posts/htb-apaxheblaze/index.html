<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>HTB Challenge: ApacheBlaze</title>
<meta name=description content="Platform: Hack The Box Link: ApacheBlaze Level: Easy Category: Web CHALLENGE DESCRIPTION Step into the ApacheBlaze universe, a world of arcade clicky games. …"><meta name=keywords content="HackTheBox"><meta property="og:url" content="https://scorpiosec.com/posts/htb-apaxheblaze/"><meta property="og:type" content="website"><meta property="og:title" content="HTB Challenge: ApacheBlaze"><meta property="og:description" content="Platform: Hack The Box Link: ApacheBlaze Level: Easy Category: Web CHALLENGE DESCRIPTION Step into the ApacheBlaze universe, a world of arcade clicky games. …"><meta property="og:image" content="https://scorpiosec.com/redscorpio.jpg"><meta property="og:image:secure_url" content="https://scorpiosec.com/redscorpio.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HTB Challenge: ApacheBlaze"><meta name=twitter:description content="Platform: Hack The Box Link: ApacheBlaze Level: Easy Category: Web CHALLENGE DESCRIPTION Step into the ApacheBlaze universe, a world of arcade clicky games. …"><meta property="twitter:domain" content="https://scorpiosec.com/posts/htb-apaxheblaze/"><meta property="twitter:url" content="https://scorpiosec.com/posts/htb-apaxheblaze/"><meta name=twitter:image content="https://scorpiosec.com/redscorpio.jpg"><link rel=canonical href=https://scorpiosec.com/posts/htb-apaxheblaze/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://scorpiosec.com/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://scorpiosec.com/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/categories/ aria-label><span data-feather=folder></span> Categories</a></div><div class="nav-link language-switcher"><a href=/fr/posts/htb-apaxheblaze/>Français</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://scorpiosec.com/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://scorpiosec.com/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/categories/><span data-feather=folder></span> Categories</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HTB Challenge: ApacheBlaze</h1><small role=doc-subtitle></small><p class=post-date>4 min read |
<span class=post-date>March 1, 2025</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/tags/hackthebox>HackTheBox</a></li></ul></div><div class=post-content><ul><li>Platform: Hack The Box</li><li>Link: <a href=https://app.hackthebox.com/challenges/ApacheBlaze>ApacheBlaze</a></li><li>Level: Easy</li><li>Category: Web</li></ul><hr><h1 id=challenge-description>CHALLENGE DESCRIPTION</h1><p>Step into the ApacheBlaze universe, a world of arcade clicky games. Rumor has it that by playing certain games, you have the chance to win a grand prize. However, before you can dive into the fun, you&rsquo;ll need to crack a puzzle.</p><blockquote><p>ZIP PASSWORD: <code>hackthebox</code></p></blockquote><h2 id=website-enumeration>Website Enumeration</h2><p>At the target IP address we find a website with four different games to play.</p><p><img src=/images/HTB-ApacheBlaze/apacheblaze_website.png alt="ApacheBlaze website"></p><p>Games 1, 2 and 3 are all unavailable. When we click on <code>PLAY</code> for Game 4 we get the message: <code>This game is currently available only from dev.apacheblaze.local.</code>.</p><p><img src=/images/HTB-ApacheBlaze/game4.png alt="Game 4 message"></p><p>The page&rsquo;s source code and directory brute forcing do not reveal anything useful.</p><p>The play button for <code>Game 4</code> sends a GET request to <code>/api/games/click_topia</code>. Sending the request gives us the same message we saw on the application.</p><p><img src=/images/HTB-ApacheBlaze/req_game_access.png alt="game 4 access message in Burp"></p><h2 id=source-code-review>Source Code Review</h2><p>Let&rsquo;s turn our attention to the source code.</p><p>In <code>app.py</code>, we see that the application accepts a <code>game</code> parameter. If the value of <code>game</code> is <code>click_topia</code> (<code>game == click_topia</code>) and the value of <code>X-Forwarded-Host</code> is <code>dev.apacheblaze.local</code>, the flag is revealed.</p><p><img src=/images/HTB-ApacheBlaze/get_flag_method.png alt="Flag obtention method"></p><p>We add the <code>X-Forwarded-Host</code> parameter to the request however sending it does not return the flag.</p><pre tabindex=0><code>X-Forwarded-Host: dev.apacheblaze.local
</code></pre><p><img src=/images/HTB-ApacheBlaze/modified_request.png alt="Modified request with X-Forwarded-Host"></p><p>In <code>http.conf</code> we learn that the application uses a proxy and a load balancer.</p><p>Apache is acting as a reverse-proxy (<code>mod_proxy_http</code>) to forward requests to a load balancer, this is done using a virtual host on port <code>1337</code>.</p><blockquote><p>Using the <code>[P]</code> flag in Apache instructs it to act as a proxy for the request.</p></blockquote><p>The mod_rewrite rule rewrites the request and forwards it to the load balancer on port 8080.
For example a request such as <code>GET /api/games/click_topia</code> is rewritten and forwarded to <code>GET http://127.0.0.1:8080/?game=click_topia</code>.</p><p><img src=/images/HTB-ApacheBlaze/rev_proxy.png alt="Apache Reverse proxy"></p><p>The virtual host on port 8080 sets up a load balancer using <code>mod_proxy_balancer</code>. The requests are sent to an internal backend cluster consisting of two servers at: <code>http://127.0.0.1:8081</code> and <code>http://127.0.0.1:8082</code>.</p><p><img src=/images/HTB-ApacheBlaze/proxy_info.png alt="load balancer setup"></p><p>Using a proxy and a load balancer can potentially introduce desynchronization issues meaning if Apache processes HTTP requests differently than the backend we could manipulate the headers using HTTP Request Smuggling.</p><p>We try to change the host to <code>localhost:1337</code> (the proxy) but still no flag.</p><p><img src=/images/HTB-ApacheBlaze/modified_req2.png alt="Request with modified Host parameter"></p><h3 id=http-request-smuglling-vulnerability>HTTP Request Smuglling Vulnerability</h3><p>In the Docker file we see that <code>httpd version 2.4.55</code> is used. Searching for vulnerabilities for this version leads to the discovery of <a href=https://httpd.apache.org/security/vulnerabilities_24.html>CVE-2023-25690</a> with a PoC <a href=https://github.com/dhmosfunk/CVE-2023-25690-POC>here</a>. The vulnerability is an HTTP Request Smuggling via header injection.</p><p><img src=/images/HTB-ApacheBlaze/httpd_version.png alt="httpd version"></p><p>It is caused by an improper sanitization of incoming headers when <code>mod_proxy</code> is enabled. Attackers are able to inject additional headers using <code>CRLF</code> (<code>\r\n</code>) to break the request boundaries between Apache and the backend.</p><blockquote><p>CRLF (Carriage Return Line Feed) is a sequence of two characters indicating a line break.</p></blockquote><p>So our goal is to append a second request to the first one. Following the PoC example we modify the request and obtain the flag.</p><p><img src=/images/HTB-ApacheBlaze/flag_value.png alt="Working request and flag value"></p><p><strong>FLAG VALUE</strong></p><pre tabindex=0><code>HTB{1t5_4ll_4b0ut_Th3_Cl1ck5}
</code></pre><p>We modified two parameters for the request to work properly:</p><blockquote><p>Here is the non encoded request: <code>GET /api/games/click_topia HTTP/1.1\r\nHost: dev.apacheblaze.local\r\n\r\nGET /HTTP/1.1</code>.</p></blockquote><pre tabindex=0><code>GET /api/games/click_topia%20HTTP/1.1%0d%0aHost:%20dev.apacheblaze.local%0d%0a%0d%0aGET%20/ HTTP/1.1


Host: localhost:1337
</code></pre><h2 id=explanation>Explanation</h2><ol><li>The initial request is sent to the Apache Proxy (port 1337).</li></ol><p>We are sending two HTTP requests in one. Apache only processes up to the first <code>\r\n\r\n</code> boundary, meaning it only processes the first part of the request (<code>GET /api/games/click_topia%20HTTP/1.1</code>). The smuggled <code>Host: dev.apacheblaze.local</code> is treated as part of the request body by Apache. The second GET request (<code>GET / HTTP/1.1</code>) is forwarded to Flask without modification.</p><ol start=2><li>The request is forwarded to the load balancer on port 8080.</li></ol><p>The load balancer sends the request to one of the backend servers (either port 8081 or 8082), but the second, smuggled request is effectively injected into the request flow because Apache failed to process it properly.</p><ol start=3><li>The Flask application processes the request.</li></ol><p>The application checks the condition <code>if request.headers.get('X-Forwarded-Host') == 'dev.apacheblaze.local'</code>. However, we did not explicitly send <code>X-Forwarded-Host: dev.apacheblaze.local</code>. Instead, Apache automatically added <code>X-Forwarded-Host: dev.apacheblaze.local</code> when processing the first request before forwarding it to the backend.</p><p>Now, because of HTTP request smuggling, the backend (Flask) interprets the second smuggled request (<code>GET / HTTP/1.1</code>) as part of the same connection. Since Flask processes multiple requests over the same connection without resetting headers, the second request inherits the headers from the first request, including: <code>X-Forwarded-Host: dev.apacheblaze.local</code>.</p><ol start=4><li>The flag is returned.</li></ol><p>Flask responds with the flag because the <code>X-Forwarded-Host</code> header matches the expected value (<code>dev.apacheblaze.local</code>).</p><blockquote><p><strong>NOTE:</strong> When Apache is acting as a reverse proxy, it automatically adds several headers for forwarding purposes, including <code>X-Forwarded-Host</code>, which mirrors the original Host header from the client request. Apache inserts it during the reverse proxy process. This allows the backend Flask application to see the smuggled header and perform the security check against it. <em>Read more about it <a href=https://httpd.apache.org/docs/2.4/mod/mod_proxy.html#page-header>here</a>.</em></p></blockquote></div><div class=prev-next><div class=prev-post><p><a href=/posts/thm-rabbit_store/>&#8592;
Previous:
THM: Rabbit Store</a></p><p class=prev-post-date>February 25, 2025</p></div><div class=next-post><p><a href=/posts/htb-chemistry/>Next:
HTB: Chemistry
&#8594;</a></p><p class=next-post-date>March 7, 2025</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><a href=#challenge-description>CHALLENGE DESCRIPTION</a><ul><li><a href=#website-enumeration>Website Enumeration</a></li><li><a href=#source-code-review>Source Code Review</a><ul><li><a href=#http-request-smuglling-vulnerability>HTTP Request Smuglling Vulnerability</a></li></ul></li><li><a href=#explanation>Explanation</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2025 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>